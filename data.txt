package IVD_Batch;



import egl.core.deleteafteruse;

import CommonMigratedParts.*;

import DataItems.*;

import DataTables.*;



//*** PROGRAM=DCP27A ****

// COMPONENT NAME: DCP27A :  DCP27A - CALLED BATCH

// ===============

// 

// DESCRIPTION:

// ============

// This application takes place during case initiation only.

// It calls various modules (DCM05A, DCM06A, DCM07A) to perform

// the case assignment and complete the case initiation process

// 

// 

// ***********************



program DCP27A type basicProgram //VAGen Info - called batch program

(VDBCONTROL VDBCONTROL, // record

        VMESSAGE VMESSAGE, // record

        DCP27W DCP27W, // record

        GNOMADS GNOMADS, // record

        G-IV-D G-IV-D // record

){includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes}



    // Data Declarations

    CEP02W CEP02W; // record

    DCM05W1 DCM05W1; // record

    DCP27W2 DCP27W2; // record

    DFMBTCH-XFER DFMBTCH-XFER; // record

    DFMPOP-TRANSFER DFMPOP-TRANSFER; // record

    H-TCDTSL H-TCDTSL; // record

    H-TICCC6 H-TICCC6; // record

    H-TIDCQ7 H-TIDCQ7; // record

    H-TJHSCA H-TJHSCA; // record

    H-TOFFSB H-TOFFSB; // record

    H-TPAHQ1 H-TPAHQ1; // record

    H2-2-EMP-JHS H2-2-EMP-JHS; // record

    H2-2-PAH-PER H2-2-PAH-PER; // record

    H2-3-COR-DCN-DOC H2-3-COR-DCN-DOC; // record

    H2-DOCKET H2-DOCKET; // record

    H2-EMPLOYER H2-EMPLOYER; // record

    H2-FRM-CASE-TRKNG H2-FRM-CASE-TRKNG; // record

    H2-IVD-CASELD-CASE H2-IVD-CASELD-CASE; // record

    H2-JOB-HISTORY H2-JOB-HISTORY; // record

    H2-NCP-EXG-SUP-DTL H2-NCP-EXG-SUP-DTL; // record

    H2-PERSON H2-PERSON; // record

    H2-PERSON-ADRS-HST H2-PERSON-ADRS-HST; // record

    H3-IVD-CASE-CHD H3-IVD-CASE-CHD; // record

    PCAL16A-INP PCAL16A-INP; // record

    PCALINP PCALINP; // record

    PDCM-ASGN-CASELD PDCM-ASGN-CASELD; // record

    PDCM-ASGN-JURIS PDCM-ASGN-JURIS; // record

    VDBCOMMON VDBCOMMON; // record

    VSTRREC4 VSTRREC4; // record

    

    // VAGen Info - items needed for migration

    VAGen_EZESYS char(8);

    VAGen_EZEREPLY num(1);

    VAGen_EZE_WAIT_TIME bin(9, 2);

    VAGen_EZE_ITEMLEN int;



    // Use Declarations

    use VDB00T1{deleteAfterUse = yes}; // table

    

    function main()

    // VAGen Info - initialization needed for migration

        VAGen_EZESYS = VGLib.getVAGSysType();

    DCP27P1-MAIN:

        DCP27P1-MAIN();

    end // end main

end // end DCP27A



// MAIN PROCESS



function DCP27P1-MAIN()

/*  */

    set DCP27W2 empty;

    set H-TIDCQ7 empty;

    set H-TICCC6 empty;

    /* this query is required to get cst upi*/

    /* used for Per-adres-hst table*/

    H-TIDCQ7.NCP-UPI = DCP27W.PI1-NCP-UPI;

    H-TIDCQ7.CASE-SUFX = DCP27W.PI1-CASE-SUFX;

    call "TIDCQ7A"(VDBCONTROL, VMESSAGE, H-TIDCQ7){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

    DCP27P9-CHK-RCASE();



    if(DCP27W2.WS-RESPONDING-CASE-FLG == "Y")



        /* the caseld_case table is checked first so  that if a record is*/

        /* present then the locate case will be assigned to the existing*/

        /* jurisdiction and not to office '99'*/



        WS-CASELD-FOUND-FLAG = "N";

        /* the above flag will be set to 'y' if a caseld_case record is found.*/



        DCP27P9-CHK-CSLD();



        if(WS-CASELD-FOUND-FLAG == "N")

            /*  */

            DCP27P9-GET-NCCNTY();

        end

    else

        H-TICCC6.WS-CST-UPI = H-TIDCQ7.CST-UPI;

        H-TICCC6.WS-FUNC-AREA-CD = H-TIDCQ7.FUNC-AREA-CD;

        /*  */

        H-TICCC6.UPI = DCP27W.PI1-NCP-UPI;

        H-TICCC6.CASE-SUFX = DCP27W.PI1-CASE-SUFX;

        /* select required from ivd-caseld-casetbl*/

        /* logoc to perform get-cst and move data is in dbappl.*/

        call "TICCC6A"(VDBCONTROL, VMESSAGE, H-TICCC6){isNoRefresh = yes};

        if(VDBCONTROL.URC > 104)

            exit program;

        end

        DCP27W2.WS-NCP-CNTY = H-TICCC6.WS-NCP-CNTY;

        DCP27W2.WS-CST-CNTY = H-TICCC6.WS-CST-CNTY;



    end

    /*  */

    if(H-TIDCQ7.FUNC-AREA-CD == "N")

    /*  */

    else

        DCM05W1.PI1-CASE-ID = DCP27W.PI1-IV-D-CASE-ID;

        /*  */

        DCM05W1.PI1-MANUAL-IND = DCP27W.PI1-PDCM-MANUAL-IND;

        /*  */

        DCM05W1.PI1-PROC-DATE = DCP27W.PI1-PROC-DATE;

        /*  */

        call "DCM05A"(VDBCONTROL, VMESSAGE, DCM05W1, GNOMADS,

                G-IV-D){isNoRefresh = yes};

        if(VDBCONTROL.URC > 104)

            exit program;

        end

    end

    /*  */

    PDCM-ASGN-JURIS.PO2-CASE-ID = DCP27W.PI1-IV-D-CASE-ID;

    PDCM-ASGN-JURIS.PO2-FOR-WHOM = "C";

    PDCM-ASGN-JURIS.PO2-REPLACING-COUNTY = DCP27W2.WS-CST-CNTY;

    /*  */

    PDCM-ASGN-JURIS.PO2-PDCM-MANUAL-IND = DCP27W.PI1-PDCM-MANUAL-IND;

    PDCM-ASGN-JURIS.PO2-PROC-DATE = DCP27W.PI1-PROC-DATE;

    call "DCM06A"(VDBCONTROL, VMESSAGE, PDCM-ASGN-JURIS, GNOMADS,

            G-IV-D){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    if(DCP27W2.WS-NCP-CNTY != " ")

        PDCM-ASGN-JURIS.PO2-FOR-WHOM = "N";

        PDCM-ASGN-JURIS.PO2-REPLACING-COUNTY = DCP27W2.WS-NCP-CNTY;

        PDCM-ASGN-JURIS.PO2-PDCM-MANUAL-IND = DCP27W.PI1-PDCM-MANUAL-IND;

        PDCM-ASGN-JURIS.PO2-PROC-DATE = DCP27W.PI1-PROC-DATE;

        /*  */

        call "DCM06A"(VDBCONTROL, VMESSAGE, PDCM-ASGN-JURIS, GNOMADS,

                G-IV-D){isNoRefresh = yes};

        if(VDBCONTROL.URC > 104)

            exit program;

        end

    end

    /*  */

    PDCM-ASGN-CASELD.PO3-NCP-UPI = DCP27W.PI1-NCP-UPI;

    PDCM-ASGN-CASELD.PO3-CASE-SUFX = DCP27W.PI1-CASE-SUFX;

    if(DCP27W.PI1-OFC-CNTY-CD == " ")

        PDCM-ASGN-CASELD.PO3-FOR-WHOM = "C";

        /*  */

        PDCM-ASGN-CASELD.PO3-RSP-CNTY = DCP27W2.WS-CST-CNTY;

        /*  */

        PDCM-ASGN-CASELD.PO3-PDCM-MANUAL-IND = DCP27W.PI1-PDCM-MANUAL-IND;

        PDCM-ASGN-CASELD.PO3-PROC-DATE = DCP27W.PI1-PROC-DATE;

        /*  */

        call "DCM07A"(VDBCONTROL, VMESSAGE,

                PDCM-ASGN-CASELD){isNoRefresh = yes};

        if(VDBCONTROL.URC > 104)

            exit program;

        end

    end

    if(DCP27W2.WS-NCP-CNTY != " ")

        PDCM-ASGN-CASELD.PO3-FOR-WHOM = "N";

        PDCM-ASGN-CASELD.PO3-RSP-CNTY = DCP27W2.WS-NCP-CNTY;

        PDCM-ASGN-CASELD.PO3-PDCM-MANUAL-IND = DCP27W.PI1-PDCM-MANUAL-IND;

        PDCM-ASGN-CASELD.PO3-PROC-DATE = DCP27W.PI1-PROC-DATE;

        call "DCM07A"(VDBCONTROL, VMESSAGE,

                PDCM-ASGN-CASELD){isNoRefresh = yes};

        if(VDBCONTROL.URC > 104)

            exit program;

        end

    end



    DCP27P9-CREAT-ALRT();

    DCP27P9-GEN-FORMS();



    exit program;

end // end DCP27P1-MAIN



// CREATE ALERTS ON FUNC AREA



function DCP27P9-CHILDORDER()

/*  */

    DCP27P9-DAA-S14Q1();

    if(DCP27W2.WS-COUNT == 0)

        DCP27W2.WS-ORDER-FOUND = "N";

    else

        DCP27W2.WS-ORDER-FOUND = "Y";

    end

    /*  */

end // end DCP27P9-CHILDORDER



// Control Retrieve of Data



function DCP27P9-CHK-CSLD()

    if(H-TIDCQ7.FUNC-AREA-CD == "N")

        DCP27W2.WS-CST-CNTY = "99";

        DCP27W2.WS-NCP-CNTY = "99";

        return;

    end



    /* Perform standard database application initialization*/

    WDB00PI();

    /* Initialize:*/

    /* UACCTYP - Access type (R=read, W=write)*/

    /* UAPPLNAM - Application name*/

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /* Initialize SQL row record*/

    set H2-IVD-CASELD-CASE empty;

    /*  */

    /* Move retrieve key value to SQL row record*/

    H2-IVD-CASELD-CASE.UPI = DCP27W.PI1-NCP-UPI;

    H2-IVD-CASELD-CASE.CASE-SUFX = DCP27W.PI1-CASE-SUFX;



    /* Perform process to retrieve data*/

    DCP27P9-GET-CSLD();

    if(sysVar.sqlData.sqlcode == 0)

        DCP27P9-SCAN-CSLD();

    end

    while(sysVar.sqlData.sqlcode == 0)

        WS-CASELD-FOUND-FLAG = "Y";

        /* Move retrieved data to passed record*/

        /* FOR EVERY RETRIEVED RECORD*/

        if(H2-IVD-CASELD-CASE.CASELD-IND == "C")

            DCP27W2.WS-CST-CNTY = H2-IVD-CASELD-CASE.RSP-CNTY;

        /* MOVE H2-IVD-CASELD-CASE.RSP-CNTY TO H-TICCC6.RSP-CNTY;*/

        else

            DCP27W2.WS-NCP-CNTY = H2-IVD-CASELD-CASE.RSP-CNTY;

        end

        /* next data*/

        DCP27P9-SCAN-CSLD();

    /* Data retrieved successfully*/

    end



    if(DCP27W2.WS-NCP-CNTY == "99")

        WS-CASELD-FOUND-FLAG = "N";

    end

    /* Set error control flags*/

    /* UNRF - No record found flag (Y,N,1)*/

    /* UDUP - Duplicate key flag (Y,N)*/

    VDBCOMMON.UNRF = "1";

    VDBCOMMON.UDUP = "N";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    /*  */

end // end DCP27P9-CHK-CSLD



// CHECK FOR RESPONDING CASES



function DCP27P9-CHK-RCASE()

/* PTR 10671 START*/

    DCP27P9-GET-CSTUPI();

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    if(H2-PERSON.SSN == "777000001")

        DCP27W2.WS-RESPONDING-CASE-FLG = "Y";

        return;

    end

    /* PTR 10671 END*/

    /* PTR 6262 START*/

    set H2-2-PAH-PER empty;

    H2-2-PAH-PER.UPI = H-TIDCQ7.CST-UPI;

    DCP27P9-CL1();

    if(VDBCONTROL.URC > 104)

        exit program;

    end



    if(VDBCONTROL.URC == 0)

        H-TICCC6.WS-SSN = DCP27W2.WS-SSN;

    end



    if(VDBCONTROL.URC == 100)

        if(H-TIDCQ7.FUNC-AREA-CD == "N")

            DCP27W2.WS-RESPONDING-CASE-FLG = "Y";

        else

            if(DCP27W2.WS-ST-CD == "NV")

                DCP27W2.WS-RESPONDING-CASE-FLG = "N";

            else

                DCP27W2.WS-RESPONDING-CASE-FLG = "Y";

            end

        end

    else

        if(DCP27W2.WS-ST-CD == "NV")

            DCP27W2.WS-RESPONDING-CASE-FLG = "N";

        else

            DCP27W2.WS-RESPONDING-CASE-FLG = "Y";

        end

    end

end // end DCP27P9-CHK-RCASE



// check if direct pay exists



function DCP27P9-CHKDIR-PAY()

/*  */

    WDB00PI();

    /*  */

    /* Initialize:*/

    /* UACCTYP - Access type (R=read, W=write)*/

    /* UAPPLNAM - Application name*/

    VDBCONTROL.UACCTYP = "R";



    VDBCOMMON.USQLREC = "H2-NCP-EXG-SUP-DTL";

    VDBCONTROL.UPROC-OBJ = "H2-NCP-EXG-SUP-DTL";

    VDBCONTROL.UPROC-NM = "DCP27P9-CHKDIR-PAY";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    try

        get H2-NCP-EXG-SUP-DTL

                with #sql{

        select PYMT_TO_CST_IND

        from TWNNCP_EXG_SUP_DTL T1

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

        WHERE NCP_UPI           = :NCP-UPI

        AND  CST_UPI            = :CST-UPI

        AND  SUPRT_INF_VRFD_IND = 'Y'

        AND  SUPRT_ESTD_IND     = 'Y'

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into PYMT-TO-CST-IND;

    end

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* Perform process to retrieve data*/

    /* Set error control lags*/

    /* UNRF - No record found flag (Y,N,1)*/

    /* UDUP - Duplicate key flag (Y,N)*/

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    /*  */

end // end DCP27P9-CHKDIR-PAY



// LUW for DB Access



function DCP27P9-CL1()

/* CBSI START*/

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    DCP27P9-CP1();

    if(DCP27W2.WS-EXIT-FLAG == "Y")

        return;

    end

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    /* CBSI END*/

end // end DCP27P9-CL1



// Control Retrieve of Data



function DCP27P9-CP1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/* CBSI START*/

    DCP27P9-CQ1();

    while(sysVar.sqlData.sqlcode == 0)

        DCP27P9-CQS();

        if(sysVar.sqlData.sqlcode == 0)

            DCP27W2.WS-CITY = H2-2-PAH-PER.CITY;

            DCP27W2.WS-ST-CD = H2-2-PAH-PER.ST-CD;

            DCP27W2.WS-SSN = H2-2-PAH-PER.SSN;

            DCP27W2.WS-EXIT-FLAG = "Y";

            return;

        end

    end

    /* CBSI END*/

end // end DCP27P9-CP1



// SETINQ H2-2-PAH-PER



function DCP27P9-CQ1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* 5/1/15      WI 2920     Select only status 'V', not "'C' or 'V'" */

/* 6/19/15     WI 3042     Undo last change and add 'P', remove 'CR' & 'CM' */
/* 9/9/15      WI 3155     Add PRD_END_DT, ADR_TYPE                     */

/* -----------------------------------------------------------*/

/* CBSI START*/

/*  */

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-2-PAH-PER";

    VDBCONTROL.UPROC-OBJ = "H2-2-PAH-PER";

    VDBCONTROL.UPROC-NM = "DCP27P9-PAHPERCQ1";

    VDBCONTROL.UPROC-OPT = "SETINQ";

    /*  */

    try

        open DCP27P9-CQ1_RSI01

                with #sql{

        select T1.CITY,

            T1.ST_CD,

            T1.ADR_TYPE,

            T2.SSN

        from TWNPERSON_ADRS_HST T1,

             TWNPERSON T2

        WHERE

          T1.UPI          = :H2-2-PAH-PER.UPI AND

          T1.ADR_STS in ('C', 'P', 'V')       AND

          T1.ST_CD = 'NV'                     AND
          T1.PRD_END_DT > CURRENT_DATE        AND
          T1.ADR_TYPE <> 'BI'                 AND

          T1.UPI          = T2.UPI

        ORDER BY ADR_TYPE DESC

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into CITY, ST-CD, ADR-TYPE, SSN for H2-2-PAH-PER;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* CBSI END*/

end // end DCP27P9-CQ1



// SCAN H2-2-PAH-PER



function DCP27P9-CQS()

/* -----------------------------------------------------------*/

/* This process SCANs the retrieved rows from the previous SETINQ.*/

/*  */

/*  */

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/* CBSI START*/

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-2-PAH-PER";

    VDBCONTROL.UPROC-OBJ = "H2-2-PAH-PER";

    VDBCONTROL.UPROC-NM = "DCP27P9-PAHPERCQS";

    VDBCONTROL.UPROC-OPT = "SCAN";

    /*  */

    try

        get next H2-2-PAH-PER;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* CBSI END*/

end // end DCP27P9-CQS



// CREATE ALERTS ON FUNC AREA



function DCP27P9-CREAT-ALRT()

/*  */

    set PCALINP empty;

    set PCAL16A-INP empty;

    set DCP27W2 empty;

    set H-TIDCQ7 empty;

    /*  */

    H-TIDCQ7.NCP-UPI = DCP27W.PI1-NCP-UPI;

    H-TIDCQ7.CASE-SUFX = DCP27W.PI1-CASE-SUFX;

    call "TIDCQ7A"(VDBCONTROL, VMESSAGE, H-TIDCQ7){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

    DCP27W2.WS-NCP-UPI = DCP27W.PI1-NCP-UPI;

    DCP27W2.WS-CASE-SUFX = DCP27W.PI1-CASE-SUFX;

    DCP27W2.WS-FUNC-AREA-CD = H-TIDCQ7.FUNC-AREA-CD;

    DCP27W2.WS-CASE-TYPE = H-TIDCQ7.CASE-TYPE;

    DCP27W2.WS-PROC-DATE = DCP27W.PI1-PROC-DATE;

    /*  */

    PCALINP.PAL-UPI = DCP27W2.WS-NCP-UPI;

    PCALINP.PAL-SUFFIX = DCP27W2.WS-CASE-SUFX;

    /*  */

    if(DCP27W2.WS-FUNC-AREA-CD == "P")

        PCALINP.PAL-ALERT-ACTION = "C";

        PCALINP.PAL-ALERT-CD = 330004;



        DCP27S01-CAL11();



    end



    if(DCP27W2.WS-FUNC-AREA-CD == "O")



        PCALINP.PAL-ALERT-ACTION = "C";

        PCALINP.PAL-ALERT-CD = 340006;



        DCP27S01-CAL11();



    end



    if(DCP27W2.WS-FUNC-AREA-CD == "E")

        /*  */

        DCP27P9-ORDEREXIST();

        if(DCP27W2.WS-ORDER-FOUND == "N")

            /*  */

            PCALINP.PAL-ALERT-ACTION = "C";

            PCALINP.PAL-ALERT-CD = 370042;



            DCP27S01-CAL11();

        end



    end



    if(DCP27W2.WS-FUNC-AREA-CD == "L")

        if(DCP27W2.WS-CASE-TYPE == "N" || DCP27W2.WS-CASE-TYPE ==

                        "Q" /* PTR  10389*/ || DCP27W2.WS-CASE-TYPE == "D")

            PCALINP.PAL-ALERT-ACTION = "D";

            PCALINP.PAL-ALERT-CD = 320106;



            DCP27S01-CAL11();



            PCALINP.PAL-ALERT-ACTION = "C";

            PCALINP.PAL-ALERT-CD = 320105;



            DCP27S01-CAL11();



        else

            PCALINP.PAL-ALERT-ACTION = "D";

            PCALINP.PAL-ALERT-CD = 320105;



            DCP27S01-CAL11();



            PCALINP.PAL-ALERT-ACTION = "C";

            PCALINP.PAL-ALERT-CD = 320106;



            DCP27S01-CAL11();



        end



    end

    /*  */

    if(DCP27W2.WS-CASE-TYPE != "D")

        DCP27P9-OUST-ALRT();

        DCP27P9-PRC-CHDALT();

    end

end // end DCP27P9-CREAT-ALRT



// INQURY Message Text Data



function DCP27P9-DAA-S14Q1()

/*  */

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    set H2-3-COR-DCN-DOC empty;

    /*  */

    H2-3-COR-DCN-DOC.CHD-UPI = H3-IVD-CASE-CHD.CHD-UPI;

    /*  */

    H2-3-COR-DCN-DOC.NCP-UPI = DCP27W2.WS-NCP-UPI;

    H2-3-COR-DCN-DOC.CASE-SUFX = DCP27W2.WS-CASE-SUFX;

    /*  */

    VDBCOMMON.USQLREC = "H2-3-COR-DCN-DOC";

    VDBCONTROL.UPROC-OBJ = "H2-3-COR-DCN-DOC";

    VDBCONTROL.UPROC-NM = "DCP27A";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    try

        get H2-3-COR-DCN-DOC singleRow

                with #sql{

        select COUNT(*)

        from TWNCOURT_ORDR T1,

             TWNIVD_CHILD_FIN T2,

             TWNDOCKET T3

        WHERE T2.CHD_UPI = :CHD-UPI

        AND T2.NCP_UPI   = :NCP-UPI

        AND T2.CASE_SUFX = :CASE-SUFX

        AND T2.CHD_ACTIVE_IND = 'Y'

        AND T3.DCKT_NMB = T2.DCKT_NMB

        AND T1.DCKT_NMB = T3.DCKT_NMB

        AND T1.SQNC_NMB = T3.LST_SQNC_NMB

        AND T1.ORDER_STS = 'A'

        WITH UR

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into DCP27W2.WS-COUNT;

    end

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    if(sysVar.sqlData.sqlcode == 100) /* JUST IN CASE!*/

        DCP27W2.WS-COUNT = 0;

    end

    /*  */

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

end // end DCP27P9-DAA-S14Q1



// INQURY Message Text Data



function DCP27P9-DAA-S15Q1()

/*  */

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    set H2-DOCKET empty;

    /*  */

    H2-DOCKET.UPI = DCP27W2.WS-NCP-UPI;

    H2-DOCKET.CASE-SUFX = DCP27W2.WS-CASE-SUFX;

    /* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-DOCKET";

    VDBCONTROL.UPROC-OBJ = "H2-DOCKET";

    VDBCONTROL.UPROC-NM = "DCP27P9-DAA-S15Q1";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    try

        get H2-DOCKET

                with #sql{

        select T1.UPI

        from twndocket T1

        , TWNCOURT_ORDR T2

        WHERE T1.UPI = :UPI

         AND  T1.CASE_SUFX = :CASE-SUFX

         AND  T1.DCKT_NMB = T2.DCKT_NMB

         AND  T1.LST_SQNC_NMB = T2.SQNC_NMB

         AND  T2.ORDER_STS = 'A'

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into UPI;

    end

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /*  */

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

end // end DCP27P9-DAA-S15Q1



// Generate Child Alert



function DCP27P9-DEL-CHDALT()

/*  */

    set PCAL16A-INP empty;

    PCAL16A-INP.PCAL16A-UPI = DCP27W2.WS-NCP-UPI;

    PCAL16A-INP.PCAL16A-CASE-SUFX = DCP27W2.WS-CASE-SUFX;

    PCAL16A-INP.PCAL16A-PARTICIPANT-UPI = H3-IVD-CASE-CHD.CHD-UPI;

    PCAL16A-INP.PCAL16A-ALERT-ACTION = "D";

    PCAL16A-INP.PCAL16A-PROCESS-DT = DCP27W2.WS-PROC-DATE;

    PCAL16A-INP.PCAL16A-ALERT-CD = 330005;

    call "CAL16A"(VDBCONTROL, VMESSAGE, PCAL16A-INP){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end



    set PCAL16A-INP empty;

    PCAL16A-INP.PCAL16A-UPI = DCP27W2.WS-NCP-UPI;

    PCAL16A-INP.PCAL16A-CASE-SUFX = DCP27W2.WS-CASE-SUFX;

    PCAL16A-INP.PCAL16A-PARTICIPANT-UPI = H3-IVD-CASE-CHD.CHD-UPI;

    PCAL16A-INP.PCAL16A-ALERT-ACTION = "D";

    PCAL16A-INP.PCAL16A-PROCESS-DT = DCP27W2.WS-PROC-DATE;

    PCAL16A-INP.PCAL16A-ALERT-CD = 340009;

    call "CAL16A"(VDBCONTROL, VMESSAGE, PCAL16A-INP){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

end // end DCP27P9-DEL-CHDALT



// GET EMPLR/AGNT STATE CD



function DCP27P9-EMPLR-L1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 12 MAY 1997   PTR 9287     CREATION*/

/* -----------------------------------------------------------*/

/*  */

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    DCP27P9-EMPLR-Q1();

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

end // end DCP27P9-EMPLR-L1



// GET EMPLR/AGNT STATE CD



function DCP27P9-EMPLR-Q1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/*  */

/*  */

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-EMPLOYER";

    VDBCONTROL.UPROC-OBJ = "H2-EMPLOYER";

    VDBCONTROL.UPROC-NM = "DCP27P9-EMPLR-Q1";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    /*  */

    try

        get H2-EMPLOYER

                with #sql{

        select ST_CD,

           CITY,

           AGNT_CITY,

           AGNT_ST

        from TWNEMPLOYER T1

        WHERE EMPLR_ID = :EMPLR-ID

           AND (ST_CD = 'NV' OR AGNT_ST  = 'NV' )

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into ST-CD, CITY, AGNT-CITY, AGNT-ST;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /*  */

end // end DCP27P9-EMPLR-Q1



// LUW for DB Access



function DCP27P9-FCRSL1()

/* -----------------------------------------------------------*/

/*  */

/* Perform standard database application initialization*/

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    /*  */

    VDBCOMMON.UAPPLNAM = "DCP27A";



    /*  */

    /* Perform process to retrieve data*/

    /* >> Change process to the name of your database access process*/

    DCP27P9-FCRSP1();

    /*  */

    /* Set error control flags*/

    /* UNRF - No record found flag (Y,N,1)*/

    /* UDUP - Duplicate key flag (Y,N)*/

    /*  */

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

end // end DCP27P9-FCRSL1



// Control Retrieve of Data



function DCP27P9-FCRSP1()

/* -----------------------------------------------------------*/

/* Move retrieve key value to SQL row record*/

/* Perform process to retrieve data*/

/*  */

    DCP27P9-FCRSQ1();

    /*  */

    /* If data retrieved successfully, continue*/

end // end DCP27P9-FCRSP1



// INQURY Message Text Data



function DCP27P9-FCRSQ1()

/* -----------------------------------------------------------*/

/* This process performs an INQUIRY on the Message Text*/

/* table to read a row of sample test data.*/

/*  */

/* Remember to retieve only those columns required by your*/

/* application.*/

/*  */

/*  */

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-FRM-CASE-TRKNG";

    VDBCONTROL.UPROC-OBJ = "H2-FRM-CASE-TRKNG";

    VDBCONTROL.UPROC-NM = "DCP27P9-FCRSQ1";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    /*  */

    try

        get H2-FRM-CASE-TRKNG singleRow

                with #sql{

        select COUNT(*)

        from TWNFRM_CASE_TRKNG T1

        WHERE

        NCP_UPI = :NCP-UPI AND

        FORM_ID = :FORM-ID

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into DCP27W2.WS-FORM-COUNT;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

end // end DCP27P9-FCRSQ1



// Generate Child Alert



function DCP27P9-GEN-CHDALT()

    if(H3-IVD-CASE-CHD.FUNC-AREA-CD != "L")

        set PCAL16A-INP empty;

        PCAL16A-INP.PCAL16A-UPI = DCP27W2.WS-NCP-UPI;

        PCAL16A-INP.PCAL16A-CASE-SUFX = DCP27W2.WS-CASE-SUFX;

        PCAL16A-INP.PCAL16A-PARTICIPANT-UPI = H3-IVD-CASE-CHD.CHD-UPI;

        PCAL16A-INP.PCAL16A-ALERT-ACTION = "C";

        PCAL16A-INP.PCAL16A-PROCESS-DT = DCP27W2.WS-PROC-DATE;

        if(H3-IVD-CASE-CHD.PATRN-STS-CD == "I")

            PCAL16A-INP.PCAL16A-ALERT-CD = 330005;

            call "CAL16A"(VDBCONTROL, VMESSAGE,

                    PCAL16A-INP){isNoRefresh = yes};

            if(VDBCONTROL.URC > 104)

                exit program;

            end

            /*  */

            PCAL16A-INP.PCAL16A-ALERT-CD = 340012;

            call "CAL16A"(VDBCONTROL, VMESSAGE,

                    PCAL16A-INP){isNoRefresh = yes};

            if(VDBCONTROL.URC > 104)

                exit program;

            end

        /*  */

        else

            DCP27P9-CHILDORDER();

            if(DCP27W2.WS-ORDER-FOUND == "N")

                PCAL16A-INP.PCAL16A-ALERT-CD = 340009;

                call "CAL16A"(VDBCONTROL, VMESSAGE,

                        PCAL16A-INP){isNoRefresh = yes};

                if(VDBCONTROL.URC > 104)

                    exit program;

                end

                /*  */

                PCAL16A-INP.PCAL16A-ALERT-CD = 340013;

                call "CAL16A"(VDBCONTROL, VMESSAGE,

                        PCAL16A-INP){isNoRefresh = yes};

                if(VDBCONTROL.URC > 104)

                    exit program;

                end

            end

        end

    else

        DCP27P9-DEL-CHDALT();

    end

end // end DCP27P9-GEN-CHDALT



// tracking / generate forms



function DCP27P9-GEN-FORMS()

/* Change History*/

/* ==============*/

/* Date      Pgr         Description*/

/* -------   ---         -----------*/

/* 09-23-94  TBS303      APPLICATION SPECIFIC*/

/* 11/14/96 RKennedy PTR 7514  FORMS - 1st name , middle, last*/

/* ptr 11981 form gn0004 to be generated if ncp direct pay exists*/

/*  */

/* 03-13-98  P.Walkins   WI#13441*/

/* Need to print the changed report, GN0004, for the NCP and CST.*/

/* Need the SSN for the NCP and CST.  Have all info. for on-line*/

/* application but need to add it for the CST.*/

/* -------------------------------------------*/

/* 08-03-98  C Strohofer  WI#14403*/

/* Logic to print form GN0004 moved out of DCM05A and put into DCP27A*/

/* -------------------------------------------*/



    if(H-TIDCQ7.FUNC-AREA-CD == "E" || H-TIDCQ7.FUNC-AREA-CD == "O")

        /* ptr 11981 start*/

        set H2-NCP-EXG-SUP-DTL empty;

        H2-NCP-EXG-SUP-DTL.CST-UPI = H-TIDCQ7.CST-UPI;

        H2-NCP-EXG-SUP-DTL.NCP-UPI = DCP27W.PI1-NCP-UPI;

        DCP27P9-CHKDIR-PAY();



        if(H2-NCP-EXG-SUP-DTL.PYMT-TO-CST-IND == "Y")

            /* ptr 11981 end*/

            if(H-TIDCQ7.CASE-TYPE == "A" || H-TIDCQ7.CASE-TYPE == "C" ||

                    H-TIDCQ7.CASE-TYPE == "E" || H-TIDCQ7.CASE-TYPE == "F" ||

                    H-TIDCQ7.CASE-TYPE == "M")

                set H2-FRM-CASE-TRKNG empty;

                DCP27W2.WS-FORM-COUNT = 0;

                H2-FRM-CASE-TRKNG.NCP-UPI = DCP27W.PI1-NCP-UPI;

                H2-FRM-CASE-TRKNG.FORM-ID = "GN0003";

            else

                /* IF H-TIDCSD.CASE-TYPE = 'N'  PW (do this for all case types now)*/

                /* OR H-TIDCSD.CASE-TYPE = 'D';*/

                set H2-FRM-CASE-TRKNG empty;

                DCP27W2.WS-FORM-COUNT = 0;

                H2-FRM-CASE-TRKNG.NCP-UPI = DCP27W.PI1-NCP-UPI;

                H2-FRM-CASE-TRKNG.FORM-ID = "GN0004";

            end



            DCP27P9-FCRSL1();

            if(VDBCONTROL.URC > 104)

                exit program;

            end



            if(DCP27W2.WS-FORM-COUNT == 0)

                if(sysVar.systemType is zoscics)

                    DFMPOP-TRANSFER.PO1-LENGTH = 9801;

                    DFMPOP-TRANSFER.PO1-TRANID = "WM01";

                    DFMPOP-TRANSFER.PO1-TRID-FILLER = " ";

                    DFMPOP-TRANSFER.PIO-FORM-ID = H2-FRM-CASE-TRKNG.FORM-ID;

                    DFMPOP-TRANSFER.PIO-MODE-IND = "D";

                    DFMPOP-TRANSFER.PIO-OFC-CNTY-CD = G-IV-D.G-OFC-CNTY-CD;

                    DFMPOP-TRANSFER.PIO-NMB-OF-COPIES = 1;

                    DFMPOP-TRANSFER.PIO-USRID = GNOMADS.G-USER-ID;

                    DFMPOP-TRANSFER.PIO-TERMID = GNOMADS.G-TERM-ID;



                    /* -------  PTR # 7514  ------------------------------- start **/



                    VSTRREC4.USTRING = GNOMADS.G-FRST-NAME;

                    VSTRREC4.UCONCAT = GNOMADS.G-MID-NAME;

                    VSTRREC4.UCONCAT2 = GNOMADS.G-LST-NAME;

                    VSTRREC4.UCONCAT3 = GNOMADS.G-MODIFIER;

                    VSTRREC4.USTRLEN = 56;

                    VSTRREC4.UCONLEN = 16;

                    VSTRREC4.UCONLEN2 = 21;

                    VSTRREC4.UCONLEN3 = 3;

                    /* -------  PTR # 7514  -------------------------------   end **/



                    call "WST50A"(VSTRREC4){isNoRefresh = yes};

                    DFMPOP-TRANSFER.PIO-NCP-NAME = VSTRREC4.USTRING;



                    DFMPOP-TRANSFER.PIO-FIRST-THREE-SSN = GNOMADS.G-CASE-SSN-FIRST-THREE;

                    DFMPOP-TRANSFER.PIO-NEXT-TWO-SSN = GNOMADS.G-CASE-SSN-NEXT-TWO;

                    DFMPOP-TRANSFER.PIO-LAST-FOUR-SSN = GNOMADS.G-CASE-SSN-LAST-FOUR;



                    /* -------  PTR # 7514  ------------------------------- start **/

                    VSTRREC4.USTRING = G-IV-D.G-CST-FRST-NAME;

                    VSTRREC4.UCONCAT = G-IV-D.G-CST-MID-NAME;

                    VSTRREC4.UCONCAT2 = G-IV-D.G-CST-LST-NAME;

                    VSTRREC4.UCONCAT3 = G-IV-D.G-CST-MODIFIER;

                    VSTRREC4.USTRLEN = 56;

                    VSTRREC4.UCONLEN = 16;

                    VSTRREC4.UCONLEN2 = 21;

                    VSTRREC4.UCONLEN3 = 3;

                    /* -------  PTR # 7514  -------------------------------   end **/



                    call "WST50A"(VSTRREC4){isNoRefresh = yes};

                    DFMPOP-TRANSFER.PIO-CST-NAME = VSTRREC4.USTRING;

                    DFMPOP-TRANSFER.PIO-CST-SSN = G-IV-D.G-CST-SSN;

                    DFMPOP-TRANSFER.PIO-UPI = G-IV-D.G-NCP-UPI;

                    DFMPOP-TRANSFER.PIO-CASE-SUFX = G-IV-D.G-CASE-SUFX;

                    DFMPOP-TRANSFER.PIO-POP-PARM[1] = "B";

                    DFMPOP-TRANSFER.PIO-PARM-NMB = 1;

                    DFMPOP-TRANSFER.WS-APPL-ID = "DCP27A";



                    /* Create the first report 'GN0003'.*/

                    if(H2-FRM-CASE-TRKNG.FORM-ID == "GN0003")

                        call "DFM07A"(VDBCONTROL, VMESSAGE,

                                DFMPOP-TRANSFER){isNoRefresh = yes};

                        if(VDBCONTROL.URC > 104)

                            exit program;

                        end

                    end



                    if(H-TIDCQ7.FUNC-AREA-CD == "E") /* enforcement  (pw)*/

                        /* Create the next report for the NCP.*/

                        DFMPOP-TRANSFER.PIO-FORM-ID = "GN0004";

                        DFMPOP-TRANSFER.PIO-POP-PARM[1] = "N";

                        call "DFM07A"(VDBCONTROL, VMESSAGE,

                                DFMPOP-TRANSFER){isNoRefresh = yes};

                        if(VDBCONTROL.URC > 104)

                            exit program;

                        end



                        /* Create the report for the CST.*/

                        DFMPOP-TRANSFER.PIO-POP-PARM[1] = "C";

                        call "DFM07A"(VDBCONTROL, VMESSAGE,

                                DFMPOP-TRANSFER){isNoRefresh = yes};

                        if(VDBCONTROL.URC > 104)

                            exit program;

                        end

                    end /* if enforcement*/



                else /* MVSBATCH*/

                    DFMBTCH-XFER.PIO-FORM-ID = H2-FRM-CASE-TRKNG.FORM-ID;

                    DFMBTCH-XFER.PIO-UPI = DCP27W.PI1-NCP-UPI;

                    DFMBTCH-XFER.PIO-CASE-SUFX = DCP27W.PI1-CASE-SUFX;

                    DFMBTCH-XFER.PIO-NMB-OF-COPIES = 1;

                    DFMBTCH-XFER.PIO-PARM-NMB = 1;

                    DFMBTCH-XFER.PIO-POP-PARM[1] = sysVar.sessionID;

                    DFMBTCH-XFER.PIO-PARM-NMB = 1;

                    DFMBTCH-XFER.WS-APPL-ID = "DCP27A";



                    if(DFMBTCH-XFER.PIO-FORM-ID == "GN0003")

                        call "DFM08A"(VDBCONTROL, VMESSAGE,

                                DFMBTCH-XFER){isNoRefresh = yes};

                    end



                    if(H-TIDCQ7.FUNC-AREA-CD == "E") /* enforcement  (pw)*/

                        /* Create the next report for the NCP.*/

                        DFMBTCH-XFER.PIO-FORM-ID = "GN0004";

                        call "DFM08A"(VDBCONTROL, VMESSAGE,

                                DFMBTCH-XFER){isNoRefresh = yes};



                        /* Create the report for the CST.*/

                        DFMBTCH-XFER.PIO-UPI = 0; /* flag to print CST rprt.*/

                        DFMBTCH-XFER.PIO-CST-SSN = G-IV-D.G-CST-SSN;

                        call "DFM08A"(VDBCONTROL, VMESSAGE,

                                DFMBTCH-XFER){isNoRefresh = yes};

                    end /* if enforcement*/

                end /* if EZESYS IS MVSCICS*/

            end /* IF DCP27W2.WS-FORM-COUNT = 0;*/

        end /* IF H2-NCP-EXG-SUP-DTL.PYMT-TO-CST-IND*/

    /* = 'Y';*/

    end /* IF DCP27W2.WS-FUNC-AREA-CD = 'E' or*/

    /* 'O'*/

end // end DCP27P9-GEN-FORMS



// used in dcp27a

