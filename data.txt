SELECT 
    PCH.ICI, 
    PCH.PRGM_CASE_STS, 
    PCH.PRGM_CASE_TYPE, 
    PCH.AID_CD,
    EVR.WTHDR_TST_RSLT_CD, 
    EVR.APL_DTH_TSTRSL_CD, 
    EVR.RSDN_TST_RSLT_CD, 
    EVR.AGDDIS_ST_TSTRS_CD, 
    EVR.VRF_TST_RSLT_CD, 
    EVR.SSN_TEST_RSLT_CD, 
    EVR.COOP_TEST_RSLT_CD, 
    EVR.MRF_COMP_TSTRSL_CD, 
    EVR.BNFT_YR, 
    EVR.BNFT_MTH, 
    EVR.VER_NMB, 
    CAS.CASLD_EFF_DT, 
    FCC.HOH_UPI, 
    FCC.OFC_CD, 
    FCC.CASLD_ID,
    OFF.OFC_NM, 
    BUDGET.GRS_INC_TST_RSLTCD, 
    BUDGET.RSRCS_TST_RSLT_CD, 
    MBR.LST_BU_CNSD,
    -- Additional categorization based on termination statistics
    CASE 
        WHEN PCH.AID_CD IN ('EM3', 'IN3', 'SI3', 'PK3', 'KB3', 'WB3', 'GC3', 'SS3', 'HD3', 'HG3', 'CM3') 
        THEN 'BLIND'
        WHEN PCH.AID_CD IN ('QM3', 'SL3', 'QD3', 'QI3', 'QJ3') 
        THEN 'MEDICARE BUY-IN'
        ELSE 'OTHER'
    END AS TERMINATION_CATEGORY,
    COUNT(*) AS TERMINATION_COUNT
FROM 
    TWNPRGM_CASE_HSTRY PCH, 
    TWNELIG_VERSION EVR, 
    TWNFAM_CASELD_CASE CAS, 
    TWNFAM_CASE_HSTRY FCC, 
    TWNOFFICE OFF, 
    TWNELG_VER_MBR MBR, 
    TWNELG_BDGT_UNIT BUDGET
WHERE 
    PCH.ICI = EVR.ICI
    AND PCH.PRGM_CASE_TYPE = EVR.PRGM_CASE_TYPE
    AND EVR.LST_POSTD_VER_IND = 'Y'
    AND PCH.ICI = CAS.ICI
    AND PCH.ICI = FCC.ICI
    AND FCC.PRD_BEG_DT <= :PRD_BEG_DT
    AND FCC.PRD_END_DT >= :PRD_END_DT
    AND FCC.ICI = CAS.ICI
    AND CAS.CASLD_EFF_DT = :CASLD_EFF_DT
    AND FCC.OFC_CD = OFF.OFC_CD
    AND PCH.ICI = MBR.ICI
    AND PCH.PRGM_CASE_TYPE = MBR.PRGM_CASE_TYPE
    AND PCH.BNFT_YR = MBR.BNFT_YR
    AND PCH.BNFT_MTH = MBR.BNFT_MTH
    AND PCH.VER_NMB = MBR.VER_NMB
    AND PCH.ICI = BUDGET.ICI
    AND PCH.PRGM_CASE_TYPE = BUDGET.PRGM_CASE_TYPE
    AND PCH.BNFT_YR = BUDGET.BNFT_YR
    AND PCH.BNFT_MTH = BUDGET.BNFT_MTH
    AND PCH.VER_NMB = BUDGET.VER_NMB
    AND MBR.LST_BU_CNSD = BUDGET.BU_NMB
    AND PCH.PRGM_CASE_TYPE = 'MA'
    AND PCH.PRGM_CASE_STS IN ('T', 'D')
    AND PCH.PRD_BEG_DT <= :PRD_BEG_DT
    AND PCH.PRD_END_DT >= :PRD_END_DT
    AND EVR.BNFT_MTH = :BNFT_MTH
    AND EVR.BNFT_YR = :BNFT_YR
GROUP BY 
    FCC.OFC_CD, 
    FCC.CASLD_ID, 
    PCH.AID_CD, 
    PCH.PRGM_CASE_STS
ORDER BY 
    FCC.OFC_CD, 
    FCC.CASLD_ID, 
    PCH.AID_CD, 
    PCH.PRGM_CASE_STS;
