WITH
RPT_DATES AS (
  SELECT
    VARCHAR_FORMAT(DATE('2025-01-01') - (DAY(DATE('2025-01-01')) - 1) DAYS, 'YYYY-MM-DD') AS RPT_BEG_DT,
    VARCHAR_FORMAT(LAST_DAY(DATE('2025-01-01')), 'YYYY-MM-DD') AS RPT_END_DT,
    VARCHAR_FORMAT(DATE('2025-01-01') - (DAY(DATE('2025-01-01')) - 1) DAYS, 'YYYY-MM-DD') || '-00.00.00.000000' AS RPT_BEG_DT_TS,
    VARCHAR_FORMAT(LAST_DAY(DATE('2025-01-01')), 'YYYY-MM-DD') || '-23.59.59.999999' AS RPT_END_DT_TS,
    VARCHAR_FORMAT('2025-01-01', 'MM') AS RPT_MONTH_BIN,
    VARCHAR_FORMAT('2025-01-01', 'YYYY') AS RPT_YEAR_BIN,
    CASE WHEN VARCHAR_FORMAT('2025-01-01', 'MM') = '01' THEN 12 ELSE INTEGER(VARCHAR_FORMAT('2025-01-01', 'MM')) - 1 END AS PREV_RPT_MTH,
    CASE WHEN VARCHAR_FORMAT('2025-01-01', 'MM') = '01' THEN INTEGER(VARCHAR_FORMAT('2025-01-01', 'YYYY')) - 1 ELSE INTEGER(VARCHAR_FORMAT('2025-01-01', 'YYYY')) END AS PREV_RPT_YR
  FROM SYSIBM.SYSDUMMY1
),
OFFICES AS (
  SELECT DISTINCT T1.OFC_CD, T.OFC_NM
  FROM W026DTF1.TWNCASELD_DEBTLD T1
  JOIN W026DTF1.TWNOFFICE T ON T.OFC_CD = T1.OFC_CD
  WHERE T1.PRGM_OFC_TYPE = 'A' AND T1.OFC_CD NOT IN ('DC','DH','DL','DR')
),
OFFICE_DATA AS (
  SELECT OFC.OFC_CD, OFC.OFC_NM
  FROM OFFICES OFC
),
ACT_CASELD_INFO AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX, T2.MTHLY_RPTR_IND, T3.EXPD_SRVC_IND, T3.MTHD_OF_ISNCE, T3.ISNCE_MTHD
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNFS_ISNCE T3 ON T2.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.ISNCE_DT <= RPT.RPT_END_DT
    AND T3.BNFT_MTH = RPT.RPT_MONTH_BIN
    AND T3.BNFT_YR  = RPT.RPT_YEAR_BIN
    AND T3.BNFT_TYPE = 'RG'
    AND T3.FS_ISNCE_STS IN ('IS','RD')
),
MAIN0 AS (
  SELECT
    ACI.OFC_CD, ACI.OFC_NM,
    SUM(CASE WHEN ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PACASES,
    SUM(CASE WHEN ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NACASES,
    SUM(CASE WHEN ACI.EXPD_SRVC_IND = 'Y' AND ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAEXPCASE,
    SUM(CASE WHEN ACI.EXPD_SRVC_IND = 'Y' AND ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAEXPCASE,
    SUM(CASE WHEN ACI.ISNCE_MTHD = 'E' AND ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAEBTCASE,
    SUM(CASE WHEN ACI.ISNCE_MTHD = 'E' AND ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAEBTCASE,
    SUM(CASE WHEN ACI.ISNCE_MTHD = 'E' THEN 1 ELSE 0 END) AS DMIEBT,
    SUM(CASE WHEN ACI.ISNCE_MTHD <> 'E' AND ACI.MTHD_OF_ISNCE = '3' AND ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PADAMS,
    SUM(CASE WHEN ACI.ISNCE_MTHD <> 'E' AND ACI.MTHD_OF_ISNCE = '3' AND ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NADAMS,
    SUM(CASE WHEN ACI.ISNCE_MTHD <> 'E' AND ACI.MTHD_OF_ISNCE <> '3' AND ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PASPHNDL,
    SUM(CASE WHEN ACI.ISNCE_MTHD <> 'E' AND ACI.MTHD_OF_ISNCE <> '3' AND ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NASPHNDL,
    SUM(CASE WHEN ACI.MTHLY_RPTR_IND = 'Y' AND ACI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAMRC,
    SUM(CASE WHEN ACI.MTHLY_RPTR_IND = 'Y' AND ACI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAMRC
  FROM ACT_CASELD_INFO ACI
  GROUP BY ACI.OFC_CD, ACI.OFC_NM
),
LST_MTH_CSLD AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX, T3.ISNCE_DT, RPT.RPT_BEG_DT, RPT.RPT_END_DT
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNFS_ISNCE T3 ON T2.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.BNFT_MTH = RPT.PREV_RPT_MTH
    AND T3.BNFT_YR  = RPT.PREV_RPT_YR
    AND T3.BNFT_TYPE = 'RG'
    AND T3.FS_ISNCE_STS IN ('IS','RD')
),
MAIN1 AS (
  SELECT
    LMC.OFC_CD, LMC.OFC_NM,
    SUM(CASE WHEN LMC.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAREVISED,
    SUM(CASE WHEN LMC.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAREVISED,
    SUM(CASE WHEN LMC.FS_SUFX IN ('P','S','G','A') AND LMC.ISNCE_DT BETWEEN LMC.RPT_BEG_DT AND LMC.RPT_END_DT THEN 1 ELSE 0 END) AS PALMISS,
    SUM(CASE WHEN LMC.FS_SUFX NOT IN ('P','S','G','A') AND LMC.ISNCE_DT BETWEEN LMC.RPT_BEG_DT AND LMC.RPT_END_DT THEN 1 ELSE 0 END) AS NALMISS
  FROM LST_MTH_CSLD LMC
  GROUP BY LMC.OFC_CD, LMC.OFC_NM
),
ACTION_QUERY AS (
  SELECT
    T1.ICI,
    T2.OFC_CD,
    OFC.OFC_NM,
    MIN(T1.ACTN_TS) AS AP_TS
  FROM W026DTF1.TWNFAM_ACTNS T1
  JOIN W026DTF1.TWNFAM_CASELD_CASE T2 ON T2.ICI = T1.ICI
  JOIN OFFICE_DATA OFC ON OFC.OFC_CD = T2.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRGM_OFC_TYPE = 'A'
    AND T1.PRGM_TYP = 'FS'
    AND T1.ACTN_TYP = 'AP'
    AND T1.ACTN_TS >= RPT.RPT_BEG_DT_TS
    AND T1.ACTN_TS <= RPT.RPT_END_DT_TS
  GROUP BY T1.ICI, T2.OFC_CD, OFC.OFC_NM
),
PREV_FARI AS (
  SELECT
    AQ.OFC_CD, AQ.OFC_NM, AQ.ICI, AQ.AP_TS,
    FA.ACTN_TS AS PREV_TS,
    FA.ACTN_TYP AS PREV_TYP,
    CH.FS_SUFX,
    ROW_NUMBER() OVER (PARTITION BY AQ.ICI ORDER BY FA.ACTN_TS DESC) AS RN_PREV,
    ROW_NUMBER() OVER (PARTITION BY AQ.ICI, FA.ACTN_TS ORDER BY CH.PRD_BEG_DT DESC) AS RN_CH
  FROM ACTION_QUERY AQ
  JOIN W026DTF1.TWNFAM_ACTNS FA
    ON FA.ICI = AQ.ICI
   AND FA.PRGM_TYP = 'FS'
   AND FA.ACTN_TS  < AQ.AP_TS
   AND FA.ACTN_TYP IN ('FA','RE','RI')
  JOIN W026DTF1.TWNFAM_CASE_HSTRY CH
    ON CH.ICI = FA.ICI
   AND CH.PRD_BEG_DT <= DATE(FA.ACTN_TS)
   AND CH.PRD_END_DT >= DATE(FA.ACTN_TS)
),
S04_PREV AS (
  SELECT OFC_CD, OFC_NM, ICI, AP_TS, PREV_TS, PREV_TYP, FS_SUFX
  FROM PREV_FARI
  WHERE RN_PREV = 1 AND RN_CH = 1
),
PRGM_CSH_HSTRY_LOOKUP AS (
  SELECT
    P.OFC_CD, P.OFC_NM, P.ICI, P.FS_SUFX,
    H.RCRT_APL_DT, RPT.RPT_BEG_DT, RPT.RPT_END_DT,
    COUNT(*) OVER (PARTITION BY P.ICI) AS PCH_CNT
  FROM S04_PREV P
  JOIN RPT_DATES RPT ON 1=1
  LEFT JOIN W026DTF1.TWNPRGM_CASE_HSTRY H
    ON H.ICI = P.ICI
   AND H.PRGM_CASE_TYPE = 'FS'
   AND H.PRD_BEG_DT <= RPT.RPT_END_DT
   AND H.PRD_END_DT >= RPT.RPT_END_DT
),
PRGM_CSH_HSTRY_FILTERED AS (
  SELECT OFC_CD, OFC_NM, ICI, FS_SUFX, RCRT_APL_DT, RPT_BEG_DT, RPT_END_DT
  FROM PRGM_CSH_HSTRY_LOOKUP
  WHERE PCH_CNT = 1 AND RCRT_APL_DT IS NOT NULL
),
S04_APPROVALS_DEDUP AS (
  SELECT OFC_CD, OFC_NM, ICI, FS_SUFX, RCRT_APL_DT, RPT_BEG_DT, RPT_END_DT
  FROM (
    SELECT *,
           ROW_NUMBER() OVER (PARTITION BY ICI ORDER BY ICI) AS RN
    FROM PRGM_CSH_HSTRY_FILTERED
  ) D
  WHERE RN = 1
),
MAIN2 AS (
  SELECT
    OFC_CD, OFC_NM,
    SUM(CASE WHEN FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PABNFT,
    SUM(CASE WHEN FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NABNFT,
    SUM(CASE WHEN FS_SUFX IN ('P','S','G','A') AND RCRT_APL_DT BETWEEN RPT_BEG_DT AND RPT_END_DT THEN 1 ELSE 0 END) AS PABNFT_NEW,
    SUM(CASE WHEN FS_SUFX IN ('P','S','G','A') AND (RCRT_APL_DT < RPT_BEG_DT OR RCRT_APL_DT > RPT_END_DT) THEN 1 ELSE 0 END) AS PABNFT_SUBS,
    SUM(CASE WHEN FS_SUFX NOT IN ('P','S','G','A') AND RCRT_APL_DT BETWEEN RPT_BEG_DT AND RPT_END_DT THEN 1 ELSE 0 END) AS NABNFT_NEW,
    SUM(CASE WHEN FS_SUFX NOT IN ('P','S','G','A') AND (RCRT_APL_DT < RPT_BEG_DT OR RCRT_APL_DT > RPT_END_DT) THEN 1 ELSE 0 END) AS NABNFT_SUBS
  FROM S04_APPROVALS_DEDUP
  GROUP BY OFC_CD, OFC_NM
),
WITH_DRAW_INFO AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX, T3.RCRT_APL_DT, RPT.RPT_BEG_DT, RPT.RPT_END_DT
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNPRGM_CASE_HSTRY T3 ON T1.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.PRGM_CASE_TYPE = 'FS'
    AND T3.STS_EFF_DT BETWEEN RPT.RPT_BEG_DT AND RPT.RPT_END_DT
    AND T3.CLSRE_RSN_CD = 'W'
),
MAIN3 AS (
  SELECT
    WDI.OFC_CD, WDI.OFC_NM,
    SUM(CASE WHEN WDI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAWTDR,
    SUM(CASE WHEN WDI.FS_SUFX IN ('P','S','G','A') AND WDI.RCRT_APL_DT BETWEEN WDI.RPT_BEG_DT AND WDI.RPT_END_DT THEN 1 ELSE 0 END) AS PAWTDR_NEW,
    SUM(CASE WHEN WDI.FS_SUFX IN ('P','S','G','A') AND (WDI.RCRT_APL_DT < WDI.RPT_BEG_DT OR WDI.RCRT_APL_DT > WDI.RPT_END_DT) THEN 1 ELSE 0 END) AS PAWTDR_SUBS,
    SUM(CASE WHEN WDI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAWTDR,
    SUM(CASE WHEN WDI.FS_SUFX NOT IN ('P','S','G','A') AND WDI.RCRT_APL_DT BETWEEN WDI.RPT_BEG_DT AND WDI.RPT_END_DT THEN 1 ELSE 0 END) AS NAWTDR_NEW,
    SUM(CASE WHEN WDI.FS_SUFX NOT IN ('P','S','G','A') AND (WDI.RCRT_APL_DT < WDI.RPT_BEG_DT OR WDI.RCRT_APL_DT > WDI.RPT_END_DT) THEN 1 ELSE 0 END) AS NAWTDR_SUBS
  FROM WITH_DRAW_INFO WDI
  GROUP BY WDI.OFC_CD, WDI.OFC_NM
),
DENIED_APPL_INFO AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX, T3.SYS_CLSRE_DNL_RSN, T3.RCRT_APL_DT, RPT.RPT_BEG_DT, RPT.RPT_END_DT
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNPRGM_CASE_HSTRY T3 ON T1.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.PRGM_CASE_TYPE = 'FS'
    AND T3.STS_EFF_DT BETWEEN RPT.RPT_BEG_DT AND RPT.RPT_END_DT
    AND T3.PRGM_CASE_STS = 'D'
    AND T3.CLSRE_RSN_CD <> 'W'
),
MAIN4 AS (
  SELECT
    DAI.OFC_CD, DAI.OFC_NM,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PATOT,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.RCRT_APL_DT BETWEEN DAI.RPT_BEG_DT AND DAI.RPT_END_DT THEN 1 ELSE 0 END) AS PADENY_NEW,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND (DAI.RCRT_APL_DT < DAI.RPT_BEG_DT OR DAI.RCRT_APL_DT > DAI.RPT_END_DT) THEN 1 ELSE 0 END) AS PADENY_SUBS,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '11' THEN 1 ELSE 0 END) AS PADENY,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '08' THEN 1 ELSE 0 END) AS PANCOOP,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '10' THEN 1 ELSE 0 END) AS PAQUIT,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '20' THEN 1 ELSE 0 END) AS PARSRC,
    SUM(CASE WHEN DAI.FS_SUFX IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN NOT IN ('11','08','10','20') THEN 1 ELSE 0 END) AS PAOTHR,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NATOT,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.RCRT_APL_DT BETWEEN DAI.RPT_BEG_DT AND DAI.RPT_END_DT THEN 1 ELSE 0 END) AS NADENY_NEW,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND (DAI.RCRT_APL_DT < DAI.RPT_BEG_DT OR DAI.RCRT_APL_DT > DAI.RPT_END_DT) THEN 1 ELSE 0 END) AS NADENY_SUBS,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '11' THEN 1 ELSE 0 END) AS NADENY,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '08' THEN 1 ELSE 0 END) AS NANCOOP,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '10' THEN 1 ELSE 0 END) AS NAQUIT,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN = '20' THEN 1 ELSE 0 END) AS NARSRC,
    SUM(CASE WHEN DAI.FS_SUFX NOT IN ('P','S','G','A') AND DAI.SYS_CLSRE_DNL_RSN NOT IN ('11','08','10','20') THEN 1 ELSE 0 END) AS NAOTHR
  FROM DENIED_APPL_INFO DAI
  GROUP BY DAI.OFC_CD, DAI.OFC_NM
),
APPL_PRC_INFO AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX, T3.PRGM_CASE_STS, T3.RCRT_APL_DT, T3.PRD_BEG_DT, T3.PRD_END_DT
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNPRGM_CASE_HSTRY T3 ON T1.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.PRGM_CASE_TYPE = 'FS'
    AND T3.RCRT_APL_DT BETWEEN RPT.RPT_BEG_DT AND RPT.RPT_END_DT
    AND T3.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T3.PRD_END_DT >= RPT.RPT_END_DT
),
MAIN5 AS (
  SELECT
    API.OFC_CD, API.OFC_NM,
    SUM(CASE WHEN API.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PAAPPLMTH,
    SUM(CASE WHEN API.FS_SUFX IN ('P','S','G','A') AND API.PRGM_CASE_STS = 'P' THEN 1 ELSE 0 END) AS PAPNDMTH,
    SUM(CASE WHEN API.FS_SUFX IN ('P','S','G','A') AND API.PRGM_CASE_STS = 'O' THEN 1 ELSE 0 END) AS PAAPPRVMTH,
    SUM(CASE WHEN API.FS_SUFX IN ('P','S','G','A') AND API.PRGM_CASE_STS IN ('D','T') THEN 1 ELSE 0 END) AS PADNYWDMTH,
    SUM(CASE WHEN API.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NAAPPLMTH,
    SUM(CASE WHEN API.FS_SUFX NOT IN ('P','S','G','A') AND API.PRGM_CASE_STS = 'P' THEN 1 ELSE 0 END) AS NAPNDMTH,
    SUM(CASE WHEN API.FS_SUFX NOT IN ('P','S','G','A') AND API.PRGM_CASE_STS = 'O' THEN 1 ELSE 0 END) AS NAAPPRVMTH,
    SUM(CASE WHEN API.FS_SUFX NOT IN ('P','S','G','A') AND API.PRGM_CASE_STS IN ('D','T') THEN 1 ELSE 0 END) AS NADNYWDMTH
  FROM APPL_PRC_INFO API
  GROUP BY API.OFC_CD, API.OFC_NM
),
TERMINATIONS_INFO AS (
  SELECT T1.OFC_CD, OFC.OFC_NM, T2.FS_SUFX
  FROM W026DTF1.TWNFAM_CASELD_CASE T1
  JOIN W026DTF1.TWNFAM_CASE_HSTRY T2 ON T1.ICI = T2.ICI
  JOIN W026DTF1.TWNPRGM_CASE_HSTRY T3 ON T1.ICI = T3.ICI
  JOIN OFFICE_DATA OFC ON T1.OFC_CD = OFC.OFC_CD
  JOIN RPT_DATES RPT ON 1=1
  WHERE
    T2.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T2.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.PRGM_CASE_TYPE = 'FS'
    AND T3.PRD_BEG_DT <= RPT.RPT_END_DT
    AND T3.PRD_END_DT >= RPT.RPT_END_DT
    AND T3.STS_EFF_DT BETWEEN RPT.RPT_BEG_DT AND RPT.RPT_END_DT
    AND T3.PRGM_CASE_STS = 'T'
),
MAIN6 AS (
  SELECT
    TNI.OFC_CD, TNI.OFC_NM,
    SUM(CASE WHEN TNI.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS PATERM,
    SUM(CASE WHEN TNI.FS_SUFX NOT IN ('P','S','G','A') THEN 1 ELSE 0 END) AS NATERM
  FROM TERMINATIONS_INFO TNI
  GROUP BY TNI.OFC_CD, TNI.OFC_NM
),
ALL_OFFICES AS (
  SELECT OFC_CD, OFC_NM FROM MAIN0
  UNION SELECT OFC_CD, OFC_NM FROM MAIN1
  UNION SELECT OFC_CD, OFC_NM FROM MAIN2
  UNION SELECT OFC_CD, OFC_NM FROM MAIN3
  UNION SELECT OFC_CD, OFC_NM FROM MAIN4
  UNION SELECT OFC_CD, OFC_NM FROM MAIN5
  UNION SELECT OFC_CD, OFC_NM FROM MAIN6
)
SELECT
  'JANUARY, 2025' AS RPT_MONTH,
  AO.OFC_NM,
  COALESCE(M0.PACASES,0) AS PACASES,
  COALESCE(M0.NACASES,0) AS NACASES,
  COALESCE(M0.PAEXPCASE,0) AS PAEXPCASE,
  COALESCE(M0.NAEXPCASE,0) AS NAEXPCASE,
  COALESCE(M0.PAEBTCASE,0) AS PAEBTCASE,
  COALESCE(M0.NAEBTCASE,0) AS NAEBTCASE,
  COALESCE(M0.DMIEBT,0) AS DMIEBT,
  COALESCE(M0.PADAMS,0) AS PADAMS,
  COALESCE(M0.NADAMS,0) AS NADAMS,
  COALESCE(M0.PASPHNDL,0) AS PASPHNDL,
  COALESCE(M0.NASPHNDL,0) AS NASPHNDL,
  COALESCE(M0.PAMRC,0) AS PAMRC,
  COALESCE(M0.NAMRC,0) AS NAMRC,
  COALESCE(M1.PAREVISED,0) AS PAREVISED,
  COALESCE(M1.NAREVISED,0) AS NAREVISED,
  COALESCE(M1.PALMISS,0) AS PALMISS,
  COALESCE(M1.NALMISS,0) AS NALMISS,
  COALESCE(M2.PABNFT,0) AS PABNFT,
  COALESCE(M2.PABNFT_NEW,0) AS PABNFT_NEW,
  COALESCE(M2.PABNFT_SUBS,0) AS PABNFT_SUBS,
  COALESCE(M2.NABNFT,0) AS NABNFT,
  COALESCE(M2.NABNFT_NEW,0) AS NABNFT_NEW,
  COALESCE(M2.NABNFT_SUBS,0) AS NABNFT_SUBS,
  COALESCE(M3.PAWTDR,0) AS PAWTDR,
  COALESCE(M3.PAWTDR_NEW,0) AS PAWTDR_NEW,
  COALESCE(M3.PAWTDR_SUBS,0) AS PAWTDR_SUBS,
  COALESCE(M3.NAWTDR,0) AS NAWTDR,
  COALESCE(M3.NAWTDR_NEW,0) AS NAWTDR_NEW,
  COALESCE(M3.NAWTDR_SUBS,0) AS NAWTDR_SUBS,
  COALESCE(M4.PATOT,0) AS PATOT,
  COALESCE(M4.PADENY_NEW,0) AS PADENY_NEW,
  COALESCE(M4.PADENY_SUBS,0) AS PADENY_SUBS,
  COALESCE(M4.PADENY,0) AS PADENY,
  COALESCE(M4.PANCOOP,0) AS PANCOOP,
  COALESCE(M4.PAQUIT,0) AS PAQUIT,
  COALESCE(M4.PARSRC,0) AS PARSRC,
  COALESCE(M4.PAOTHR,0) AS PAOTHR,
  COALESCE(M4.NATOT,0) AS NATOT,
  COALESCE(M4.NADENY_NEW,0) AS NADENY_NEW,
  COALESCE(M4.NADENY_SUBS,0) AS NADENY_SUBS,
  COALESCE(M4.NADENY,0) AS NADENY,
  COALESCE(M4.NANCOOP,0) AS NANCOOP,
  COALESCE(M4.NAQUIT,0) AS NAQUIT,
  COALESCE(M4.NARSRC,0) AS NARSRC,
  COALESCE(M4.NAOTHR,0) AS NAOTHR,
  COALESCE(M5.PAAPPLMTH,0) AS PAAPPLMTH,
  COALESCE(M5.PAPNDMTH,0) AS PAPNDMTH,
  COALESCE(M5.PAAPPRVMTH,0) AS PAAPPRVMTH,
  COALESCE(M5.PADNYWDMTH,0) AS PADNYWDMTH,
  COALESCE(M5.NAAPPLMTH,0) AS NAAPPLMTH,
  COALESCE(M5.NAPNDMTH,0) AS NAPNDMTH,
  COALESCE(M5.NAAPPRVMTH,0) AS NAAPPRVMTH,
  COALESCE(M5.NADNYWDMTH,0) AS NADNYWDMTH,
  COALESCE(M6.PATERM,0) AS PATERM,
  COALESCE(M6.NATERM,0) AS NATERM
FROM ALL_OFFICES AO
LEFT JOIN MAIN0 M0 ON AO.OFC_CD = M0.OFC_CD
LEFT JOIN MAIN1 M1 ON AO.OFC_CD = M1.OFC_CD
LEFT JOIN MAIN2 M2 ON AO.OFC_CD = M2.OFC_CD
LEFT JOIN MAIN3 M3 ON AO.OFC_CD = M3.OFC_CD
LEFT JOIN MAIN4 M4 ON AO.OFC_CD = M4.OFC_CD
LEFT JOIN MAIN5 M5 ON AO.OFC_CD = M5.OFC_CD
LEFT JOIN MAIN6 M6 ON AO.OFC_CD = M6.OFC_CD
ORDER BY AO.OFC_NM;
