package PGM_T_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=TLCAU1A ****
// COMPONENT NAME: TLCAU1A - THIS IS A DB LAYER APPLICATION
// ===============
// 
// DESCRIPTION:
// ============
// THIS IS A DB LAYER APPLICATION WITH THE FOLLOWING DB2
// ACCESSES:
// 
// SQL COMMAND   TABLE NAME
// ===========   ==========
// UPDATE        TWNLCTE_ACTVY
// 
// 
// ************************
Program TLCAU1A type basicProgram //VAGen Info - called batch program
  (
   VDBCONTROL VDBCONTROL, // record
   VMESSAGE VMESSAGE, // record
   H-TLCAU1 H-TLCAU1 // record
  )
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  H2-LCTE-ACTVY H2-LCTE-ACTVY; // record
  VDBCOMMON VDBCOMMON; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    TLCAU1L1: TLCAU1L1();
  end // end main
end // end TLCAU1A


// LUW for DB Access
Function TLCAU1L1()
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "TLCAU1A";
  /*  */
  /* Initialize application-specific working storage records*/
  /* Initialize SQL row record*/
  set H2-LCTE-ACTVY empty;
  /*  */
  /* Perform process to retrieve data*/
  TLCAU1P1();
  /*  */
  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
end // end TLCAU1L1


// Control Retrieve of Data
Function TLCAU1P1()
  /* Move retrieve key value to SQL row record*/
  H2-LCTE-ACTVY.INFO-RCVD-DT = H-TLCAU1.INFO-RCVD-DT;
  /* Move retrieve key values for selecting INFO-RQSTD-DT*/
  H2-LCTE-ACTVY.RQST-SQ-NMB = H-TLCAU1.RQST-SQ-NMB;
  H2-LCTE-ACTVY.LOC-SRC-CD = H-TLCAU1.LOC-SRC-CD;
  H2-LCTE-ACTVY.CASE-SUFX = H-TLCAU1.CASE-SUFX;
  H2-LCTE-ACTVY.UPI = H-TLCAU1.UPI;
  H2-LCTE-ACTVY.INFO-RQSTD-TS = H-TLCAU1.INFO-RQSTD-TS;
  /* PERFORM TLCAU1P9-QS1;*/
  /* If select is successful continue*/
  /* IF EZESQCOD = 0;*/
  /* Perform process to retrieve data*/
  TLCAU1Q1();
  /* If data retrieved successfully, continue*/
  /* END;*/
  if (sysVar.sqlData.sqlcode == 0)
    /*  */
    /* Move retrieved data to passed record*/
    /*  */
  end /* Data retrieved successfully*/
end // end TLCAU1P1


// UPDATE recieved info  date
Function TLCAU1Q1()
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-LCTE-ACTVY";
  /*  */
  VDBCONTROL.UPROC-OBJ = "H2-LCTE-ACTVY";
  VDBCONTROL.UPROC-OPT = "SQLEXEC";
  VDBCONTROL.UPROC-NM = "TLCAU1Q1";
  VDBCOMMON.USQLREC = "H2-LCTE-ACTVY";
  /*  */
  try
    execute update 
      #sql{
        UPDATE
          twnlcte_actvy T1
        SET
          INFO_RCVD_DT = :INFO-RCVD-DT
           --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE INFO_RQSTD_TS = :INFO-RQSTD-TS
        AND LOC_SRC_CD = 'ESD'
        AND CASE_SUFX = :CASE-SUFX
        AND UPI = :UPI
        AND RQST_SQ_NMB = 1
      }
      for H2-LCTE-ACTVY ; // model = update
  end
  /*  */
  /* Increment count of rows retrieved*/
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
end // end TLCAU1Q1


