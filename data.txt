package PGM_T_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=TPAHP5A ****
// COMPONENT NAME: TPAHP5A - THIS IS A DB LAYER APPLICATION
// ===============
// 
// DESCRIPTION:
// ============
// This application is called from various applications and
// calls a non-CSP program (CAD01A) to format the Person
// Address History record.  This application then calls
// TPAHI1A to insert a row into TWNPERSON_ADRS_HST.
// WI #1002 - Add LAST-UPD-DT to insert of TWNPERSON_ADRS_HST.
// ************************
Program TPAHP5A type basicProgram //VAGen Info - called batch program
  (
   VDBCONTROL VDBCONTROL, // record
   VMESSAGE VMESSAGE, // record
   H-TPAHP5 H-TPAHP5 // record
  )
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  DFC03W1 DFC03W1; // record
  G-IV-D G-IV-D; // record
  GDW GDW; // record
  GNOMADS GNOMADS; // record
  H-TPAHI1 H-TPAHI1; // record
  TPAHP5W TPAHP5W; // record
  TPAHP5W1 TPAHP5W1; // record
  VDBCOMMON VDBCOMMON; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    TPAHP5P9-L1: TPAHP5P9-L1();
  end // end main
end // end TPAHP5A


// LUW for DB Access
Function TPAHP5P9-L1()
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  VDBCOMMON.UAPPLNAM = "TPAHP5A";
  /*  */
  TPAHP5P9-P1();
  /*  */
end // end TPAHP5P9-L1


// Control Retrieve of Data
Function TPAHP5P9-P1()
  /*  */
  H-TPAHI1.UPI = H-TPAHP5.UPI;
  H-TPAHI1.ADR-TYPE = H-TPAHP5.ADR-TYPE;
  H-TPAHI1.ADR-STS = H-TPAHP5.ADR-STS;
  H-TPAHI1.ADR-SRC = H-TPAHP5.ADR-SRC;
  H-TPAHI1.INTRFC-SSN = H-TPAHP5.INTRFC-SSN;
  H-TPAHI1.LAST-UPD-DT = H-TPAHP5.LAST-UPD-DT;

  if (H-TPAHP5.ADR-FORMAT == "Y")
    TPAHP5W.PIO1-ADDR1 = H-TPAHP5.ADR1;
    TPAHP5W.PIO1-ADDR2 = H-TPAHP5.ADR2;

    call "CAD01A" (TPAHP5W) {isNoRefresh = yes, isExternal = yes};

    if (TPAHP5W.PIO1-CODE == 0)
      H-TPAHI1.HOUSE-NMB = TPAHP5W.PIO1-HOUSE-NUM;
      H-TPAHI1.STR-DIR = TPAHP5W.PIO1-STR-DIR;
      H-TPAHI1.STR-NM = TPAHP5W.PIO1-STR-NAME;
      H-TPAHI1.STR-TYPE = TPAHP5W.PIO1-STR-TYPE;
      H-TPAHI1.APT-NMB = TPAHP5W.PIO1-APT-NUM;
      H-TPAHI1.OTH-ADDR = TPAHP5W.PIO1-OTHER-ADDR;
    else
  /* WI 22949 begin*/
  /* MOVE TPAHP5W.PIO1-STR-NAME TO H2-PERSON-ADRS-HST.STR-NM;*/
      if (H-TPAHP5.ADR1 != " ")
        H-TPAHI1.OTH-ADDR = H-TPAHP5.ADR1;
      else
        H-TPAHI1.OTH-ADDR = H-TPAHP5.ADR2;
      end
  /* WI 22949 end*/
    end
  else
    H-TPAHI1.HOUSE-NMB = H-TPAHP5.HOUSE-NUM;
    H-TPAHI1.STR-DIR = H-TPAHP5.STR-DIR;
    H-TPAHI1.STR-NM = H-TPAHP5.STR-NAME;
    H-TPAHI1.STR-TYPE = H-TPAHP5.STR-TYPE;
    H-TPAHI1.APT-NMB = H-TPAHP5.APT-NUM;
    H-TPAHI1.OTH-ADDR = H-TPAHP5.OTHER-ADDR;
  end

  if (H-TPAHI1.OTH-ADDR == " ")
    H-TPAHI1.OTH-ADDR = H-TPAHP5.ADR3;
  end
  H-TPAHI1.CITY = H-TPAHP5.CITY;
  if (H-TPAHP5.ST-CD == " ")
    H-TPAHI1.CNTRY-CD = H-TPAHP5.CNTRY-CD;
  else
    H-TPAHI1.ST-CD = H-TPAHP5.ST-CD;
  end
  if (H-TPAHP5.ZIP-CD == " ")
    H-TPAHI1.ZIP-CD = H-TPAHP5.CNTRY-ZIP;
  else
    H-TPAHI1.ZIP-CD = H-TPAHP5.ZIP-CD;
  end

  H-TPAHI1.ADR-VRFD-BY = " ";
  H-TPAHI1.ADR-VRFD-DT = "9999-12-31";
  H-TPAHI1.AS-OF-DT = H-TPAHP5.CRTN-DT;
  H-TPAHI1.PRD-END-DT = "9999-12-31";
  H-TPAHI1.ADR-VRFD-CD = "N";
  H-TPAHI1.ADR-STS-EFF-DT = H-TPAHP5.CRTN-DT;

  call "TPAHI1A" (VDBCONTROL, VMESSAGE, H-TPAHI1, GNOMADS, G-IV-D) {isNoRefresh = yes};

  if (VDBCONTROL.URC > 104)
    exit program;
  end
end // end TPAHP5P9-P1


Record TPAHP5W type basicRecord
  10 PIO1-PARSE-OUT char(142) ; 
    15 PIO1-ADDR1 char(35) ; 
    15 PIO1-ADDR2 char(35) ; 
    15 PIO1-HOUSE-NUM char(8) ; 
    15 PIO1-STR-DIR char(2) ; 
    15 PIO1-STR-NAME char(25) ; 
    15 PIO1-STR-TYPE char(4) ; 
    15 PIO1-APT-NUM char(5) ; 
    15 PIO1-OTHER-ADDR char(25) ; 
    15 PIO1-CODE num(1) ; 
    15 PIO1-ERR-MSG-NR num(2) ; 
end // end TPAHP5W


Record TPAHP5W1 type basicRecord
  10 WS-COUNT int ; 
  10 WS-OTH-COUNT int ; 
  10 WS-ADDR char(80) ; 
    15 WS-ADDR1 char(40) ; 
    15 WS-ADDR2 char(40) ; 
end // end TPAHP5W1


