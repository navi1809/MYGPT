import org.w3c.dom.*;

public class XmlNilCleaner {

    /**
     * Removes elements with xsi:nil="true" under a specific parent tag.
     *
     * @param doc                 The DOM Document to clean.
     * @param parentTagLocalName The local name of the parent element (e.g., "RootWrapper").
     */
    public static void removeNilsUnderElement(Document doc, String parentTagLocalName) {
        NodeList allElements = doc.getElementsByTagName("*");

        for (int i = 0; i < allElements.getLength(); i++) {
            Element el = (Element) allElements.item(i);
            if (parentTagLocalName.equals(el.getLocalName())) {
                cleanChildrenWithNil(el);
            }
        }
    }

    // Helper: removes children of an element that have xsi:nil="true"
    private static void cleanChildrenWithNil(Element parent) {
        NodeList children = parent.getChildNodes();
        for (int j = children.getLength() - 1; j >= 0; j--) {
            Node child = children.item(j);
            if (child.getNodeType() == Node.ELEMENT_NODE) {
                Element childEl = (Element) child;
                if ("true".equals(childEl.getAttributeNS("http://www.w3.org/2001/XMLSchema-instance", "nil"))) {
                    parent.removeChild(childEl);
                }
            }
        }
    }
}
