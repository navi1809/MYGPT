package IVA_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=AIN22A ****
// **************
// COMPONENT NAME: AIN22A
// ===============
// *
// DESCRIPTION:
// ============
// THE INTERFACE PERFORMS ALL EDIT-CHECKS REQUIRED ON THE
// SDX-SSI INTERFACE FILE. THE ECS WORKER IS ALERTED AND
// ELIGIBILITY TRIGGERED. IF THE UNEARNED INCOME REPORTED
// BY THE BENEFICIARY IS BEYOND THE TOLERANCE LIMIT THE
// UNEARNED INCOME IN THE UNIN SCREEN IS ACCORDINGLY UPDATED.
// A SEQUENTIAL FILE IS ALSO BUILT UP, WHICH IS USED LATER
// FOR PRINTING.
// *
// ***********************
Program AIN22A type basicProgram //VAGen Info - main batch program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  inputRecord = VWORKSTOR
  }

  // Data Declarations
  AIN22W AIN22W; // record
  AIN22W-CLOG-RECD AIN22W-CLOG-RECD; // record
  AIN22W-COST-ARRAY AIN22W-COST-ARRAY; // record
  AIN22W-DATES AIN22W-DATES; // record
  AIN22W-HDR AIN22W-HDR; // record
  AIN22W-ICI-ARRAY AIN22W-ICI-ARRAY; // record
  AIN22W-UNIN-NEW AIN22W-UNIN-NEW; // record
  AIN22W-UNIN-OLD AIN22W-UNIN-OLD; // record
  AIN22W-UNIN-W1 AIN22W-UNIN-W1; // record
  AIN22W1 AIN22W1; // record
  AIN22W2 AIN22W2; // record
  AIN22W2-COST AIN22W2-COST; // record
  BDATEREC BDATEREC; // record
  CEP01W CEP01W; // record
  FORMATW FORMATW; // record
  GDW GDW; // record
  H-TFSLI1 H-TFSLI1; // record
  H2-2-CMH-FCH H2-2-CMH-FCH; // record
  H2-2-CMH-PER H2-2-CMH-PER; // record
  H2-2-FAC-SPT H2-2-FAC-SPT; // record
  H2-3-CMH-FCH-PER H2-3-CMH-FCH-PER; // record
  H2-ALTERNATE-SSN H2-ALTERNATE-SSN; // record
  H2-BG-TRN H2-BG-TRN; // record
  H2-CASE-LOG H2-CASE-LOG; // record
  H2-CASE-MEMBER-HST H2-CASE-MEMBER-HST; // record
  H2-CLNDR H2-CLNDR; // record
  H2-COST-INFC-DTLS H2-COST-INFC-DTLS; // record
  H2-ELIG-VERSION H2-ELIG-VERSION; // record
  H2-FAM-CASE H2-FAM-CASE; // record
  H2-FAM-CASE-HSTRY H2-FAM-CASE-HSTRY; // record
  H2-INCAP-DSBLTY H2-INCAP-DSBLTY; // record
  H2-LSUM-RSRCE-DTLS H2-LSUM-RSRCE-DTLS; // record
  H2-MASS-CHNG-PARMS H2-MASS-CHNG-PARMS; // record
  H2-PERSON-ADRS-HST H2-PERSON-ADRS-HST; // record
  H2-RESP-PRSN-DBTR H2-RESP-PRSN-DBTR; // record
  H2-SDX-SSI-BNFDTL H2-SDX-SSI-BNFDTL; // record
  H2-SDXI-UERND-INCM H2-SDXI-UERND-INCM; // record
  H2-UERND-INCM-DTL H2-UERND-INCM-DTL; // record
  P-DATE-REC3 P-DATE-REC3; // record
  PCALINP PCALINP; // record
  PIIN-SDX-PROCESS PIIN-SDX-PROCESS; // record
  REP-COMMON REP-COMMON; // record
  S2-2-FCH-PER S2-2-FCH-PER; // record
  SR-Q22CL-REC SR-Q22CL-REC; // record
  SR-Q22IP-REC SR-Q22IP-REC; // record
  SR-Q22IP-REC-R SR-Q22IP-REC-R { redefines = SR-Q22IP-REC } ; // record
  SR-Q22OP-REC SR-Q22OP-REC; // record
  VDBCOMMON VDBCOMMON; // record
  VDBCONTROL VDBCONTROL; // record
  VMESSAGE VMESSAGE; // record
  VSTRREC VSTRREC; // record
  VSTRREC6 VSTRREC6; // record
  VWORKSTOR VWORKSTOR ; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    AIN22P9-MAIN: AIN22P9-MAIN();
  end // end main
end // end AIN22A


// ADD 1 TO MONTH
Function AIN22P9-ADD-1-MM()
  /*  */

  if (AIN22W-DATES.WS-CALC-EFF-MM == "12")
    AIN22W-DATES.WS-CALC-EFF-MM-NUM = 01;
    AIN22W-DATES.WS-CALC-EFF-CCYY-NUM = AIN22W-DATES.WS-CALC-EFF-CCYY-NUM + 1;
  else
    AIN22W-DATES.WS-CALC-EFF-MM-NUM = AIN22W-DATES.WS-CALC-EFF-MM-NUM + 1;
  end

  AIN22W-DATES.WS-CALC-EFF-DD = "01";

  /*  */
end // end AIN22P9-ADD-1-MM


// ADD 2 TO MONTH
Function AIN22P9-ADD-2-MM()
  /*  */

  if (AIN22W-DATES.WS-CALC-EFF-MM == "11")
    AIN22W-DATES.WS-CALC-EFF-MM-NUM = 01;
    AIN22W-DATES.WS-CALC-EFF-CCYY-NUM = AIN22W-DATES.WS-CALC-EFF-CCYY-NUM + 1;
  else
    if (AIN22W-DATES.WS-CALC-EFF-MM == "12")
      AIN22W-DATES.WS-CALC-EFF-MM-NUM = 02;
      AIN22W-DATES.WS-CALC-EFF-CCYY-NUM = AIN22W-DATES.WS-CALC-EFF-CCYY-NUM + 1;
    else
      AIN22W-DATES.WS-CALC-EFF-MM-NUM = AIN22W-DATES.WS-CALC-EFF-MM-NUM + 2;
    end
  end

  AIN22W-DATES.WS-CALC-EFF-DD = "01";

  /*  */
end // end AIN22P9-ADD-2-MM


// ADD LUMP SUM RSRCE
Function AIN22P9-ADD-I06()
  /* INSERT NEW LUMP SUM ROW*/
  WDB00PI();
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  VDBCOMMON.USQLREC = "H2-LSUM-RSRCE-DTLS";
  VDBCONTROL.UPROC-OBJ = "H2-LSUM-RSRCE-DTLS";
  VDBCONTROL.UPROC-NM = "AIN22P9-ADD-I06";
  VDBCONTROL.UPROC-OPT = "ADD";
  try
    add H2-LSUM-RSRCE-DTLS ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN22P9-ADD-I06


// CALL-ALERT-WORKER
Function AIN22P9-ALERT()
  /* CBSI START*/
  /* DETERMINE ALL THE CASE-ID'S FOR THE UPI*/

  set H2-CASE-MEMBER-HST empty;
  /* if goldberg/kellysend that alert*/
  /* IF SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) = 'G';*/
  /* MOVE H2-2-CMH-PER.SSN TO AIN22W1.PALERT-CASE-ID;*/
  /* MOVE H2-2-CMH-PER.ICI TO AIN22W.WS-ICI;*/
  /* MOVE AIN22W.WS-ICI TO AIN22W1.PALERT-UPI;*/
  /* MOVE 129044 TO AIN22W1.PALERT-ALERT-ID;*/
  /* MOVE 'C' TO AIN22W1.PALERT-ACTION;*/
  /* MOVE ' ' TO AIN22W1.PALERT-SUFX;*/
  /* MOVE AIN22W1.PALERT-ALERT-ID TO PCALINP.PAL-ALERT-CD;*/
  /* MOVE AIN22W1.PALERT-CASE-ID TO PCALINP.PAL-CASE-ID;*/
  /* MOVE AIN22W1.PALERT-ACTION TO PCALINP.PAL-ALERT-ACTION;*/
  /* MOVE AIN22W1.PALERT-DISP-DT TO PCALINP.PAL-DISPL-DT;*/
  /* MOVE AIN22W1.PALERT-DISP-DT TO PCALINP.PAL-PROCESS-DT;*/
  /* CALL CAL11A VDBCONTROL,VMESSAGE,PCALINP (NOMAPS;*/
  /* IF VDBCONTROL.URC > 104;*/
  /* PERFORM WCM00P2-TO-CEP01A;*/
  /* END;*/
  /* END;*/
  if ((AIN22W.WS-ALERT-FLAG == "T" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G") || 
  (AIN22W.WS-ERR-UERND-INCM-AMT != " " || 
  AIN22W.WS-MOVED-OUT-OF-STATE != " " || 
  AIN22W.WS-ERR-PYMT-STS-CD != " " || 
  AIN22W.WS-ERR-ZIP-CD != " " || 
  AIN22W.WS-ERR-UERND-INC-AMT != " " || 
  AIN22W.WS-UNIN-UPDATED != " " || 
  AIN22W.WS-UNIN-MORE-REC != " " || 
  AIN22W.WS-UNIN-FREQ-FLAG != " " || 
  AIN22W.WS-LSUM-ADDED != " " || 
  AIN22W.WS-DISA-UPDATED != " " || 
  AIN22W.WS-ERR-PB-LAW-CD != " "))
    if (AIN22W.WS-DSGNT-IND == "T")
  /* THIS CHANGE HAS BEEN DONE AFTER GOING THROUGH THE REQUIREMENTS*/
  /* OF CAL11A PROGRAM*/
      AIN22W1.PALERT-CASE-ID = H2-2-CMH-PER.SSN;
      AIN22W1.PALERT-SUFX = "I";
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
      if (AIN22W.WS-UPD-IND == "Y")
        AIN22W1.PALERT-ALERT-ID = 129002;
      else
        AIN22W1.PALERT-ALERT-ID = 129013;
      end
      AIN22W1.PALERT-ACTION = "C";
  /* /*//**//**//**//**//**//**//**//**//**//**//**//**-PTR 6820 BEGIN/*//**//**//**//**//**//**//**//**//**//**//**//***/
      PCALINP.PAL-ALERT-CD = AIN22W1.PALERT-ALERT-ID;
      PCALINP.PAL-CASE-ID = AIN22W1.PALERT-CASE-ID;
      PCALINP.PAL-ALERT-ACTION = AIN22W1.PALERT-ACTION;
      PCALINP.PAL-DISPL-DT = AIN22W1.PALERT-DISP-DT;
  /* 6274 /*- add process date /*//**- 09/25/96 /*//**- begin /*//**//***/
      PCALINP.PAL-PROCESS-DT = AIN22W1.PALERT-DISP-DT;
  /* /*//**//**//**//**//**//**//**//**//**//**//**//**-PTR 6820 END/*&-6274/*//**//**//**//**//**//**//**//**//***/
      if (AIN22W.WS-ALERT-FLAG == "T")
        call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
        AIN22W.WS-ALERT-FLAG = " ";
      end
    else
      H2-CASE-MEMBER-HST.UPI = H2-2-CMH-PER.UPI;
      H2-CASE-MEMBER-HST.PRD-END-DT = "9999-12-31";
       /* WI 21582 START*/
      AIN22P9-CMH-QUERY();
  /* PERFORM AIN22P9-QUERY-S04;*/
       /* WI 21582 END*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      else
       /* WI 21582 START*/
        AIN22P9-CMH-SCAN();
  /* PERFORM AIN22P9-SCAN4;*/
       /* WI 21582 END*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      end
      while (sysVar.sqlData.sqlcode == 0)
       /* WI 21582 START*/
        H2-FAM-CASE-HSTRY.ICI = H2-CASE-MEMBER-HST.ICI;
        AIN22W2.WS-DATE-CCYY = AIN22W.WS-PROCESS-DATE-CCYY;
        AIN22W2.WS-DATE-MM = AIN22W.WS-PROCESS-DATE-MO;
        AIN22W2.WS-DATE-DD = AIN22W.WS-PROCESS-DATE-DT;
        AIN22P9-LAST-DAY();
        H2-FAM-CASE-HSTRY.PRD-END-DT = AIN22W2.WS-PREV-DATE;
  /* MOVE '9999-12-31' TO H2-FAM-CASE-HSTRY.PRD-END-DT;*/
        AIN22P9-CASE-STS();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
        if (H2-FAM-CASE-HSTRY not ioError)
       /* WI 21582 END*/
          AIN22W.WS-ICI = H2-CASE-MEMBER-HST.ICI;
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
          if (AIN22W.WS-UPD-IND == "Y")
            AIN22W1.PALERT-ALERT-ID = 129002;
          else
            AIN22W1.PALERT-ALERT-ID = 129013;
          end
          AIN22W1.PALERT-SUFX = " ";
  /* THE UPI HAS BEEN MOVED AFTER NOTING THE REQUIREMENT OF CAL11A*/
          AIN22W1.PALERT-UPI = AIN22W.WS-ICI;
          AIN22W1.PALERT-ACTION = "C";
  /* PTR3143 BEGIN*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/
  /* MOVE AIN22W.WS-SYS-MM TO AIN22W.WS-SYS1-MM;*/
  /* MOVE AIN22W.WS-SYS-DD TO AIN22W.WS-SYS1-DD;*/
  /* MOVE AIN22W.WS-SYS-YY TO AIN22W.WS-SYS1-YY;*/
  /* MOVE AIN22W.WS-SYS-CC TO AIN22W.WS-SYS1-CC;*/
  /* MOVE AIN22W.WS-SYS1-DATE TO AIN22W1.PALERT-DISP-DT;*/
  /* /*//**//**//**//**//**//**//**//**//**//**//**//**-PTR 6820 BEGIN/*//**//**//**//**//**//**//**//**//**//**//**//***/
          PCALINP.PAL-ALERT-CD = AIN22W1.PALERT-ALERT-ID;
          PCALINP.PAL-CASE-ID = AIN22W1.PALERT-CASE-ID;
          PCALINP.PAL-ALERT-ACTION = AIN22W1.PALERT-ACTION;
          PCALINP.PAL-DISPL-DT = AIN22W1.PALERT-DISP-DT;
  /* /*//**//**//**//**//**//**//**//**//**//**//**//**-PTR 6820 END/*//**//**//**//**//**//**//**//**//**//**//**//**//***/
          if (AIN22W.WS-ALERT-FLAG == "T")
            call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end
            AIN22W.WS-ALERT-FLAG = " ";
          end
       /* WI 21582 START*/
       /* GENERATE CASE LOG FOR DIFFERENT CHANGES */
       /* INCOME CHANGE,ADDRESS CHANGE,STATE OF RESIDENCE CHANGE */
       /* PAYMENT STATUS CHANGE AND ANY CHANGE TO PUBLIC LAW CASES */
          AIN22P9-CLOG();
       /* WI 21582 END*/
          if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
            PCALINP.PAL-UPI = AIN22W.WS-ICI;
            PCALINP.PAL-ALERT-ACTION = "C";
            PCALINP.PAL-ALERT-CD = 129044;
            AIN22W1.PALERT-SUFX = " ";
            call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end
          end
       /* WI 21582 START*/
          AIN22P9-CMH-SCAN();
  /* PERFORM AIN22P9-SCAN4;*/
       /* WI 21582 END*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
       /* WI 21582 START*/
        end
       /* WI 21582 END*/
      end
      AIN22W.WS-ALERT-FLAG = " ";
    end
  end
  AIN22W.WS-ERR-UERND-INCM-AMT = " ";
  AIN22W.WS-MOVED-OUT-OF-STATE = " ";
  AIN22W.WS-ERR-PYMT-STS-CD = " ";
  AIN22W.WS-ERR-ZIP-CD = " ";
  AIN22W.WS-ERR-UERND-INC-AMT = " ";
  AIN22W.WS-UNIN-UPDATED = " ";
  AIN22W.WS-UNIN-MORE-REC = " ";
  AIN22W.WS-UNIN-FREQ-FLAG = " ";
  AIN22W.WS-LSUM-ADDED = " ";
  AIN22W.WS-ERR-PB-LAW-CD = " ";
  AIN22W.WS-DISA-UPDATED = " ";
  /* CBSI END*/
end // end AIN22P9-ALERT


// GET DATES FOR BG-TRAN FR & TO
Function AIN22P9-BGT-FR-TO()
  /*  */
  /* ****************** WI 25803:WNMLS:2005-09-01 START *******************/

  AIN22P9-ENROL-DT();
  AIN22W.WS-SYS-MM = AIN22W.WS-VALID-ENROL-MM;
  AIN22W.WS-SYS-YR = AIN22W.WS-VALID-ENROL-YY;
  if (AIN22W.WS-SYS-MM == "02")
    AIN22W.WS-REM1 = AIN22W.WS-SYS-NUM-YR % 4;
    AIN22W.WS-REM2 = AIN22W.WS-SYS-NUM-YR % 100;
    AIN22W.WS-REM3 = AIN22W.WS-SYS-NUM-YR % 400;
    if (AIN22W.WS-REM1 != 0)
      AIN22W.WS-SYS-DD = "28";
    else
      if (AIN22W.WS-REM2 == 0)
        if (AIN22W.WS-REM3 == 0)
          AIN22W.WS-SYS-DD = "29";
        else
          AIN22W.WS-SYS-DD = "28";
        end
      else
        AIN22W.WS-SYS-DD = "28";
      end
    end

  else
    if (AIN22W.WS-SYS-MM == "04" || 
    AIN22W.WS-SYS-MM == "06" || 
    AIN22W.WS-SYS-MM == "09" || 
    AIN22W.WS-SYS-MM == "11")
      AIN22W.WS-SYS-DD = "30";
    else
      if (AIN22W.WS-SYS-MM == "01" || 
      AIN22W.WS-SYS-MM == "03" || 
      AIN22W.WS-SYS-MM == "05" || 
      AIN22W.WS-SYS-MM == "07" || 
      AIN22W.WS-SYS-MM == "08" || 
      AIN22W.WS-SYS-MM == "10" || 
      AIN22W.WS-SYS-MM == "12")
        AIN22W.WS-SYS-DD = "31";
      end
    end
  end

  AIN22W.WS-SYS1-DD = AIN22W.WS-SYS-DD;
  AIN22W.WS-SYS1-MM = AIN22W.WS-SYS-MM;
  AIN22W.WS-SYS1-YY = AIN22W.WS-SYS-YY;
  AIN22W.WS-SYS1-CC = AIN22W.WS-SYS-CC;
  AIN22W.WS-SYS1-F1 = "-";
  AIN22W.WS-SYS1-F2 = "-";
  AIN22W.WS-END-DATE = AIN22W.WS-SYS1-DATE;

  AIN22W2-COST.BFR-BG-TRAN-FR-DT = AIN22W.WS-VALID-ENROL-DT;
  AIN22W2-COST.BFR-BG-TRAN-TO-DT = AIN22W.WS-END-DATE;

  AIN22W2-COST.WORK-BNFT-DT = AIN22W2-COST.BFR-BG-TRAN-FR-DT; /* date that's used for incrementing*/

  /* ****************** WI 25803:WNMLS:2005-09-01 END *********************/
  /*  */
end // end AIN22P9-BGT-FR-TO


// Build ICI & COST ARRAYS
Function AIN22P9-BILD-ARRYS()
  /*  */
  /* ****************** WI 25803:WNMLS:2005-09-01 START *******************/

  set AIN22W-COST-ARRAY empty;
  AIN22W-COST-ARRAY.CWS-ARRAY-IDX = 1;

  set AIN22W-ICI-ARRAY empty;
  AIN22W-ICI-ARRAY.IWS-ARRAY-IDX = 1;

  set H2-2-CMH-FCH empty;
  H2-2-CMH-FCH.UPI = AIN22W.WS-UPI;

  AIN22W.WS-DUMMY-DATE = AIN22W2-COST.INFILE-DATE;
  AIN22P9-DATE-PROC();
  H2-2-CMH-FCH.PRD-END-DT = AIN22W.WS-LAST-DATE;
  AIN22W2-COST.WS-CMH-FCH-PRD-END-DT = AIN22W.WS-LAST-DATE;

  AIN22Q1-S-CMH-FCH();

  if (sysVar.sqlData.sqlcode == 0)
    AIN22Q1-SCN-CMHFCH();
    while (sysVar.sqlData.sqlcode == 0) /* Pop ICI array*/

      AIN22W-ICI-ARRAY.IWS-ICI[IWS-ARRAY-IDX] = H2-2-CMH-FCH.ICI;

      AIN22W-ICI-ARRAY.IWS-ARRAY-IDX = AIN22W-ICI-ARRAY.IWS-ARRAY-IDX + 1;
      AIN22W-ICI-ARRAY.IWS-ARRAY-SIZE = AIN22W-ICI-ARRAY.IWS-ARRAY-SIZE + 1;

      AIN22P9-COST-BFORE(); /* Pop COST array with elig-ver vals*/


      AIN22Q1-SCN-CMHFCH(); /* Get all ICI's for the UPI*/
    end /* WHILE EZE = 0*/
  end /* IF EZE = 0*/

  /* ****************** WI 25803:WNMLS:2005-09-01 END *********************/
  /*  */
end // end AIN22P9-BILD-ARRYS


// CONTROL LUMP SUM BUILD
Function AIN22P9-BILD-LSUM()
  /* ** WI 21582 START ***/
  set H2-LSUM-RSRCE-DTLS empty;
  AIN22W.WS-UNIN-BEG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  AIN22W.WS-DD-UNIN-BEG-DT = 01;
  H2-LSUM-RSRCE-DTLS.PRD-BEG-DT = AIN22W.WS-UNIN-BEG-DT;
  /* ** WI 21582 END  ***/
  H2-LSUM-RSRCE-DTLS.UPI = WS-UPI;
  AIN22P9-INQ-S12();
  if (sysVar.sqlData.sqlcode != 0)
    H2-LSUM-RSRCE-DTLS.RSRC-SQ-NMB = 1;
  else
    H2-LSUM-RSRCE-DTLS.RSRC-SQ-NMB = H2-LSUM-RSRCE-DTLS.RSRC-SQ-NMB + 1;
  end
  H2-LSUM-RSRCE-DTLS.LUMP-SUM-RSRCE-AMT = (SR-Q22IP-REC.TRE-SSI-MONTHLY-ASSIST-AMT -   SR-Q22IP-REC.TRE-SSI-GROSS-PAYABLE-AMT);
  H2-LSUM-RSRCE-DTLS.RECUR-IND = "N";
  /* 7404 CHANGE TYPE FROM RP TO SI ---- 09/25/96 -------*/
  H2-LSUM-RSRCE-DTLS.LUMP-SUM-RSRCE-TYP = "SI";
  H2-LSUM-RSRCE-DTLS.AFDC-CNTBL-IND = "N";
  H2-LSUM-RSRCE-DTLS.CHAP-CNTBL-IND = "N";
  H2-LSUM-RSRCE-DTLS.FS-CNTBL-IND = "Y";
  H2-LSUM-RSRCE-DTLS.MA-CNTBL-CD = "Y";
  H2-LSUM-RSRCE-DTLS.DISREG-30-1-3-IND = "N";
  /* PTR 8521 CORRECT -180 FOUND WHEN TESTING THIS PTR - 11/19/96 - BEGIN*/
  /* PTR 11455 correct prd_end_dt below --STRT---------- 05/19/97 -------*/
  AIN22W2.WS-DATE-YY = BDATEREC.BDATE-PROCESS-DATE-YY;
  AIN22W2.WS-DATE-MM = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIN22P9-LAST-DAY();
  H2-LSUM-RSRCE-DTLS.PRD-END-DT = AIN22W2.WS-PREV-DATE;
  /* PTR 11316 correct prd_end_dt -END------------------ 05/19/97 -------*/
  AIN22W.WS-UNIN-BEG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  AIN22W.WS-DD-UNIN-BEG-DT = 01;
  H2-LSUM-RSRCE-DTLS.RCPT-DT = AIN22W.WS-UNIN-BEG-DT;
  H2-LSUM-RSRCE-DTLS.RPRTD-DT = AIN22W.WS-UNIN-BEG-DT;
  H2-LSUM-RSRCE-DTLS.PRD-BEG-DT = AIN22W.WS-UNIN-BEG-DT;
  H2-LSUM-RSRCE-DTLS.CHNG-ENTRY-DT = AIN22W.WS-UNIN-BEG-DT;
  H2-LSUM-RSRCE-DTLS.LS-RES-VRFN-DT = AIN22W.WS-UNIN-BEG-DT;
  /* PTR 8521 CORRECT -180 FOUND WHEN TESTING THIS PTR - 11/19/96 - END*/
  AIN22P9-ADD-I06();
  /* ** START WI 21582*/
  AIN22W.WS-LSUM-ADDED = "T";
  AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
  AIN22W.WS-ALERT-FLAG = "T";
  /* ** END WI 21582*/
  /* PTR 7404 ADD ALERT ------------- 09/25/96 ------*/
  AIN22W1.PALERT-CASE-ID = H2-2-CMH-PER.SSN;
  AIN22W1.PALERT-SUFX = "I";
  AIN22W1.PALERT-ALERT-ID = 129003;
  AIN22W1.PALERT-ACTION = "C";
  PCALINP.PAL-ALERT-CD = AIN22W1.PALERT-ALERT-ID;
  PCALINP.PAL-CASE-ID = AIN22W1.PALERT-CASE-ID;
  PCALINP.PAL-ALERT-ACTION = AIN22W1.PALERT-ACTION;
  PCALINP.PAL-DISPL-DT = AIN22W1.PALERT-DISP-DT;
  PCALINP.PAL-PROCESS-DT = AIN22W1.PALERT-DISP-DT;
  call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN22P9-BILD-LSUM


// BUILD-REPORT-FILE
Function AIN22P9-BUILD-REP()
  /* CBSI START*/
  /* PTR 9721 SPLIT PROBLEM SQL JOIN ----- 02/12/97 ---- BEGIN*/
  /* SET H2-3-CMH-FAC-SPT EMPTY;*/
  set H2-CASE-MEMBER-HST empty;
  set S2-2-FCH-PER empty;
  H2-CASE-MEMBER-HST.UPI = AIN22W.WS-UPI;
  /* MOVE AIN22W.WS-UPI TO H2-3-CMH-FAC-SPT.UPI;*/
  /* MOVE '9999-12-31' TO H2-3-CMH-FAC-SPT.PRD-END-DT;*/
  H2-CASE-MEMBER-HST.PRD-END-DT = "9999-12-31";
  /* PTR 3954 BEGIN*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO H2-3-CMH-FAC-SPT.ASMNT-BEG-DT;*/
  H2-2-FAC-SPT.ASMNT-BEG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  /* END*/

  AIN22P9-QUERY-S06();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  while (sysVar.sqlData.sqlcode == 0)

    /* TO GET THE SSN / CASE NUMBER OF HOH UPI*/

    S2-2-FCH-PER.ICI = H2-CASE-MEMBER-HST.ICI;
    H2-2-FAC-SPT.ICI = H2-CASE-MEMBER-HST.ICI;
    AIN22P9-QUERY-S6B();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    S2-2-FCH-PER.ICI = H2-CASE-MEMBER-HST.ICI;
    /* MOVE H2-3-CMH-FAC-SPT.PRD-BEG-DT TO S2-2-FCH-PER.PRD-BEG-DT;*/
    S2-2-FCH-PER.PRD-BEG-DT = H2-CASE-MEMBER-HST.PRD-BEG-DT;
    AIN22P9-QUERY-S07();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    if (sysVar.sqlData.sqlcode == 0)
      SR-Q22OP-REC.AIN22A-01-OFC-CD = H2-2-FAC-SPT.OFC-CD;
      SR-Q22OP-REC.AIN22A-01-CASLD-ID = H2-2-FAC-SPT.CASLD-ID;
      SR-Q22OP-REC.AIN22A-01-NOMADS-USRID = H2-2-FAC-SPT.NOMADS-USRID;
  /* PTR 9721 SPLIT PROBLEM SQL JOIN ----- 02/12/97 ---- END*/
      SR-Q22OP-REC.AIN22A-01-LAST-NAME = SR-Q22IP-REC.TRE-LAST-NAME;
      SR-Q22OP-REC.AIN22A-01-FIRST-NAME = SR-Q22IP-REC.TRE-FIRST-NAME;
      SR-Q22OP-REC.AIN22A-01-MIDDLE-INIT = SR-Q22IP-REC.TRE-MIDDLE-INIT;
  /* START WI 21582*/
      S2-2-FCH-PER.ICI = H2-CASE-MEMBER-HST.ICI;
    /* MOVE H2-3-CMH-FAC-SPT.PRD-BEG-DT TO S2-2-FCH-PER.PRD-BEG-DT;*/
      S2-2-FCH-PER.PRD-BEG-DT = H2-CASE-MEMBER-HST.PRD-BEG-DT;
      AIN22P9-QUERY-S07();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
      if (sysVar.sqlData.sqlcode == 0)
  /* END   WI 21582*/
        SR-Q22OP-REC.AIN22A-01-CASE-NUMBER = S2-2-FCH-PER.SSN;
      /* PTR 5508 ADD NEW-SSN TO*/
        if (AIN22W.WS-NEW-SSN == " ")
          SR-Q22OP-REC.AIN22A-01-NEW-SSN = " ";
        else
          SR-Q22OP-REC.AIN22A-01-NEW-SSN = AIN22W.WS-NEW-SSN;
        end
      end
  /* PTR3143 BEGIN*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/
  /* MOVE AIN22W.WS-SYS-MM TO AIN22W.WS-CHA-MM;*/
  /* MOVE AIN22W.WS-SYS-DD TO AIN22W.WS-CHA-DD;*/
  /* MOVE AIN22W.WS-SYS-YR TO AIN22W.WS-CHA-YR;*/
  /* MOVE AIN22W.WS-CHA-DATE TO AIN22W.WS-NUM-DATE;*/
      SR-Q22OP-REC.AIN22A-01-PROCESS-DATE = AIN22W.WS-NOMADS-PROCESS-DATE;
  /* PRT3143 END*/
      SR-Q22OP-REC.AIN22A-01-NOMADS-AMT = AIN22W.WS-NOMADS-SSI-AMT;
      SR-Q22OP-REC.AIN22A-01-INTERFACE-AMT = AIN22W.WS-INTERFACE-SSI-AMT;
      AIN22W.WS-REPORT-DIFF = AIN22W.WS-NOMADS-SSI-AMT -       AIN22W.WS-INTERFACE-SSI-AMT;
      SR-Q22OP-REC.AIN22A-01-REPORT-DIFF = AIN22W.WS-REPORT-DIFF;
      /* PTR 7082  ALLOW FOR 0 IN INTERFACE-SSI-AMT*/
      if (AIN22W.WS-INTERFACE-SSI-AMT == 0.00 || 
      AIN22W.WS-NOMADS-SSI-AMT == 0.00)
        AIN22W.WS-REPORT-DIFF-PCT = 999;
        /* PTR 7082 PUT PRCNT ON OUTPUT*/
        SR-Q22OP-REC.AIN22A-01-DIFF-PCT = AIN22W.WS-REPORT-DIFF-PCT;
      else
        AIN22W.WS-REPORT-DIFF-PCT = (AIN22W.WS-NOMADS-SSI-AMT / AIN22W.WS-INTERFACE-SSI-AMT) * 100;
        SR-Q22OP-REC.AIN22A-01-DIFF-PCT = AIN22W.WS-REPORT-DIFF-PCT;
      end
      /* PTR 7055 ONLY PUT MSG ON LINES THAT HAD ALERT CREATED*/
      /* PTR 9397 ONLY PUT MSG ON LINES THAT HAD ALERT CREATED*/
      /* WI 13259 ANY CHANGE HAS ALERT CREATED*/
      /* IF WS-ALERT-FLAG = 'Y';*/
      /* IF AIN22W.WS-REPORT-DIFF-PCT > 104 OR*/
      /* AIN22W.WS-REPORT-DIFF-PCT < 096;*/
      if (AIN22W.WS-REPORT-DIFF-PCT > 100 || 
      AIN22W.WS-REPORT-DIFF-PCT < 100)
        SR-Q22OP-REC.AIN22A-01-ACTION = "ECS-ALRTED";
      else
        SR-Q22OP-REC.AIN22A-01-ACTION = " ";
      end
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
      if (AIN22W.WS-UPD-IND == "N")
        SR-Q22OP-REC.AIN22A-01-ACTION = "NOT UPDATED";
      end

      /* PTR 7082 CHANGE TOLERANCE TO TRIGGER-ELIG FLAG*/
      /* THE WS-TOLERANCE-LIMIT-FLAG IS USED TO DETERMINE IF IT IS A*/
      /* PROBLEM*/
      /* CASE OR CHANGED CASE*/

      /* IF AIN22W.WS-TOLERANCE-LIMIT-FLAG = 'F';*/
      if (AIN22W.WS-TRIGGER-ELIGIBILITY == "T")
        SR-Q22OP-REC.AIN22A-01-CASE-TYPE = "P";
      else
        if (AIN22W.WS-NOMADS-SSI-AMT != AIN22W.WS-INTERFACE-SSI-AMT)
          SR-Q22OP-REC.AIN22A-01-CASE-TYPE = "C";
        else
          SR-Q22OP-REC.AIN22A-01-CASE-TYPE = " ";
        end
      end
      AIN22P9-OP01-WRITE();
    end
    AIN22P9-SCAN6();
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  end
  /* CBSI END*/
end // end AIN22P9-BUILD-REP


// check to see if case open
Function AIN22P9-CASE-OPEN()
  AIN22P9-INQ8();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  if (sysVar.sqlData.sqlcode == 100)
    AIN22W.WS-CASE-OPEN = "N";
  else
    AIN22W.WS-CASE-OPEN = "Y";
  end
end // end AIN22P9-CASE-OPEN


Function AIN22P9-CASE-STS()
  WDB00PI();
  /*  */
  /* INITIALIZE:*/
  /* UACCTYP - ACCESS TYPE (R=READ, W=WRITE)*/
  /* UAPPLNAM - APPLICATION NAME*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  /*  */
  /* SET ERROR CONTROL FLAGS*/
  /* UNRF - NO RECORD FOUND FLAG (Y,N,1)*/
  /* UDUP - DUPLICATE KEY FLAG (Y,N)*/
  /* MOVE NAME OF SQL ROW RECORD USED TO COMMON REC*/
  VDBCOMMON.USQLREC = "H2-FAM-CASE-HSTRY";
  VDBCONTROL.UPROC-OBJ = "H2-FAM-CASE-HSTRY";
  VDBCONTROL.UPROC-NM = "AIN22P9-CASE-STS";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-FAM-CASE-HSTRY
      with #sql{
        select ICI
        from TWNFAM_CASE_HSTRY T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE ICI = :ICI
        AND CASE_STS IN ('O','P')
        AND PRD_BEG_DT <= :PRD-END-DT
        AND PRD_END_DT >= :PRD-END-DT
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into ICI ;
  end
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* PERFORM DBM ERROR PROCESSING*/
  WDB00PE-SQLERR();
end // end AIN22P9-CASE-STS


// CHECK FOR RECOUPMNT ACTVY
Function AIN22P9-CHK-DEDN()
  /* CBSI START*/
  /* SET H2-UERND-INCM-DTL EMPTY;*/
  AIN22W.WS-RECOVER-AMOUNT = 0;
  if (SR-Q22IP-REC.TRE-CURR-MONTH-RECOVER-AMT > 0)
   /* CHANGES DUE TO PTR# AIN22001 BEGIN*/
    AIN22W.WS-RECOVER-AMOUNT = SR-Q22IP-REC.TRE-CURR-MONTH-RECOVER-AMT;
   /* CHANGES DUE TO PTR# AIN22001 END*/
    /* MOVE 'T' TO AIN22W.WS-ALERT-FLAG;*/
  /* AS PER THE ISSUE RAISED IN AIN22S1*/
    /* MOVE 'T' TO AIN22W.WS-TRIGGER-ELIGIBILITY;*/
  end
  /* CBSI END*/
end // end AIN22P9-CHK-DEDN


Function AIN22P9-CHK-PADRS()
  /*  */
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-PERSON-ADRS-HST";
  VDBCONTROL.UPROC-OBJ = "H2-PERSON-ADRS-HST";
  VDBCONTROL.UPROC-NM = "AIN22P9-CHK-PADRS";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-PERSON-ADRS-HST
      with #sql{
        select ZIP_CD
        from TWNPERSON_ADRS_HST T1
        WHERE UPI = :UPI
          AND ADR_TYPE = :ADR-TYPE
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into ZIP-CD ;
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 100
   || H2-PERSON-ADRS-HST.ZIP-CD != AIN22W.WS-ZIP-CODE)
    AIN22W.WS-ALERT-FLAG = "T";
  end
  /* ** start wi 21582 ***/
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /* ** end wi 21582 ***/
  /*  */
end // end AIN22P9-CHK-PADRS


// CALCULATE LAST DATE OF MONTH
Function AIN22P9-CLC-END-DT()
  if (AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "04" || 
  AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "06" || 
  AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "09" || 
  AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "11")
    AIN22W-DATES.WS-CURR-MTH-END-DT-DD = "30";
  else
    if (AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "01" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "03" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "05" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "07" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "08" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "10" || 
    AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "12")
      AIN22W-DATES.WS-CURR-MTH-END-DT-DD = "31";
    else
      if (AIN22W-DATES.WS-CURR-MTH-END-DT-MM == "02")
        REP-COMMON.WS-YYYY = AIN22W-DATES.WS-CURR-MTH-END-DT-CCYY;

        LEAP-YEAR-CHECK();
        if (REP-COMMON.WS-LEAP-FLAG == "Y")
          AIN22W-DATES.WS-CURR-MTH-END-DT-DD = "29";
        else
          AIN22W-DATES.WS-CURR-MTH-END-DT-DD = "28";
        end
      end
    end
  end

  /*  */
end // end AIN22P9-CLC-END-DT


// CASE-LOG
Function AIN22P9-CLOG()
  set H2-CASE-LOG empty;
  set VSTRREC6 empty;
  set VSTRREC empty;
  AIN22W.WS-CL-ACTVY-DESC1 = "SDX-SSI INTERFACE DISCREPANCY";
  if (AIN22W.WS-ERR-UERND-INCM-AMT == "T")
    VSTRREC6.USTRING = "INCOME CHANGED, ";
  end
  if (AIN22W.WS-MOVED-OUT-OF-STATE == "Y")
    VSTRREC6.UCONCAT = "STATE OF RESIDENCE CHANGE, ";
  end
  if (AIN22W.WS-ERR-PYMT-STS-CD == "T")
    VSTRREC6.UCONCAT2 = "PAYMENT STATUS CHANGED, ";
  end
  if (AIN22W.WS-ERR-ZIP-CD == "T")
    VSTRREC6.UCONCAT3 = "ADDRESS ZIP CHANGED, ";
  end
  VSTRREC6.USTRLEN = 16;
  VSTRREC6.UCONLEN = 27;
  VSTRREC6.UCONLEN2 = 24;
  VSTRREC6.UCONLEN3 = 21;
  call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  if (AIN22W.WS-ERR-PB-LAW-CD == "T")
    VSTRREC6.UCONCAT = "CHANGE IN PUBLIC LAW CASES";
    VSTRREC6.UCONLEN = 26;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-LSUM-ADDED == "T")
    VSTRREC6.UCONCAT = "LSUM ADDED";
    VSTRREC6.UCONLEN = 10;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-UNIN-FREQ-FLAG == "T")
    VSTRREC6.UCONCAT = "UNIN FREQ IS NOT MONTHLY";
    VSTRREC6.UCONLEN = 24;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-UNIN-MORE-REC == "T")
    VSTRREC6.UCONCAT = "UNIN HAS MORE THAN 1 RECORD";
    VSTRREC6.UCONLEN = 27;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-UNIN-UPDATED == "T")
    VSTRREC6.UCONCAT = "UNIN UPDATED";
    VSTRREC6.UCONLEN = 12;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-ERR-UERND-INC-AMT == "T")
    VSTRREC6.UCONCAT = "ERROR IN UNEARNED INCOME AMT";
    VSTRREC6.UCONLEN = 28;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-DISA-UPDATED == "T")
    VSTRREC6.UCONCAT = "DISA UPDATED";
    VSTRREC6.UCONLEN = 12;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-ERR-DT-OF-BIRTH == "T")
    VSTRREC6.UCONCAT = "DOB ERROR";
    VSTRREC6.UCONLEN = 9;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (AIN22W.WS-ERR-SEX == "T")
    VSTRREC6.UCONCAT = "ERROR IN SEX CODE";
    VSTRREC6.UCONLEN = 17;
    VSTRREC6.UCONCAT2 = ",";
    VSTRREC6.UCONLEN2 = 1;
    VSTRREC6.UCONCAT3 = " ";
    VSTRREC6.UCONLEN3 = 0;
    call "WST51A" (VSTRREC6) {isNoRefresh = yes};
  end
  if (VSTRREC6.USTRING != " ")
    H2-CASE-LOG.CL-ACTVY-DESC = VSTRREC6.USTRING;
    AIN22W.WS-LOG-ENTRY-DE = "SDX-SSI INTERFACE DISCREPANCY";
    H2-CASE-LOG.ICI = AIN22W.WS-ICI;
    H2-CASE-LOG.ACTVY-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
    call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
    H2-CASE-LOG.LOG-CRN-TS = GDW.TS;
    H2-CASE-LOG.PRGM-CASE-TYPE = "CO";
    H2-CASE-LOG.ACTVY-TM = VGVar.currentFormattedTime;
    H2-CASE-LOG.LOG-ENTRY-DESC = AIN22W.WS-LOG-ENTRY-DE;
    H2-CASE-LOG.LOG-ENTRY-TYPE = "S";
    AIN22P9-QUERY-I06();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  end
end // end AIN22P9-CLOG


// SET CURSOR FOR CASE-MEM-HST
Function AIN22P9-CMH-QUERY()
  WDB00PI();
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  /* UNRF - NO RECORD FOUND FLAG (Y,N,1)*/
  /* UDUP - DUPLICATE KEY FLAG (Y,N)*/
  /*  */
  /* PERFORM DBM ERROR PROCESSING*/
  VDBCOMMON.USQLREC = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-NM = "AIN22P9-CMH-QUERY";
  VDBCONTROL.UPROC-OPT = "SETINQ";
  try
    open AIN22P9-CMH-QUERY_RSI01
      with #sql{
        select ICI
        from TWNCASE_MEMBER_HST T1
        WHERE UPI = :UPI AND
              PRD_END_DT = :PRD-END-DT AND
              HH_LEFT_DT = '9999-12-31'
              FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into ICI
      for H2-CASE-MEMBER-HST ;
  end
  VDBCOMMON.UNRF = "1";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
end // end AIN22P9-CMH-QUERY


// READ NEXT CASE_MEM_HST
Function AIN22P9-CMH-SCAN()
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-NM = "AIN22P9-CMH-SCAN";
  VDBCONTROL.UPROC-OPT = "SCAN";
  try
    get next H2-CASE-MEMBER-HST ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
end // end AIN22P9-CMH-SCAN


// WRITE THE CONTROL TOTALS
Function AIN22P9-CNL-ADD()
  /* CBSI START*/
  VGVar.handleHardIOErrors = 1;
  try
    add SR-Q22CL-REC ;
  end
  if (SR-Q22CL-REC is ioError)
    VDBCONTROL.UPROC-OBJ = "SR-Q22CL-REC";
    VDBCONTROL.UPROC-NM = "AIN22P9-CNL-ADD";
    VDBCONTROL.UPROC-OPT = "ADD";
  /* PTR 12560 CALL CEP01A ON ERROR -------------------- 08/03/97 ---*/
    AIN22W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AIN22W.WS-ERR-LAST-FOUR;
    VMESSAGE.UMSGCODE-JCL-ERR = 10;
    VMESSAGE.UMSGINS[2] = "AIN22A";
    WCM00P2-TO-CEP01A();
  end
  /* BATCH ERROR CHECKING - PASS 8 IF NO RECS --------- 07/22/97 ----*/
  if (SR-Q22CL-REC.AININT-CNT-NO-RECS == 0
   || SR-Q22CL-REC.AININT-CNT-REC-PRO == 0)
    VMESSAGE.UMSGCODE-JCL-ERR = 8;
    VMESSAGE.UMSGCODE = "GEN0274 ";
    VMESSAGE.UMSGINS[2] = "AIN22A";
    WCM00P2-TO-CEP01A();
  end
  /* CBSI END*/
end // end AIN22P9-CNL-ADD


// INS EVR TO ICOST BEFORE BGTRAN
Function AIN22P9-COST-BFORE()
  /*  */
  if (H2-2-CMH-FCH.CASE-STS == "O")

  /* Use same source dates for date range of H2-BG-TRN.TRAN-PRD-FM-DT &*/
  /* H2-BG-TRN.TRAN-PRD-TO-DT.*/
  /*  */
    AIN22P9-BGT-FR-TO();

  /* Need WHILE for mult months because of BG-TRAN FM & TO dates.*/
  /* AIN22W2-COST.WORK-BNFT-DT is pop'd with AIN22W2-COST.BFR-BG-TRAN-FR-DT*/
  /*  */
    while (((AIN22W2-COST.WORK-BNFT-DT
     >= AIN22W2-COST.BFR-BG-TRAN-FR-DT)
     && (AIN22W2-COST.WORK-BNFT-DT
     <= AIN22W2-COST.BFR-BG-TRAN-TO-DT)))

  /* FOOD STAMPS*/
      if (H2-2-CMH-FCH.FS-ASST-IND == "Y")

        set H2-ELIG-VERSION empty;

        H2-ELIG-VERSION.ICI = H2-2-CMH-FCH.ICI;
        H2-ELIG-VERSION.PRGM-CASE-TYPE = "FS";
        H2-ELIG-VERSION.BNFT-MTH = AIN22W2-COST.WORK-BNFT-MM;
        H2-ELIG-VERSION.BNFT-YR = AIN22W2-COST.WORK-BNFT-CCYY;

        AIN22Q1-S-EVR();
  /* Need to use a scan here because of mult versions.*/
        if (sysVar.sqlData.sqlcode == 0)
          AIN22Q1-SCAN-EVR();

          if (sysVar.sqlData.sqlcode == 0)

            AIN22P9-POP-ARRAY();

          end
        end

      end

      if (H2-2-CMH-FCH.AFDC-ASST-IND == "Y")

  /* TANF CASH AND CHAP*/
        if (H2-2-CMH-FCH.AFDC-AID-CD == "AF" /* TANF CASH*/
         || H2-2-CMH-FCH.AFDC-AID-CD == "AI" 
         || H2-2-CMH-FCH.AFDC-AID-CD == "AM" 
         || H2-2-CMH-FCH.AFDC-AID-CD == "PC" 
         || H2-2-CMH-FCH.AFDC-AID-CD == "UP" 
         || H2-2-CMH-FCH.AFDC-AID-CD == "COA"
         || H2-2-CMH-FCH.AFDC-AID-CD == "COS"
         || H2-2-CMH-FCH.AFDC-AID-CD == "COK"
         || H2-2-CMH-FCH.AFDC-AID-CD == "CON"
                                             
         || H2-2-CMH-FCH.AFDC-AID-CD == "CH" /* CHAP*/
         || H2-2-CMH-FCH.AFDC-AID-CD == "SN") /* CHAP*/

          set H2-ELIG-VERSION empty;

          H2-ELIG-VERSION.ICI = H2-2-CMH-FCH.ICI;
          H2-ELIG-VERSION.PRGM-CASE-TYPE = "AF";
          H2-ELIG-VERSION.BNFT-MTH = AIN22W2-COST.WORK-BNFT-MM;
          H2-ELIG-VERSION.BNFT-YR = AIN22W2-COST.WORK-BNFT-CCYY;

          AIN22Q1-S-EVR();

          if (sysVar.sqlData.sqlcode == 0)
            AIN22Q1-SCAN-EVR();

            if (sysVar.sqlData.sqlcode == 0)

              AIN22P9-POP-ARRAY();

            end
          end

        end
      end

  /* MAABD*/
      if (H2-2-CMH-FCH.MA-ASST-IND == "Y")

        set H2-ELIG-VERSION empty;

        H2-ELIG-VERSION.ICI = H2-2-CMH-FCH.ICI;
        H2-ELIG-VERSION.PRGM-CASE-TYPE = "MA";
        H2-ELIG-VERSION.BNFT-MTH = AIN22W2-COST.WORK-BNFT-MM;
        H2-ELIG-VERSION.BNFT-YR = AIN22W2-COST.WORK-BNFT-CCYY;

        AIN22Q1-S-EVR();

        if (sysVar.sqlData.sqlcode == 0)
          AIN22Q1-SCAN-EVR();

          if (sysVar.sqlData.sqlcode == 0)

            AIN22P9-POP-ARRAY();

          end
        end

      end

  /* Increment mm of work date via dummy date*/
      AIN22W.WS-DUM-MM = AIN22W2-COST.WORK-BNFT-MM;
      AIN22W.WS-DUM-YY = AIN22W2-COST.WORK-BNFT-YY;
      AIN22W.WS-DUM-MM = AIN22W.WS-DUM-MM + 1;
      AIN22P9-DATE-PROC();
      AIN22W2-COST.WORK-BNFT-DT = AIN22W.WS-FIRST-DATE;

    end /* While (date-beg-end-range)*/

  end /* IF 'O'*/
  /*  */
end // end AIN22P9-COST-BFORE


// CHECK STATUS OF SSI FOR TERM
Function AIN22P9-CT-STS()
  /* CHANGES DUE TO PTR# AIN22001 BEGIN*/
  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
    AIN22P9-SSI-AMT();
  end
  /* PTR 7067 'N' ALSO TERMINATES/ENDS THE PAYMENT*/
  if ((SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "T" || 
  SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "N") && 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] != "G")
    /* PTR 9071 ADD EDITTING TO TERMINATES ----- 01/03/97 ------*/
    AIN22P9-SSI-AMT();
    AIN22P9-TERM-SSI();
  end
  /* CHANGES DUE TO PTR# AIN22001 END*/
end // end AIN22P9-CT-STS


// date retrieval process
Function AIN22P9-DATE-PROC()
  /* ***********************************************************************/
  /* Performs the process of retreiving the first and last date for the  **/
  /* given month                                                         **/
  /* ***********************************************************************/
  /* PTR 12053 CHANGE CENTURY CUT-OFF TO 1950 ------------- 06/16/97 -----*/
  /* If the value of month received is 13 increment the year value by*/
  /* one.*/
  AIN22W.WS-FIRST-F1 = "-";
  AIN22W.WS-FIRST-F2 = "-";
  AIN22W.WS-LAST-F1 = "-";
  AIN22W.WS-LAST-F2 = "-";
  AIN22W.WS-PREV-F1 = "-";
  AIN22W.WS-PREV-F2 = "-";
  /*  */
  if (AIN22W.WS-DUM-MM == 13)
    AIN22W.WS-DUM-MM = 01;
    AIN22W.WS-DUM-YY = AIN22W.WS-DUM-YY + 1;
  end
  /*  */
  /* First date determination*/
  /*  */
  AIN22W.WS-FIRST-DD = 01;
  AIN22W.WS-FIRST-MM = AIN22W.WS-DUM-MM;
  AIN22W.WS-FIRST-YY = AIN22W.WS-DUM-YY;
  if (AIN22W.WS-DUM-YY > 50)
    AIN22W.WS-FIRST-CC = 19;
  else
    AIN22W.WS-FIRST-CC = 20;
  end
  /*  */
  /* Last date determination*/
  /*  */
  AIN22W.WS-LAST-MM = AIN22W.WS-DUM-MM;
  AIN22W.WS-LAST-YY = AIN22W.WS-DUM-YY;
  if (AIN22W.WS-DUM-YY > 50)
    AIN22W.WS-LAST-CC = 19;
  else
    AIN22W.WS-LAST-CC = 20;
  end
  /*  */
  if (AIN22W.WS-LAST-MM == 01 || 
  AIN22W.WS-LAST-MM == 03 || 
  AIN22W.WS-LAST-MM == 05 || 
  AIN22W.WS-LAST-MM == 07 || 
  AIN22W.WS-LAST-MM == 08 || 
  AIN22W.WS-LAST-MM == 10 || 
  AIN22W.WS-LAST-MM == 12)
  /*  */
    AIN22W.WS-LAST-DD = 31;
  /*  */
  end

  if (AIN22W.WS-LAST-MM == 04 || 
  AIN22W.WS-LAST-MM == 06 || 
  AIN22W.WS-LAST-MM == 09 || 
  AIN22W.WS-LAST-MM == 11)
  /*  */
    AIN22W.WS-LAST-DD = 30;
  /*  */
  end
  /*  */
  if (AIN22W.WS-LAST-MM == 02)
  /*  */
    AIN22W.WS-REM1 = AIN22W.WS-LAST-CCYY % 4;
    AIN22W.WS-REM2 = AIN22W.WS-LAST-CCYY % 100;
    AIN22W.WS-REM3 = AIN22W.WS-LAST-CCYY % 400;
  /*  */
    if (AIN22W.WS-REM1 != 0)
      AIN22W.WS-LAST-DD = 28;
    else
      if (AIN22W.WS-REM2 == 0)
        if (AIN22W.WS-REM3 == 0)
          AIN22W.WS-LAST-DD = 29;
        else
          AIN22W.WS-LAST-DD = 28;
        end
      else
        AIN22W.WS-LAST-DD = 28;
      end
    end

  end
  /*  */
  /* Last day of the previous month from the given date*/
  /* PTR 10171 ADD SET OF PREV-DD TO THIS COND. --- 02/20/97 -----*/
  if (AIN22W.WS-DUM-MM == 01)
    AIN22W.WS-PREV-MM = 12;
    if (AIN22W.WS-DUM-YY == 00)
      AIN22W.WS-PREV-YY = 99;
    else
      AIN22W.WS-PREV-YY = AIN22W.WS-DUM-YY - 1;
    end
    AIN22W.WS-PREV-DD = 31;
  /*  */
  else
    AIN22W.WS-PREV-YY = AIN22W.WS-DUM-YY;
  end
  if (AIN22W.WS-PREV-YY > 50)
    AIN22W.WS-PREV-CC = 19;
  /*  */
  else
  /*  */
    AIN22W.WS-PREV-CC = 20;
  /*  */
  end
  /*  */
  if (AIN22W.WS-DUM-MM == 05 || 
  AIN22W.WS-DUM-MM == 07 || 
  AIN22W.WS-DUM-MM == 10 || 
  AIN22W.WS-DUM-MM == 12)
    AIN22W.WS-TEMP1-MM = AIN22W.WS-DUM-MM - 1;
    AIN22W.WS-PREV-MM = AIN22W.WS-TEMP1-MM;
    AIN22W.WS-PREV-DD = 30;
  end
  if (AIN22W.WS-DUM-MM == 02 || 
  AIN22W.WS-DUM-MM == 04 || 
  AIN22W.WS-DUM-MM == 06 || 
  AIN22W.WS-DUM-MM == 08 || 
  AIN22W.WS-DUM-MM == 09 || 
  AIN22W.WS-DUM-MM == 11)
  /*  */
    AIN22W.WS-TEMP1-MM = AIN22W.WS-DUM-MM - 1;
    AIN22W.WS-PREV-MM = AIN22W.WS-TEMP1-MM;
    AIN22W.WS-PREV-DD = 31;
  /*  */
  end
  /*  */
  if (AIN22W.WS-DUM-MM == 03)
  /*  */
    AIN22W.WS-REM1 = AIN22W.WS-PREV-CCYY % 4;
    AIN22W.WS-REM2 = AIN22W.WS-PREV-CCYY % 100;
    AIN22W.WS-REM3 = AIN22W.WS-PREV-CCYY % 400;
  /*  */
    if (AIN22W.WS-REM1 != 0)
      AIN22W.WS-PREV-MM = 02;
      AIN22W.WS-PREV-DD = 28;
    else
      if (AIN22W.WS-REM2 == 0)
        if (AIN22W.WS-REM3 == 0)
          AIN22W.WS-PREV-MM = 02;
          AIN22W.WS-PREV-DD = 29;
        else
          AIN22W.WS-PREV-MM = 02;
          AIN22W.WS-PREV-DD = 28;
        end
      else
        AIN22W.WS-PREV-MM = 02;
        AIN22W.WS-PREV-DD = 28;
      end
    end
  /*  */
  end
  /*  */
  /* cbsi end*/
end // end AIN22P9-DATE-PROC


// CHECK-DEATH-DATE
Function AIN22P9-DEATH-DATE()
  /* CBSI START*/
  /* THE WORKER IS ALERTED WHEN DEATH DATE APPEARS IN THE SDX TRANSMISSION*/
  /* FILE*/
  AIN22W.WS-ERR-DTH-DT = "F";
  if (SR-Q22IP-REC.TRE-DATE-OF-DEATH != 0)
    AIN22W.WS-ALERT-FLAG = "T";
    AIN22W.WS-ERR-DTH-DT = "T";
  end
  /* CBSI END*/
end // end AIN22P9-DEATH-DATE


// EDIT-CHECKS
Function AIN22P9-EDIT()
  /* CBSI START*/
  /* THE FIRST OCCURENCE OF THE PAYMENT DATE OF PAYMENT INFORMATION*/
  /* IS USED AS PROCESSED DATE*/
  /* PTR 5508 -- IF PAY-DT IS ZERO MOVE NOMADS DT -- 11/13/96 -- BEGIN*/

  if (SR-Q22IP-REC.TRE-PAYMENT-MO[1] != 0)
    AIN22W.WS-PROCESS-DATE-MO = SR-Q22IP-REC.TRE-PAYMENT-MO[1];
    AIN22W.WS-PROCESS-DATE-DT = SR-Q22IP-REC.TRE-PAYMENT-DY[1];
    AIN22W.WS-PROCESS-DATE-YR = SR-Q22IP-REC.TRE-PAYMENT-YR[1];
    /* wi 13211 century is on input  --  04/21/98  - kem - begin*/
    AIN22W.WS-PROCESS-DATE-CC = SR-Q22IP-REC.TRE-PAYMENT-CC[1];
    /* MOVE AIN22W.WS-NOMADS-PROCESS-CC TO AIN22W.WS-PROCESS-DATE-CC;*/
    /* wi 13211 century is on input  --  04/21/98  - kem - END*/
    /* PTR3143 END*/
  else
    AIN22W.WS-PROCESS-DATE-CC = AIN22W.WS-NOMADS-PROCESS-CC;
    AIN22W.WS-PROCESS-DATE-YR = AIN22W.WS-NOMADS-PROCESS-YY;
    AIN22W.WS-PROCESS-DATE-MO = AIN22W.WS-NOMADS-PROCESS-MM;
    AIN22W.WS-PROCESS-DATE-DT = AIN22W.WS-NOMADS-PROCESS-DD;
  end
  /* PTR 9589 -- USE NOMADS DATE NOT CALL DATEAPP -- 02/05/97 --------*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/
  /* MOVE AIN22W.WS-SYS-CC TO AIN22W.WS-TEMP-CC;*/
  /* MOVE AIN22W.WS-TEMP1-CC TO AIN22W.WS-PROCESS-DATE-CC;*/
  AIN22W.WS-ALERT-FLAG = "F";
  AIN22P9-SEX-DOB();
  AIN22P9-NEVADA-ADR();
  AIN22P9-PUBLIC-LAW();
  AIN22P9-DEATH-DATE();
  AIN22P9-CHK-DEDN();
  AIN22P9-RECUR-DIS();
  AIN22P9-OUT-STATE();
  /* CHANGES DUE TO PTR# AIN22001 BEGIN*/
  /* CHANGES DUE TO PTR# 7067     BEGIN*/
  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01" || 
  SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "T" || 
  SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "N" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
    AIN22P9-CT-STS();
  end
  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "N01")
    AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
  end
  AIN22P9-INS-UPD();
  AIN22P9-ALERT();
  if (AIN22W.WS-TRIGGER-ELIGIBILITY == "T")
    AIN22P9-TRI-ELI();
  end
  /* CBSI END*/
end // end AIN22P9-EDIT


// CHECK FOR PRE OR POST ADVERSE
Function AIN22P9-EFF-DT-CLC()
  /* This process replaces the call in MAIN to perform AIN22P9-HEADER*/
  /* which performs AIN22P9-SET-EFDT.*/

  set AIN22W-DATES empty;

  AIN22W-DATES.BDATE-CC = BDATEREC.BDATE-PROCESS-DATE-CC;
  AIN22W-DATES.BDATE-YY = BDATEREC.BDATE-PROCESS-DATE-YY;
  AIN22W-DATES.BDATE-F1 = "-";
  AIN22W-DATES.BDATE-MM = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIN22W-DATES.BDATE-F2 = "-";
  AIN22W-DATES.BDATE-DD = BDATEREC.BDATE-PROCESS-DATE-DD;

  AIN22W-DATES.WS-CURR-MTH-END-DT = AIN22W-DATES.BDATE;

  AIN22P9-CLC-END-DT();

  set P-DATE-REC3 empty;

  P-DATE-REC3.C-OUTPUT-DATE = AIN22W-DATES.WS-CURR-MTH-END-DT;
  P-DATE-REC3.C-INPUT-DATE = AIN22W-DATES.BDATE;

  call "DATED1A" (VDBCONTROL, VMESSAGE, P-DATE-REC3) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    exit program;
  end

  /* Before Adverse*/
  if (P-DATE-REC3.N-DIFF-DAYS >= 13)

    AIN22W-DATES.WS-CALC-EFF-DATE = AIN22W-DATES.BDATE;

  /* Add 1 month to bdate/EFF-DATE, Move '1' to EFF-DD*/
    AIN22P9-ADD-1-MM();

    AIN22W.WS-EFF-DATE = AIN22W-DATES.WS-CALC-EFF-DATE;

  else

    AIN22W-DATES.WS-CALC-EFF-DATE = AIN22W-DATES.BDATE;

  /* Add 2 months to bdate/EFF-DATE, Move '1' to EFF-DD*/
    AIN22P9-ADD-2-MM();

    AIN22W.WS-EFF-DATE = AIN22W-DATES.WS-CALC-EFF-DATE;

  end

  /*  */
end // end AIN22P9-EFF-DT-CLC


// CALC VALID ENROLL DATE
Function AIN22P9-ENROL-DT()
  /* ************************************************************************/
  /* THIS PROCESS CALCULATES THE VALID ENROLLMENT DATE.  IF THE SYSTEM DATE*/
  /* IS BEFORE THE CUTOFF DATE, THE VALID ENROLLMENT DATE IS THE SYSTEM*/
  /* DATE + 1 MONTH.  IF THE SYSTEM DATE IS AFTER THE CUTOFF DATE, THE*/
  /* VALID ENROLLMENT DATE IS THE SYSTEM DATE + 2 MONTHS.*/
  /* ************************************************************************/

  AIN22P9-GET-CUTOFF();
  P-DATE-REC3.C-INPUT-DATE = AIN22W.WS-NOMADS-PROCESS-DATE;
  P-DATE-REC3.C-OUTPUT-DATE = AIN22W.WS-CUT-OFF;
  call "DATED1A" (VDBCONTROL, VMESSAGE, P-DATE-REC3) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    exit program;
  end

  AIN22W.WS-DATE-MM-NUM = AIN22W.WS-NOMADS-PROCESS-MM;
  AIN22W.WS-DATE-YR-NUM = AIN22W.WS-NOMADS-PROCESS-CCYY;

  if (AIN22W.WS-CUT-OFF < AIN22W.WS-NOMADS-PROCESS-DATE)
    if (AIN22W.WS-DATE-MM-NUM == 11)
      AIN22W.WS-VALID-ENROL-MM = 1;
      AIN22W.WS-VALID-ENROL-YY = AIN22W.WS-DATE-YR-NUM + 1;
    else
      if (AIN22W.WS-DATE-MM-NUM == 12)
        AIN22W.WS-VALID-ENROL-MM = 2;
        AIN22W.WS-VALID-ENROL-YY = AIN22W.WS-DATE-YR-NUM + 1;
      else
        AIN22W.WS-VALID-ENROL-MM = AIN22W.WS-DATE-MM-NUM + 2;
        AIN22W.WS-VALID-ENROL-YY = AIN22W.WS-DATE-YR-NUM;
      end
    end
  else
    if (AIN22W.WS-DATE-MM-NUM == 12)
      AIN22W.WS-VALID-ENROL-MM = 1;
      AIN22W.WS-VALID-ENROL-YY = AIN22W.WS-DATE-YR-NUM + 1;
    else
      AIN22W.WS-VALID-ENROL-MM = AIN22W.WS-DATE-MM-NUM + 1;
      AIN22W.WS-VALID-ENROL-YY = AIN22W.WS-DATE-YR-NUM;
    end
  end

  AIN22W.WS-VALID-DASH-1 = "-";
  AIN22W.WS-VALID-DASH-2 = "-";
  AIN22W.WS-VALID-ENROL-DD = 1;
end // end AIN22P9-ENROL-DT


// GET-FCTR-PROCESS
Function AIN22P9-FCTR()
  /* CBSI START*/
  /* THIS PROCESS GETS THE FACTORS TO CONVERT WEEKLY AND BI-WEEKLY*/
  /* INCOME AMOUNTS INTO MONTHLY INCOME AMOUNTS*/

  set H2-MASS-CHNG-PARMS empty;
  H2-MASS-CHNG-PARMS.EFF-TO-DT = "9999-12-31";
  /* --------------PTR 5913 BEGIN---------------------------*/
  H2-MASS-CHNG-PARMS.PRGM-TYPE = "CM";
  H2-MASS-CHNG-PARMS.MASS-CHNG-TYPE = "C01";
  /* --------------PTR 5913 END-----------------------------*/

  /* 'C01' IS THE TYPE CODE FOR FACTOR TO CALCULATE MONTHLY INCOME*/
  /* FROM WEEKLY INCOME.*/

  AIN22P9-QUERY-S02();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN22W.WS-WKLY-FACTOR = H2-MASS-CHNG-PARMS.FACTOR;

  /* 'C04' IS THE TYPE CODE FOR FACTOR TO CALCULATE MONTHLY INCOME*/
  /* FROM BI-WEEKLY INCOME*/

  set H2-MASS-CHNG-PARMS empty;
  H2-MASS-CHNG-PARMS.EFF-TO-DT = "9999-12-31";
  /* ------------------------------PTR 5913 BEGIN----------------------*/
  H2-MASS-CHNG-PARMS.PRGM-TYPE = "CM";
  /* wi 13259 kem 02/09/98 get biwkly factor for uernd inc calculation*/
  H2-MASS-CHNG-PARMS.MASS-CHNG-TYPE = "C04";
  /* ------------------------------PTR 5913 BEGIN----------------------*/

  AIN22P9-QUERY-S02();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN22W.WS-BIWKLY-FACTOR = H2-MASS-CHNG-PARMS.FACTOR;

  /* ---------CHANGES DUE TO PHASE III REWORK START--------*/

  /* wi 13259 kem 02/09/98 begin*/
  /* READ SYS PARAMETERS removed as all changes to amount should update*/
  /* READ SYS PARAMETERS TABLE TO GET THE DESCREPANCY PERCENTAGE LIMIT*/

  /* PERFORM AIN22P9-QUERY-S11;*/
  /* IF VDBCONTROL.URC > 104;*/
  /* PERFORM WCM00P2-TO-CEP01A;*/
  /* END;*/
  /* IF EZESQCOD = 0;*/
  /* MOVE H2-SYS-PARAMETERS.INTF-TOL-LMT-PCT TO AIN22W.WS-PERCENT;*/
  AIN22W.WS-PERCENT = 0.00;
  /* END;*/
  /* wi 13259 kem 02/09/98 end*/
  /* --------CHANGES DUE TO PHASE III REWORK END----------*/
  /* CBSI END*/
end // end AIN22P9-FCTR


Function AIN22P9-GET-CUTOFF()
  AIN22W.WS-DATE-BEG = AIN22W.WS-NOMADS-PROCESS-DATE;
  AIN22W.WS-DATE-BEG-DD = "01";
  AIN22W.WS-DATE-END = AIN22W.WS-NOMADS-PROCESS-DATE;
  AIN22W.WS-DATE-END-DD = "28";
  AIN22P9-S06-Q06();
  if (VDBCONTROL.URC == 0)
    AIN22W.WS-CUT-OFF = H2-CLNDR.CLNDR-DT;
  end
end // end AIN22P9-GET-CUTOFF


// GET NEXT MAX SEQUENCE NMB
Function AIN22P9-GET-MAX-SQ()
  /* -----------------------PTR 7967 BEGIN-----------------------*/
  H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
  H2-UERND-INCM-DTL.PRD-END-DT = "9999-12-31";
  /* period begin date is already set*/

  /* get the max exp-sq-nmb of unin dtl for this person and requested month*/

  WDB00PI();
  AIN22P9-QUERY-S14();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  if (sysVar.sqlData.sqlcode == 100)
    AIN22W.WS-MAX-SQ-NMB = 01;
  else
    AIN22W.WS-MAX-SQ-NMB = H2-UERND-INCM-DTL.INCM-SQ-NMB + 1;
  end

  /* ---------------------------PTR 7967 END-----------------------------*/
end // end AIN22P9-GET-MAX-SQ


// INS-UPD-INCAP-DISAB
Function AIN22P9-ICP-DIS()
  /* CBSI START*/
  /* THE ONSET DISABILITY DATE WILL BE SET TO BEGIN DATE*/
  /* IN TWNINCAP-DSBLTY*/

  set H2-INCAP-DSBLTY empty;
  H2-INCAP-DSBLTY.DSBL-BEG-DT = "0001-01-01";
  H2-INCAP-DSBLTY.DSBL-END-DT = "9999-12-31";
  AIN22W.WS-SSI-RFRL-STS-CD = " ";
  if (AIN22W.WS-INCAP-DISAB-FLAG == "T")
    H2-INCAP-DSBLTY.UPI = AIN22W.WS-UPI;
  /* MOVE AIN22W.WS-NOMET-DISABILITY-DT TO H2-INCAP-DSBLTY.PRD-BEG-DT;*/
    H2-INCAP-DSBLTY.PRD-BEG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
    H2-INCAP-DSBLTY.PRD-END-DT = "9999-12-31";
    AIN22P9-QUERY-S05();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    if (sysVar.sqlData.sqlcode == 0)
      AIN22W.WS-SYS1-DATE = H2-INCAP-DSBLTY.PRD-BEG-DT;
      AIN22W.WS-DISA-PRD-BEG-DT = H2-INCAP-DSBLTY.PRD-BEG-DT;
      AIN22W.WS-DISA-PRD-END-DT = H2-INCAP-DSBLTY.PRD-END-DT;
      /* PTR 8978 STRT <= NOMADS START THEN UPDATE ONLY -- 12/24/96 - BEGIN*/
      /* PTR 9071 ONLY INSERT IF ONGOING - ELSE UPDATE(TERM) -- 01/03/97 -*/
      AIN22P9-MOVE-DISA();
      if (H2-INCAP-DSBLTY.SSI-RFRL-STS-CD != AIN22W.WS-SSI-RFRL-STS-CD
       || AIN22W.WS-ONSET-DISABILITY-DT != H2-INCAP-DSBLTY.DSBL-BEG-DT)
  /* IF ((SR-Q22IP-REC.TRE-DISABILITY-MO <= AIN22W.WS-SYS1-MM AND*/
  /* SR-Q22IP-REC.TRE-DISABILITY-CY = AIN22W.WS-SYS1-YR) OR*/
  /* SR-Q22IP-REC.TRE-DISABILITY-CY <= AIN22W.WS-SYS1-YR);*/
        if (((AIN22W.WS-NOMADS-PROCESS-MM <= AIN22W.WS-SYS1-MM && 
        AIN22W.WS-NOMADS-PROCESS-CCYY == AIN22W.WS-SYS1-YR) || 
        AIN22W.WS-NOMADS-PROCESS-CCYY < AIN22W.WS-SYS1-YR))
  /* IF SR-Q22IP-REC.TRE-PAY-STATUS-CD(1) = 'C01' OR*/
  /* SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) = 'G';*/
      /* PTR 8978 STRT <= NOMADS START THEN UPDATE ONLY -- 12/24/96 - END*/
          if (H2-INCAP-DSBLTY.PRD-END-DT != "9999-12-31")
            /* MOVE 'T' TO AIN22W.WS-ALERT-FLAG;*/
            return;
          end
          if ((AIN22W.WS-NOMADS-PROCESS-MM == AIN22W.WS-SYS1-MM && 
          AIN22W.WS-NOMADS-PROCESS-CCYY == AIN22W.WS-SYS1-YR))
            AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
            AIN22W.WS-ALERT-FLAG = "T";
            AIN22W.WS-DISA-UPDATED = "T";
          /* PERFORM AIN22P9-MOVE-DISA;*/
            AIN22W2.WS-DATE-CCYY = AIN22W.WS-NOMADS-PROCESS-CCYY;
            AIN22W2.WS-DATE-MM = AIN22W.WS-NOMADS-PROCESS-MM;
            AIN22P9-LAST-DAY();
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
            H2-INCAP-DSBLTY.PRD-END-DT = AIN22W.WS-DISA-PRD-END-DT;
            if (AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT
            )
              if (AIN22W.WS-ONSET-DISABILITY-DT != " "
               && AIN22W.WS-ONSET-DISABILITY-DT != "0001-01-01"
               && AIN22W.WS-ONSET-DISABILITY-DT != "9999-12-31")
                AIN22W2.WS-DATE-MM = AIN22W.WS-ONSET-DSAB-DT-MM;
                AIN22W2.WS-DATE-DD = AIN22W.WS-ONSET-DSAB-DT-DD;
                AIN22W2.WS-DATE-CCYY = AIN22W.WS-ONSET-DSAB-DT-CY;
                AIN22P9-LAST-DATE();
                H2-INCAP-DSBLTY.DSBL-END-DT = AIN22W2.WS-PREV-DATE;
              end
            end
            AIN22P9-QUERY-U02();
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end
            AIN22P9-MOV-OTHER();
  /* IF AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT*/
  /* ;*/
  /* MOVE AIN22W.WS-ONSET-DISABILITY-DT TO*/
  /* H2-INCAP-DSBLTY.DSBL-BEG-DT;*/
  /* END;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* MOVE AIN22W.WS-DISA-PRD-END-DT TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS2-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS2-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS2-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F2;*/
  /* IF AIN22W.WS-SYS2-MM = 12;*/
  /* AIN22W.WS-SYS2-MM = 01;*/
  /* AIN22W.WS-SYS2-YR = AIN22W.WS-SYS2-YR + 1;*/
  /* ELSE;*/
  /* AIN22W.WS-SYS2-MM = AIN22W.WS-SYS2-MM + 1;*/
  /* END;*/
  /* MOVE AIN22W.WS-SYS2-DATE TO H2-INCAP-DSBLTY.PRD-BEG-DT;*/
  /* MOVE '9999-12-31' TO H2-INCAP-DSBLTY.DSBL-END-DT;*/
  /* MOVE AIN22W.WS-SSI-RFRL-STS-CD TO*/
  /* H2-INCAP-DSBLTY.SSI-RFRL-STS-CD;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO*/
  /* H2-INCAP-DSBLTY.SSI-RFRL-DT;*/
  /* PERFORM AIN22P9-QUERY-I03;*/
  /* IF VDBCONTROL.URC > 104;*/
  /* PERFORM WCM00P2-TO-CEP01A;*/
  /* END;*/
          else
            if (H2-INCAP-DSBLTY.PRD-END-DT != "9999-12-31")
              return;
            end
            AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
            AIN22W.WS-ALERT-FLAG = "T";
            AIN22W.WS-DISA-UPDATED = "T";
            if (AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT
            )
              if (AIN22W.WS-ONSET-DISABILITY-DT != " "
               && AIN22W.WS-ONSET-DISABILITY-DT != "0001-01-01"
               && AIN22W.WS-ONSET-DISABILITY-DT != "9999-12-31")
                H2-INCAP-DSBLTY.DSBL-BEG-DT = AIN22W.WS-ONSET-DISABILITY-DT;
              end
            end
            H2-INCAP-DSBLTY.SSI-RFRL-STS-CD = AIN22W.WS-SSI-RFRL-STS-CD;
            H2-INCAP-DSBLTY.SSI-RFRL-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
            H2-INCAP-DSBLTY.PRD-END-DT = AIN22W.WS-DISA-PRD-END-DT;
            H2-INCAP-DSBLTY.PRD-BEG-DT = AIN22W.WS-DISA-PRD-BEG-DT;
            AIN22P9-QUERY-U02();
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end
  /* ** start 23393 ***/
  /* IF AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT*/
  /* ;*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-MM TO AIN22W2.WS-DATE-MM;*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-DD TO AIN22W2.WS-DATE-DD;*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-CY TO AIN22W2.WS-DATE-CCYY;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.DSBL-END-DT;*/
  /* END;*/
  /* MOVE AIN22W.WS-YR-DISA-PRD-BEG-DT TO AIN22W2.WS-DATE-CCYY;*/
  /* MOVE AIN22W.WS-MTH-DISA-PRD-BEG-DT TO AIN22W2.WS-DATE-MM;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS1-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS1-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS1-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F2;*/
  /* MOVE AIN22W.WS-SYS1-DATE TO*/
  /* H2-INCAP-DSBLTY.PRD-BEG-DT;*/
  /* PERFORM AIN22P9-MOV-OTHER;*/
  /* PERFORM AIN22P9-QUERY-I03;*/
  /* IF VDBCONTROL.URC > 104;*/
  /* PERFORM WCM00P2-TO-CEP01A;*/
  /* END;*/
  /* ** end 23393 ***/
          end
        else
          if (H2-INCAP-DSBLTY.PRD-END-DT != "9999-12-31")
            return;
          end
          AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
          AIN22W.WS-ALERT-FLAG = "T";
          AIN22W.WS-DISA-UPDATED = "T";
          /* PERFORM AIN22P9-MOVE-DISA;*/
          AIN22W2.WS-DATE-CCYY = AIN22W.WS-NOMADS-PROCESS-CCYY;
          AIN22W2.WS-DATE-MM = AIN22W.WS-NOMADS-PROCESS-MM;
          AIN22P9-LAST-DATE();
          H2-INCAP-DSBLTY.PRD-END-DT = AIN22W2.WS-PREV-DATE;
          if (AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT
          )
  /* ** start 23393 ***/
            if (AIN22W.WS-ONSET-DISABILITY-DT != " "
             && AIN22W.WS-ONSET-DISABILITY-DT != "0001-01-01"
             && AIN22W.WS-ONSET-DISABILITY-DT != "9999-12-31")
              AIN22W2.WS-DATE-MM = AIN22W.WS-ONSET-DSAB-DT-MM;
              AIN22W2.WS-DATE-DD = AIN22W.WS-ONSET-DSAB-DT-DD;
              AIN22W2.WS-DATE-CCYY = AIN22W.WS-ONSET-DSAB-DT-CY;
  /* ** end 23393 ***/
              AIN22P9-LAST-DATE();
              H2-INCAP-DSBLTY.DSBL-END-DT = AIN22W2.WS-PREV-DATE;
            end
          end
          AIN22P9-QUERY-U02();
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
          AIN22P9-MOV-OTHER();
          if (AIN22W.WS-ONSET-DISABILITY-DT > H2-INCAP-DSBLTY.DSBL-BEG-DT
          )
            if (AIN22W.WS-ONSET-DISABILITY-DT != " "
             && AIN22W.WS-ONSET-DISABILITY-DT != "0001-01-01"
             && AIN22W.WS-ONSET-DISABILITY-DT != "9999-12-31")
              H2-INCAP-DSBLTY.DSBL-BEG-DT = AIN22W.WS-ONSET-DISABILITY-DT;
            end
          end
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
          H2-INCAP-DSBLTY.PRD-END-DT = "9999-12-31";
          AIN22W.WS-SYS1-YR = AIN22W.WS-NOMADS-PROCESS-CCYY;
          AIN22W.WS-SYS1-MM = AIN22W.WS-NOMADS-PROCESS-MM;
          AIN22W.WS-SYS1-DD = "01";
          AIN22W.WS-SYS1-F1 = "-";
          AIN22W.WS-SYS1-F2 = "-";
          H2-INCAP-DSBLTY.PRD-BEG-DT = AIN22W.WS-SYS1-DATE;
          H2-INCAP-DSBLTY.DSBL-END-DT = "9999-12-31";
          H2-INCAP-DSBLTY.SSI-RFRL-STS-CD = AIN22W.WS-SSI-RFRL-STS-CD;
          H2-INCAP-DSBLTY.SSI-RFRL-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
          AIN22P9-QUERY-I03();
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
  /* IF H2-INCAP-DSBLTY.PRD-END-DT NE '9999-12-31';*/
  /* /*MOVE 'T' TO AIN22W.WS-ALERT-FLAG;*/
  /* EZERTN;*/
  /* END;*/
  /* IF SR-Q22IP-REC.TRE-PAY-STATUS-CD(1) = 'C01' OR*/
  /* SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) = 'G';*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-MM TO AIN22W2.WS-DATE-MM;*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-DD TO AIN22W2.WS-DATE-DD;*/
  /* MOVE AIN22W.WS-ONSET-DSAB-DT-CY TO AIN22W2.WS-DATE-CCYY;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* PERFORM AIN22P9-QUERY-U02;*/
  /* ELSE;*/
  /* PERFORM AIN22P9-MOVE-DISA;*/
  /* END;*/
   /* IF VDBCONTROL.URC > 104;*/
   /* PERFORM WCM00P2-TO-CEP01A;*/
   /* END;*/
   /* IF SR-Q22IP-REC.TRE-PAY-STATUS-CD(1) = 'C01' OR*/
   /* SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) = 'G';*/
   /* /*IF SR-Q22IP-REC.TRE-DENIAL-CD = ' ';*/
   /* PERFORM AIN22P9-MOVE-DISA;*/
   /* PERFORM AIN22P9-MOV-OTHER;*/
   /* PERFORM AIN22P9-QUERY-I03;*/
   /* IF VDBCONTROL.URC > 104;*/
   /* PERFORM WCM00P2-TO-CEP01A;*/
   /* END;*/
   /* END;*/
        end /* PROCESS DATE <= DISA PRD_BEG_DT*/
      end /* RFRL_STS_CD CHANGED or NOT*/
    else
    /* IF SR-Q22IP-REC.TRE-PAY-STATUS-CD(1) = 'C01' OR*/
    /* SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) = 'G';*/
      /* IF SR-Q22IP-REC.TRE-DENIAL-CD = ' ';*/
      AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
      AIN22W.WS-ALERT-FLAG = "T";
      AIN22W.WS-DISA-UPDATED = "T";
      AIN22P9-MOVE-DISA();
      H2-INCAP-DSBLTY.SSI-RFRL-STS-CD = AIN22W.WS-SSI-RFRL-STS-CD;
      AIN22P9-MOV-OTHER();
      AIN22W.WS-SYS1-YR = AIN22W.WS-NOMADS-PROCESS-CCYY;
      AIN22W.WS-SYS1-MM = AIN22W.WS-NOMADS-PROCESS-MM;
      AIN22W.WS-SYS1-DD = "01";
      AIN22W.WS-SYS1-F1 = "-";
      AIN22W.WS-SYS1-F2 = "-";
      H2-INCAP-DSBLTY.SSI-RFRL-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
      H2-INCAP-DSBLTY.PRD-BEG-DT = AIN22W.WS-SYS1-DATE;
      H2-INCAP-DSBLTY.DSBL-END-DT = "9999-12-31";
      AIN22P9-QUERY-I03();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  end
end // end AIN22P9-ICP-DIS


// INIT-PARA
Function AIN22P9-INIT()
  /* CBSI START*/
  /* INITIALIZING AIN22W*/
  set AIN22W empty;
  AIN22W.WS-ALERT-FLAG = "F";
  AIN22W.WS-END-SEARCH = "F";
  AIN22W.WS-UERND-REC-EXIST = "F";
  AIN22W.WS-TOLERANCE-LIMIT-FLAG = "F";
  AIN22W.WS-INCAP-DISAB-FLAG = "F";
  AIN22W.WS-ERR-SEX = "F";
  AIN22W.WS-ERR-DT-OF-BIRTH = "F";
  AIN22W.WS-ERR-ZIP-CD = "F";
  AIN22W.WS-ERR-PYMT-STS-CD = "F";
  AIN22W.WS-ERR-PB-LAW-CD = "F";
  AIN22W.WS-ERR-DTH-DT = "F";
  AIN22W.WS-ERR-UERND-INC-AMT = "F";
  AIN22W.WS-TRIGGER-ELIGIBILITY = "F";
  AIN22W.WS-TERMINATION-STATUS = "F";
  AIN22W.WS-DSGNT-IND = "F";
  AIN22W.WS-ERR-UERND-INCM-AMT = "F";
  /* ** start wi 21582 ***/
  AIN22W.WS-MOVED-OUT-OF-STATE = "F";
  AIN22W.WS-UNIN-UPDATED = "F";
  AIN22W.WS-UNIN-MORE-REC = "F";
  AIN22W.WS-UNIN-FREQ-FLAG = "F";
  AIN22W.WS-LSUM-ADDED = "F";
  /* ** end wi 21582 ***/
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
  AIN22W.WS-UPD-IND = "N";
  AIN22W.WS-RCVD-F1 = "-";
  AIN22W.WS-RCVD-F2 = "-";
  /* PTR3143 BEGIN move '-' to newly created WS process date fields*/
  AIN22W.WS-NOMADS-PROCESS-HYPHEN-1 = "-";
  AIN22W.WS-NOMADS-PROCESS-HYPHEN-2 = "-";
  /* PRT3143 END*/
  /*  */
  /* PTR3143 BEGIN fetchbdts and move values to working storage*/
  /* PTR 12052 move value to working storage ----------- 06/16/97 ----*/
  WCM00P3-FETCHBDTS();
  AIN22W.WS-NOMADS-PROCESS-CC = BDATEREC.BDATE-PROCESS-DATE-CC;
  AIN22W.WS-NOMADS-PROCESS-YY = BDATEREC.BDATE-PROCESS-DATE-YY;
  AIN22W.WS-EFF-YR = AIN22W.WS-NOMADS-PROCESS-CCYY;
  AIN22W.WS-NOMADS-PROCESS-MM = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIN22W.WS-EFF-MM = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIN22W.WS-NOMADS-PROCESS-DD = BDATEREC.BDATE-PROCESS-DATE-DD;
  AIN22W.WS-EFF-DD = BDATEREC.BDATE-PROCESS-DATE-DD;
  AIN22W.WS-PROCESS-DATE = BDATEREC.BDATE-PROCESS-DATE;
  AIN22W.WS-STRT-ELIG-DT = "9999-12-31";
  AIN22W.WS-EFF-F1 = "-";
  AIN22W.WS-EFF-F2 = "-";
  /* PTR3143 END*/

  AIN22P9-EFF-DT-CLC(); /* WI 27640*/

  /*  */
  /* PTR3143 BEGIN read the PIIN-SDX-PROCESS-MMCCYY*/
  AIN22P9-PIINSDX();

  AIN22W2-COST.INFILE-DATE = PIIN-SDX-PROCESS.PIIN-SDX-PROCESS-MMCCYY; /* WI 25803*/

  /* PTR3143 END*/
  /*  */
  /* this initialization of ws-onset-disability-date is being done*/
  /* for in case it is set in the process inside.  low values as default*/
  /* the initialization format is mmddyyyy for compatibility purposes*/
  AIN22W.WS-ONSET-DISABILITY-DT = "0001-01-01";
  /* THE CONVERSION FACTOR IS DETERMINED FOR CASES WHERE THE FREQUENCY*/
  /* OF PAYMENT IS NOT MONTHLY*/

  AIN22P9-FCTR();
  /* CBSI END*/
end // end AIN22P9-INIT


// FIND NXT RSRCE SEQ-NUM
Function AIN22P9-INQ-S12()
  /* DATE       PGR.       DESCRIPITON*/
  /* --------  ----------- --------------------------*/
  /* 07/01/96  KEM         find the maximum seqence number for the resource*/

  /* WI 21582 START */
  WDB00PI();
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  VDBCOMMON.USQLREC = "H2-LSUM-RSRCE-DTLS";
  VDBCONTROL.UPROC-OBJ = "H2-LSUM-RSRCE-DTLS";
  VDBCONTROL.UPROC-NM = "H2-LSUM-RSRCE-DTLS";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-LSUM-RSRCE-DTLS singleRow
      with #sql{
        select MAX(RSRC_SQ_NMB)
        from TWNLSUM_RSRCE_DTLS T1
        WHERE UPI = :UPI
          AND PRD_BEG_DT = :PRD-BEG-DT
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into RSRC-SQ-NMB ;
  end
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /* WI 21582 END */
end // end AIN22P9-INQ-S12


// JOIN-OF-FAM-CASLD-SUP-UNIT
Function AIN22P9-INQ-S6B()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 02/12/97  KMEADERS    CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-2-FAC-SPT";
  VDBCONTROL.UPROC-OBJ = "H2-2-FAC-SPT";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ-S6B";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-2-FAC-SPT
      with #sql{
        select T1.OFC_CD,
          T1.CASLD_ID,
          T2.NOMADS_USRID
        from TWNFAM_CASELD_CASE T1,
             TWNSUP_UNT_POS_HST T2
        WHERE T1.ICI = :ICI
            AND T1.OFC_CD = T2.OFC_CD
            AND T1.PRGM_OFC_TYPE = T2.PRGM_OFC_TYPE
            AND T1.SPRVS_UNIT = T2.SPRVS_UNIT
            AND T1.PSN_NMB = T2.PSN_NMB
            AND T2.ASMNT_BEG_DT <= :ASMNT-BEG-DT
            AND T2.ASMNT_END_DT >= :ASMNT-BEG-DT
      }
      into OFC-CD,
           CASLD-ID,
           NOMADS-USRID ;
  end
  /*  */
end // end AIN22P9-INQ-S6B


// FINDS THE PERSON INFO
Function AIN22P9-INQ1()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/08/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-OBJ = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ1";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    open AIN22P9-INQ1_RSI01
      with #sql{
        select T1.AFDC_ELIG_CD, T1.FS_ELIG_CD, T1.MA_ELIG_CD,
            T2.UPI, T2.DOB, T2.SEX_CD, T2.IVA_CASE_MBR_FG,T1.ICI,
            T1.TN_ELIG_CD,T1.TP_ELIG_CD,T1.TL_ELIG_CD,T1.TC_ELIG_CD,T1.SG_ELIG_CD
        from TWNCASE_MEMBER_HST T1,
             TWNPERSON T2
        WHERE T2.SSN = :SSN
            AND T1.UPI = T2.UPI
            AND T1.PRD_END_DT > :PRD-END-DT
            FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into AFDC-ELIG-CD, FS-ELIG-CD, MA-ELIG-CD,
           UPI, DOB, SEX-CD, IVA-CASE-MBR-FG,ICI,
           TN-ELIG-CD,TP-ELIG-CD,TL-ELIG-CD,TC-ELIG-CD,SG-ELIG-CD
      for H2-2-CMH-PER ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INQ1


// AIN22P9-INQ10
Function AIN22P9-INQ10()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/08/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-RESP-PRSN-DBTR";
  VDBCONTROL.UPROC-OBJ = "H2-RESP-PRSN-DBTR";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ10";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-RESP-PRSN-DBTR
      with #sql{
        select DSGNT_DBTR_IND
        from TWNRESP_PRSN_DBTR T1
        WHERE DBTR_SSN = :DBTR-SSN
      }
      into DSGNT-DBTR-IND ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INQ10


// READ MASS CHANGE PARAMETERS
Function AIN22P9-INQ2()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-MASS-CHNG-PARMS";
  VDBCONTROL.UPROC-OBJ = "H2-MASS-CHNG-PARMS";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ2";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-MASS-CHNG-PARMS
      with #sql{
        select MASS_CHNG_PCT, FACTOR
        from TWNMASS_CHNG_PARMS T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
           WHERE  MASS_CHNG_TYPE = :MASS-CHNG-TYPE AND
                  PRGM_TYPE = :PRGM-TYPE AND
                  EFF_TO_DT = :EFF-TO-DT AND
                  MASS_CHNG_DATA_TYP = 'P'
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into MASS-CHNG-PCT, FACTOR ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INQ2


// READ INCAP_DSBLTY
Function AIN22P9-INQ5()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-INCAP-DSBLTY";
  VDBCONTROL.UPROC-OBJ = "H2-INCAP-DSBLTY";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ5";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    open AIN22P9-INQ5_RSI01
      with #sql{
        select UPI, PRD_BEG_DT, INJRY_IND, NMO_RFRL_STS_DT,
          NMO_RFRL_STS_CD, MDCL_PRBLM_SCND1,
          MDCL_PRBLM_PRMRY, DSBL_END_DT, DSBL_BEG_DT,
          SSI_RFRL_STS_CD, VOC_REHAB_SIIS_IND,
          MDCAL_RVW_DT, INCAP_DSBL_RSN_CD, SSI_RFRL_DT,
          INCAP_DSBL_VERF_CD, MED_PRBLM_SCND2, MAINT_CD,
          PRD_END_DT, INCAP_DSBL_VERF_BY,
          INCAP_DSBL_VERF_DT, HIWA_STATUS
        from TWNINCAP_DSBLTY T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE UPI = :UPI AND
              PRD_END_DT > :PRD-BEG-DT
        ORDER BY PRD_BEG_DT Desc FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into UPI, PRD-BEG-DT, INJRY-IND, NMO-RFRL-STS-DT,
           NMO-RFRL-STS-CD, MDCL-PRBLM-SCND1,
           MDCL-PRBLM-PRMRY, DSBL-END-DT, DSBL-BEG-DT,
           SSI-RFRL-STS-CD, VOC-REHAB-SIIS-IND,
           MDCAL-RVW-DT, INCAP-DSBL-RSN-CD, SSI-RFRL-DT,
           INCAP-DSBL-VERF-CD, MED-PRBLM-SCND2, MAINT-CD,
           PRD-END-DT, INCAP-DSBL-VERF-BY,
           INCAP-DSBL-VERF-DT, HIWA-STATUS
      for H2-INCAP-DSBLTY ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INQ5


// GET SSN OF H-O-H
Function AIN22P9-INQ7()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "S2-2-FCH-PER";
  VDBCONTROL.UPROC-OBJ = "S2-2-FCH-PER";
  VDBCONTROL.UPROC-NM = "AIN22P9-INQ7";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get S2-2-FCH-PER
      with #sql{
        select T2.SSN
        from TWNFAM_CASE_HSTRY T1,
             TWNPERSON T2
        WHERE
          T1.ICI = :ICI AND
          T1.HOH_UPI = T2.UPI AND
          T1.PRD_BEG_DT = :PRD-BEG-DT
      }
      into SSN ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INQ7


Function AIN22P9-INQ8()

  H2-3-CMH-FCH-PER.SSN = SR-Q22IP-REC.TRE-SSN;
  H2-3-CMH-FCH-PER.PRD-END-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  WDB00PI();
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  VDBCOMMON.USQLREC = "H2-3-CMH-FCH-PER";
  VDBCONTROL.UPROC-OBJ = "H2-3-CMH-FCH-PER";
  VDBCONTROL.UPROC-NM = "AIN22P9-CASE-OPEN";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-3-CMH-FCH-PER
      with #sql{
        select T1.ICI
        from TWNCASE_MEMBER_HST T1,
             TWNFAM_CASE_HSTRY T2,
             TWNPERSON T3
        where T3.SSN = :SSN  AND
              T3.UPI = T1.UPI AND
              T1.ICI = T2.ICI AND
              T1.PRD_BEG_DT <= :PRD-END-DT AND
              T1.PRD_END_DT >= :PRD-END-DT AND
              T2.PRD_BEG_DT <= :PRD-END-DT AND
              T2.PRD_END_DT >= :PRD-END-DT AND
              T2.CASE_STS IN ('O','P')  FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into ICI ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
end // end AIN22P9-INQ8


// INSERT-UPDATE-RECS
Function AIN22P9-INS-UPD()
  /* CBSI START*/
  /* IF THE TWNUERND_INCM_DTL/TWNINCAP_DSBLTY RECORD EXISTS THEN THE RECORD*/
  /* WOULD BE UPDATED, ELSE A RECORD WOULD BE INSERTED. A RECORD WOULD ALSO*/
  /* BE INSERTED IN TWNSDX_SSI_BNFDTL*/
  /* CHANGES DUE TO PTR# AIN22001 BEGIN*/
  if ((SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G"))
  /* PTR 9071 ONLY ONGOING PAY CASES NEED BE INSERTED -- 01/03/97 -- BEGIN*/
  /* OR SR-Q22IP-REC.TRE-PAY-STATUS-CD-1(1) = 'T'*/
  /* CHANGES DUE TO PTR# AIN22001 END*/
  /* CHANGES DUE TO PTR# 7068 BEGIN*/
  /* OR SR-Q22IP-REC.TRE-PAY-STATUS-CD-1(1) = 'N';*/
  /* CHANGES DUE TO PTR# 7068 END*/
  /* PTR 9071 ONLY ONGOING PAY CASES NEED BE INSERTED -- 01/03/97 -- END*/
    AIN22P9-IUP-UEN();
  end
  AIN22P9-ICP-DIS();
  AIN22P9-SDX-SSI();
  /* CBSI END*/
end // end AIN22P9-INS-UPD


// INSERT A BG_TRN ROW
Function AIN22P9-INS1()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/

  /* AS THE REFERENCE TO PARENT TABLE TWNELIG_VERSION TABLE HAS BEEN*/
  /* REMOVED IN THE NEW PHASE3 CHG4 DDL, THE FOLLOWING LINES HAVE BEEN*/
  /* COMMENTED.*/
  /* ************************************************************/
  /* MOVE ' ' TO H2-BG-TRN.USERID;*/
  /* MOVE 'FS' TO H2-BG-TRN.PRGM-CASE-TYPE;*/
  /* MOVE 1994 TO H2-BG-TRN.BNFT-YR;*/
  /* MOVE 12 TO H2-BG-TRN.BNFT-MTH;*/
  /* MOVE H2-2-CMH-FCH.ICI TO H2-BG-TRN.VER-NMB;*/
  /* ***********************************************************/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-BG-TRN";
  VDBCONTROL.UPROC-OBJ = "H2-BG-TRN";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS1";
  VDBCONTROL.UPROC-OPT = "ADD";

  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  try
    add H2-BG-TRN
      with #sql{
        insert into twnbg_trn
        (ICI, CRN_TS, TRAN_PRD_FM_DT, TRAN_STS_CD, TRAN_PRTY, TRAN_TYPE,
            TRAN_PRD_TO_DT, POSTING_TYPE,PRGM_CASE_TYPE, BNFT_YR, BNFT_MTH,
            VER_NMB,USERID)
        values (:ICI, :GDW.TS, :TRAN-PRD-FM-DT, :TRAN-STS-CD, :TRAN-PRTY,
            :TRAN-TYPE, :TRAN-PRD-TO-DT,:POSTING-TYPE, :PRGM-CASE-TYPE,
            :BNFT-YR, :BNFT-MTH, :VER-NMB, :USERID)
      } ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INS1


// ADD UNEARNED INC ROW
Function AIN22P9-INS2()
  /*  */
  WDB00PI();
  AIN22W.WS-RCVD-MO = SR-Q22IP-REC.TRE-PAYMENT-MO[1];
  AIN22W.WS-RCVD-DT = SR-Q22IP-REC.TRE-PAYMENT-DY[1];
  AIN22W.WS-RCVD-YR = SR-Q22IP-REC.TRE-PAYMENT-YR[1];
  if (AIN22W.WS-RCVD-YR > 90)
    AIN22W.WS-RCVD-CC = 19;
  else
    AIN22W.WS-RCVD-CC = 20;
  end
  H2-UERND-INCM-DTL.UERND-INC-RCVD-DT = AIN22W.WS-RCVD-DATE;
  H2-UERND-INCM-DTL.SSI-RSDI-RCVD-MTH = 12;
  H2-UERND-INCM-DTL.SSI-RSDI-RCVD-YR = 9999;
  H2-UERND-INCM-DTL.UNE-INC-VERF-CD = "Y";
  H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-UERND-INCM-DTL";
  VDBCONTROL.UPROC-OBJ = "H2-UERND-INCM-DTL";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS2";
  VDBCONTROL.UPROC-OPT = "ADD";
  H2-UERND-INCM-DTL.CHNG-ENTRY-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-UERND-INCM-DTL.UNE-INC-VERF-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-UERND-INCM-DTL.RCVD-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-UERND-INCM-DTL.RPRTD-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-UERND-INCM-DTL.RCPT-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  try
    add H2-UERND-INCM-DTL
      with #sql{
        insert into TWNUERND_INCM_DTL
        (UPI, PRD_BEG_DT, UERND_INC_TYPE_CD, INCM_SQ_NMB,
            UERND_INC_RCVD_DT, PREV_AMT,
            UERND_INC_FREQ, UERND_INC_AMT,
            AFDC_CNTBL_IND, FS_CNTBL_AMT,
            FS_CNTBL_IND, MA_CNTBL_CD, PRD_END_DT,
            invo_mnd_dedn_amt , UNE_INC_VERF_CD , RECUR_IND, CHNG_ENTRY_DT,
            SSI_RSDI_RCVD_MTH, SSI_RSDI_RCVD_YR,
            UNE_INC_VERF_DT,RCVD_DT,RPRTD_DT,RCPT_DT,
            UNE_INC_VERF_BY, CHAP_CNTBL_IND)
        values (:UPI, :PRD-BEG-DT, :UERND-INC-TYPE-CD, :INCM-SQ-NMB,
            :UERND-INC-RCVD-DT, :PREV-AMT,
            :UERND-INC-FREQ, :UERND-INC-AMT,
            :AFDC-CNTBL-IND, :FS-CNTBL-AMT,
            :FS-CNTBL-IND, :MA-CNTBL-CD, :PRD-END-DT,
            :INVO-MND-DEDN-AMT, :UNE-INC-VERF-CD, :RECUR-IND, :CHNG-ENTRY-DT,
            :SSI-RSDI-RCVD-MTH, :SSI-RSDI-RCVD-YR,
            :UNE-INC-VERF-DT, :RCVD-DT, :RPRTD-DT, :RCPT-DT,
            :UNE-INC-VERF-BY, :CHAP-CNTBL-IND)
      } ;
  end
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
    AIN22W.WS-UPD-IND = "Y";
  end
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /* CBSI END*/
end // end AIN22P9-INS2


// ADD DISABLTY ROW
Function AIN22P9-INS3()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* ---CHANGES DUE TO PHASE IV MAABD IMPACT START-------*/
  /* In phase 3 the value of ssi-rfrl-sts-cd was not inserted,hence*/
  /* spaces was assigned to it. Because of the phase 3 rework a*/
  /* definite value has been incorporated for it in the dad. So the*/
  /* line which moved spaces to it has been removed*/
  /*  */
  if (H2-INCAP-DSBLTY.INJRY-IND == " ")
    H2-INCAP-DSBLTY.INJRY-IND = "?";
  end
  if (H2-INCAP-DSBLTY.VOC-REHAB-SIIS-IND == " ")
    H2-INCAP-DSBLTY.VOC-REHAB-SIIS-IND = "?";
  end
  if (H2-INCAP-DSBLTY.INCAP-DSBL-RSN-CD == " ")
    H2-INCAP-DSBLTY.INCAP-DSBL-RSN-CD = "?";
  end
  H2-INCAP-DSBLTY.INCAP-DSBL-VERF-CD = "Y";
  if (H2-INCAP-DSBLTY.SSI-RFRL-DT == " ")
    H2-INCAP-DSBLTY.SSI-RFRL-DT = "9999-12-31";
  end
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-INCAP-DSBLTY";
  VDBCONTROL.UPROC-OBJ = "H2-INCAP-DSBLTY";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS3";
  VDBCONTROL.UPROC-OPT = "ADD";
  if (H2-INCAP-DSBLTY.MDCAL-RVW-DT == " ")
    H2-INCAP-DSBLTY.MDCAL-RVW-DT = "9999-12-31";
  end
  if (H2-INCAP-DSBLTY.DSBL-END-DT == " ")
    H2-INCAP-DSBLTY.DSBL-END-DT = "9999-12-31";
  end
  try
    add H2-INCAP-DSBLTY ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INS3