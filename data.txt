package IVD_Batch;

import egl.core.deleteafteruse;
import CommonMigratedParts.*;
import DataItems.*;
import DataTables.*;

//*** PROGRAM=DFM34A ****
// Application Name : DFM34A   Generate NMSN form.
// ==================
// 
// This application generates the National Medical Support
// Notice (NMSN) form (GN0155). All applications generating the
// NMSN form including the forms menu (DFM04A) should call this
// application to do so.
// ***********************

program DFM34A type basicProgram //VAGen Info - called batch program
(VDBCONTROL VDBCONTROL, // record
        VMESSAGE VMESSAGE, // record
        DFM34W DFM34W, // record
        GNOMADS GNOMADS // record
){includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes}

    // Data Declarations
    DFE01W DFE01W; // record
    DFG00W1 DFG00W1; // record
    DFM34W1 DFM34W1{initialized = yes}; // record
    DFM34W2 DFM34W2; // record
    DFM34W3 DFM34W3; // record
    DFMBTCH-XFER DFMBTCH-XFER; // record
    DFMPOP-TRANSFER DFMPOP-TRANSFER; // record
    H-TOSSS3 H-TOSSS3; // record
    H2-2-COR-DOC H2-2-COR-DOC; // record
    H2-2-DCH-DCN H2-2-DCH-DCN; // record
    H2-2-OFF-IRF H2-2-OFF-IRF; // record
    H2-2-SPT-DCC H2-2-SPT-DCC; // record
    H2-CODE-TBL H2-CODE-TBL; // record
    H2-CUSTODIAN H2-CUSTODIAN; // record
    H2-EMPLOYER H2-EMPLOYER; // record
    H2-EMPLR-WWH-DTLS H2-EMPLR-WWH-DTLS; // record
    H2-FINAN-OBLGN H2-FINAN-OBLGN; // record
    H2-IVD-CASE H2-IVD-CASE; // record
    H2-JOB-HISTORY H2-JOB-HISTORY; // record
    H2-MED-INS-PLICY H2-MED-INS-PLICY; // record
    H2-NCP-ACCT-RCBL H2-NCP-ACCT-RCBL; // record
    H2-NOMADS-USER H2-NOMADS-USER; // record
    H2-OJRD-DTL H2-OJRD-DTL; // record
    H2-PERSON H2-PERSON; // record
    H3-PRVSN H3-PRVSN; // record
    VDBCOMMON VDBCOMMON; // record
    VFRMREC VFRMREC; // record
    VFRMREC3 VFRMREC3; // record
    VSTRREC4 VSTRREC4; // record
    
    // VAGen Info - items needed for migration
    VAGen_EZESYS char(8);
    VAGen_EZEREPLY num(1);
    VAGen_EZE_WAIT_TIME bin(9, 2);
    VAGen_EZE_ITEMLEN int;

    // Use Declarations
    use VDB00T1{deleteAfterUse = yes}; // table
    
    function main()
    // VAGen Info - initialization needed for migration
        VAGen_EZESYS = VGLib.getVAGSysType();
    DFM34P1-MAIN:
        DFM34P1-MAIN();
    end // end main
end // end DFM34A

// Update NMSN info

function DFM34I01-EWD()
    set H2-EMPLR-WWH-DTLS empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-OBJ = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-NM = "DFM34I01-EWD";
    VDBCONTROL.UPROC-OPT = "ADD";

    H2-EMPLR-WWH-DTLS.EMPLR-ID = H2-JOB-HISTORY.EMPLR-ID;
    H2-EMPLR-WWH-DTLS.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H2-EMPLR-WWH-DTLS.INC-WH-TRMND-DT = "9999-12-31";
    H2-EMPLR-WWH-DTLS.INC-WH-STRT-DT = "9999-12-31";
    H2-EMPLR-WWH-DTLS.EMPLR-DELIN-DT = "9999-12-31";
    H2-EMPLR-WWH-DTLS.NMSN-GEN-DT = DFM34W1.WS-PROC-DATE;
    H2-EMPLR-WWH-DTLS.NMSN-STATUS = "I";
    try
        add H2-EMPLR-WWH-DTLS
                with #sql{
        insert into twnemplr_wwh_dtls
        (EMPLR_ID, DCKT_NMB, EMPLR_WWH_ESTD_AMT,
          INC_WH_TRMND_DT, INC_WH_STRT_DT,
          EMPLR_DELIN_DT, NMSN_GEN_DT, NMSN_STATUS)
        values (:EMPLR-ID, :DCKT-NMB, :EMPLR-WWH-ESTD-AMT,
          :INC-WH-TRMND-DT, :INC-WH-STRT-DT,
          :EMPLR-DELIN-DT, :NMSN-GEN-DT, :NMSN-STATUS)
      };
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34I01-EWD

function DFM34P1-MAIN()
    set DFM34W1 empty;
    DFM34W.GN0155-GENERATED-IND = "N";
    /*  */
    /* ************************************************************************/
    /* VALIDATE PASSED PARAMETERS                             **/
    /* ************************************************************************/
    /*  */
    if(DFM34W.SUB-SYS-CODE != "A" && DFM34W.SUB-SYS-CODE != "D")
        VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
        VMESSAGE.UMSGINS[1] = "DFM34A";
        VMESSAGE.UMSGINS[2] = "(SUB SYSTEM CODE)";
        VMESSAGE.UMSGTYPE = "E";
        VDBCONTROL.URC = 105;
        exit program;
    end

    if(DFM34W.APPL-NAME == " ")
        VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
        VMESSAGE.UMSGINS[1] = "DFM34A";
        VMESSAGE.UMSGINS[2] = "(APPLICATION NAME)";
        VMESSAGE.UMSGTYPE = "E";
        VDBCONTROL.URC = 105;
        exit program;
    end

    if(DFM34W.APPL-TYPE != "B" && DFM34W.APPL-TYPE != "O")
        VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
        VMESSAGE.UMSGINS[1] = "DFM34A";
        VMESSAGE.UMSGINS[2] = "(APPLICATION TYPE)";
        VMESSAGE.UMSGTYPE = "E";
        VDBCONTROL.URC = 105;
        exit program;
    end

    if(DFM34W.CRNT-DATE-MM < "01" || DFM34W.CRNT-DATE-MM > "12")
        VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
        VMESSAGE.UMSGINS[1] = "DFM34A";
        VMESSAGE.UMSGINS[2] = "(DATE)";
        VMESSAGE.UMSGTYPE = "E";
        VDBCONTROL.URC = 105;
        exit program;
    end

    /* WI-4287 - JMorgan 02/02/18 */
    DFM34Q23-CT();
    if(DFM34W.EMPLR-ID == H2-CODE-TBL.CODE-DESC && DFM34W.APPL-NAME !=
                    "DFM04A")
        ;
        exit program;
    end

    DFM34W1.WS-PROC-DATE = "    -  -  ";
    DFM34W1.WS-PROC-DATE-CCYY = DFM34W.CRNT-DATE-CCYY;
    DFM34W1.WS-PROC-DATE-MM = DFM34W.CRNT-DATE-MM;
    DFM34W1.WS-PROC-DATE-DD = DFM34W.CRNT-DATE-DD;

    DFM34W1.HW-YR = DFM34W.CRNT-DATE-CCYY;
    DFM34W1.HW-MTH = DFM34W.CRNT-DATE-MM;

    /* for fame*/
    if(DFM34W.SUB-SYS-CODE == "A")
        if(DFM34W.PLICY-SQ-NMB == 0)
            VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
            VMESSAGE.UMSGINS[1] = "DFM34A";
            VMESSAGE.UMSGINS[2] = "(POLICY SQ NMB)";
            VMESSAGE.UMSGTYPE = "E";
            VDBCONTROL.URC = 105;
            exit program;
        end
    end

    /* for IV-D*/

    if(DFM34W.SUB-SYS-CODE == "D")

        if(DFM34W.NCP-UPI == 0)
            VMESSAGE.UMSGCODE = "GEN0665E"; /* INPUT PARAMETERS INVALID*/
            VMESSAGE.UMSGINS[1] = "DFM34A";
            VMESSAGE.UMSGINS[2] = "(NCP UPI)";
            VMESSAGE.UMSGTYPE = "E";
            VDBCONTROL.URC = 105;
            exit program;
        end

    end
    /*  */
    /* ************************************************************************/
    /* PROCESS                                                **/
    /* ************************************************************************/
    /*  */
    if(DFM34W.SUB-SYS-CODE == "A") /* FAME*/

        DFM34Q16-MIP();
        if(H2-MED-INS-PLICY.UPI > 0)
            DFM34W.NCP-UPI = H2-MED-INS-PLICY.UPI;
            DFM34Q01-IDC();
            DFM34Q01-SCAN();
            while(H2-IVD-CASE not noRecordFound)
                DFM34P3-ALL-DOCKTS();
                DFM34Q01-SCAN();
            end
        end

    else /* IV-D*/

        if(DFM34W.APPL-NAME == "DFM04A") /* Forms menu*/

            set H2-IVD-CASE empty;
            H2-IVD-CASE.NCP-UPI = DFM34W.NCP-UPI;
            H2-IVD-CASE.CASE-SUFX = DFM34W.CASE-SUFX;
            H2-IVD-CASE.CST-UPI = DFM34W.CST-UPI;

            set DFMPOP-TRANSFER empty;

            /* Get Docket*/
            DFMPOP-TRANSFER.PIO-FORM-ID = "GN0155";
            DFMPOP-TRANSFER.PIO-CASE-SUFX = DFM34W.CASE-SUFX;
            DFMPOP-TRANSFER.PIO-UPI = DFM34W.NCP-UPI;
            call "DFC61A"(VDBCONTROL, VMESSAGE,
                    DFMPOP-TRANSFER){isNoRefresh = yes};
            if(VDBCONTROL.URC > 104)
                exit program;
            end
            DFM34W.DCKT-NMB = DFMPOP-TRANSFER.PIO-DCKT-NMB;

            /* Get Employer*/

            DFMPOP-TRANSFER.PIO-PARM-NMB = 13;
            call "DFC06A"(VDBCONTROL, VMESSAGE,
                    DFMPOP-TRANSFER){isNoRefresh = yes};
            if(VDBCONTROL.URC > 104)
                exit program;
            end

            DFM34W.EMPLR-ID = DFMPOP-TRANSFER.PIO-POP-PARM[13];
            set H2-JOB-HISTORY empty;
            H2-JOB-HISTORY.EMPLR-ID = DFMPOP-TRANSFER.PIO-POP-PARM[13];

            DFM34Q15-COR-DOC();

            /* WI-4287 - JMorgan 02/02/18 
            DFM34Q23-CT();
            if(DFM34W.EMPLR-ID == H2-CODE-TBL.CODE-DESC && DFM34W.APPL-NAME !="DFM04A");
                exit program;
            end
            */

            /* WI 28699 begin*/
            DFM34Q22-PRV();
            if(sysVar.sqlData.sqlcode != 0)
                /* WI 28699 end*/

                DFM34P4-PROC-DOCKT();
            end

        else /* Other IV-D applications*/
            /* (auto generated)*/

            if(DFM34W.CASE-SUFX == " ") /* Process all qualifing cases*/
                DFM34Q01-IDC(); /* for the NCP*/
                DFM34Q01-SCAN();
                while(H2-IVD-CASE not noRecordFound)
                    if(DFM34W.DCKT-NMB == 0)
                        DFM34P3-ALL-DOCKTS();
                    else
                        DFM34P3-ONE-DOCKET();
                    end
                    DFM34Q01-SCAN();
                end
            else /* Process the specific case*/
                /* for the NCP*/
                DFM34Q02-IDC();
                if(H2-IVD-CASE is noRecordFound)
                    return;
                end

                if(DFM34W.DCKT-NMB == 0)
                    DFM34P3-ALL-DOCKTS();
                else
                    DFM34P3-ONE-DOCKET();
                end
            end
        end
    end
end // end DFM34P1-MAIN

function DFM34P3-ALL-DOCKTS()
/* ************************************************************************/
/* Process all dockets for the case.                                   **/
/* ************************************************************************/

    set H2-2-COR-DOC empty;
    DFM34Q03-COR-DOC();
    DFM34Q03-SCAN();
    while(H2-2-COR-DOC not noRecordFound)
        /* WI 28699 begin*/
        DFM34Q22-PRV();
        if(sysVar.sqlData.sqlcode != 0)
            /* WI 28699 end*/
            DFM34P4-PROC-DOCKT();
        end
        DFM34Q03-SCAN();
    end
    /*  */
end // end DFM34P3-ALL-DOCKTS

function DFM34P3-ONE-DOCKET()
/* ************************************************************************/
/* Process specific docket.                                            **/
/* ************************************************************************/

    set H2-2-COR-DOC empty;
    DFM34Q08-COR-DOC();
    if(H2-2-COR-DOC not noRecordFound)
        /* WI 28699 begin*/
        DFM34Q22-PRV();
        if(sysVar.sqlData.sqlcode != 0)
            /* WI 28699 end*/
            DFM34P4-PROC-DOCKT();
        end
    end
    /*  */
end // end DFM34P3-ONE-DOCKET

function DFM34P4-PROC-DOCKT()
/* ************************************************************************/
/* Process docket                                                      **/
/* ************************************************************************/

    set DFM34W2 empty;

    /* ONLY PROCESS DOCKETS WITH CUR CMOA UNLESS REQUESTED FROM FORMS MENU*/
    if(DFM34W.APPL-NAME == "DFM04A")
        DFM34W2.CMOA-IND = "Y";
    else
        DFM34W2.CMOA-IND = "N";
        DFM34P5-CMOA();
    end
    if(DFM34W2.CMOA-IND == "N")
        return;
    end

    DFM34W2.FVI = "N";
    DFM34W2.NON-DISCLSR-FND = "N";
    DFM34W2.CHD-INDX = 0;
    /* GET CHILDREN*/
    DFM34Q05-DCH-DCN();
    DFM34Q05-SCAN();
    while(H2-2-DCH-DCN not noRecordFound && DFM34W2.CHD-INDX < 10)
        /* WI 22974 begin*/
        /* PERFORM DFM34Q06-MIP-PCO;      /* Check Insurance*/
        /* IF DFM34W2.INS-PLCY-IND = 'N';*/
        /* WI 22974 end*/
        DFM34W2.CHD-INDX = DFM34W2.CHD-INDX + 1;
        DFM34P9-MOVE-CHILD();
        /* END;*/
        DFM34Q05-SCAN();
    end

    if(DFM34W2.CHD-INDX > 0)
        if(DFM34W.EMPLR-ID == " ")
            DFM34P5-ALL-EMPLRS();
        else
            DFM34P5-ONE-EMPLR();
        end
    end
    /*  */
end // end DFM34P4-PROC-DOCKT

// Process all Employers

function DFM34P5-ALL-EMPLRS()
    DFM34Q09-JHS();
    DFM34Q09-SCAN();
    while(H2-JOB-HISTORY not noRecordFound)
        /* WI-4287 - JMorgan 02/02/18 */
        if(H2-JOB-HISTORY.EMPLR-ID == H2-CODE-TBL.CODE-DESC &&
                DFM34W.APPL-NAME != "DFM04A")
        /* DO NOTHING */
        else
            DFM34P6-GEN-FORM();
        end
        DFM34Q09-SCAN();
    /**** DELETE LAST TWO LINES WHEN MOVING TO PRODUCTION */
    /* DFM34P6-GEN-FORM();
        DFM34Q09-SCAN(); */
    end
end // end DFM34P5-ALL-EMPLRS

// Determine current CS CMOA

function DFM34P5-CMOA()
/* If Fin Obligation not active, do not generate*/
    DFM34Q20-FIO();
    if(H2-FINAN-OBLGN is noRecordFound || H2-FINAN-OBLGN.CRNT-OBLGN-STS != "A")
        return;
    end

    /* IF CMOA on NCP Accounts Receivable > 0, do generate the form*/
    DFM34Q04-NAC();
    if(H2-NCP-ACCT-RCBL is noRecordFound)
        return;
    end
    if(H2-NCP-ACCT-RCBL.CRSUP-CMOA > 0)
        DFM34W2.CMOA-IND = "Y";
        return;
    end

    /* If Variation, do generate the form*/
    set H-TOSSS3 empty;
    H-TOSSS3.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H-TOSSS3.SQNC-NMB = H2-2-COR-DOC.LST-SQNC-NMB;
    H-TOSSS3.PRVSN-TYPE = "CS";
    H-TOSSS3.OBLGN-SUSPN-TYPE = "C";
    H-TOSSS3.HW-YRMTH = DFM34W1.HW-YRMTH;
    H-TOSSS3.HW-MONTH = DFM34W.CRNT-DATE-MM-NUM;
    H-TOSSS3.HW-YEAR = DFM34W.CRNT-DATE-CCYY-NUM;
    call "TOSSS3A"(VDBCONTROL, VMESSAGE, H-TOSSS3){isNoRefresh = yes};
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    if(VDBCONTROL.URC == 0)
        DFM34W2.CMOA-IND = "Y";
    end
    /*  */
end // end DFM34P5-CMOA

// Process Specific Employer

function DFM34P5-ONE-EMPLR()
    DFM34Q19-JHS();
    if(DFM34W.APPL-NAME != "DFM04A" &&((H2-JOB-HISTORY.VRFN-STS != "C" &&
                    H2-JOB-HISTORY.VRFN-STS != "V") ||(
                    H2-JOB-HISTORY.HLTH-INS-IND != "Y" &&
                            H2-JOB-HISTORY.HLTH-INS-IND != " " &&
                            H2-JOB-HISTORY.HLTH-INS-IND != "U") ||
                    H2-JOB-HISTORY.JOB-END-DT != "9999-12-31"))
        return;
    end

    DFM34P6-GEN-FORM();
end // end DFM34P5-ONE-EMPLR

function DFM34P6-GEN-FORM()
/* Check Custodian for non-disclosure and family violence if needed.*/
    if(DFM34W2.FVI == "N" && DFM34W2.NON-DISCLSR-FND == "N")
        DFM34Q13-CTN();
        if(H2-CUSTODIAN.FVI == "Y")
            DFM34W2.FVI = "Y";
        end
        if(H2-CUSTODIAN.NON-DISCLSR-FND == "Y" ||
                H2-CUSTODIAN.NON-DISCLSR-FND == "P")
            DFM34W2.NON-DISCLSR-FND = "Y";
        end
    end
    /*  */
    DFM34Q10-EWD();
    /*  */
    if(H2-EMPLR-WWH-DTLS not noRecordFound && H2-EMPLR-WWH-DTLS.NMSN-GEN-DT !=
                    "9999-12-31" && DFM34W.APPL-NAME !=
                    "DFM04A") /* Do not generate form when previously*/
        return; /* generated unless requested from forms*/
    end /* menu*/
    /*  */
    /* ************************************************************************/
    /* Build Sib Parameters in working storage                            **/
    /* ************************************************************************/

    set DFM34W3 empty;

    /* WNSYSDATE*/
    VFRMREC.WS-SYSDATE = DFM34W1.WS-PROC-DATE;
    DFG00P9-DATE-FMT(); /* Format Date*/
    DFM34W3.SIB-PARM[1] = VFRMREC.WS-SYSDATE;

    /* WNOFFICECD WNOFFNAME WNOFFADR1 WNOFFADDR2 WNOFFCTY*/
    /* WNOFFST    WNOFFZIP  WNPHONE   WNOFFPHNO*/
    DFM34Q17-SPT-DCC();
    set DFE01W empty;
    DFE01W.PIO-UPI = DFM34W.NCP-UPI;
    DFE01W.PIO-CASE-SUFX = DFM34W.CASE-SUFX;
    DFE01W.PIO-PARM-NMB = 1;
    DFE01W.PIO-POP-PARM[1] = H2-2-SPT-DCC.OFC-CD;
    call "DFE05A"(VDBCONTROL, VMESSAGE, DFE01W){isNoRefresh = yes};
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    DFM34W3.SIB-PARM[2] = DFE01W.PIO-POP-PARM[1];
    DFM34W3.SIB-PARM[3] = DFE01W.PIO-POP-PARM[2];
    DFM34W3.SIB-PARM[4] = DFE01W.PIO-POP-PARM[3];
    DFM34W3.SIB-PARM[5] = DFE01W.PIO-POP-PARM[4];
    DFM34W3.SIB-PARM[6] = DFE01W.PIO-POP-PARM[5];
    DFM34W3.SIB-PARM[7] = DFE01W.PIO-POP-PARM[6];
    DFM34W3.SIB-PARM[8] = DFE01W.PIO-POP-PARM[7];
    DFM34W3.SIB-PARM[9] = DFE01W.PIO-POP-PARM[8];
    DFM34W3.SIB-PARM[10] = DFE01W.PIO-POP-PARM[9];

    DFM34Q18-NMU();

    DFM34Q21-IRF-OFF();
    if(H2-2-OFF-IRF.PHN-NMB != " ")
        VFRMREC3.WS-PHONE-FMT = " ";
        VFRMREC3.WS-PHONE = H2-2-OFF-IRF.PHN-NMB;
        DFG00P9-PHONE-FMT3();
        DFM34W3.SIB-PARM[9] = VFRMREC3.WS-AREA;
        DFM34W3.SIB-PARM[10] = VFRMREC3.WS-PHONE-FMT;
    end

    /* WNFAXAREA WNFAXNO*/
    VFRMREC3.WS-PHONE-FMT = " ";
    VFRMREC3.WS-PHONE = H2-NOMADS-USER.FAX-NMB;
    DFG00P9-PHONE-FMT3();
    DFM34W3.SIB-PARM[11] = VFRMREC3.WS-AREA;
    DFM34W3.SIB-PARM[12] = VFRMREC3.WS-PHONE-FMT;

    /* WNEMPFEIN*/
    DFM34W1.FEIN = H2-JOB-HISTORY.EMPLR-ID;
    if(DFM34W1.FEIN-I == "-")
        DFM34W3.SIB-PARM[13] = H2-JOB-HISTORY.EMPLR-ID;
    else
        DFM34W3.SIB-PARM[13] = " ";
    end

    /* WNEMPNM*/
    /* Employer Name Hierarchy: Agent Name / Employer Name*/
    DFM34Q11-EMP();
    if(H2-EMPLOYER.AGNT-NM != " ")
        DFM34W3.SIB-PARM[14] = H2-EMPLOYER.AGNT-NM;
    else
        DFM34W3.SIB-PARM[14] = H2-EMPLOYER.EMPLR-NM;
    end

    /* WNEMPADR1 / WNEMPADR2 / WNEMPCTY / WNEMPST / WNEMPZIP*/
    /* Employer Address Hierarchy: Agent Address / Site Address*/
    /* Employer Address.*/
    if(H2-EMPLOYER.AGNT-CITY != " ") /* Agent Address*/
        DFM34W3.SIB-PARM[15] = H2-EMPLOYER.AGNT-ADR1;
        DFM34W3.SIB-PARM[16] = H2-EMPLOYER.AGNT-ADR2;
        DFM34W3.SIB-PARM[17] = H2-EMPLOYER.AGNT-CITY;
        DFM34W3.SIB-PARM[18] = H2-EMPLOYER.AGNT-ST;
        VFRMREC.WS-ZIP = H2-EMPLOYER.AGNT-ZIP-CD;
        DFG00P9-ZIP-FMT(); /* Format zip code*/
        DFM34W3.SIB-PARM[19] = VFRMREC.WS-ZIP-FMT;
    else
        if(H2-JOB-HISTORY.CITY != " ") /* Site Address*/
            DFM34W3.SIB-PARM[15] = H2-JOB-HISTORY.ADR-LN1;
            DFM34W3.SIB-PARM[16] = H2-JOB-HISTORY.ADR-LN2;
            DFM34W3.SIB-PARM[17] = H2-JOB-HISTORY.CITY;
            DFM34W3.SIB-PARM[18] = H2-JOB-HISTORY.ST-CD;
            VFRMREC.WS-ZIP = H2-JOB-HISTORY.ZIP-CD;
            DFG00P9-ZIP-FMT(); /* Format zip code*/
            DFM34W3.SIB-PARM[19] = VFRMREC.WS-ZIP-FMT;
        else /* Employer Address*/
            DFM34W3.SIB-PARM[15] = H2-EMPLOYER.ADR-LN1;
            DFM34W3.SIB-PARM[16] = H2-EMPLOYER.ADR-LN2;
            DFM34W3.SIB-PARM[17] = H2-EMPLOYER.CITY;
            DFM34W3.SIB-PARM[18] = H2-EMPLOYER.ST-CD;
            VFRMREC.WS-ZIP = H2-EMPLOYER.ZIP-CD;
            DFG00P9-ZIP-FMT(); /* Format zip code*/
            DFM34W3.SIB-PARM[19] = VFRMREC.WS-ZIP-FMT;
        end
    end

    /* WNCOURT*/
    DFM34Q12-CDT();
    if(H2-CODE-TBL.CODE-TBL-CD > "00   " && H2-CODE-TBL.CODE-TBL-CD < "19   ")
        VSTRREC4.USTRING = H2-CODE-TBL.CODE-DESC;
        VSTRREC4.UCONCAT = "COUNTY";
        VSTRREC4.UCONCAT2 = " ";
        VSTRREC4.UCONCAT3 = " ";
        VSTRREC4.USTRLEN = 50;
        VSTRREC4.UCONLEN = 6;
        VSTRREC4.UCONLEN2 = 0;
        VSTRREC4.UCONLEN3 = 0;
        call "WST50A"(VSTRREC4){isNoRefresh = yes};
        DFM34W1.WS-TEXT-37 = VSTRREC4.USTRING;
        DFM34W3.SIB-PARM[20] = DFM34W1.WS-TEXT-37;
    else
        DFM34W1.WS-TEXT-37 = H2-CODE-TBL.CODE-DESC;
        DFM34W3.SIB-PARM[20] = DFM34W1.WS-TEXT-37;
    end

    /* WNEFFDT*/
    VFRMREC.WS-SYSDATE = H2-2-COR-DOC.ORDER-EFF-DT;
    DFG00P9-DATE-FMT(); /* Format Date*/
    DFM34W3.SIB-PARM[21] = VFRMREC.WS-SYSDATE;

    /* WNDCKTNMB*/

    if(H2-2-COR-DOC.INIT-CNTRL-IND == "D" || H2-2-COR-DOC.INIT-CNTRL-IND ==
                    "P")
        DFM34W3.SIB-PARM[22] = H2-2-COR-DOC.INIT-DCKT-NMB;
    else
        if(H2-2-COR-DOC.RESP-CNTRL-IND == "D" || H2-2-COR-DOC.RESP-CNTRL-IND ==
                        "P")
            DFM34W3.SIB-PARM[22] = H2-2-COR-DOC.RSPDG-DCKT-NMB;
        else
            if(H2-2-COR-DOC.OTHER-CNTRL-IND == "D" ||
                    H2-2-COR-DOC.OTHER-CNTRL-IND == "P")
                DFM34W3.SIB-PARM[22] = H2-2-COR-DOC.OTHER-DCKT-NMB;
            end
        end
    end

    /* WNNCPNM (FED Format)*/
    set H2-PERSON empty;
    H2-PERSON.UPI = DFM34W.NCP-UPI;
    DFM34Q07-PERSON();

    VSTRREC4.USTRING = H2-PERSON.LST-NM;
    VSTRREC4.UCONCAT = H2-PERSON.FRST-NM;
    VSTRREC4.UCONCAT2 = H2-PERSON.MID-NM;
    VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
    VSTRREC4.USTRLEN = 21;
    VSTRREC4.UCONLEN = 56;
    VSTRREC4.UCONLEN2 = 16;
    VSTRREC4.UCONLEN3 = 3;
    call "DFE06A"(VSTRREC4){isNoRefresh = yes};
    DFM34W1.WS-TEXT-40 = VSTRREC4.USTRING;
    DFM34W3.SIB-PARM[23] = DFM34W1.WS-TEXT-40;

    /* WNNCPNAME (Normal Format)*/
    VSTRREC4.USTRING = H2-PERSON.FRST-NM;
    VSTRREC4.UCONCAT = H2-PERSON.MID-NM;
    VSTRREC4.UCONCAT2 = H2-PERSON.LST-NM;
    VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
    VSTRREC4.USTRLEN = 56;
    VSTRREC4.UCONLEN = 16;
    VSTRREC4.UCONLEN2 = 21;
    VSTRREC4.UCONLEN3 = 3;
    call "WST50A"(VSTRREC4){isNoRefresh = yes};
    DFM34W3.NCP-NAME = VSTRREC4.USTRING;

    /* WNNCPSSN*/
    DFM34W3.NCP-SSN = H2-PERSON.SSN;

    /* WNCSTNM (FED Format)*/
    set H2-PERSON empty;
    H2-PERSON.UPI = H2-IVD-CASE.CST-UPI;
    DFM34Q07-PERSON();

    VSTRREC4.USTRING = H2-PERSON.LST-NM;
    VSTRREC4.UCONCAT = H2-PERSON.FRST-NM;
    VSTRREC4.UCONCAT2 = H2-PERSON.MID-NM;
    VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
    VSTRREC4.USTRLEN = 21;
    VSTRREC4.UCONLEN = 56;
    VSTRREC4.UCONLEN2 = 16;
    VSTRREC4.UCONLEN3 = 3;
    call "DFE06A"(VSTRREC4){isNoRefresh = yes};
    DFM34W1.WS-TEXT-40 = VSTRREC4.USTRING;
    DFM34W3.SIB-PARM[29] = DFM34W1.WS-TEXT-40;

    /* WNCSTNAME (Normal Format)*/
    VSTRREC4.USTRING = H2-PERSON.FRST-NM;
    VSTRREC4.UCONCAT = H2-PERSON.MID-NM;
    VSTRREC4.UCONCAT2 = H2-PERSON.LST-NM;
    VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
    VSTRREC4.USTRLEN = 56;
    VSTRREC4.UCONLEN = 16;
    VSTRREC4.UCONLEN2 = 21;
    VSTRREC4.UCONLEN3 = 3;
    call "WST50A"(VSTRREC4){isNoRefresh = yes};
    DFM34W3.CST-NAME = VSTRREC4.USTRING;

    /* WNCSTSSN*/
    DFM34W3.CST-SSN = H2-PERSON.SSN;

    /* WNCORRFIPS*/
    if(DFM34W2.FVI == "N" && DFM34W2.NON-DISCLSR-FND == "N")
        if(H2-2-COR-DOC.JRSDT-TYPE == "R")
            DFM34Q14-OJR();
            if(H2-OJRD-DTL not noRecordFound)
                DFM34W3.FIPS-CD = H2-OJRD-DTL.CRSPG-FIPS-CD;
                DFM34W3.FIPS-SUFX = H2-OJRD-DTL.CRSPG-FIPS-CD-SUFX;
                DFM34W3.SIB-PARM[35] = DFM34W3.FIPS;
                DFM34W3.SIB-PARM[36] = "X";
            else
                DFM34W3.SIB-PARM[30] = "X";
            end
        else
            DFM34W3.SIB-PARM[30] = "X";
        end
    end

    /* Child Info*/
    DFM34W2.CHD-INDX = 1;
    DFM34W3.PARM-INDEX = 43;
    while(DFM34W2.CHD-INDX < 11)
        DFM34W3.SIB-PARM[PARM-INDEX] = DFM34W2.NAME[CHD-INDX];
        DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        DFM34W3.SIB-PARM[PARM-INDEX] = DFM34W2.DOB[CHD-INDX];
        DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        DFM34W3.SIB-PARM[PARM-INDEX] = DFM34W2.SSN[CHD-INDX];
        DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        DFM34W2.CHD-INDX = DFM34W2.CHD-INDX + 1;
    end

    /* WNWORKNM*/
    VSTRREC4.USTRING = H2-NOMADS-USER.FRST-NM;
    VSTRREC4.UCONCAT = H2-NOMADS-USER.MID-NM;
    VSTRREC4.UCONCAT2 = H2-NOMADS-USER.LST-NM;
    VSTRREC4.UCONCAT3 = H2-NOMADS-USER.MODFR;
    VSTRREC4.USTRLEN = 16;
    VSTRREC4.UCONLEN = 16;
    VSTRREC4.UCONLEN2 = 21;
    VSTRREC4.UCONLEN3 = 3;
    call "WST50A"(VSTRREC4){isNoRefresh = yes};
    DFM34W3.SIB-PARM[73] = VSTRREC4.USTRING;

    // WI 1933 begin
    /* Child Sex*/
    DFM34W2.CHD-INDX = 1;
    DFM34W3.PARM-INDEX = 74;
    while(DFM34W2.CHD-INDX < 11)
        DFM34W3.SIB-PARM[PARM-INDEX] = DFM34W2.SEX[CHD-INDX];
        DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        DFM34W2.CHD-INDX = DFM34W2.CHD-INDX + 1;
    end
    // WI 1933 end
    
    /* ************************************************************************/
    /* Generate Form GN0155                                                 **/
    /* ************************************************************************/

    if(DFM34W.APPL-TYPE == "O")
        set DFMPOP-TRANSFER empty;
        DFMPOP-TRANSFER.PO1-LENGTH = 9801;
        DFMPOP-TRANSFER.PO1-TRANID = "WM01";
        DFMPOP-TRANSFER.PIO-FORM-ID = "GN0155";
        DFMPOP-TRANSFER.PIO-CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
        DFMPOP-TRANSFER.PIO-UPI = H2-IVD-CASE.NCP-UPI;
        DFMPOP-TRANSFER.PIO-DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
        DFMPOP-TRANSFER.PIO-LST-SQ-NMB = H2-2-COR-DOC.LST-SQNC-NMB;
        DFMPOP-TRANSFER.PIO-NMB-OF-COPIES = 1;
        if(DFM34W.APPL-NAME == "DFM04A") /* FORMS MENU*/
            DFMPOP-TRANSFER.PIO-MODE-IND = "F";
        else
            DFMPOP-TRANSFER.PIO-MODE-IND = "D";
        end
        DFMPOP-TRANSFER.PIO-USRID = GNOMADS.G-USER-ID;
        DFMPOP-TRANSFER.PIO-TERMID = GNOMADS.G-TERM-ID;
        DFMPOP-TRANSFER.PIO-NCP-NAME = DFM34W3.NCP-NAME;
        DFMPOP-TRANSFER.PIO-NCP-SSN = DFM34W3.NCP-SSN;
        DFMPOP-TRANSFER.PIO-CST-NAME = DFM34W3.CST-NAME;
        DFMPOP-TRANSFER.PIO-CST-SSN = DFM34W3.CST-SSN;
        DFMPOP-TRANSFER.PIO-PARM-NMB = 83;
        DFM34W3.PARM-INDEX = 1;
        while(DFM34W3.PARM-INDEX < 84)
            DFMPOP-TRANSFER.PIO-POP-PARM[PARM-INDEX] = DFM34W3.SIB-PARM[PARM-INDEX];
            DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        end
        DFMPOP-TRANSFER.WS-APPL-ID = DFM34W.APPL-NAME;
        call "DFM07A"(VDBCONTROL, VMESSAGE,
                DFMPOP-TRANSFER){isNoRefresh = yes};
        if(VDBCONTROL.URC > 104)
            exit program;
        end
        DFM34W.GN0155-GENERATED-IND = "Y";
    end

    if(DFM34W.APPL-TYPE == "B") /* BATCH*/
        set DFMBTCH-XFER empty;
        DFMBTCH-XFER.PIO-FORM-ID = "GN0155";
        DFMBTCH-XFER.PIO-CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
        DFMBTCH-XFER.PIO-UPI = H2-IVD-CASE.NCP-UPI;
        DFMBTCH-XFER.PIO-DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
        DFMBTCH-XFER.PIO-DCKT-SQ-NMB = H2-2-COR-DOC.LST-SQNC-NMB;
        DFMBTCH-XFER.PIO-NMB-OF-COPIES = 1;
        DFMBTCH-XFER.PIO-NCP-NAME = DFM34W3.NCP-NAME;
        DFMBTCH-XFER.PIO-NCP-SSN = DFM34W3.NCP-SSN;
        DFMBTCH-XFER.PIO-CST-NAME = DFM34W3.CST-NAME;
        DFMBTCH-XFER.PIO-CST-SSN = DFM34W3.CST-SSN;
        DFMBTCH-XFER.PIO-PARM-NMB = 83;
        DFM34W3.PARM-INDEX = 1;
        while(DFM34W3.PARM-INDEX < 84)
            DFMBTCH-XFER.PIO-POP-PARM[PARM-INDEX] = DFM34W3.SIB-PARM[PARM-INDEX];
            DFM34W3.PARM-INDEX = DFM34W3.PARM-INDEX + 1;
        end
        DFMBTCH-XFER.WS-APPL-ID = DFM34W.APPL-NAME;
        call "DFM08A"(VDBCONTROL, VMESSAGE, DFMBTCH-XFER){isNoRefresh = yes};
        if(VDBCONTROL.URC > 104)
            exit program;
        end
        if(VMESSAGE.UMESSAGE == " ")
            DFM34W.GN0155-GENERATED-IND = "Y";
        end
    end

    if(DFM34W.GN0155-GENERATED-IND == "Y")
        if(H2-EMPLR-WWH-DTLS not noRecordFound)
            DFM34U01-EWD();
        else
            DFM34I01-EWD();
        end
    end
    /*  */
end // end DFM34P6-GEN-FORM

// Move Child info

function DFM34P9-MOVE-CHILD()
    if(H2-2-DCH-DCN.FVI == "Y")
        DFM34W2.FVI = "Y";
    end

    if(H2-2-DCH-DCN.NON-DISCLSR-FND == "Y" || H2-2-DCH-DCN.NON-DISCLSR-FND ==
                    "P")
        DFM34W2.NON-DISCLSR-FND = "Y";
    end

    set H2-PERSON empty;
    H2-PERSON.UPI = H2-2-DCH-DCN.CHD-UPI;
    DFM34Q07-PERSON();

    VSTRREC4.USTRING = H2-PERSON.LST-NM;
    VSTRREC4.UCONCAT = H2-PERSON.FRST-NM;
    VSTRREC4.UCONCAT2 = H2-PERSON.MID-NM;
    VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
    VSTRREC4.USTRLEN = 21;
    VSTRREC4.UCONLEN = 56;
    VSTRREC4.UCONLEN2 = 16;
    VSTRREC4.UCONLEN3 = 3;
    call "DFE06A"(VSTRREC4){isNoRefresh = yes};
    DFM34W2.NAME[CHD-INDX] = VSTRREC4.USTRING;

    VFRMREC.WS-SSN = H2-PERSON.SSN;
    DFG00P9-SSN-FMT(); /* Format SSN*/
    DFM34W2.SSN[CHD-INDX] = VFRMREC.WS-SSN-FMT;

    VFRMREC.WS-SYSDATE = H2-PERSON.DOB;
    DFG00P9-DATE-FMT(); /* Format Date*/
    DFM34W2.DOB[CHD-INDX] = VFRMREC.WS-SYSDATE;

    // WI 1993 begin
    DFM34W2.SEX[CHD-INDX] = H2-PERSON.SEX-CD;
    // WI 1933 end
    
end // end DFM34P9-MOVE-CHILD

// Get Qualifing Cases

function DFM34Q01-IDC()
    set H2-IVD-CASE empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-IVD-CASE";
    VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";
    VDBCONTROL.UPROC-NM = "DFM34Q01-IDC";
    VDBCONTROL.UPROC-OPT = "SETINQ";

    H2-IVD-CASE.NCP-UPI = DFM34W.NCP-UPI;
    try
        open DFM34Q01-IDC_RSI01
                with #sql{
        select CASE_SUFX, CST_UPI
        from TWNIVD_CASE T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
          NCP_UPI        =   :NCP-UPI                         AND
          CASE_STS       =   'A'                              AND
          CASE_TYPE      IN ('A', 'C', 'E', 'M', 'N', 'P')    AND
          FUNC_AREA_CD   =   'E'                              AND
          SRVC_LVL       <>  'Y'
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CASE-SUFX, CST-UPI for H2-IVD-CASE;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q01-IDC

// Get Qualifing Cases

function DFM34Q01-SCAN()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-IVD-CASE";
    VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";
    VDBCONTROL.UPROC-NM = "DFM34Q01-SCAN";
    VDBCONTROL.UPROC-OPT = "SCAN";
    try
        get next H2-IVD-CASE;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q01-SCAN

// Check if Case Qualifies

function DFM34Q02-IDC()
    set H2-IVD-CASE empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-IVD-CASE";
    VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";
    VDBCONTROL.UPROC-NM = "DFM34Q02-IDC";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-IVD-CASE.NCP-UPI = DFM34W.NCP-UPI;
    H2-IVD-CASE.CASE-SUFX = DFM34W.CASE-SUFX;
    try
        get H2-IVD-CASE singleRow
                with #sql{
        select CST_UPI
        from TWNIVD_CASE T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
          NCP_UPI        =   :NCP-UPI                         AND
          CASE_SUFX      =   :CASE-SUFX                       AND
          CASE_STS       =   'A'                              AND
          CASE_TYPE      IN ('A', 'C', 'E', 'M', 'N', 'P')    AND
          FUNC_AREA_CD   =   'E'                              AND
          SRVC_LVL       <>  'Y'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CST-UPI;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q02-IDC

// Get Qualifing Dockets

function DFM34Q03-COR-DOC()
    set H2-2-COR-DOC empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-OBJ = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-NM = "DFM34Q03-COR-DOC";
    VDBCONTROL.UPROC-OPT = "SETINQ";

    H2-2-COR-DOC.UPI = H2-IVD-CASE.NCP-UPI;
    H2-2-COR-DOC.CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
    try
        open DFM34Q03-COR-DOC_RSI01
                with #sql{
        select T2.DCKT_NMB, T2.RESP_LCTN_CD, T2.RSPDG_DCKT_NMB,
          T2.OTHER_LCTN_CD, T2.OTHER_DCKT_NMB, T2.INIT_DCKT_NMB,
          T2.INIT_LCTN_CD, T1.ORDER_EFF_DT,
          T2.INIT_CNTRL_IND, T2.RESP_CNTRL_IND, T2.OTHER_CNTRL_IND,
          T2.JRSDT_TYPE, T2.LST_SQNC_NMB
        from TWNCOURT_ORDR T1,
             TWNDOCKET T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
          UPI            =   :UPI                             AND
          CASE_SUFX      =   :CASE-SUFX                       AND
          JRSDT_TYPE     IN ('L', 'T', 'R')                   AND
          T1.DCKT_NMB    =    T2.DCKT_NMB                     AND
          SQNC_NMB       =    LST_SQNC_NMB                    AND
          HLTH_INS_IND   =   'Y'                              AND
          ORDER_STS      =   'A'
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into DCKT-NMB, RESP-LCTN-CD, RSPDG-DCKT-NMB, OTHER-LCTN-CD, OTHER-DCKT-NMB, INIT-DCKT-NMB, INIT-LCTN-CD, ORDER-EFF-DT, INIT-CNTRL-IND, RESP-CNTRL-IND, OTHER-CNTRL-IND, JRSDT-TYPE, LST-SQNC-NMB
                for H2-2-COR-DOC;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q03-COR-DOC

// Get Qualifing Dockets

function DFM34Q03-SCAN()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-OBJ = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-NM = "DFM34Q03-SCAN";
    VDBCONTROL.UPROC-OPT = "SCAN";
    try
        get next H2-2-COR-DOC;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q03-SCAN

// NCP Accounts Receivable

function DFM34Q04-NAC()
    set H2-NCP-ACCT-RCBL empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-NCP-ACCT-RCBL";
    VDBCONTROL.UPROC-OBJ = "H2-NCP-ACCT-RCBL";
    VDBCONTROL.UPROC-NM = "DFM34Q04-NAC";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-NCP-ACCT-RCBL.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H2-NCP-ACCT-RCBL.SQNC-NMB = H2-2-COR-DOC.LST-SQNC-NMB;
    H2-NCP-ACCT-RCBL.NCP-ACCT-RCBL-YR = DFM34W.CRNT-DATE-CCYY-NUM;
    H2-NCP-ACCT-RCBL.NCP-ACCT-RCBL-MTH = DFM34W.CRNT-DATE-MM-NUM;
    try
        get H2-NCP-ACCT-RCBL singleRow
                with #sql{
        select CRSUP_CMOA
        from TWNNCP_ACCT_RCBL T1
        WHERE  T1.DCKT_NMB = :DCKT-NMB
          AND  T1.SQNC_NMB = :SQNC-NMB
          AND  T1.PRVSN_TYPE = 'CS'
          AND  T1.NCP_ACCT_RCBL_YR = :NCP-ACCT-RCBL-YR
          AND  T1.NCP_ACCT_RCBL_MTH = :NCP-ACCT-RCBL-MTH
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CRSUP-CMOA;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q04-NAC

// Get Children

function DFM34Q05-DCH-DCN()
    set H2-2-DCH-DCN empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-DCH-DCN";
    VDBCONTROL.UPROC-OBJ = "H2-2-DCH-DCN";
    VDBCONTROL.UPROC-NM = "DFM34Q05-DCH-DCN";
    VDBCONTROL.UPROC-OPT = "SETINQ";

    H2-2-DCH-DCN.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H2-2-DCH-DCN.NCP-UPI = H2-IVD-CASE.NCP-UPI;
    H2-2-DCH-DCN.CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
    try
        open DFM34Q05-DCH-DCN_RSI01
                with #sql{
        select T1.CHD_UPI, T1.FVI, T1.NON_DISCLSR_FND
        from TWNIVD_CASE_CHILD T1,
             TWNIVD_CHILD_FIN T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE     T2.DCKT_NMB = :DCKT-NMB
          AND     T2.NCP_UPI  = :NCP-UPI
          AND     T2.CASE_SUFX = :CASE-SUFX
          AND     T2.CHD_ACTIVE_IND = 'Y'
          AND     T1.NCP_UPI = T2.NCP_UPI
          AND     T1.CASE_SUFX = T2.CASE_SUFX
          AND     T1.CHD_UPI = T2.CHD_UPI
          AND     T1.CHILD_RMVD_RSN = ' '
          AND     T1.CHILD_RMVD_DT IN ('0001-01-01', '9999-12-31')
          AND     T1.PATRN_STS_CD <> 'EX'
          AND     T1.PATRN_STS_CD <> 'BN'
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CHD-UPI, FVI, NON-DISCLSR-FND for H2-2-DCH-DCN;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q05-DCH-DCN

// Get Children

function DFM34Q05-SCAN()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-DCH-DCN";
    VDBCONTROL.UPROC-OBJ = "H2-2-DCH-DCN";
    VDBCONTROL.UPROC-NM = "DFM34Q05-SCAN";
    VDBCONTROL.UPROC-OPT = "SCAN";
    try
        get next H2-2-DCH-DCN;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q05-SCAN

// Get Person Info

function DFM34Q07-PERSON()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-PERSON";
    VDBCONTROL.UPROC-OBJ = "H2-PERSON";
    VDBCONTROL.UPROC-NM = "DFM34Q07-PERSON";
    VDBCONTROL.UPROC-OPT = "INQUIRY";
    try
        get H2-PERSON singleRow
                with #sql{
        select MODFR, MID_NM, FRST_NM,
          LST_NM, SSN, DOB, SEX_CD
        from TWNPERSON T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE UPI = :UPI
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into MODFR, MID-NM, FRST-NM, LST-NM, SSN, DOB, SEX-CD;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q07-PERSON

// Check Docket

function DFM34Q08-COR-DOC()
    set H2-2-COR-DOC empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-OBJ = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-NM = "DFM34Q08-COR-DOC";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-2-COR-DOC.DCKT-NMB = DFM34W.DCKT-NMB;
    try
        get H2-2-COR-DOC singleRow
                with #sql{
        select T2.RESP_LCTN_CD, T2.RSPDG_DCKT_NMB,
          T2.OTHER_LCTN_CD, T2.OTHER_DCKT_NMB, T2.INIT_DCKT_NMB,
          T2.INIT_LCTN_CD, T1.ORDER_EFF_DT,
          T2.INIT_CNTRL_IND, T2.RESP_CNTRL_IND, T2.OTHER_CNTRL_IND,
          T2.JRSDT_TYPE, T2.LST_SQNC_NMB
        from TWNCOURT_ORDR T1,
             TWNDOCKET T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
          T2.DCKT_NMB    =   :DCKT-NMB                        AND
          JRSDT_TYPE     IN ('L', 'T', 'R')                   AND
          T1.DCKT_NMB    =    T2.DCKT_NMB                     AND
          SQNC_NMB       =    LST_SQNC_NMB                    AND
          HLTH_INS_IND   =   'Y'                              AND
          ORDER_STS      =   'A'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into RESP-LCTN-CD, RSPDG-DCKT-NMB, OTHER-LCTN-CD, OTHER-DCKT-NMB, INIT-DCKT-NMB, INIT-LCTN-CD, ORDER-EFF-DT, INIT-CNTRL-IND, RESP-CNTRL-IND, OTHER-CNTRL-IND, JRSDT-TYPE, LST-SQNC-NMB;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q08-COR-DOC

// Get Employers

function DFM34Q09-JHS()
    set H2-JOB-HISTORY empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-NM = "DFM34Q09-JHS";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-JOB-HISTORY.UPI = H2-IVD-CASE.NCP-UPI;
    try
        open DFM34Q09-JHS_RSI01
                with #sql{
        select EMPLR_ID, ADR_LN1, ADR_LN2, CITY, ST_CD, ZIP_CD
        from TWNJOB_HISTORY T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
              UPI = :UPI
          AND VRFN_STS IN ('C', 'V')
          AND HLTH_INS_IND IN ('Y', 'U', ' ')
          AND JOB_END_DT = '9999-12-31'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into EMPLR-ID, ADR-LN1, ADR-LN2, CITY, ST-CD, ZIP-CD
                for H2-JOB-HISTORY;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q09-JHS

// Get Employers

function DFM34Q09-SCAN()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-NM = "DFM34Q09-SCAN";
    VDBCONTROL.UPROC-OPT = "SCAN";
    try
        get next H2-JOB-HISTORY;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q09-SCAN

// Check NMSN info

function DFM34Q10-EWD()
    set H2-EMPLR-WWH-DTLS empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-OBJ = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-NM = "DFM34Q10-EWD";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-EMPLR-WWH-DTLS.EMPLR-ID = H2-JOB-HISTORY.EMPLR-ID;
    H2-EMPLR-WWH-DTLS.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    try
        get H2-EMPLR-WWH-DTLS singleRow
                with #sql{
        select NMSN_GEN_DT, NMSN_STATUS
        from twnemplr_wwh_dtls T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
              EMPLR_ID = :EMPLR-ID
          AND DCKT_NMB = :DCKT-NMB
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into NMSN-GEN-DT, NMSN-STATUS;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q10-EWD

// Get Employer Info

function DFM34Q11-EMP()
    set H2-EMPLOYER empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-EMPLOYER";
    VDBCONTROL.UPROC-OBJ = "H2-EMPLOYER";
    VDBCONTROL.UPROC-NM = "DFM34Q11-EMP";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-EMPLOYER.EMPLR-ID = H2-JOB-HISTORY.EMPLR-ID;
    try
        get H2-EMPLOYER singleRow
                with #sql{
        select EMPLR_NM, AGNT_NM,
          ADR_LN1, ADR_LN2, CITY, ST_CD, ZIP_CD,
          AGNT_ADR1, AGNT_ADR2, AGNT_CITY, AGNT_ST, AGNT_ZIP_CD
        from TWNEMPLOYER T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
              EMPLR_ID = :EMPLR-ID
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into EMPLR-NM, AGNT-NM, ADR-LN1, ADR-LN2, CITY, ST-CD, ZIP-CD, AGNT-ADR1, AGNT-ADR2, AGNT-CITY, AGNT-ST, AGNT-ZIP-CD;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q11-EMP

// Get County/State/Country Descr

function DFM34Q12-CDT()
    set H2-CODE-TBL empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-CODE-TBL";
    VDBCONTROL.UPROC-OBJ = "H2-CODE-TBL";
    VDBCONTROL.UPROC-NM = "DFM34Q12-CDT";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    if(H2-2-COR-DOC.INIT-CNTRL-IND == "D" || H2-2-COR-DOC.INIT-CNTRL-IND ==
                    "P")
        H2-CODE-TBL.CODE-TBL-CD = H2-2-COR-DOC.INIT-LCTN-CD;
    else
        if(H2-2-COR-DOC.RESP-CNTRL-IND == "D" || H2-2-COR-DOC.RESP-CNTRL-IND ==
                        "P")
            H2-CODE-TBL.CODE-TBL-CD = H2-2-COR-DOC.RESP-LCTN-CD;
        else
            if(H2-2-COR-DOC.OTHER-CNTRL-IND == "D" ||
                    H2-2-COR-DOC.OTHER-CNTRL-IND == "P")
                H2-CODE-TBL.CODE-TBL-CD = H2-2-COR-DOC.OTHER-LCTN-CD;
            else
                return;
            end
        end
    end
    try
        get H2-CODE-TBL singleRow
                with #sql{
        select CODE_DESC
        from twncode_tbl T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE CODE_TBL_CD = :CODE-TBL-CD
          AND CODE_TBL_TYP = 'CNTSTCTY'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CODE-DESC;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q12-CDT

// Get Custodian Info

function DFM34Q13-CTN()
    set H2-CUSTODIAN empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-CUSTODIAN";
    VDBCONTROL.UPROC-OBJ = "H2-CUSTODIAN";
    VDBCONTROL.UPROC-NM = "DFM34Q13-CTN";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-CUSTODIAN.UPI = H2-IVD-CASE.CST-UPI;
    try
        get H2-CUSTODIAN singleRow
                with #sql{
        select FVI, NON_DISCLSR_FND
        from TWNCUSTODIAN T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE UPI = :UPI
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into FVI, NON-DISCLSR-FND;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q13-CTN

// Get Other Jurisdiction

function DFM34Q14-OJR()
    set H2-OJRD-DTL empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-OJRD-DTL";
    VDBCONTROL.UPROC-OBJ = "H2-OJRD-DTL";
    VDBCONTROL.UPROC-NM = "DFM34Q14-OJR";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-OJRD-DTL.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    try
        get H2-OJRD-DTL
                with #sql{
        select CRSPG_FIPS_CD, CRSPG_FIPS_CD_SUFX
        from TWNOJRD_DTL T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE DCKT_NMB = :DCKT-NMB
         --** INSERT ORDER BY CLAUSE HERE **
        FOR FETCH ONLY
      }
                into CRSPG-FIPS-CD, CRSPG-FIPS-CD-SUFX;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q14-OJR

// Check Docket

function DFM34Q15-COR-DOC()
    set H2-2-COR-DOC empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-OBJ = "H2-2-COR-DOC";
    VDBCONTROL.UPROC-NM = "DFM34Q15-COR-DOC";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-2-COR-DOC.DCKT-NMB = DFM34W.DCKT-NMB;
    try
        get H2-2-COR-DOC singleRow
                with #sql{
        select T2.RESP_LCTN_CD, T2.RSPDG_DCKT_NMB,
          T2.OTHER_LCTN_CD, T2.OTHER_DCKT_NMB, T2.INIT_DCKT_NMB,
          T2.INIT_LCTN_CD, T1.ORDER_EFF_DT,
          T2.INIT_CNTRL_IND, T2.RESP_CNTRL_IND, T2.OTHER_CNTRL_IND,
          T2.JRSDT_TYPE, T2.LST_SQNC_NMB
        from TWNCOURT_ORDR T1,
             TWNDOCKET T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
          T2.DCKT_NMB    =   :DCKT-NMB                        AND
          T1.DCKT_NMB    =    T2.DCKT_NMB                     AND
          SQNC_NMB       =    LST_SQNC_NMB
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into RESP-LCTN-CD, RSPDG-DCKT-NMB, OTHER-LCTN-CD, OTHER-DCKT-NMB, INIT-DCKT-NMB, INIT-LCTN-CD, ORDER-EFF-DT, INIT-CNTRL-IND, RESP-CNTRL-IND, OTHER-CNTRL-IND, JRSDT-TYPE, LST-SQNC-NMB;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q15-COR-DOC

// Get policy holder UPI

function DFM34Q16-MIP()
    set H2-MED-INS-PLICY empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-MED-INS-PLICY";
    VDBCONTROL.UPROC-OBJ = "H2-MED-INS-PLICY";
    VDBCONTROL.UPROC-NM = "DFM34Q16-MIP";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-MED-INS-PLICY.PLICY-SQ-NMB = DFM34W.PLICY-SQ-NMB;
    try
        get H2-MED-INS-PLICY singleRow
                with #sql{
        select UPI
        from TWNMED_INS_PLICY T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE PLICY_SQ_NMB = :PLICY-SQ-NMB
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into UPI;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q16-MIP

// Get Worker ID

function DFM34Q17-SPT-DCC()
    set H2-2-SPT-DCC empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-SPT-DCC";
    VDBCONTROL.UPROC-OBJ = "H2-2-SPT-DCC";
    VDBCONTROL.UPROC-NM = "DFM34Q17-SPT-DCC";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-2-SPT-DCC.UPI = H2-IVD-CASE.NCP-UPI;
    H2-2-SPT-DCC.CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
    try
        get H2-2-SPT-DCC
                with #sql{
        select NOMADS_USRID, T2.OFC_CD
        from TWNSUP_UNT_POS_HST T1,
             TWNIVD_CASELD_CASE T2
        WHERE T1.OFC_CD = T2.OFC_CD
        AND   T1.PRGM_OFC_TYPE = T2.PRGM_OFC_TYPE
        AND   T1.SPRVS_UNIT = T2.SPRVS_UNIT
        AND   T1.PSN_NMB = T2.PSN_NMB
        AND   (:DFM34W1.WS-PROC-DATE  BETWEEN T1.ASMNT_BEG_DT AND
                                               T1.ASMNT_END_DT)
        AND   T2.CASELD_IND = 'N'
        AND   T2.UPI = :UPI
        AND   T2.CASE_SUFX = :CASE-SUFX
        AND   T1.OFC_CD >= ' '
        AND   T1.PRGM_OFC_TYPE >= ' '
        AND   T1.SPRVS_UNIT >= ' '
        AND   T1.PSN_NMB >= 0
         --** INSERT ORDER BY CLAUSE HERE **
        FOR FETCH ONLY
        OPTIMIZE FOR 1 ROW
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into NOMADS-USRID, OFC-CD;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q17-SPT-DCC

// Get Worker info

function DFM34Q18-NMU()
    set H2-NOMADS-USER empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-NOMADS-USER";
    VDBCONTROL.UPROC-OBJ = "H2-NOMADS-USER";
    VDBCONTROL.UPROC-NM = "DFM34Q18-NMU";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-NOMADS-USER.NOMADS-USRID = H2-2-SPT-DCC.NOMADS-USRID;
    try
        get H2-NOMADS-USER singleRow
                with #sql{
        select MODFR, MID_NM, LST_NM, FRST_NM, FAX_NMB, OFC_CD
        from TWNNOMADS_USER T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE NOMADS_USRID = :NOMADS-USRID
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into MODFR, MID-NM, LST-NM, FRST-NM, FAX-NMB, OFC-CD;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q18-NMU

// Get Employer

function DFM34Q19-JHS()
    set H2-JOB-HISTORY empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";
    VDBCONTROL.UPROC-NM = "DFM34Q19-JHS";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-JOB-HISTORY.UPI = H2-IVD-CASE.NCP-UPI;
    H2-JOB-HISTORY.EMPLR-ID = DFM34W.EMPLR-ID;
    try
        get H2-JOB-HISTORY
                with #sql{
        select ADR_LN1, ADR_LN2, CITY, ST_CD, ZIP_CD,
          VRFN_STS, HLTH_INS_IND, JOB_END_DT
        from TWNJOB_HISTORY T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE
              UPI = :UPI
          AND EMPLR_ID = :EMPLR-ID
         --** INSERT ORDER BY CLAUSE HERE **
        ORDER BY
              JOB_END_DT DESC
        FOR FETCH ONLY
      }
                into ADR-LN1, ADR-LN2, CITY, ST-CD, ZIP-CD, VRFN-STS, HLTH-INS-IND, JOB-END-DT;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q19-JHS

// Fin Obligation

function DFM34Q20-FIO()
    set H2-FINAN-OBLGN empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-FINAN-OBLGN";
    VDBCONTROL.UPROC-OBJ = "H2-FINAN-OBLGN";
    VDBCONTROL.UPROC-NM = "DFM34Q20-FIO";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-FINAN-OBLGN.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H2-FINAN-OBLGN.SQNC-NMB = H2-2-COR-DOC.LST-SQNC-NMB;
    try
        get H2-FINAN-OBLGN singleRow
                with #sql{
        select CRNT_OBLGN_STS
        from TWNFINAN_OBLGN T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE  T1.DCKT_NMB = :DCKT-NMB
          AND  T1.SQNC_NMB = :SQNC-NMB
          AND  T1.PRVSN_TYPE = 'CS'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into CRNT-OBLGN-STS;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q20-FIO

// Office Phone Number

function DFM34Q21-IRF-OFF()
    set H2-2-OFF-IRF empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-2-OFF-IRF";
    VDBCONTROL.UPROC-OBJ = "H2-2-OFF-IRF";
    VDBCONTROL.UPROC-NM = "DFM34Q21-IRF-OFF";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    H2-2-OFF-IRF.OFC-CD = H2-NOMADS-USER.OFC-CD;
    try
        get H2-2-OFF-IRF singleRow
                with #sql{
        select T2.PHN_NMB
        from twnoffice T1,
             twninterst_rfguide T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE T1.OFC_CD = :OFC-CD
          AND T2.FIPS_CD = T1.FIPS_CD
          AND T2.FIPS_CD_SUFX = T1.FIPS_CD_SUFX
          AND T2.ADR_TYPE1 = 'LOC'
          AND T2.ADR_TYPE2 = 'RES'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into PHN-NMB;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
    /*  */
end // end DFM34Q21-IRF-OFF

// Check if CST ordered

function DFM34Q22-PRV()
    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H3-PRVSN";
    VDBCONTROL.UPROC-OBJ = "H3-PRVSN";
    VDBCONTROL.UPROC-NM = "DFM34Q22-PRV";
    VDBCONTROL.UPROC-OPT = "INQUIRY";
    try
        get H3-PRVSN singleRow
                with #sql{
        select HI_ORDRD_TO_PROVD
        from TWNPRVSN T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE DCKT_NMB = :H2-2-COR-DOC.DCKT-NMB
        AND   SQNC_NMB = :H2-2-COR-DOC.LST-SQNC-NMB
        AND   PRVSN_TYPE = 'HI'
        AND   HI_ORDRD_TO_PROVD = 'CST'
         --** INSERT ORDER BY CLAUSE HERE **
      }
                into HI-ORDRD-TO-PROVD;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q22-PRV

// Selecting SSA Employer ID Code Description

function DFM34Q23-CT()
    set H2-CODE-TBL empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-CODE-TBL";
    VDBCONTROL.UPROC-OBJ = "H2-CODE-TBL";
    VDBCONTROL.UPROC-NM = "DFM34Q23-CT";
    VDBCONTROL.UPROC-OPT = "INQUIRY";

    try
        get H2-CODE-TBL
                with #sql{
        select CODE_DESC
        from TWNCODE_TBL T1
        WHERE
        	CODE_TBL_CD = 'SSAID' AND
        	CODE_TBL_TYP = 'SSAEMPID'
        FOR FETCH ONLY
      }
                into CODE-DESC;
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34Q23-CT

// Update NMSN info

function DFM34U01-EWD()
    set H2-EMPLR-WWH-DTLS empty;

    WDB00PI();
    VDBCOMMON.UAPPLNAM = "DFM34A";
    VDBCOMMON.USQLREC = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-OBJ = "H2-EMPLR-WWH-DTLS";
    VDBCONTROL.UPROC-NM = "DFM34U01-EWD";
    VDBCONTROL.UPROC-OPT = "UPDATE";

    H2-EMPLR-WWH-DTLS.EMPLR-ID = H2-JOB-HISTORY.EMPLR-ID;
    H2-EMPLR-WWH-DTLS.DCKT-NMB = H2-2-COR-DOC.DCKT-NMB;
    H2-EMPLR-WWH-DTLS.NMSN-GEN-DT = DFM34W1.WS-PROC-DATE;
    try
        execute 
                #sql{
         --** INSERT SQL STATEMENT HERE **
        UPDATE TWNEMPLR_WWH_DTLS
        SET   NMSN_GEN_DT = :NMSN-GEN-DT,
              NMSN_STATUS = 'I'
        WHERE EMPLR_ID = :EMPLR-ID
          AND DCKT_NMB = :DCKT-NMB
      }
                for H2-EMPLR-WWH-DTLS; // model = none
    end

    WDB00PE-SQLERR();
    if(VDBCONTROL.URC > 104)
        exit program;
    end
end // end DFM34U01-EWD

record DFM34W1 type basicRecord
    10 WS-PROC-DATE char(10);
        15 WS-PROC-DATE-CCYY char(4);
        15 * char(1);
        15 WS-PROC-DATE-MM char(2);
        15 * char(1);
        15 WS-PROC-DATE-DD char(2);
    10 FEIN char(10);
        15 * char(2);
        15 FEIN-I char(1);
        15 * char(7);
    10 WS-TEXT-37 char(37);
    10 WS-TEXT-40 char(40);
    10 HW-YRMTH char(6);
        15 HW-YR char(4);
        15 HW-MTH char(2);
end // end DFM34W1

record DFM34W2 type basicRecord
    10 INS-PLCY-IND char(1);
    10 CHD-INDX smallInt;
    10 CHILD-INFO char(53)[10];
        15 NAME char(31);
        15 SSN char(11);
        15 DOB char(10);
        15 SEX char(1);
    10 FVI char(1);
    10 NON-DISCLSR-FND char(1);
    10 CMOA-IND char(1);
end // end DFM34W2

record DFM34W3 type basicRecord
    10 PARM-INDEX smallInt;
    10 SIB-PARM char(60)[83];
    10 NCP-NAME char(60);
    10 NCP-SSN char(9); // NCP-SSN
    10 CST-NAME char(60);
    10 CST-SSN char(9);
    10 FIPS char(7);
        15 FIPS-CD char(5); // FIPS_CD
        15 FIPS-SUFX char(2);
end // end DFM34W3

