package IVA_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=AIF27A ****
// COMPONENT NAME: AIF27A
// 
// DESCRIPTION: Reads file created by AIF26A to create alerts
//              and clogs for all IV-A cases with UNIN and LSUM
//              data.
// LOGIC: 1) Get all the member UPI's (CST and kids) for a
//           given block from the file.
//        2) Allocate the $'s from the file to the active kids
//           for the month.
//        3) If the kid is not active in any IVA case, Allocate
//           that $'s to the CST
//        4) Generate clog's and alerts in all the cases where
//           there people are active mmebers. The clog's and
//           alerts will be same on all cases.
// ***********************
Program AIF27A type basicProgram //VAGen Info - main batch program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  AIF27W AIF27W; // record
  AIF27W1 AIF27W1; // record
  AIF27W2 AIF27W2; // record
  AIF27W3 AIF27W3; // record
  BDATEREC BDATEREC; // record
  CEP01W CEP01W; // record
  GDS GDS; // record
  GDW GDW; // record
  P-DATE-REC1 P-DATE-REC1; // record
  H2-2-CMH-PER H2-2-CMH-PER; // record
  H2-CASE-LOG H2-CASE-LOG; // record
  H2-CASE-MEMBER-HST H2-CASE-MEMBER-HST; // record
  H2-FAM-CASELD-CASE H2-FAM-CASELD-CASE; // record
  H2-IVA-FACT-ALERT H2-IVA-FACT-ALERT; // record
  SR-AIF27-RECIN SR-AIF27-RECIN; // record
  VDBCOMMON VDBCOMMON; // record
  VDBCONTROL VDBCONTROL; // record
  VMESSAGE VMESSAGE; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    AIF27P1-MAIN: AIF27P1-MAIN();
  end // end main
end // end AIF27A


// MAIN
Function AIF27P1-MAIN()
  /* **/

  /* Initialize records.*/
  set AIF27W empty;
  set AIF27W1 empty;
  set AIF27W2 empty;
  set AIF27W3 empty;
  set SR-AIF27-RECIN empty;

  /* Read date*/
  WCM00P3-FETCHBDTS();

  /* populate the ws-process date with dates from the BDATEPARM file*/
  AIF27W.WS-PROCESS-DT-CC = BDATEREC.BDATE-PROCESS-DATE-CC;
  AIF27W.WS-PROCESS-DT-YY = BDATEREC.BDATE-PROCESS-DATE-YY;
  AIF27W.WS-PROCESS-DT-MM = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIF27W.WS-PROCESS-DT-DD = "01";
  AIF27W.WS-PROCESS-DT-F1 = "-";
  AIF27W.WS-PROCESS-DT-F2 = "-";
  
  /* WI 1735 move current date to working storage*/
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  AIF27W.WS-CURRENT-DATE = GDW.DTCD;

  /* Read SYSTEM FLAG*/
  AIF27P9-S-SYS-L();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (VDBCONTROL.URC == 0)
    AIF27W.WS-SYSTEM-FLAG = GDS.SYSTEM-FLAG;
  end

  /* Perform Pocedure para*/
  AIF27P9-PROC-PARA();

  /* **/
end // end AIF27P1-MAIN


// LUW for DB Access
Function AIF27P9-ADD-AFA-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set H2-IVA-FACT-ALERT empty;

  /* Perform process to retrieve data*/
  AIF27P9-ADD-AFA-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-ADD-AFA-L


// Set Control Retrieve of Data
Function AIF27P9-ADD-AFA-P()
  /* **/

  H2-IVA-FACT-ALERT.ICI = H2-FAM-CASELD-CASE.ICI;
  H2-IVA-FACT-ALERT.OFC-CD = H2-FAM-CASELD-CASE.OFC-CD;
  H2-IVA-FACT-ALERT.CASLD-ID = H2-FAM-CASELD-CASE.CASLD-ID;

  AIF27W2.WS-ALERT-TXT-C = "CHECK CSE INCOME TYPE:";
  AIF27W2.WS-ALERT-TXT-V = AIF27W3.WS-ACTVY-DESC1-V2;
  AIF27W2.WS-ALERT-TXT-F = " ";

  H2-IVA-FACT-ALERT.FACT-ALERT-TXT = AIF27W2.WS-ALERT-TXT;
  /*H2-IVA-FACT-ALERT.DLT-ALERT-DT = "9999-12-31"; */
  /* WI 1735-Delete overdue alerts --  */
  /* Set FACT-ALERT DLT-ALERT-DT so alerts will auto delete after 24 months */
  P-DATE-REC1.C-INPUT-DATE = AIF27W.WS-CURRENT-DATE;
  P-DATE-REC1.N-ADD-DAYS = 731;
  call "DATEA1A" (VDBCONTROL, VMESSAGE, P-DATE-REC1);
    H2-IVA-FACT-ALERT.DLT-ALERT-DT = P-DATE-REC1.C-OUTPUT-DATE;
 /* end WI 1735 */

  if (AIF27W.WS-SYSTEM-FLAG == "P")
    AIF27P9-ADD-AFA-Q1();
  else
    AIF27P9-ADD-AFA-Q2();
  end
  /* **/
end // end AIF27P9-ADD-AFA-P


// ADD H2-IVA-FACT-ALERT
Function AIF27P9-ADD-AFA-Q1()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-IVA-FACT-ALERT";
  VDBCONTROL.UPROC-OBJ = "H2-IVA-FACT-ALERT";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-AFA-Q1";

  /*  */
  try
    add H2-IVA-FACT-ALERT
      with #sql{
        insert into TWNIVA_FACT_ALERT
        (ICI, ALERT_TS, DLT_ALERT_DT, DISPL_DT, DUE_DT,
          CASLD_ID, FACT_ALERT_TXT, OFC_CD)
        values (:ICI, CURRENT TIMESTAMP, :DLT-ALERT-DT, CURRENT DATE, CURRENT DATE,
          :CASLD-ID, :FACT-ALERT-TXT, :OFC-CD)
      } ;
  end

  /* **/
end // end AIF27P9-ADD-AFA-Q1


// ADD H2-IVA-FACT-ALERT
Function AIF27P9-ADD-AFA-Q2()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-IVA-FACT-ALERT";
  VDBCONTROL.UPROC-OBJ = "H2-IVA-FACT-ALERT";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-AFA-Q2";

  /* Call DATEAPP*/
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};

  /*  */
  try
    add H2-IVA-FACT-ALERT
      with #sql{
        insert into TWNIVA_FACT_ALERT
        (ICI, ALERT_TS, DLT_ALERT_DT, DISPL_DT, DUE_DT,
          CASLD_ID, FACT_ALERT_TXT, OFC_CD)
        values (:ICI, :GDW.TS, :DLT-ALERT-DT, :GDW.DTCD, :GDW.DTCD,
          :CASLD-ID, :FACT-ALERT-TXT, :OFC-CD)
      } ;
  end

  /* **/
end // end AIF27P9-ADD-AFA-Q2


// LUW for DB Access
Function AIF27P9-ADD-CSL-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set H2-CASE-LOG empty;

  /* Perform process to retrieve data*/
  AIF27P9-ADD-CSL-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-ADD-CSL-L


// Set Control Retrieve of Data
Function AIF27P9-ADD-CSL-P()
  /* **/

  H2-CASE-LOG.ICI = AIF27W3.WS-ICI;
  H2-CASE-LOG.PRGM-CASE-TYPE = AIF27W3.WS-PRGM-CASE-TYPE;
  H2-CASE-LOG.WRKR-ID = AIF27W3.WS-WRKR-ID;
  H2-CASE-LOG.LOG-ENTRY-DESC = AIF27W3.WS-LOG-ENTRY-DESC;
  H2-CASE-LOG.LOG-ENTRY-TYPE = AIF27W3.WS-LOG-ENTRY-TYPE;
  H2-CASE-LOG.CL-ACTVY-DESC = AIF27W3.WS-CL-ACTVY-DESC;

  if (AIF27W.WS-SYSTEM-FLAG == "P")
    AIF27P9-ADD-CSL-Q1();
  else
    AIF27P9-ADD-CSL-Q2();
  end

  /* **/
end // end AIF27P9-ADD-CSL-P


// ADD H2-CASE-LOG
Function AIF27P9-ADD-CSL-Q1()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-LOG";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-LOG";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-CMH-Q1";

  /*  */
  try
    add H2-CASE-LOG
      with #sql{
        insert into TWNCASE_LOG
        (ICI, ACTVY_DT, LOG_CRN_TS, PRGM_CASE_TYPE,
          ACTVY_TM, WRKR_ID, LOG_ENTRY_DESC,
          LOG_ENTRY_TYPE, CL_ACTVY_DESC)
        values (:ICI, CURRENT DATE, CURRENT TIMESTAMP, :PRGM-CASE-TYPE,
          CURRENT TIME, :WRKR-ID, :LOG-ENTRY-DESC,
          :LOG-ENTRY-TYPE, :CL-ACTVY-DESC)
      } ;
  end

  /* **/
end // end AIF27P9-ADD-CSL-Q1


// ADD H2-CASE-LOG
Function AIF27P9-ADD-CSL-Q2()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-LOG";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-LOG";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-CMH-Q2";

  /* Call DATEAPP*/
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};

  /*  */
  try
    add H2-CASE-LOG
      with #sql{
        insert into TWNCASE_LOG
        (ICI, ACTVY_DT, LOG_CRN_TS, PRGM_CASE_TYPE,
          ACTVY_TM, WRKR_ID, LOG_ENTRY_DESC,
          LOG_ENTRY_TYPE, CL_ACTVY_DESC)
        values (:ICI, :GDW.DTCD, :GDW.TS, :PRGM-CASE-TYPE,
          CURRENT TIME, :WRKR-ID, :LOG-ENTRY-DESC,
          :LOG-ENTRY-TYPE, :CL-ACTVY-DESC)
      } ;
  end

  /* **/
end // end AIF27P9-ADD-CSL-Q2


// MAIN
Function AIF27P9-CLOG-ALRT()
  /* **/

  /* Perform the process to get distict ICI's to generate CLOG and ALRT*/
  AIF27P9-INQ-CMH-L();

  AIF27W.WS-SINQ-H2-SQCOD = VDBCONTROL.URC;

  if (AIF27W.WS-SINQ-H2-SQCOD > 104)
    WCM00P2-TO-CEP01A();
  end

  if (AIF27W.WS-SINQ-H2-SQCOD == 0)

    AIF27P9-INQ-CMH-QS();

    VDBCOMMON.UNRF = "Y";
    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    AIF27W.WS-SCAN-H2-SQCOD = VDBCONTROL.URC;

    if (AIF27W.WS-SCAN-H2-SQCOD > 104)
      WCM00P2-TO-CEP01A();
    end

    while (AIF27W.WS-SCAN-H2-SQCOD == 0)

      /* Generate CLOG*/
      AIF27P9-GEN-CLOG();

      /* Generate Alert*/
      AIF27P9-GEN-ALRT();

      /* Scan*/
      AIF27P9-INQ-CMH-QS();

      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";

      WDB00PE-SQLERR();

      AIF27W.WS-SCAN-H2-SQCOD = VDBCONTROL.URC;

      if (AIF27W.WS-SCAN-H2-SQCOD > 104)
        WCM00P2-TO-CEP01A();
      end

      if (AIF27W.WS-SCAN-H2-SQCOD == 100)
        AIF27W.WS-SINQ-H2-SQCOD = 100;
      end

    end

  end

  /* **/
end // end AIF27P9-CLOG-ALRT


// MAIN
Function AIF27P9-CLR-TEXT()
  /* **/

  /* Clear the unused lines*/
  if (AIF27W.WS-COUNT == 12)
  else
    if (AIF27W.WS-COUNT == 11)
      AIF27W3.WS-ACTVY-DESC12 = " ";
    else
      if (AIF27W.WS-COUNT == 10)
        AIF27W3.WS-ACTVY-DESC11 = " ";
        AIF27W3.WS-ACTVY-DESC12 = " ";
      else
        if (AIF27W.WS-COUNT == 9)
          AIF27W3.WS-ACTVY-DESC10 = " ";
          AIF27W3.WS-ACTVY-DESC11 = " ";
          AIF27W3.WS-ACTVY-DESC12 = " ";
        else
          if (AIF27W.WS-COUNT == 8)
            AIF27W3.WS-ACTVY-DESC9 = " ";
            AIF27W3.WS-ACTVY-DESC10 = " ";
            AIF27W3.WS-ACTVY-DESC11 = " ";
            AIF27W3.WS-ACTVY-DESC12 = " ";
          else
            if (AIF27W.WS-COUNT == 7)
              AIF27W3.WS-ACTVY-DESC8 = " ";
              AIF27W3.WS-ACTVY-DESC9 = " ";
              AIF27W3.WS-ACTVY-DESC10 = " ";
              AIF27W3.WS-ACTVY-DESC11 = " ";
              AIF27W3.WS-ACTVY-DESC12 = " ";
            else
              if (AIF27W.WS-COUNT == 6)
                AIF27W3.WS-ACTVY-DESC7 = " ";
                AIF27W3.WS-ACTVY-DESC8 = " ";
                AIF27W3.WS-ACTVY-DESC9 = " ";
                AIF27W3.WS-ACTVY-DESC10 = " ";
                AIF27W3.WS-ACTVY-DESC11 = " ";
                AIF27W3.WS-ACTVY-DESC12 = " ";
              else

                if (AIF27W.WS-COUNT == 5)
                  AIF27W3.WS-ACTVY-DESC6 = " ";
                  AIF27W3.WS-ACTVY-DESC7 = " ";
                  AIF27W3.WS-ACTVY-DESC8 = " ";
                  AIF27W3.WS-ACTVY-DESC9 = " ";
                  AIF27W3.WS-ACTVY-DESC10 = " ";
                  AIF27W3.WS-ACTVY-DESC11 = " ";
                  AIF27W3.WS-ACTVY-DESC12 = " ";
                else
                  if (AIF27W.WS-COUNT == 4)
                    AIF27W3.WS-ACTVY-DESC5 = " ";
                    AIF27W3.WS-ACTVY-DESC6 = " ";
                    AIF27W3.WS-ACTVY-DESC7 = " ";
                    AIF27W3.WS-ACTVY-DESC8 = " ";
                    AIF27W3.WS-ACTVY-DESC9 = " ";
                    AIF27W3.WS-ACTVY-DESC10 = " ";
                    AIF27W3.WS-ACTVY-DESC11 = " ";
                    AIF27W3.WS-ACTVY-DESC12 = " ";
                  else

                    if (AIF27W.WS-COUNT == 3)
                      AIF27W3.WS-ACTVY-DESC4 = " ";
                      AIF27W3.WS-ACTVY-DESC5 = " ";
                      AIF27W3.WS-ACTVY-DESC6 = " ";
                      AIF27W3.WS-ACTVY-DESC7 = " ";
                      AIF27W3.WS-ACTVY-DESC8 = " ";
                      AIF27W3.WS-ACTVY-DESC9 = " ";
                      AIF27W3.WS-ACTVY-DESC10 = " ";
                      AIF27W3.WS-ACTVY-DESC11 = " ";
                      AIF27W3.WS-ACTVY-DESC12 = " ";
                    else
                      if (AIF27W.WS-COUNT == 2)
                        AIF27W3.WS-ACTVY-DESC3 = " ";
                        AIF27W3.WS-ACTVY-DESC4 = " ";
                        AIF27W3.WS-ACTVY-DESC5 = " ";
                        AIF27W3.WS-ACTVY-DESC6 = " ";
                        AIF27W3.WS-ACTVY-DESC7 = " ";
                        AIF27W3.WS-ACTVY-DESC8 = " ";
                        AIF27W3.WS-ACTVY-DESC9 = " ";
                        AIF27W3.WS-ACTVY-DESC10 = " ";
                        AIF27W3.WS-ACTVY-DESC11 = " ";
                        AIF27W3.WS-ACTVY-DESC12 = " ";

                      end
                    end
                  end
                end

              end
            end
          end
        end
      end
    end
  end

  /* **/
end // end AIF27P9-CLR-TEXT


// MAIN
Function AIF27P9-GEN-ALRT()
  /* **/

  /* Get caseload of the case to generate IVA FACT alert*/
  AIF27P9-SEL-FAC-L();

  AIF27W.WS-FAC-SEL-SQCOD = VDBCONTROL.URC;

  if (AIF27W.WS-FAC-SEL-SQCOD > 104)
    WCM00P2-TO-CEP01A();
  end

  if (AIF27W.WS-FAC-SEL-SQCOD == 0)

    /* Generate IVA FACT alert*/
    AIF27P9-ADD-AFA-L();

    AIF27W.WS-AFA-ADD-SQCOD = VDBCONTROL.URC;

    if (AIF27W.WS-AFA-ADD-SQCOD > 104)
      WCM00P2-TO-CEP01A();
    end

  end

  /* **/
end // end AIF27P9-GEN-ALRT


// MAIN
Function AIF27P9-GEN-CLOG()
  /* **/

  AIF27W3.WS-ICI = H2-CASE-MEMBER-HST.ICI;
  AIF27W3.WS-PRGM-CASE-TYPE = " ";
  AIF27W3.WS-WRKR-ID = "AIF27A";
  AIF27W3.WS-LOG-ENTRY-DESC = "CHECK CSE INCOME";
  AIF27W3.WS-LOG-ENTRY-TYPE = "S";

  /* Logic to populate $ for to 2 consicutive record TYP:1*/
  if (AIF27W.WS-COUNT > 2)

    /* Line 2 data*/
    AIF27W3.WS-ACTVY-DESC2-V1 = AIF27W3.WS-ACTVY-DESC1-V1;
    AIF27W3.WS-ACTVY-DESC2-V2 = AIF27W3.WS-ACTVY-DESC1-V2;

    AIF27W.WS-CST-D-AMT-D = AIF27W.WS-CST-AMT-D;
    AIF27W.WS-CST-D-AMT-F = ".";
    AIF27W.WS-CST-D-AMT-C = AIF27W.WS-CST-AMT-C;
    AIF27W3.WS-ACTVY-DESC2-V3 = AIF27W.WS-CST-D-AMT;

    /* Line 12 data*/
    AIF27W3.WS-ACTVY-DESC12-V1 = AIF27W3.WS-ACTVY-DESC1-V2;

    AIF27W.WS-CST-D-AMT-D = AIF27W.WS-CST-DD-AMT-D;
    AIF27W.WS-CST-D-AMT-F = ".";
    AIF27W.WS-CST-D-AMT-C = AIF27W.WS-CST-DD-AMT-C;
    AIF27W3.WS-ACTVY-DESC12-V2 = AIF27W.WS-CST-D-AMT;
  else
    /* Line 2 data*/
    AIF27W3.WS-ACTVY-DESC2-V1 = AIF27W3.WS-ACTVY-DESC1-V1;
    AIF27W3.WS-ACTVY-DESC2-V2 = AIF27W3.WS-ACTVY-DESC1-V2;
    AIF27W3.WS-ACTVY-DESC2-V3 = AIF27W3.WS-ACTVY-DESC1-V3;
  end

  /* Clear unused WS text record*/
  AIF27P9-CLR-TEXT();

  /* Add CLOG*/
  AIF27P9-ADD-CSL-L();

  AIF27W.WS-CSL-ADD-SQCOD = VDBCONTROL.URC;

  if (AIF27W.WS-CSL-ADD-SQCOD > 104)
    WCM00P2-TO-CEP01A();
  end

  /* **/
end // end AIF27P9-GEN-CLOG


// MAIN
Function AIF27P9-GEN-TEXT()
  /* **/

  set AIF27W3 empty;

  /* Line 1*/
  AIF27W3.WS-ACTVY-DESC1-C1 = "AMT RCVD BY CST";
  AIF27W3.WS-ACTVY-DESC1-F1 = " ";
  AIF27W3.WS-ACTVY-DESC1-V1 = " ";
  AIF27W3.WS-ACTVY-DESC1-F2 = " ";
  AIF27W3.WS-ACTVY-DESC1-C2 = "FROM IV-D TP:";
  AIF27W3.WS-ACTVY-DESC1-V2 = " ";
  AIF27W3.WS-ACTVY-DESC1-F3 = " ";
  AIF27W3.WS-ACTVY-DESC1-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC1-V3 = " ";
  AIF27W3.WS-ACTVY-DESC1-F4 = " ";

  /* Line 2*/
  AIF27W3.WS-ACTVY-DESC2-C1 = "AMT ALLOCATED TO CST";
  AIF27W3.WS-ACTVY-DESC2-F1 = " ";
  AIF27W3.WS-ACTVY-DESC2-V1 = " ";
  AIF27W3.WS-ACTVY-DESC2-F2 = " ";
  AIF27W3.WS-ACTVY-DESC2-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC2-V2 = " ";
  AIF27W3.WS-ACTVY-DESC2-F3 = " ";
  AIF27W3.WS-ACTVY-DESC2-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC2-V3 = " ";
  AIF27W3.WS-ACTVY-DESC2-F4 = " ";

  /* Line 3*/
  AIF27W3.WS-ACTVY-DESC3-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC3-F1 = " ";
  AIF27W3.WS-ACTVY-DESC3-V1 = " ";
  AIF27W3.WS-ACTVY-DESC3-F2 = " ";
  AIF27W3.WS-ACTVY-DESC3-V2 = " ";
  AIF27W3.WS-ACTVY-DESC3-F3 = " ";
  AIF27W3.WS-ACTVY-DESC3-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC3-V3 = " ";
  AIF27W3.WS-ACTVY-DESC3-F4 = " ";
  AIF27W3.WS-ACTVY-DESC3-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC3-V4 = " ";

  /* Line 4*/
  AIF27W3.WS-ACTVY-DESC4-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC4-F1 = " ";
  AIF27W3.WS-ACTVY-DESC4-V1 = " ";
  AIF27W3.WS-ACTVY-DESC4-F2 = " ";
  AIF27W3.WS-ACTVY-DESC4-V2 = " ";
  AIF27W3.WS-ACTVY-DESC4-F3 = " ";
  AIF27W3.WS-ACTVY-DESC4-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC4-V3 = " ";
  AIF27W3.WS-ACTVY-DESC4-F4 = " ";
  AIF27W3.WS-ACTVY-DESC4-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC4-V4 = " ";

  /* Line 5*/
  AIF27W3.WS-ACTVY-DESC5-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC5-F1 = " ";
  AIF27W3.WS-ACTVY-DESC5-V1 = " ";
  AIF27W3.WS-ACTVY-DESC5-F2 = " ";
  AIF27W3.WS-ACTVY-DESC5-V2 = " ";
  AIF27W3.WS-ACTVY-DESC5-F3 = " ";
  AIF27W3.WS-ACTVY-DESC5-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC5-V3 = " ";
  AIF27W3.WS-ACTVY-DESC5-F4 = " ";
  AIF27W3.WS-ACTVY-DESC5-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC5-V4 = " ";

  /* Line 6*/
  AIF27W3.WS-ACTVY-DESC6-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC6-F1 = " ";
  AIF27W3.WS-ACTVY-DESC6-V1 = " ";
  AIF27W3.WS-ACTVY-DESC6-F2 = " ";
  AIF27W3.WS-ACTVY-DESC6-V2 = " ";
  AIF27W3.WS-ACTVY-DESC6-F3 = " ";
  AIF27W3.WS-ACTVY-DESC6-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC6-V3 = " ";
  AIF27W3.WS-ACTVY-DESC6-F4 = " ";
  AIF27W3.WS-ACTVY-DESC6-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC6-V4 = " ";

  /* Line 7*/
  AIF27W3.WS-ACTVY-DESC7-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC7-F1 = " ";
  AIF27W3.WS-ACTVY-DESC7-V1 = " ";
  AIF27W3.WS-ACTVY-DESC7-F2 = " ";
  AIF27W3.WS-ACTVY-DESC7-V2 = " ";
  AIF27W3.WS-ACTVY-DESC7-F3 = " ";
  AIF27W3.WS-ACTVY-DESC7-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC7-V3 = " ";
  AIF27W3.WS-ACTVY-DESC7-F4 = " ";
  AIF27W3.WS-ACTVY-DESC7-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC7-V4 = " ";

  /* Line 8*/
  AIF27W3.WS-ACTVY-DESC8-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC8-F1 = " ";
  AIF27W3.WS-ACTVY-DESC8-V1 = " ";
  AIF27W3.WS-ACTVY-DESC8-F2 = " ";
  AIF27W3.WS-ACTVY-DESC8-V2 = " ";
  AIF27W3.WS-ACTVY-DESC8-F3 = " ";
  AIF27W3.WS-ACTVY-DESC8-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC8-V3 = " ";
  AIF27W3.WS-ACTVY-DESC8-F4 = " ";
  AIF27W3.WS-ACTVY-DESC8-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC8-V4 = " ";

  /* Line 9*/
  AIF27W3.WS-ACTVY-DESC9-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC9-F1 = " ";
  AIF27W3.WS-ACTVY-DESC9-V1 = " ";
  AIF27W3.WS-ACTVY-DESC9-F2 = " ";
  AIF27W3.WS-ACTVY-DESC9-V2 = " ";
  AIF27W3.WS-ACTVY-DESC9-F3 = " ";
  AIF27W3.WS-ACTVY-DESC9-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC9-V3 = " ";
  AIF27W3.WS-ACTVY-DESC9-F4 = " ";
  AIF27W3.WS-ACTVY-DESC9-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC9-V4 = " ";

  /* Line 10*/
  AIF27W3.WS-ACTVY-DESC10-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC10-F1 = " ";
  AIF27W3.WS-ACTVY-DESC10-V1 = " ";
  AIF27W3.WS-ACTVY-DESC10-F2 = " ";
  AIF27W3.WS-ACTVY-DESC10-V2 = " ";
  AIF27W3.WS-ACTVY-DESC10-F3 = " ";
  AIF27W3.WS-ACTVY-DESC10-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC10-V3 = " ";
  AIF27W3.WS-ACTVY-DESC10-F4 = " ";
  AIF27W3.WS-ACTVY-DESC10-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC10-V4 = " ";

  /* Line 11*/
  AIF27W3.WS-ACTVY-DESC11-C1 = "AMT ALLOCATED TO CHILD";
  AIF27W3.WS-ACTVY-DESC11-F1 = " ";
  AIF27W3.WS-ACTVY-DESC11-V1 = " ";
  AIF27W3.WS-ACTVY-DESC11-F2 = " ";
  AIF27W3.WS-ACTVY-DESC11-V2 = " ";
  AIF27W3.WS-ACTVY-DESC11-F3 = " ";
  AIF27W3.WS-ACTVY-DESC11-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC11-V3 = " ";
  AIF27W3.WS-ACTVY-DESC11-F4 = " ";
  AIF27W3.WS-ACTVY-DESC11-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC11-V4 = " ";

  /* Line 12*/
  AIF27W3.WS-ACTVY-DESC12-C1 = "AMT ALLOCATED TO CST FOR ADD PARTICIPANTS";
  AIF27W3.WS-ACTVY-DESC12-F1 = " ";
  AIF27W3.WS-ACTVY-DESC12-C2 = "TP:";
  AIF27W3.WS-ACTVY-DESC12-V1 = " ";
  AIF27W3.WS-ACTVY-DESC12-F2 = " ";
  AIF27W3.WS-ACTVY-DESC12-C3 = "$:";
  AIF27W3.WS-ACTVY-DESC12-V2 = " ";

  /* **/
end // end AIF27P9-GEN-TEXT


// Scan SR-AIF27-RECIN
Function AIF27P9-GET-IP-REC()
  /* **/

  /* Scan in put record to get the range of the years for data*/
  /* to process*/

  VGVar.handleHardIOErrors = 1;

  /*  */
  try
    get next SR-AIF27-RECIN ;
  end

  /*  */
  if (SR-AIF27-RECIN is ioError && SR-AIF27-RECIN not endOfFile)

    VDBCONTROL.UPROC-NM = "AIF27P9-GET-IP-REC";
    VDBCONTROL.UPROC-OBJ = "SR-AIF27-RECIN";
    VDBCONTROL.UPROC-OPT = "SCAN";
    VMESSAGE.UMSGINS[2] = "AIF27A";

    /* THE FOLLOWING CONDITIONS ARE ADDED TO MOVE THE CORRESPONDING*/
    /* ERROR MESSAGES*/
    if (SR-AIF27-RECIN is fileNotAvailable)
      VDBCONTROL.UEZESQRRM = "FILE IS NOT AVAILABLE";
    else
      if (SR-AIF27-RECIN is fileNotFound)
        VDBCONTROL.UEZESQRRM = "FILE NOT FOUND";
      else
        if (SR-AIF27-RECIN is invalidFormat)
          VDBCONTROL.UEZESQRRM = "FILE FORMAT MISMATCH";
        end /* END CHECK FOR FORMAT MISMATCH*/
      end /* END CHECK FOR FILE NOT FOUND*/
    end /* END CHECK FOR FILE NOT AVAILABLE*/

    WCM00P2-TO-CEP01A();

  end /* END CHECK FOR RECORD FOUND*/

  /* **/
end // end AIF27P9-GET-IP-REC


// LUW for DB Access
Function AIF27P9-INQ-CMH-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set H2-CASE-MEMBER-HST empty;

  /* Perform process to retrieve data*/
  AIF27P9-INQ-CMH-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-INQ-CMH-L


// Set Control Retrieve of Data
Function AIF27P9-INQ-CMH-P()
  /* **/

  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIF27W.WS-PROCESS-DT;
  H2-CASE-MEMBER-HST.PRD-END-DT = AIF27W.WS-PROCESS-DT;

  AIF27P9-INQ-CMH-Q();

  /* **/
end // end AIF27P9-INQ-CMH-P


// READ ON H2-CASE-MEMBER-HST
Function AIF27P9-INQ-CMH-Q()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OPT = "SETINQ";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-CMH-Q";

  /*  */
  try
    open AIF27P9-INQ-CMH-Q_RSI01
      with #sql{
        select DISTINCT(ICI)
        from TWNCASE_MEMBER_HST T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE UPI       IN(:WS-CST-UPI,
                              :WS-CHD-UPI1,
                              :WS-CHD-UPI2,
                              :WS-CHD-UPI3,
                              :WS-CHD-UPI4,
                              :WS-CHD-UPI5,
                              :WS-CHD-UPI6,
                              :WS-CHD-UPI7,
                              :WS-CHD-UPI8,
                              :WS-CHD-UPI9)
        AND PRD_BEG_DT  <= :PRD-BEG-DT
        AND PRD_END_DT  >= :PRD-END-DT
        AND MAINT_CD    <> 'D'
        AND ((HH_LEFT_DT     >= :PRD-BEG-DT)
          OR (HH_LEFT_DT     <= :PRD-END-DT AND
              HH_LEFT_RSN_CD IN ('M', 'O', 'V', 'E')))
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into ICI
      for H2-CASE-MEMBER-HST ;
  end

  /* **/
end // end AIF27P9-INQ-CMH-Q


// SCAN ON H2-CASE-MEMBER-HST
Function AIF27P9-INQ-CMH-QS()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-MEMBER-HST";
  VDBCONTROL.UPROC-OPT = "SCAN";
  VDBCONTROL.UPROC-NM = "AIF27P9-INQ-CMH-QS";

  /*  */
  try
    get next H2-CASE-MEMBER-HST ;
  end

  /* **/
end // end AIF27P9-INQ-CMH-QS


// Process with logic
Function AIF27P9-PROC-DATA()
  /* **/

  /* Check member exist in CMH*/
  AIF27P9-S-CMHPER-L();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (AIF27W.WS-RECIN-REC-TYP == "1")

    /* Initialise*/
    set AIF27W1 empty;

    /* Initialise CST $ for kids not being a FAME case member*/
    AIF27W.WS-CST-AMT = 000000000;

    /* Initialise CST $ for case with more than 9 kids*/
    AIF27W.WS-CST-DD-AMT = 000000000;

    /* Initialise line count*/
    AIF27W.WS-COUNT = 2;

    if (VDBCONTROL.URC == 0)
      AIF27W.WS-SSN = " ";
      AIF27W.WS-D-SSN = " ";
      AIF27W.WS-D-SSN-F1 = "-";
      AIF27W.WS-D-SSN-F2 = "-";
      AIF27W.WS-SSN = H2-2-CMH-PER.SSN;

      AIF27W.WS-D-SSN-3 = AIF27W.WS-SSN-3;
      AIF27W.WS-D-SSN-2 = AIF27W.WS-SSN-2;
      AIF27W.WS-D-SSN-4 = AIF27W.WS-SSN-4;

      AIF27W1.WS-CST-UPI = AIF27W.WS-RECIN-UPI-N;

      AIF27W3.WS-ACTVY-DESC1-V1 = AIF27W.WS-D-SSN;
      AIF27W3.WS-ACTVY-DESC1-V2 = AIF27W.WS-RECIN-INC-TYP;

      AIF27W.WS-CST-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
      AIF27W.WS-CST-D-AMT-F = ".";
      AIF27W.WS-CST-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
      AIF27W3.WS-ACTVY-DESC1-V3 = AIF27W.WS-CST-D-AMT;
    end
  else
    if (AIF27W.WS-RECIN-REC-TYP == "2")

      if (VDBCONTROL.URC == 0)

        /* INITIALISE CHILD $*/
        AIF27W.WS-CHD-D-AMT = 000000000;

        /* Incriment line count*/
        AIF27W.WS-COUNT = AIF27W.WS-COUNT + 1;

        AIF27W.WS-SSN = " ";
        AIF27W.WS-D-SSN = " ";
        AIF27W.WS-D-SSN-F1 = "-";
        AIF27W.WS-D-SSN-F2 = "-";
        AIF27W.WS-SSN = H2-2-CMH-PER.SSN;
        AIF27W.WS-FRST-NM = H2-2-CMH-PER.FRST-NM;

        AIF27W.WS-D-SSN-3 = AIF27W.WS-SSN-3;
        AIF27W.WS-D-SSN-2 = AIF27W.WS-SSN-2;
        AIF27W.WS-D-SSN-4 = AIF27W.WS-SSN-4;

        if (AIF27W.WS-COUNT == 3)
          AIF27W1.WS-CHD-UPI1 = AIF27W.WS-RECIN-UPI-N;
          AIF27W3.WS-ACTVY-DESC3-V1 = AIF27W.WS-FRST-NM;
          AIF27W3.WS-ACTVY-DESC3-V2 = AIF27W.WS-D-SSN;
          AIF27W3.WS-ACTVY-DESC3-V3 = AIF27W.WS-RECIN-INC-TYP;

          AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
          AIF27W.WS-CHD-D-AMT-F = ".";
          AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
          AIF27W3.WS-ACTVY-DESC3-V4 = AIF27W.WS-CHD-D-AMT;
        else
          if (AIF27W.WS-COUNT == 4)
            AIF27W1.WS-CHD-UPI2 = AIF27W.WS-RECIN-UPI-N;
            AIF27W3.WS-ACTVY-DESC4-V1 = AIF27W.WS-FRST-NM;
            AIF27W3.WS-ACTVY-DESC4-V2 = AIF27W.WS-D-SSN;
            AIF27W3.WS-ACTVY-DESC4-V3 = AIF27W.WS-RECIN-INC-TYP;

            AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
            AIF27W.WS-CHD-D-AMT-F = ".";
            AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
            AIF27W3.WS-ACTVY-DESC4-V4 = AIF27W.WS-CHD-D-AMT;
          else
            if (AIF27W.WS-COUNT == 5)
              AIF27W1.WS-CHD-UPI3 = AIF27W.WS-RECIN-UPI-N;
              AIF27W3.WS-ACTVY-DESC5-V1 = AIF27W.WS-FRST-NM;
              AIF27W3.WS-ACTVY-DESC5-V2 = AIF27W.WS-D-SSN;
              AIF27W3.WS-ACTVY-DESC5-V3 = AIF27W.WS-RECIN-INC-TYP;

              AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
              AIF27W.WS-CHD-D-AMT-F = ".";
              AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
              AIF27W3.WS-ACTVY-DESC5-V4 = AIF27W.WS-CHD-D-AMT;
            else
              if (AIF27W.WS-COUNT == 6)
                AIF27W1.WS-CHD-UPI4 = AIF27W.WS-RECIN-UPI-N;
                AIF27W3.WS-ACTVY-DESC6-V1 = AIF27W.WS-FRST-NM;
                AIF27W3.WS-ACTVY-DESC6-V2 = AIF27W.WS-D-SSN;
                AIF27W3.WS-ACTVY-DESC6-V3 = AIF27W.WS-RECIN-INC-TYP;

                AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
                AIF27W.WS-CHD-D-AMT-F = ".";
                AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
                AIF27W3.WS-ACTVY-DESC6-V4 = AIF27W.WS-CHD-D-AMT;
              end
            end
          end
        end

        if (AIF27W.WS-COUNT == 7)
          AIF27W1.WS-CHD-UPI5 = AIF27W.WS-RECIN-UPI-N;
          AIF27W3.WS-ACTVY-DESC7-V1 = AIF27W.WS-FRST-NM;
          AIF27W3.WS-ACTVY-DESC7-V2 = AIF27W.WS-D-SSN;
          AIF27W3.WS-ACTVY-DESC7-V3 = AIF27W.WS-RECIN-INC-TYP;

          AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
          AIF27W.WS-CHD-D-AMT-F = ".";
          AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
          AIF27W3.WS-ACTVY-DESC7-V4 = AIF27W.WS-CHD-D-AMT;
        else
          if (AIF27W.WS-COUNT == 8)
            AIF27W1.WS-CHD-UPI6 = AIF27W.WS-RECIN-UPI-N;
            AIF27W3.WS-ACTVY-DESC8-V1 = AIF27W.WS-FRST-NM;
            AIF27W3.WS-ACTVY-DESC8-V2 = AIF27W.WS-D-SSN;
            AIF27W3.WS-ACTVY-DESC8-V3 = AIF27W.WS-RECIN-INC-TYP;

            AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
            AIF27W.WS-CHD-D-AMT-F = ".";
            AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
            AIF27W3.WS-ACTVY-DESC8-V4 = AIF27W.WS-CHD-D-AMT;
          else
            if (AIF27W.WS-COUNT == 9)
              AIF27W1.WS-CHD-UPI7 = AIF27W.WS-RECIN-UPI-N;
              AIF27W3.WS-ACTVY-DESC9-V1 = AIF27W.WS-FRST-NM;
              AIF27W3.WS-ACTVY-DESC9-V2 = AIF27W.WS-D-SSN;
              AIF27W3.WS-ACTVY-DESC9-V3 = AIF27W.WS-RECIN-INC-TYP;

              AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
              AIF27W.WS-CHD-D-AMT-F = ".";
              AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
              AIF27W3.WS-ACTVY-DESC9-V4 = AIF27W.WS-CHD-D-AMT;
            end
          end
        end

        if (AIF27W.WS-COUNT == 10)
          AIF27W1.WS-CHD-UPI8 = AIF27W.WS-RECIN-UPI-N;
          AIF27W3.WS-ACTVY-DESC10-V1 = AIF27W.WS-FRST-NM;
          AIF27W3.WS-ACTVY-DESC10-V2 = AIF27W.WS-D-SSN;
          AIF27W3.WS-ACTVY-DESC10-V3 = AIF27W.WS-RECIN-INC-TYP;

          AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
          AIF27W.WS-CHD-D-AMT-F = ".";
          AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
          AIF27W3.WS-ACTVY-DESC10-V4 = AIF27W.WS-CHD-D-AMT;
        else
          if (AIF27W.WS-COUNT == 11)
            AIF27W1.WS-CHD-UPI9 = AIF27W.WS-RECIN-UPI-N;
            AIF27W3.WS-ACTVY-DESC11-V1 = AIF27W.WS-FRST-NM;
            AIF27W3.WS-ACTVY-DESC11-V2 = AIF27W.WS-D-SSN;
            AIF27W3.WS-ACTVY-DESC11-V3 = AIF27W.WS-RECIN-INC-TYP;

            AIF27W.WS-CHD-D-AMT-D = AIF27W.WS-RECIN-AMT-D;
            AIF27W.WS-CHD-D-AMT-F = ".";
            AIF27W.WS-CHD-D-AMT-C = AIF27W.WS-RECIN-AMT-C;
            AIF27W3.WS-ACTVY-DESC11-V4 = AIF27W.WS-CHD-D-AMT;
          end
        end

        /* $ allocated to CST for case with more than 9 active kids*/
        if (AIF27W.WS-COUNT >= 12)
          AIF27W.WS-CST-DD-AMT = AIF27W.WS-CST-DD-AMT +           AIF27W.WS-RECIN-AMT;
        end

      end

      /* $ allocated to CST for kids not beig active*/
      if (VDBCONTROL.URC == 100)
        AIF27W.WS-CST-AMT = AIF27W.WS-CST-AMT + AIF27W.WS-RECIN-AMT;
      end

    end /* End of code for record type 2*/

  end

  /* **/
end // end AIF27P9-PROC-DATA


// Process with logic
Function AIF27P9-PROC-PARA()
  /* **/

  /* Read file for input*/
  AIF27P9-GET-IP-REC();

  AIF27W.WS-RECIN-REC-TYP = SR-AIF27-RECIN.ACO01-RECIN-REC-TYP;
  AIF27W.WS-RECIN-INC-TYP = SR-AIF27-RECIN.ACO01-RECIN-INC-TYP;
  AIF27W.WS-RECIN-UPI = SR-AIF27-RECIN.ACO01-RECIN-UPI;
  AIF27W.WS-RECIN-AMT = SR-AIF27-RECIN.ACO01-RECIN-AMT;

  /* Create Text data*/
  AIF27P9-GEN-TEXT();

  while (sysVar.errorCode == "00000000")

    /* Process Data*/
    AIF27P9-PROC-DATA();

    /* Read file for input*/
    AIF27P9-GET-IP-REC();

    AIF27W.WS-RECIN-REC-TYP = SR-AIF27-RECIN.ACO01-RECIN-REC-TYP;
    AIF27W.WS-RECIN-INC-TYP = SR-AIF27-RECIN.ACO01-RECIN-INC-TYP;
    AIF27W.WS-RECIN-UPI = SR-AIF27-RECIN.ACO01-RECIN-UPI;
    AIF27W.WS-RECIN-AMT = SR-AIF27-RECIN.ACO01-RECIN-AMT;

    if (AIF27W.WS-RECIN-REC-TYP == "1")

      /* Create Clog and Alerts*/
      AIF27P9-CLOG-ALRT();

      /* Create Text data*/
      AIF27P9-GEN-TEXT();
    end

  end

  if (AIF27W.WS-RECIN-REC-TYP != "1")

    /* Create Clog and Alerts for the last TYP:1 read*/
    AIF27P9-CLOG-ALRT();

  end

  /* **/
end // end AIF27P9-PROC-PARA


// LUW for DB Access
Function AIF27P9-S-CMHPER-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set H2-2-CMH-PER empty;

  /* Perform process to retrieve data*/
  AIF27P9-S-CMHPER-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "Y";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-S-CMHPER-L


// Set Control Retrieve of Data
Function AIF27P9-S-CMHPER-P()
  /* **/

  H2-2-CMH-PER.UPI = AIF27W.WS-RECIN-UPI-N;
  H2-2-CMH-PER.PRD-BEG-DT = AIF27W.WS-PROCESS-DT;
  H2-2-CMH-PER.PRD-END-DT = AIF27W.WS-PROCESS-DT;

  AIF27P9-S-CMHPER-Q();

  /* **/
end // end AIF27P9-S-CMHPER-P


// READ ON H2-2-CMH-PER
Function AIF27P9-S-CMHPER-Q()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-OBJ = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  VDBCONTROL.UPROC-NM = "AIF27P9-S-CMHPER-Q";

  /*  */
  try
    get H2-2-CMH-PER
      with #sql{
        select SSN, FRST_NM
        from TWNCASE_MEMBER_HST T1,
             TWNPERSON T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE T1.UPI          = :UPI
          AND T1.UPI          = T2.UPI
          AND T1.PRD_BEG_DT  <= :PRD-BEG-DT
          AND T1.PRD_END_DT  >= :PRD-END-DT
          AND T1.MAINT_CD    <> 'D'
          AND ((T1.HH_LEFT_DT     >= :PRD-BEG-DT)
            OR (T1.HH_LEFT_DT     <= :PRD-END-DT AND
                T1.HH_LEFT_RSN_CD IN ('M', 'O', 'V', 'E')))
        FETCH FIRST 1 ROW ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into SSN, FRST-NM ;
  end

  /* **/
end // end AIF27P9-S-CMHPER-Q


// LUW for DB Access
Function AIF27P9-S-SYS-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set GDS empty;

  /* Perform process to retrieve data*/
  AIF27P9-S-SYS-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "N";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-S-SYS-L


// Set Control Retrieve of Data
Function AIF27P9-S-SYS-P()
  /* **/

  /* Perform process to retrieve data*/
  AIF27P9-S-SYS-Q();

  /* **/
end // end AIF27P9-S-SYS-P


// READ ON GDS
Function AIF27P9-S-SYS-Q()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "GDS";
  VDBCONTROL.UPROC-OBJ = "GDS";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  VDBCONTROL.UPROC-NM = "AIF27P9-S-SYS-Q";

  /*  */
  try
    get GDS singleRow
      with #sql{
        select SYSTEM_FLAG
        from TWNSYSDATE T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into SYSTEM-FLAG ;
  end

  /* **/
end // end AIF27P9-S-SYS-Q


// LUW for DB Access
Function AIF27P9-SEL-FAC-L()
  /* **/

  /* Perform standard database application initialization*/
  WDB00PI();

  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIF27A";

  /* Initialize SQL row record*/
  set H2-FAM-CASELD-CASE empty;

  /* Perform process to retrieve data*/
  AIF27P9-SEL-FAC-P();

  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";

  /* * Perform DBM error processing*/
  WDB00PE-SQLERR();

  /* **/
end // end AIF27P9-SEL-FAC-L


// Set Control Retrieve of Data
Function AIF27P9-SEL-FAC-P()
  /* **/

  H2-FAM-CASELD-CASE.ICI = H2-CASE-MEMBER-HST.ICI;

  AIF27P9-SEL-FAC-Q();

  /* **/
end // end AIF27P9-SEL-FAC-P


// READ ON H2-FAM-CASELD-CASE
Function AIF27P9-SEL-FAC-Q()
  /* **/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-FAM-CASELD-CASE";
  VDBCONTROL.UPROC-OBJ = "H2-FAM-CASELD-CASE";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  VDBCONTROL.UPROC-NM = "AIF27P9-SEL-FAC-Q";

  /*  */
  try
    get H2-FAM-CASELD-CASE
      with #sql{
        select OFC_CD, PRGM_OFC_TYPE, SPRVS_UNIT, PSN_NMB,
          FUNC_AREA_CD, WRKR_TYPE, CASLD_EFF_DT, ICI,
          CASLD_ID, IVE_CASLD_ID
        from twnfam_caseld_case T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE ICI = :ICI
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into OFC-CD, PRGM-OFC-TYPE, SPRVS-UNIT, PSN-NMB,
           FUNC-AREA-CD, WRKR-TYPE, CASLD-EFF-DT, ICI,
           CASLD-ID, IVE-CASLD-ID ;
  end

  /* **/
end // end AIF27P9-SEL-FAC-Q


Record AIF27W type basicRecord
  5 WS-RECIN char(21) ; 
    10 WS-RECIN-REC-TYP char(1) ; 
    10 WS-RECIN-INC-TYP char(2) ; 
    10 WS-RECIN-UPI char(9) ; 
      15 WS-RECIN-UPI-N num(9) ; 
    10 WS-RECIN-AMT num(9) ; 
      15 WS-RECIN-AMT-D num(7) ; 
      15 WS-RECIN-AMT-C num(2) ; 
  5 WS-PROCESS-DT char(10) ; 
    10 WS-PROCESS-DT-CCYY-N num(4) ; 
      15 WS-PROCESS-DT-CC char(2) ; 
      15 WS-PROCESS-DT-YY char(2) ; 
    10 WS-PROCESS-DT-F1 char(1) ; 
    10 WS-PROCESS-DT-MM-N num(2) ; 
      15 WS-PROCESS-DT-MM char(2) ; 
    10 WS-PROCESS-DT-F2 char(1) ; 
    10 WS-PROCESS-DT-DD-N num(2) ; 
      15 WS-PROCESS-DT-DD char(2) ; 
  5 WS-CURRENT-DATE char(10) ;
  5 WS-SYSTEM-FLAG char(1) ; 
  5 WS-CST-AMT num(9) ; 
    10 WS-CST-AMT-D num(7) ; 
    10 WS-CST-AMT-C num(2) ; 
  5 WS-CST-D-AMT char(10) ; 
    10 WS-CST-D-AMT-D char(7) ; 
    10 WS-CST-D-AMT-F char(1) ; 
    10 WS-CST-D-AMT-C char(2) ; 
  5 WS-CST-DD-AMT num(9) ; 
    10 WS-CST-DD-AMT-D char(7) ; 
    10 WS-CST-DD-AMT-C char(2) ; 
  5 WS-CHD-D-AMT char(10) ; 
    10 WS-CHD-D-AMT-D char(7) ; 
    10 WS-CHD-D-AMT-F char(1) ; 
    10 WS-CHD-D-AMT-C char(2) ; 
  5 WS-COUNT num(2) ; 
  5 WS-SSN char(9) ; 
    10 WS-SSN-3 char(3) ; 
    10 WS-SSN-2 char(2) ; 
    10 WS-SSN-4 char(4) ; 
  5 WS-D-SSN char(11) ; 
    10 WS-D-SSN-3 char(3) ; 
    10 WS-D-SSN-F1 char(1) ; 
    10 WS-D-SSN-2 char(2) ; 
    10 WS-D-SSN-F2 char(1) ; 
    10 WS-D-SSN-4 char(4) ; 
  5 WS-SINQ-H2-SQCOD smallint ; 
  5 WS-SCAN-H2-SQCOD smallint ; 
  5 WS-CSL-ADD-SQCOD smallint ; 
  5 WS-AFA-ADD-SQCOD smallint ; 
  5 WS-FAC-SEL-SQCOD smallint ; 
  5 WS-FRST-NM char(12) ; 
end // end AIF27W


Record AIF27W1 type basicRecord
  10 WS-CST-UPI int ; 
  10 WS-CHD-UPI1 int ; 
  10 WS-CHD-UPI2 int ; 
  10 WS-CHD-UPI3 int ; 
  10 WS-CHD-UPI4 int ; 
  10 WS-CHD-UPI5 int ; 
  10 WS-CHD-UPI6 int ; 
  10 WS-CHD-UPI7 int ; 
  10 WS-CHD-UPI8 int ; 
  10 WS-CHD-UPI9 int ; 
end // end AIF27W1


Record AIF27W2 type basicRecord
  10 WS-ALERT-TXT char(65) ; 
    15 WS-ALERT-TXT-C char(22) ; 
    15 WS-ALERT-TXT-V char(2) ; 
    15 WS-ALERT-TXT-F char(41) ; 
end // end AIF27W2


Record AIF27W3 type basicRecord
  10 WS-ICI int ; 
  10 WS-LOG-CRN-TS char(26) ; 
  10 WS-PRGM-CASE-TYPE char(2) ; 
  10 WS-ACTVY-TM char(8) ; 
  10 WS-WRKR-ID char(8) ; 
  10 WS-LOG-ENTRY-DESC char(60) ; 
  10 WS-LOG-ENTRY-TYPE char(1) ; 
  10 WS-CL-ACTVY-DESC char(720) ; 
    15 WS-ACTVY-DESC1 char(60) ; 
      20 WS-ACTVY-DESC1-C1 char(15) ; 
      20 WS-ACTVY-DESC1-F1 char(1) ; 
      20 WS-ACTVY-DESC1-V1 char(11) ; 
      20 WS-ACTVY-DESC1-F2 char(1) ; 
      20 WS-ACTVY-DESC1-C2 char(13) ; 
      20 WS-ACTVY-DESC1-V2 char(2) ; 
      20 WS-ACTVY-DESC1-F3 char(1) ; 
      20 WS-ACTVY-DESC1-C3 char(2) ; 
      20 WS-ACTVY-DESC1-V3 char(10) ; 
      20 WS-ACTVY-DESC1-F4 char(4) ; 
    15 WS-ACTVY-DESC2 char(60) ; 
      20 WS-ACTVY-DESC2-C1 char(20) ; 
      20 WS-ACTVY-DESC2-F1 char(1) ; 
      20 WS-ACTVY-DESC2-V1 char(11) ; 
      20 WS-ACTVY-DESC2-F2 char(1) ; 
      20 WS-ACTVY-DESC2-C2 char(3) ; 
      20 WS-ACTVY-DESC2-V2 char(2) ; 
      20 WS-ACTVY-DESC2-F3 char(1) ; 
      20 WS-ACTVY-DESC2-C3 char(2) ; 
      20 WS-ACTVY-DESC2-V3 char(10) ; 
      20 WS-ACTVY-DESC2-F4 char(9) ; 
    15 WS-ACTVY-DESC3 char(60) ; 
      20 WS-ACTVY-DESC3-C1 char(16) ; 
      20 WS-ACTVY-DESC3-F1 char(1) ; 
      20 WS-ACTVY-DESC3-V1 char(12) ; 
      20 WS-ACTVY-DESC3-F2 char(1) ; 
      20 WS-ACTVY-DESC3-V2 char(11) ; 
      20 WS-ACTVY-DESC3-F3 char(1) ; 
      20 WS-ACTVY-DESC3-C2 char(3) ; 
      20 WS-ACTVY-DESC3-V3 char(2) ; 
      20 WS-ACTVY-DESC3-F4 char(1) ; 
      20 WS-ACTVY-DESC3-C3 char(2) ; 
      20 WS-ACTVY-DESC3-V4 char(10) ; 
    15 WS-ACTVY-DESC4 char(60) ; 
      20 WS-ACTVY-DESC4-C1 char(16) ; 
      20 WS-ACTVY-DESC4-F1 char(1) ; 
      20 WS-ACTVY-DESC4-V1 char(12) ; 
      20 WS-ACTVY-DESC4-F2 char(1) ; 
      20 WS-ACTVY-DESC4-V2 char(11) ; 
      20 WS-ACTVY-DESC4-F3 char(1) ; 
      20 WS-ACTVY-DESC4-C2 char(3) ; 
      20 WS-ACTVY-DESC4-V3 char(2) ; 
      20 WS-ACTVY-DESC4-F4 char(1) ; 
      20 WS-ACTVY-DESC4-C3 char(2) ; 
      20 WS-ACTVY-DESC4-V4 char(10) ; 
    15 WS-ACTVY-DESC5 char(60) ; 
      20 WS-ACTVY-DESC5-C1 char(16) ; 
      20 WS-ACTVY-DESC5-F1 char(1) ; 
      20 WS-ACTVY-DESC5-V1 char(12) ; 
      20 WS-ACTVY-DESC5-F2 char(1) ; 
      20 WS-ACTVY-DESC5-V2 char(11) ; 
      20 WS-ACTVY-DESC5-F3 char(1) ; 
      20 WS-ACTVY-DESC5-C2 char(3) ; 
      20 WS-ACTVY-DESC5-V3 char(2) ; 
      20 WS-ACTVY-DESC5-F4 char(1) ; 
      20 WS-ACTVY-DESC5-C3 char(2) ; 
      20 WS-ACTVY-DESC5-V4 char(10) ; 
    15 WS-ACTVY-DESC6 char(60) ; 
      20 WS-ACTVY-DESC6-C1 char(16) ; 
      20 WS-ACTVY-DESC6-F1 char(1) ; 
      20 WS-ACTVY-DESC6-V1 char(12) ; 
      20 WS-ACTVY-DESC6-F2 char(1) ; 
      20 WS-ACTVY-DESC6-V2 char(11) ; 
      20 WS-ACTVY-DESC6-F3 char(1) ; 
      20 WS-ACTVY-DESC6-C2 char(3) ; 
      20 WS-ACTVY-DESC6-V3 char(2) ; 
      20 WS-ACTVY-DESC6-F4 char(1) ; 
      20 WS-ACTVY-DESC6-C3 char(2) ; 
      20 WS-ACTVY-DESC6-V4 char(10) ; 
    15 WS-ACTVY-DESC7 char(60) ; 
      20 WS-ACTVY-DESC7-C1 char(16) ; 
      20 WS-ACTVY-DESC7-F1 char(1) ; 
      20 WS-ACTVY-DESC7-V1 char(12) ; 
      20 WS-ACTVY-DESC7-F2 char(1) ; 
      20 WS-ACTVY-DESC7-V2 char(11) ; 
      20 WS-ACTVY-DESC7-F3 char(1) ; 
      20 WS-ACTVY-DESC7-C2 char(3) ; 
      20 WS-ACTVY-DESC7-V3 char(2) ; 
      20 WS-ACTVY-DESC7-F4 char(1) ; 
      20 WS-ACTVY-DESC7-C3 char(2) ; 
      20 WS-ACTVY-DESC7-V4 char(10) ; 
    15 WS-ACTVY-DESC8 char(60) ; 
      20 WS-ACTVY-DESC8-C1 char(16) ; 
      20 WS-ACTVY-DESC8-F1 char(1) ; 
      20 WS-ACTVY-DESC8-V1 char(12) ; 
      20 WS-ACTVY-DESC8-F2 char(1) ; 
      20 WS-ACTVY-DESC8-V2 char(11) ; 
      20 WS-ACTVY-DESC8-F3 char(1) ; 
      20 WS-ACTVY-DESC8-C2 char(3) ; 
      20 WS-ACTVY-DESC8-V3 char(2) ; 
      20 WS-ACTVY-DESC8-F4 char(1) ; 
      20 WS-ACTVY-DESC8-C3 char(2) ; 
      20 WS-ACTVY-DESC8-V4 char(10) ; 
    15 WS-ACTVY-DESC9 char(60) ; 
      20 WS-ACTVY-DESC9-C1 char(16) ; 
      20 WS-ACTVY-DESC9-F1 char(1) ; 
      20 WS-ACTVY-DESC9-V1 char(12) ; 
      20 WS-ACTVY-DESC9-F2 char(1) ; 
      20 WS-ACTVY-DESC9-V2 char(11) ; 
      20 WS-ACTVY-DESC9-F3 char(1) ; 
      20 WS-ACTVY-DESC9-C2 char(3) ; 
      20 WS-ACTVY-DESC9-V3 char(2) ; 
      20 WS-ACTVY-DESC9-F4 char(1) ; 
      20 WS-ACTVY-DESC9-C3 char(2) ; 
      20 WS-ACTVY-DESC9-V4 char(10) ; 
    15 WS-ACTVY-DESC10 char(60) ; 
      20 WS-ACTVY-DESC10-C1 char(16) ; 
      20 WS-ACTVY-DESC10-F1 char(1) ; 
      20 WS-ACTVY-DESC10-V1 char(12) ; 
      20 WS-ACTVY-DESC10-F2 char(1) ; 
      20 WS-ACTVY-DESC10-V2 char(11) ; 
      20 WS-ACTVY-DESC10-F3 char(1) ; 
      20 WS-ACTVY-DESC10-C2 char(3) ; 
      20 WS-ACTVY-DESC10-V3 char(2) ; 
      20 WS-ACTVY-DESC10-F4 char(1) ; 
      20 WS-ACTVY-DESC10-C3 char(2) ; 
      20 WS-ACTVY-DESC10-V4 char(10) ; 
    15 WS-ACTVY-DESC11 char(60) ; 
      20 WS-ACTVY-DESC11-C1 char(16) ; 
      20 WS-ACTVY-DESC11-F1 char(1) ; 
      20 WS-ACTVY-DESC11-V1 char(12) ; 
      20 WS-ACTVY-DESC11-F2 char(1) ; 
      20 WS-ACTVY-DESC11-V2 char(11) ; 
      20 WS-ACTVY-DESC11-F3 char(1) ; 
      20 WS-ACTVY-DESC11-C2 char(3) ; 
      20 WS-ACTVY-DESC11-V3 char(2) ; 
      20 WS-ACTVY-DESC11-F4 char(1) ; 
      20 WS-ACTVY-DESC11-C3 char(2) ; 
      20 WS-ACTVY-DESC11-V4 char(10) ; 
    15 WS-ACTVY-DESC12 char(60) ; 
      20 WS-ACTVY-DESC12-C1 char(41) ; 
      20 WS-ACTVY-DESC12-F1 char(1) ; 
      20 WS-ACTVY-DESC12-C2 char(3) ; 
      20 WS-ACTVY-DESC12-V1 char(2) ; 
      20 WS-ACTVY-DESC12-F2 char(1) ; 
      20 WS-ACTVY-DESC12-C3 char(2) ; 
      20 WS-ACTVY-DESC12-V2 char(10) ; 
end // end AIF27W3

