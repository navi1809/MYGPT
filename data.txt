package IVD_Batch;
import egl.core.deleteafteruse;
import CommonMigratedParts.*;
import DataItems.*;
import DataTables.*;

//*** PROGRAM=DCM08A ****
// COMPONENT NAME: DCM08A CALLED BATCH
// ===============
// 
// DESCRIPTION:
// ============
// THIS APPLICTION ACCEPTS THE PARAMETERS FROM OTHER
// APPLICATIONS INTENDING TO CREATE A CASE TRACKING ENTRY.
// 
// 
// ***********************
Program DCM08A type basicProgram //VAGen Info - called batch program
  (
   VDBCONTROL VDBCONTROL, // record
   VMESSAGE VMESSAGE, // record
   GNOMADS GNOMADS, // record
   G-IV-D G-IV-D, // record
   PDCM-CASE-TRACKING PDCM-CASE-TRACKING // record
  )
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  CEP01W CEP01W; // record
  DCM08W DCM08W; // record
  H-TDCHC2 H-TDCHC2; // record
  H-TDCTI1 H-TDCTI1; // record
  H-TIDCC7 H-TIDCC7; // record
  H-TLMCS1 H-TLMCS1; // record
  H2-2-DCC-SPT H2-2-DCC-SPT; // record
  H2-IVD-CASE H2-IVD-CASE; // record
  H2-PERSON H2-PERSON; // record
  PDCM-CASE-TRCK-PI1 PDCM-CASE-TRCK-PI1; // record
  VDBCOMMON VDBCOMMON; // record
  VSTRREC4 VSTRREC4; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    DCM08P9-CREATE: DCM08P9-CREATE();
  end // end main
end // end DCM08A


// format/ create tracking record
Function DCM08P9-CREATE()
  /* Change History*/
  /* ==============*/
  /* Date      Pgr         Description*/
  /* -------   ---         -----------*/
  /* 09-15-94  TBST89      APPLICATION SPECIFIC*/
  /* 3/27/2000 wi 19646 -  track for specific case msg type 190 for ncp*/
  /* -------------------------------------------*/
  /* ------------CBSI START-----------------*/
  /*  */
  set DCM08W empty;
  PDCM-CASE-TRCK-PI1.PI1-CASE-TRACKING = PDCM-CASE-TRACKING.PDCM-CASE-TRAC;
  DCM08W.WS-TRACK-MSG = " ";
  DCM08W.WS-FIRST-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1;
  DCM08W.WS-SECOND-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-2;
  /* PTR 5463 Change start*/
  DCM08W.WS-MSG-1 = PDCM-CASE-TRACKING.PDCM-TEXT1;
  DCM08W.WS-MSG-2 = PDCM-CASE-TRACKING.PDCM-TEXT2;
  WS-INDEX1 = 1;
  /* Append 'CHANGED FROM' text at the beginning where necessary.*/
  if (DCM08W.WS-WHOLE == "020" || DCM08W.WS-WHOLE == "021"
   /* ptr 9484 start*/
   /* OR DCM08W.WS-WHOLE = '041' OR*/
   /* DCM08W.WS-WHOLE = '042'*/
   /* ptr 9484 end*/
   /* -=> #7177: Case tracking on NEMP*/
   /* screen, Format Changes Needed WGM beg*/
   /* OR DCM08W.WS-WHOLE = '043' OR*/
   /* DCM08W.WS-WHOLE = '044'      /*#7177*/
   /* Cmt*/
   /* -=> #7177: Case tracking on NEMP*/
   /* screen, Format Changes Needed WGM end*/
   || DCM08W.WS-WHOLE == "050" || DCM08W.WS-WHOLE == "110"
   || DCM08W.WS-WHOLE == "120")
    DCM08W.WS-TRACK-MSG = "CHANGED FROM";
    DCM08W.WS-FLAG1 = "Y";
    DCM08W.WS-INDEX1 = 14;
  end
  /* Position index2 to last character in array 1*/
  DCM08W.WS-INDEX2 = 240;
  while (DCM08W.WS-INDEX2 > 0 && DCM08W.WS-ARRAY-1[WS-INDEX2] == " ")
    DCM08W.WS-INDEX2 = DCM08W.WS-INDEX2 - 1;
  end
  /* ws-index2 contains no of charac to be added from msg-1*/
  /* ws-index1 contains starting position in the array.*/
  DCM08W.WS-INDEX3 = 1;
  while (DCM08W.WS-INDEX2 >= DCM08W.WS-INDEX3)
    WS-TRACK-ARRAY[WS-INDEX1] = WS-ARRAY-1[WS-INDEX3];
    DCM08W.WS-INDEX3 = DCM08W.WS-INDEX3 + 1;
    DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 1;
  end
  /* provide for the space between the strings*/
  DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 1;
  /* Check to see if 'TO ' is to be juxtaposed between the strings*/
  if (DCM08W.WS-FLAG1 == "Y")
    DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 1;
    WS-TRACK-ARRAY[WS-INDEX1] = "T";
    DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 1;
    WS-TRACK-ARRAY[WS-INDEX1] = "O";
    DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 2;
  end
  /* append second string*/
  DCM08W.WS-INDEX3 = 1;
  while (DCM08W.WS-INDEX3 < 241)
    WS-TRACK-ARRAY[WS-INDEX1] = WS-ARRAY-2[WS-INDEX3];
    DCM08W.WS-INDEX3 = DCM08W.WS-INDEX3 + 1;
    DCM08W.WS-INDEX1 = DCM08W.WS-INDEX1 + 1;
  end
  /* tracking text must be formatted to get rid of unneeded whitespace*/
  DCM08W.WS-TEMP-STRING = " ";
  DCM08W.WS-TEMP-STRING = DCM08W.WS-TRACK-MSG;
  DCM08P9-REM-SPACES();
  DCM08W.WS-TRACK-ARRAY = " ";
  DCM08W.WS-TRACK-MSG = DCM08W.WS-FINAL-STRING;

  /* PTR 5463 change end*/
  /* ptr 9174 start*/
  DCM08W.NCP-FLAG = "N";
  DCM08W.CST-FLAG = "N";
  DCM08W.CHD-FLAG = "N";

  if (PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1 == "02" || 
  PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1 == "04" || 
  PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1 == "11" || 
  PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1 == "16")
    DCM08P9-PERSON-L1();
    if (VDBCONTROL.URC > 104)
      exit program;
    end
    DCM08W.NCP-FLAG = H2-PERSON.NCP-FG;
    DCM08W.CST-FLAG = H2-PERSON.CST-FG;
    DCM08W.CHD-FLAG = H2-PERSON.CHD-FG;

    DCM08W.WS-DO-ALL = "Y";
  else
    DCM08W.WS-DO-ALL = "N";
  end

  /* ptr 9174 end*/
  /*  */
  if (PDCM-CASE-TRCK-PI1.PI1-PARTICIPANT != " "
   /* ptr 9174 start*/
   || DCM08W.WS-DO-ALL == "Y")
  /* ptr 9174 end*/
    if (PDCM-CASE-TRCK-PI1.PI1-PARTICIPANT == "N"
     /* ptr 9174 start*/
     || DCM08W.NCP-FLAG == "Y")
  /* wi 19646 insert begin*/
      if (PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE == "19A")
        if (GNOMADS.G-USER-ID > "AAAAAAAA"
         && GNOMADS.G-USER-ID < "99999999")
          H-TDCTI1.WRKR-ID = GNOMADS.G-USER-ID;
        else
          DCM08P9-Q1-WRKR-ID();
        end
        H-TDCTI1.UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
        H-TDCTI1.CASE-SUFX = PDCM-CASE-TRCK-PI1.PI1-CASE-SFX;
        H-TDCTI1.MSG-LOG-TYPE = "19A";
        H-TDCTI1.PRTCP-CD = "1";
        DCM08P9-TRACK-PROC();
      else
  /* 19646 insert end*/
  /* ptr 9174 end*/
        H-TIDCC7.NCP-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
        H-TIDCC7.HWS-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
        H-TIDCC7.HWS-TRACK-MSG = DCM08W.WS-TRACK-MSG;
        DCM08W.WS-FIRST-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1;
        DCM08W.WS-SECOND-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-2;
        H-TIDCC7.HWS-MSG = DCM08W.WS-WHOLE;
        H-TLMCS1.LOG-TYPE = PDCM-CASE-TRACKING.PDCM-MSG-TYPE;
        H-TIDCC7.HWS-WRKR-ID = GNOMADS.G-USER-ID;
  /* -------------------------PTR2751 START--------------------------------*/
        H-TIDCC7.MANUAL-IND = PDCM-CASE-TRACKING.PDCM-MANUAL-IND;
  /* -------------------------PTR2751 END----------------------------------*/
        call "TIDCC7A" (VDBCONTROL, VMESSAGE, H-TIDCC7);
        if (VDBCONTROL.URC > 104)
          exit program;
        end
      end
    end
    if (PDCM-CASE-TRCK-PI1.PI1-PARTICIPANT == "C"
     /* ptr 9174 start*/
     || DCM08W.CST-FLAG == "Y")
  /* ptr 9174 end*/
      H-TIDCC7.CST-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
      H-TIDCC7.HWS-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
      H-TIDCC7.HWS-TRACK-MSG = DCM08W.WS-TRACK-MSG;
      DCM08W.WS-FIRST-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1;
      DCM08W.WS-SECOND-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-2;
      H-TIDCC7.HWS-MSG = DCM08W.WS-WHOLE;
      H-TLMCS1.LOG-TYPE = PDCM-CASE-TRACKING.PDCM-MSG-TYPE;
      H-TIDCC7.HWS-WRKR-ID = GNOMADS.G-USER-ID;
  /* -------------------------PTR2751 START--------------------------------*/
      H-TIDCC7.MANUAL-IND = PDCM-CASE-TRACKING.PDCM-MANUAL-IND;
  /* -------------------------PTR2751 END----------------------------------*/
      call "TIDCC8A" (VDBCONTROL, VMESSAGE, H-TIDCC7);
      if (VDBCONTROL.URC > 104)
        exit program;
      end
      H-TDCTI1.MSG-LOG-TYPE = H-TIDCC7.FUNC-AREA-CD; /* PTR 10381*/
    end
    if (PDCM-CASE-TRCK-PI1.PI1-PARTICIPANT == "K"
     /* ptr 9174 start*/
     || DCM08W.CHD-FLAG == "Y")
  /* ptr 9174 end*/
      H-TDCHC2.CHD-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
      H-TDCHC2.HWS-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
      H-TDCHC2.HWS-TRACK-MSG = DCM08W.WS-TRACK-MSG;
      DCM08W.WS-FIRST-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1;
      DCM08W.WS-SECOND-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-2;
      H-TDCHC2.HWS-MSG = DCM08W.WS-WHOLE;
      H-TLMCS1.LOG-TYPE = PDCM-CASE-TRACKING.PDCM-MSG-TYPE;
      H-TDCHC2.HWS-WRKR-ID = GNOMADS.G-USER-ID;
  /* -------------------------PTR2751 START--------------------------------*/
      H-TDCHC2.MANUAL-IND = PDCM-CASE-TRACKING.PDCM-MANUAL-IND;
  /* -------------------------PTR2751 END----------------------------------*/
      call "TDCHC2A" (VDBCONTROL, VMESSAGE, H-TDCHC2);
      if (VDBCONTROL.URC > 104)
        exit program;
      end
    end
  else
    /* ---------------------------------   /*   PTR 10362 START*/
    if (GNOMADS.G-USER-ID > "AAAAAAAA"
     && GNOMADS.G-USER-ID < "99999999")
      H-TDCTI1.WRKR-ID = GNOMADS.G-USER-ID;
    else
      DCM08P9-Q1-WRKR-ID();
    end
    /* ---------------------------------/*   PTR 10362 END*/
    if (PDCM-CASE-TRACKING.PDCM-MSG-TYPE == "199") /* PTR 10381*/
      H2-IVD-CASE.NCP-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
                                   /* PTR 10381*/
      DCM08P9-OPEN-CASE(); /* PRT 10381*/
      H-TDCTI1.MSG-LOG-TYPE = H-TIDCC7.FUNC-AREA-CD; /* PTR 10381*/
    end /* PTR 10381*/
    ;
    H-TDCTI1.UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
    H-TDCTI1.CASE-SUFX = PDCM-CASE-TRCK-PI1.PI1-CASE-SFX;
    DCM08P9-TRACK-PROC();
  end
  exit program;
  /* EXIT MODULE*/
  /* ------------CBSI END-----------------*/
end // end DCM08P9-CREATE


// INQURY Message Text Data
Function DCM08P9-OPEN-CASE()

  VDBCOMMON.USQLREC = "H2-IVD-CASE";
  /*  */
  VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";
  VDBCONTROL.UPROC-OPT = "SETINQ";
  VDBCONTROL.UPROC-NM = "DCM08P9-OPEN-CASE";
  VDBCOMMON.USQLREC = "H2-IVD-CASE";
  /*  */
  try
    open DCM08P9-OPEN-CASE_RSI01
      with #sql{
        select NCP_UPI, CASE_SUFX, FUNC_AREA_CD
        from TWNIVD_CASE T1
        WHERE NCP_UPI = :NCP-UPI
        AND   CASE_SUFX BETWEEN 'A' AND 'Z'
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into NCP-UPI, CASE-SUFX, FUNC-AREA-CD
      for H2-IVD-CASE ;
  end

  if (sysVar.sqlData.sqlcode == 0)
    DCM08P9-READ-CASE();
  end
end // end DCM08P9-OPEN-CASE


// LUW for DB Access
Function DCM08P9-PERSON-L1()
  /* ptr 9174  START*/
  WDB00PI();
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "DCM08A";
  set H2-PERSON empty;
  DCM08P9-PERSON-P1();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
  /*  */
  /* ptr 9174  END*/
end // end DCM08P9-PERSON-L1


// Control Retrieve of Data
Function DCM08P9-PERSON-P1()
  /* ptr 9174  start*/
  H2-PERSON.UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
  DCM08P9-PERSON-Q1();
  /*  */
  /* ptr 9174  end*/
end // end DCM08P9-PERSON-P1


// get person chd, cst ncp flags
Function DCM08P9-PERSON-Q1()
  VDBCOMMON.USQLREC = "H2-PERSON";
  /*  */
  VDBCONTROL.UPROC-OBJ = "H2-PERSON";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  VDBCONTROL.UPROC-NM = "DCM08P9-PERSON-Q1";
  VDBCOMMON.USQLREC = "H2-PERSON";
  /*  */
  try
    get H2-PERSON singleRow
      with #sql{
        select NCP_FG, CST_FG, CHD_FG
        from TWNPERSON T1
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE UPI = :UPI
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into NCP-FG, CST-FG, CHD-FG ;
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /*  */
  /*  */
end // end DCM08P9-PERSON-Q1


// get worker id
Function DCM08P9-Q1-WRKR-ID()
  H2-2-DCC-SPT.UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
  H2-2-DCC-SPT.CASE-SUFX = PDCM-CASE-TRCK-PI1.PI1-CASE-SFX;
  VDBCOMMON.USQLREC = "H2-2-DCC-SPT";
  /*  */
  VDBCONTROL.UPROC-OBJ = "H2-2-DCC-SPT";
  VDBCONTROL.UPROC-OPT = "SETINQ";
  VDBCONTROL.UPROC-NM = "DCM08P9-Q1-WRKR-ID";
  VDBCOMMON.USQLREC = "H2-2-DCC-SPT";
  /*  */
  try
    open DCM08P9-Q1-WRKR-ID_RSI01
      with #sql{
        select T2.OFC_CD, T2.NOMADS_USRID, T1.CASELD_IND
        from twnivd_caseld_case T1,
             twnsup_unt_pos_hst T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE T1.UPI = :UPI
          AND T1.CASE_SUFX = :CASE-SUFX
          AND T1.OFC_CD = T2.OFC_CD
          AND T1.PRGM_OFC_TYPE = T2.PRGM_OFC_TYPE
          AND T1.SPRVS_UNIT = T2.SPRVS_UNIT
          AND T1.PSN_NMB    = T2.PSN_NMB
          AND T1.CASELD_IND = 'N'
        FOR FETCH ONLY
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into OFC-CD, NOMADS-USRID, CASELD-IND
      for H2-2-DCC-SPT ;
  end
  /*  */
  /* Increment count of rows retrieved*/
  if (sysVar.sqlData.sqlcode == 0)
    DCM08P9-Q2-WRKR-ID();
  end
end // end DCM08P9-Q1-WRKR-ID


// fetch the worker id
Function DCM08P9-Q2-WRKR-ID()
  while (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UPROC-OBJ = "H2-2-DCC-SPT";
    VDBCONTROL.UPROC-OPT = "SCAN";
    VDBCONTROL.UPROC-NM = "DCM08P9-Q2-WRKR-ID";
    VDBCOMMON.USQLREC = "H2-2-DCC-SPT";
  /*  */
    try
      get next H2-2-DCC-SPT ;
    end

    if (sysVar.sqlData.sqlcode == 0)
      H-TDCTI1.WRKR-ID = H2-2-DCC-SPT.NOMADS-USRID;
    end
  end
  /* CBSI END*/
end // end DCM08P9-Q2-WRKR-ID


// SCAN  H2-IVD-CASE
Function DCM08P9-READ-CASE()
  /* --------CBSI STARTS ----------*/

  VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";
  VDBCONTROL.UPROC-OPT = "SCAN";
  VDBCONTROL.UPROC-NM = "DCM08P9-READ-CASE";
  VDBCOMMON.USQLREC = "H2-IVD-CASE";
  /*  */
  try
    get next H2-IVD-CASE ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    H-TIDCC7.CASE-SUFX = H2-IVD-CASE.CASE-SUFX;
    H-TIDCC7.NCP-UPI = H2-IVD-CASE.NCP-UPI;
    H-TIDCC7.FUNC-AREA-CD = H2-IVD-CASE.FUNC-AREA-CD; /* PTR10381*/

  end
  /* --------CBSI ENDS ----------*/
end // end DCM08P9-READ-CASE


// REMOVE EXTRA SPACES FROM TEXT
Function DCM08P9-REM-SPACES()
  /* THIS PROCESS REMOVES EXTRA SPACES FROM THE TEXT PASSED IN*/
  /* WS-TEMP-STRING. THE PARSED TEXT IS THEN STORED IN WS-FINAL-STRING*/
  /* ANY STRING WITH MORE THAN TWO BLANKS SIDE BY SIDE WILL BE CONVERTED*/
  /* INTO A SINGLE BLANK.*/

  DCM08W.WS-MAX-CHARS = 600; /* MAX size of the character array*/
  DCM08W.WS-FINAL-STRING = " ";
  DCM08W.WS-TC = 1; /* temp string counter*/
  DCM08W.WS-FC = 1; /* final string counter*/
  DCM08W.WS-PC = 1; /* looks ahead one character of ws-tc*/


  while (DCM08W.WS-TC < DCM08W.WS-MAX-CHARS)
    DCM08W.WS-PC = DCM08W.WS-TC + 1;
    if (DCM08W.WS-TEMP-CHAR[WS-TC] != " ")
      DCM08W.WS-FINAL-CHAR[WS-FC] = DCM08W.WS-TEMP-CHAR[WS-TC];
      DCM08W.WS-TC = DCM08W.WS-TC + 1;
      DCM08W.WS-FC = DCM08W.WS-FC + 1;
    else

      if (DCM08W.WS-TEMP-CHAR[WS-PC] == " ")
        DCM08W.WS-TC = DCM08W.WS-TC + 1;
      else
        DCM08W.WS-FINAL-CHAR[WS-FC] = DCM08W.WS-TEMP-CHAR[WS-TC];
        DCM08W.WS-TC = DCM08W.WS-TC + 1;
        DCM08W.WS-FC = DCM08W.WS-FC + 1;
      end
    end
  end /* END WHILE LOOP*/

  DCM08W.WS-FINAL-CHAR[WS-MAX-CHARS] = DCM08W.WS-TEMP-CHAR[WS-MAX-CHARS];
  /*  */
end // end DCM08P9-REM-SPACES


// INSERT TRACKING RECORD
Function DCM08P9-TRACK-PROC()
  /* Change History*/
  /* ==============*/
  /* Date      Pgr         Description*/
  /* -------   ---         -----------*/
  /* 09-15-94  TBST89      APPLICATION SPECIFIC*/
  /* -------------------------------------------*/
  /* ------------CBSI START-----------------*/
  DCM08W.WS-FIRST-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-1;
  DCM08W.WS-SECOND-TWO = PDCM-CASE-TRCK-PI1.PI1-MSG-TYPE-2;
  H-TDCTI1.LOG-TYPE = PDCM-CASE-TRACKING.PDCM-MSG-TYPE;
  /* MOVE PDCM-CASE-TRACKING.PDCM-MSG-TYPE TO H-TDCTI1.MSG-LOG-TYPE;PTR10381*/
  H-TDCTI1.TRKNG-TXT = DCM08W.WS-TRACK-MSG;
  H-TDCTI1.PRTCP-UPI = PDCM-CASE-TRCK-PI1.PI1-CASE-UPI;
  if (PDCM-CASE-TRACKING.PDCM-PARTICIPANT == "K")
    H-TDCTI1.PRTCP-CD = "CHD";
  end
  if (PDCM-CASE-TRACKING.PDCM-PARTICIPANT == "C")
    H-TDCTI1.PRTCP-CD = "CST";
  end
  if (PDCM-CASE-TRACKING.PDCM-PARTICIPANT == "N")
    H-TDCTI1.PRTCP-CD = "NCP";
  end
  /* -------------------------PTR2751 START--------------------------------*/
  H-TDCTI1.MANUAL-IND = PDCM-CASE-TRACKING.PDCM-MANUAL-IND;
  /* -------------------------PTR2751 END----------------------------------*/
  call "TDCTI1A" (VDBCONTROL, VMESSAGE, H-TDCTI1) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    exit program;
  end
  /* ------------CBSI END-----------------*/
end // end DCM08P9-TRACK-PROC


