package IVA_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=AMA46A ****
// COMPONENT NAME: ARX04A Create monthly program case history
// extract
// ===============
// 
// DESCRIPTION:
// ============
// This Module creates sequential program case history extract
// file.
// 
// 
// ***********************
Program AMA46A type basicProgram //VAGen Info - main batch program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes, 
  inputRecord = VWORKSTOR
  }

  // Data Declarations
  AMA46W AMA46W; // record
  AMA46W2 AMA46W2; // record
  AMA46W3 AMA46W3; // record
  CEP01W CEP01W; // record
  GNOMADS GNOMADS; // record
  H2-FAM-CASE-STATS H2-FAM-CASE-STATS; // record
  SR-AMA46W1 SR-AMA46W1; // record
  SR-AMA46W2 SR-AMA46W2; // record
  SR-AMA46W4 SR-AMA46W4; // record
  VCOMMON VCOMMON; // record
  VCONTROL VCONTROL; // record
  VDBCOMMON VDBCOMMON; // record
  VDBCONTROL VDBCONTROL; // record
  VDTSREC VDTSREC; // record
  VMESSAGE VMESSAGE; // record
  VWORKSTOR VWORKSTOR ; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    AMA46P9-MAIN: AMA46P9-MAIN();
  end // end main
end // end AMA46A


// Close PCE File
Function AMA46P9-CLS-SRW1()
  try
    close SR-AMA46W1 ;
  end
  if (SR-AMA46W1 is ioError)
    VDBCONTROL.UPROC-NM = "AMA46P9-CLS-SRW1";
    VDBCONTROL.UPROC-OBJ = "SR-AMA46W1";
    VDBCONTROL.UPROC-OPT = "CLOSE";
    VDBCONTROL.UMSQLCODE = 0;
    VMESSAGE.UMSGINS[2] = "AMA46A";
    AMA46W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AMA46W.WS-ERR-LAST-FOUR;
    VDBCONTROL.UEZESQRRM = "PCEFILE FILE - I/O ERROR";
    WCM00P2-TO-CEP01A();
  end
  /* ** Changes due to PTR # 12596- end   ****/
end // end AMA46P9-CLS-SRW1


// Close PCE File
Function AMA46P9-CLS-SRW2()
  try
    close SR-AMA46W2 ;
  end
  if (SR-AMA46W2 is ioError)
    VDBCONTROL.UPROC-NM = "AMA46P9-CLS-SRW2";
    VDBCONTROL.UPROC-OBJ = "SR-AMA46W2";
    VDBCONTROL.UPROC-OPT = "CLOSE";
    VDBCONTROL.UMSQLCODE = 0;
    VMESSAGE.UMSGINS[2] = "AMA46A";
    AMA46W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AMA46W.WS-ERR-LAST-FOUR;
    VDBCONTROL.UEZESQRRM = "PCEFILE FILE - I/O ERROR";
    WCM00P2-TO-CEP01A();
  end
  /* ** Changes due to PTR # 12596- end   ****/
end // end AMA46P9-CLS-SRW2


// RETRIVE PCH DATA
Function AMA46P9-COPY-SR-W1()
  /* Read the input PCE-File and Write it to the output PCE-File*/
  /* as a copy.*/

  AMA46P9-READ-PCE();
  if (sysVar.sqlData.sqlcode == 0)
    /* Fetch first record*/
    while (SR-AMA46W1 not endOfFile)
      SR-AMA46W2.PCE-TOP-REC = SR-AMA46W1.PCE-TOP-REC;
      AMA46P9-WRIT-PCE();
      AMA46P9-READ-PCE();
    end
  end
  AMA46P9-CLS-SRW1();
  /*  */
end // end AMA46P9-COPY-SR-W1


// INITIALIZATION PROCESS
Function AMA46P9-INITIALIZE()
  VGVar.handleHardIOErrors = 1;
  /* Initailise working storage*/
  set AMA46W empty;
  set SR-AMA46W1 empty;
  set SR-AMA46W2 empty;
  set AMA46W2 empty;
  set AMA46W3 empty;
end // end AMA46P9-INITIALIZE


// SCAN PCE FILE
Function AMA46P9-INP-SCAN()
  /* ************************************************************************/
  /* This process scans the input file and stores it in the*/
  /* serial record*/
  /* ************************************************************************/
  /*  */
  try
    get next SR-AMA46W4 ;
  end
  /*  */
  if (SR-AMA46W4 is ioError)
    VMESSAGE.UMSGINS[2] = "AMA46A";
    VDBCONTROL.UPROC-NM = "AMA46P9-MAIN";
    VDBCONTROL.UPROC-OBJ = "SR-AMA46W4";
    VDBCONTROL.UPROC-OPT = "SCAN";
    VDBCONTROL.UMSQLCODE = 0;
    AMA46W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AMA46W.WS-ERR-LAST-FOUR;
    VDBCONTROL.UEZESQRRM = "INPUT PARAMETER FILE - I/O ERROR";
    WCM00P2-TO-CEP01A();
  end
end // end AMA46P9-INP-SCAN


// Main process
Function AMA46P9-MAIN()
  /* ************************************************************************/
  /* Main process for ama46a application, Reads the ARX04A extract file to*/
  /* insure all Office Codes, Case Loads, and Aid Codes have been included*/
  /* in the file for proper reporting in the MAABD reports AMA02A - AMA20A.*/
  /*  */
  /* 1. Initailise working storage*/
  /* 2. Scan input date file, same file as for ARX04A*/
  /* 3. Validate date fields read*/
  /* 4. Perform Verification process*/
  /* 5. End application*/
  /* ************************************************************************/
  /*  */
  /* Initailise working storage*/
  AMA46P9-INITIALIZE();
  /*  */
  /* Scan input date file*/
  AMA46P9-INP-SCAN();
  /*  */
  /* Validate input data (date validation)*/
  AMA46P9-VALIDATE();
  /*  */
  AMA46P9-COPY-SR-W1();

  /* Get program case history details process*/
  AMA46P9-VERIFY-PCE();
  /*  */
  /* Close PCEFILE*/
  AMA46P9-CLS-SRW2();
end // end AMA46P9-MAIN


// SCAN PCE FILE
Function AMA46P9-READ-PCE()
  /* Write into PCE file*/
  /*  */
  try
    get next SR-AMA46W1 ;
  end
  if (SR-AMA46W1 is ioError && SR-AMA46W1 not endOfFile)
    VDBCONTROL.UPROC-NM = "AMA46P9-READ-PCE";
    VDBCONTROL.UPROC-OBJ = "SR-AMA46W1";
    VDBCONTROL.UPROC-OPT = "SCAN";
    VMESSAGE.UMSGINS[2] = "AMA46A";
    VDBCONTROL.UMSQLCODE = 0;
    VMESSAGE.UMSGCODE = " ";
    AMA46W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AMA46W.WS-ERR-LAST-FOUR;
    VDBCONTROL.UEZESQRRM = "INPUT PARAMETER FILE - I/O ERROR";
    WCM00P2-TO-CEP01A();
  end
end // end AMA46P9-READ-PCE


// VALIDATE INPUT PARMS
Function AMA46P9-VALIDATE()
  /* ************************************************************************/
  /* Validate input parameter.*/
  /* ************************************************************************/

  /* ** Changes due to PTR # 11846 - start ****/

  VDBCONTROL.UPROC-NM = "AMA46P9-VALIDATE";
  VDBCONTROL.UPROC-OBJ = "SR-AMA46W4";
  VDBCONTROL.UPROC-OPT = "SCAN";
  VMESSAGE.UMSGINS[2] = "AMA46A";

  /* ** Changes due to PTR # 11846 - end   ****/

  /* Move serial record values to working storage*/

  AMA46W3.PI1-LST-DAY-MNTH = SR-AMA46W4.IN-DATE;
  AMA46W2.PI1-LST-DAY-MNTH-CCYY = AMA46W3.PI1-LST-DAY-MNTH-CCYY;
  AMA46W2.PI1-LST-DAY-MNTH-MM = AMA46W3.PI1-LST-DAY-MNTH-MM;
  AMA46W2.PI1-LST-DAY-MNTH-DD = AMA46W3.PI1-LST-DAY-MNTH-DD;
  AMA46W2.PL1-FIL1 = "-";
  AMA46W2.PL1-FIL2 = "-";
  /*  */
  VDTSREC.UDATMM = AMA46W2.PI1-LST-DAY-MNTH-MM;
  AMA46W.WS-LST-MM = AMA46W2.PI1-LST-DAY-MNTH-MM;
  VDTSREC.UDATDD = AMA46W2.PI1-LST-DAY-MNTH-DD;
  VDTSREC.UDATYY = AMA46W2.PI1-LST-DAY-MNTH-CCYY;
  AMA46W.WS-LST-YY = AMA46W2.PI1-LST-DAY-MNTH-CCYY;

  /*  */
  /* Call date validation routine*/
  call "WDT10A" (VCONTROL, VDTSREC) {isNoRefresh = yes};
  /*  */
  /* On date error exit application*/
  if (VCONTROL.URC != 0)

  /* ** Changes due to PTR # 11846 - start ****/
    VMESSAGE.UMSGCODE = "ARX0402E";
  /* **  MOVE 'INVALID INPUT PARAMETER - DATE' TO VDBCONTROL.UEZESQRRM;*/
  /* ** Changes due to PTR # 11846 - end   ****/

    WCM00P2-TO-CEP01A();
    exit program;
  end
  /*  */
  /* Display error if the date is not the last day of the month*/
  if ((AMA46W2.PI1-LST-DAY-MNTH-MM == 1
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 3
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 5
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 7
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 8
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 10
   || AMA46W2.PI1-LST-DAY-MNTH-MM == 12) && 
  AMA46W2.PI1-LST-DAY-MNTH-DD != 31)

  /* ** Changes due to PTR # 11846 - start ****/
    VMESSAGE.UMSGCODE = "ARX0403E";
  /* **  MOVE 'DATE ENTERED MUST BE LAST DATE OF THE MONTH'*/
  /* **    TO VDBCONTROL.UEZESQRRM;*/
  /* ** Changes due to PTR # 11846 - end   ****/

    WCM00P2-TO-CEP01A();
    exit program;
  else
    if ((AMA46W2.PI1-LST-DAY-MNTH-MM == 4
     || AMA46W2.PI1-LST-DAY-MNTH-MM == 6
     || AMA46W2.PI1-LST-DAY-MNTH-MM == 9
     || AMA46W2.PI1-LST-DAY-MNTH-MM == 11) && 
    AMA46W2.PI1-LST-DAY-MNTH-DD != 30)

  /* ** Changes due to PTR # 11846 - start ****/
      VMESSAGE.UMSGCODE = "ARX0403E";
  /* **    MOVE 'INPUT DATE MUST BE LAST DAY OF THE MONTH'*/
  /* **      TO VDBCONTROL.UEZESQRRM;*/
  /* ** Changes due to PTR # 11846 - end   ****/

      WCM00P2-TO-CEP01A();
      exit program;
    end
  end
  /*  */
  /* Check for leap year and check for last day of the month*/
  /* Display error if the date is not the last day of the month*/
  if (AMA46W2.PI1-LST-DAY-MNTH-MM == 2)
    AMA46W.WS-LEAP-FLAG = "N";
    AMA46W.WS-TEMP = AMA46W2.PI1-LST-DAY-MNTH-CCYY % 4;
    if ((AMA46W.WS-TEMP == 0))
      AMA46W.WS-TEMP = AMA46W2.PI1-LST-DAY-MNTH-CCYY % 100;
      if (AMA46W.WS-TEMP != 0)
        AMA46W.WS-LEAP-FLAG = "Y";
      else
        AMA46W.WS-TEMP = AMA46W2.PI1-LST-DAY-MNTH-CCYY % 400;
        if (AMA46W.WS-TEMP == 0)
          AMA46W.WS-LEAP-FLAG = "Y";
        end
      end
    end
  end
  /*  */
  /* If leap year then last day of the month should be checked for 29*/
  /* else 28.*/
  if ((AMA46W.WS-LEAP-FLAG == "Y" && 
  AMA46W2.PI1-LST-DAY-MNTH-DD != 29) || 
  (AMA46W.WS-LEAP-FLAG == "N" && 
  AMA46W2.PI1-LST-DAY-MNTH-DD != 28))

  /* ** Changes due to PTR # 11846 - start ****/
    VMESSAGE.UMSGCODE = "ARX0403E";
  /* **  MOVE 'INPUT DATE MUST BE LAST DAY OF THE MONTH'*/
  /* **    TO VDBCONTROL.UEZESQRRM;*/
  /* ** Changes due to PTR # 11846 - end   ****/

    WCM00P2-TO-CEP01A();
    exit program;
  end
end // end AMA46P9-VALIDATE


// RETRIVE PCH DATA
Function AMA46P9-VERIFY-PCE()
  /* Read TWNFAM_CASE_STATS to check if an entry for that ofc_cd/case_ld/*/
  /* aid_cd combination*/

  set SR-AMA46W2 empty;
  AMA46W.WS-EOF-FLAG = "N";

    /* Fetch first record*/
  AMA46P9-READ-PCE();
  AMA46Q1-S01();
  if (sysVar.sqlData.sqlcode == 0)
    AMA46Q1-S01-SCAN();
    AMA46W.WS-FAM-CASE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
    AMA46W.WS-FAME-CASE-CASLD = H2-FAM-CASE-STATS.CASLD;
    AMA46W.WS-FAME-CASE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
  end

  while (sysVar.sqlData.sqlcode == 0
   && AMA46W.WS-EOF-FLAG == "N")
    while (SR-AMA46W1 not endOfFile
     && sysVar.sqlData.sqlcode == 0)
      if (SR-AMA46W1.PCE-OFC-CD != AMA46W.WS-PREV-OFC-CD)
        AMA46W.WS-PCE-OFC-CD = SR-AMA46W1.PCE-OFC-CD;
        AMA46W.WS-PCE-CASELD = SR-AMA46W1.PCE-CASLD-ID;
        AMA46W.WS-PCE-AID-CD = SR-AMA46W1.PCE-AID-CD;

        while (AMA46W.WS-PCE-RECORD > AMA46W.WS-FAM-CASE-RECORD
         && sysVar.sqlData.sqlcode == 0)
          SR-AMA46W2.PCE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
          SR-AMA46W2.PCE-CASLD-ID = H2-FAM-CASE-STATS.CASLD;
          SR-AMA46W2.PCE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
          SR-AMA46W2.PCE-PRGM-CASE-TYPE = "MA";
          SR-AMA46W2.PCE-ACT-APPL-DT = "0001-01-01";
          SR-AMA46W2.PCE-APPL-DT = "0001-01-01";
          SR-AMA46W2.PCE-PRGM-STS-EFF-DT = "0001-01-01";
  /* -----------------------------------------------------------*/
  /* wds;wi25865;2003-12-03 - blanks causing "OC7" in production*/
          if (H2-FAM-CASE-STATS.OFC-CD != " "
           && H2-FAM-CASE-STATS.CASLD != " ")
            AMA46P9-WRIT-PCE();
          end
  /* -----------------------------------------------------------*/
          AMA46Q1-S01-SCAN();
          AMA46W.WS-FAM-CASE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
          AMA46W.WS-FAME-CASE-CASLD = H2-FAM-CASE-STATS.CASLD;
          AMA46W.WS-FAME-CASE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
        end
        if (AMA46W.WS-PCE-RECORD == AMA46W.WS-FAM-CASE-RECORD
         && sysVar.sqlData.sqlcode == 0)
          AMA46Q1-S01-SCAN(); /* Read again to compare next record*/
        end
        AMA46W.WS-PREV-OFC-CD = AMA46W.WS-FAM-CASE-OFC-CD;
        AMA46W.WS-PREV-CASELD = AMA46W.WS-FAME-CASE-CASLD;
        AMA46W.WS-PREV-AID-CD = AMA46W.WS-FAME-CASE-AID-CD;
      else
        if (SR-AMA46W1.PCE-CASLD-ID != AMA46W.WS-PREV-CASELD)
          AMA46W.WS-PCE-OFC-CD = SR-AMA46W1.PCE-OFC-CD;
          AMA46W.WS-PCE-CASELD = SR-AMA46W1.PCE-CASLD-ID;
          AMA46W.WS-PCE-AID-CD = SR-AMA46W1.PCE-AID-CD;

          while (AMA46W.WS-PCE-RECORD > AMA46W.WS-FAM-CASE-RECORD
           && sysVar.sqlData.sqlcode == 0)
            SR-AMA46W2.PCE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
            SR-AMA46W2.PCE-CASLD-ID = H2-FAM-CASE-STATS.CASLD;
            SR-AMA46W2.PCE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
            SR-AMA46W2.PCE-PRGM-CASE-TYPE = "MA";
            SR-AMA46W2.PCE-ACT-APPL-DT = "0001-01-01";
            SR-AMA46W2.PCE-APPL-DT = "0001-01-01";
            SR-AMA46W2.PCE-PRGM-STS-EFF-DT = "0001-01-01";
  /* -----------------------------------------------------------*/
  /* wds;wi25865;2003-12-03 - blanks causing "OC7" in production*/
            if (H2-FAM-CASE-STATS.OFC-CD != " "
             && H2-FAM-CASE-STATS.CASLD != " ")
              AMA46P9-WRIT-PCE();
            end
  /* -----------------------------------------------------------*/
            AMA46Q1-S01-SCAN();
            AMA46W.WS-FAM-CASE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
            AMA46W.WS-FAME-CASE-CASLD = H2-FAM-CASE-STATS.CASLD;
            AMA46W.WS-FAME-CASE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
          end
          if (AMA46W.WS-PCE-RECORD == AMA46W.WS-FAM-CASE-RECORD
           && sysVar.sqlData.sqlcode == 0)
            AMA46Q1-S01-SCAN(); /* Read again to compare next record*/
          end
          AMA46W.WS-PREV-CASELD = AMA46W.WS-FAME-CASE-CASLD;
          AMA46W.WS-PREV-AID-CD = AMA46W.WS-FAME-CASE-AID-CD;
        else
          if (SR-AMA46W1.PCE-AID-CD != AMA46W.WS-PREV-AID-CD)
            AMA46W.WS-PCE-OFC-CD = SR-AMA46W1.PCE-OFC-CD;
            AMA46W.WS-PCE-CASELD = SR-AMA46W1.PCE-CASLD-ID;
            AMA46W.WS-PCE-AID-CD = SR-AMA46W1.PCE-AID-CD;

            while (AMA46W.WS-PCE-RECORD > AMA46W.WS-FAM-CASE-RECORD
             && sysVar.sqlData.sqlcode == 0)
              SR-AMA46W2.PCE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
              SR-AMA46W2.PCE-CASLD-ID = H2-FAM-CASE-STATS.CASLD;
              SR-AMA46W2.PCE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
              SR-AMA46W2.PCE-PRGM-CASE-TYPE = "MA";
              SR-AMA46W2.PCE-ACT-APPL-DT = "0001-01-01";
              SR-AMA46W2.PCE-APPL-DT = "0001-01-01";
              SR-AMA46W2.PCE-PRGM-STS-EFF-DT = "0001-01-01";
  /* -----------------------------------------------------------*/
  /* wds;wi25865;2003-12-03 - blanks causing "OC7" in production*/
              if (H2-FAM-CASE-STATS.OFC-CD != " "
               && H2-FAM-CASE-STATS.CASLD != " ")
                AMA46P9-WRIT-PCE();
              end
  /* -----------------------------------------------------------*/
              AMA46Q1-S01-SCAN();
              AMA46W.WS-FAM-CASE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
              AMA46W.WS-FAME-CASE-CASLD = H2-FAM-CASE-STATS.CASLD;
              AMA46W.WS-FAME-CASE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
            end
            if (AMA46W.WS-PCE-RECORD == AMA46W.WS-FAM-CASE-RECORD
             && sysVar.sqlData.sqlcode == 0)
              AMA46Q1-S01-SCAN(); /* Read again to compare next record*/
            end
            AMA46W.WS-PREV-AID-CD = AMA46W.WS-FAME-CASE-AID-CD;
          end
        end
      end
      AMA46P9-READ-PCE();
      if (SR-AMA46W1 is endOfFile)
        AMA46W.WS-EOF-FLAG = "Y";
      end
    end
  end

  /* Write any rows still left in TWNFAM_CASE_STATS once PCE file is EOF*/

  if (SR-AMA46W1 is endOfFile && sysVar.sqlData.sqlcode == 0)
    while (sysVar.sqlData.sqlcode == 0)
      SR-AMA46W2.PCE-OFC-CD = H2-FAM-CASE-STATS.OFC-CD;
      SR-AMA46W2.PCE-CASLD-ID = H2-FAM-CASE-STATS.CASLD;
      SR-AMA46W2.PCE-AID-CD = H2-FAM-CASE-STATS.AID-CD;
      SR-AMA46W2.PCE-PRGM-CASE-TYPE = "MA";
      SR-AMA46W2.PCE-ACT-APPL-DT = "0001-01-01";
      SR-AMA46W2.PCE-APPL-DT = "0001-01-01";
      SR-AMA46W2.PCE-PRGM-STS-EFF-DT = "0001-01-01";
  /* -----------------------------------------------------------*/
  /* wds;wi25865;2003-12-03 - blanks causing "OC7" in production*/
      if (H2-FAM-CASE-STATS.OFC-CD != " "
       && H2-FAM-CASE-STATS.CASLD != " ")
        AMA46P9-WRIT-PCE();
      end
  /* -----------------------------------------------------------*/
      AMA46Q1-S01-SCAN();
    end
  end
end // end AMA46P9-VERIFY-PCE


// WRITE PCE FILE
Function AMA46P9-WRIT-PCE()
  /* Write into PCE file*/
  /*  */
  try
    add SR-AMA46W2 ;
  end
  if (SR-AMA46W2 is ioError)
    VDBCONTROL.UPROC-NM = "AMA46P9-WRIT-PCE";
    VDBCONTROL.UPROC-OBJ = "SR-AMA46W2";
    VDBCONTROL.UPROC-OPT = "ADD";
    VMESSAGE.UMSGINS[2] = "AMA46A";
    VDBCONTROL.UMSQLCODE = 0;
    VMESSAGE.UMSGCODE = " ";
    AMA46W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AMA46W.WS-ERR-LAST-FOUR;
    VDBCONTROL.UEZESQRRM = "INPUT PARAMETER FILE - I/O ERROR";
    WCM00P2-TO-CEP01A();
  end
end // end AMA46P9-WRIT-PCE


// TABLE SETINQ
Function AMA46Q1-S01()
  /* cbsi start*/
  VDBCOMMON.USQLREC = "H2-FAM-CASE-STATS";
  VDBCONTROL.UPROC-NM = "AMA46Q1-S01";
  VDBCONTROL.UPROC-OPT = "SETINQ";
  VDBCONTROL.UPROC-OBJ = "H2-FAM-CASE-STATS";
  VDBCONTROL.URC = 0;
  try
    open AMA46Q1-S01_RSI01
      with #sql{
        select DISTINCT OFC_CD, CASLD, AID_CD
        from TWNFAM_CASE_STATS T1
        WHERE
         --     CASLD = :CASLD
             YR    = :AMA46W.WS-LST-YY
        AND  MTH   = :AMA46W.WS-LST-MM
         --AND AID_CD = :AID-CD
         --AND OFC_CD = :OFC-CD
        ORDER BY OFC_CD ASC, CASLD ASC, AID_CD ASC
         --** INSERT ORDER BY CLAUSE HERE **
      }      
      into OFC-CD, CASLD, AID-CD
      for H2-FAM-CASE-STATS ;
  end
  /* perform process to set vdbcontrol.urc*/
  if (sysVar.sqlData.sqlcode != 0)
    REPP9-SQL-CHKERR();
  end
  /* cbsi end*/
end // end AMA46Q1-S01


// TABLE SCAN
Function AMA46Q1-S01-SCAN()
  /* cbsi start*/
  VDBCOMMON.USQLREC = "H2-FAM-CASE-STATS";
  VDBCONTROL.UPROC-NM = "AMA46Q1-S01-SCAN";
  VDBCONTROL.UPROC-OPT = "SCAN";
  VDBCONTROL.UPROC-OBJ = "H2-FAM-CASE-STATS";
  VDBCONTROL.URC = 0;
  try
    get next H2-FAM-CASE-STATS ;
  end
  /* perform process to set vdbcontrol.urc*/
  if (sysVar.sqlData.sqlcode != 0)
    REPP9-SQL-CHKERR();
  end
  /* cbsi end*/
end // end AMA46Q1-S01-SCAN


Record AMA46W type basicRecord
  10 WS-PREV-OFC-CD char(2) ; 
  10 WS-PREV-CASELD char(5) ; 
  10 WS-PREV-AID-CD char(3) ; 
  10 WS-PCE-RECORD char(10) ; 
    15 WS-PCE-OFC-CD char(2) ; 
    15 WS-PCE-CASELD char(5) ; 
    15 WS-PCE-AID-CD char(3) ; 
  10 WS-FAM-CASE-RECORD char(10) ; 
    15 WS-FAM-CASE-OFC-CD char(2) ; 
    15 WS-FAME-CASE-CASLD char(5) ; 
    15 WS-FAME-CASE-AID-CD char(3) ; 
  10 WS-FCS-COUNT smallint ; 
  10 WS-PCH-COUNT smallint ; 
  10 WS-FOUND-FLG char(1) ; 
  10 WS-S01-SQL-CD num(3) ; 
  10 WS-S05-SQL-CD num(3) ; 
  10 WS-LST-YY smallint ; 
  10 WS-LST-MM smallint ; 
  10 WS-INC smallint ; 
  10 WS-FLAG char(1) ; 
  10 WS-COUNT1 smallint ; 
  10 WS-TEMP num(4) ; 
  10 WS-SQCOD num(9) ; 
  10 WS-LEAP-FLAG char(1) ; 
  10 WS-UROWR int ; 
  10 WS-INIT-APRVL-DT char(10) ; 
  10 WS-ERR-CD char(8) ; 
    15 WS-ERR-FIRST-FOUR char(4) ; 
    15 WS-ERR-LAST-FOUR char(4) ; 
  10 WS-EOF-FLAG char(1) ; 
end // end AMA46W


Record AMA46W2 type basicRecord
  10 PI1-LST-DAY-MNTH char(10) ; 
    15 PI1-LST-DAY-MNTH-CCYY num(4) ; 
    15 PL1-FIL1 char(1) ; 
    15 PI1-LST-DAY-MNTH-MM num(2) ; 
    15 PL1-FIL2 char(1) ; 
    15 PI1-LST-DAY-MNTH-DD num(2) ; 
end // end AMA46W2


Record AMA46W3 type basicRecord
  10 PI1-LST-DAY-MNTH char(8) ; 
    15 PI1-LST-DAY-MNTH-CCYY num(4) ; 
    15 PI1-LST-DAY-MNTH-MM num(2) ; 
    15 PI1-LST-DAY-MNTH-DD num(2) ; 
end // end AMA46W3


