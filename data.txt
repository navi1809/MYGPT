package gov.nv.dwss.fsc.util;

import java.time.LocalDate;
import java.time.Period;
import java.util.Map;

public class AgeCategoryProcessor {

    public void processMember(
            LocalDate dob,
            boolean isDisqualified,
            LocalDate reportDate,
            Map<String, Integer> ageCategoryCounts
    ) {
        if (isDisqualified || dob == null || reportDate == null) {
            return;
        }

        int age = calculateAge(dob, reportDate);
        String category = getAgeCategoryLabel(age);
        incrementCategoryCount(ageCategoryCounts, category);
    }

    private int calculateAge(LocalDate dob, LocalDate reportDate) {
        return Period.between(dob, reportDate).getYears();
    }

    private String getAgeCategoryLabel(int age) {
        if (age <= 5) return "0-5";
        if (age == 6) return "6";
        if (age <= 12) return "7-12";
        if (age <= 15) return "13-15";
        if (age <= 17) return "16-17";
        if (age <= 20) return "18-20";
        if (age <= 25) return "21-25";
        if (age <= 30) return "26-30";
        if (age <= 35) return "31-35";
        if (age <= 40) return "36-40";
        if (age <= 45) return "41-45";
        if (age <= 50) return "46-50";
        if (age <= 55) return "51-55";
        if (age <= 59) return "56-59";
        return "60+";
    }

    private void incrementCategoryCount(Map<String, Integer> map, String category) {
        map.put(category, map.getOrDefault(category, 0) + 1);
    }
}
