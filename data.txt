public void processEthnicity(H2Person person, EthnicityContext context) {
    String ethCode = person.getEthnicityCode();
    String sexCode = person.getSexCode();

    boolean validEthCode = ethCode != null && !ethCode.isBlank()
            && !"U".equalsIgnoreCase(ethCode)
            && !"?".equals(ethCode);

    String ethnicity = "UNKNOWN";

    if (validEthCode && context.getValidEthnicityCodes().contains(ethCode)) {
        ethnicity = context.getCodeToDescription().getOrDefault(ethCode, "UNKNOWN");

        increment(context.getTotalMap(), ethnicity);
        if ("F".equalsIgnoreCase(sexCode)) {
            increment(context.getFemaleMap(), ethnicity);
        } else if ("M".equalsIgnoreCase(sexCode)) {
            increment(context.getMaleMap(), ethnicity);
        }

    } else if (context.getEthnicityDescriptions().contains("UNKNOWN")) {
        increment(context.getTotalMap(), ethnicity);
        if ("F".equalsIgnoreCase(sexCode)) {
            increment(context.getFemaleMap(), ethnicity);
        } else if ("M".equalsIgnoreCase(sexCode)) {
            increment(context.getMaleMap(), ethnicity);
        }
    }
}
