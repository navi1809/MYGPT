// ADD SDX DETAILS ROW
Function AIN22P9-INS4()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-SDX-SSI-BNFDTL";
  VDBCONTROL.UPROC-OBJ = "H2-SDX-SSI-BNFDTL";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS4";
  VDBCONTROL.UPROC-OPT = "ADD";
  /* PTR 9589 REMOVE DATEAPP CALL ---------- 02/05/97 ------*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  H2-SDX-SSI-BNFDTL.MAABD-APPL-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-SDX-SSI-BNFDTL.MAABD-ELIG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-SDX-SSI-BNFDTL.MAIL-ST-RES-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-SDX-SSI-BNFDTL.MEDIC-EFF-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H2-SDX-SSI-BNFDTL.RPYMT-PYE-ACTBG-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  try
    add H2-SDX-SSI-BNFDTL
      with #sql{
        insert into TWNSDX_SSI_BNFDTL
        (UPI,
             PROCESS_DT,
             LST_NM,
             FRST_NM,
             MID_INIT,
             ADR_LINE3,
             ADR_LINE2,
             ADR_LINE1,
             ZIP_CD,
             RESID_ADR_LINE3,
        RESID_ADR_LINE2,
             RESID_ADR_LINE1,
             SPS_PRNT_SSN,
             APEAL_DT,
             ELIG_DT,
            APPL_FILNG_DT,
            PB_LAW_CD,
            APL_DT,
            DSBLD_PYMT_CD,
            APEAL_STS_CD,
            RSDN_DT,
            FED_LIVNG_ARGMT_CD,
            ST_LIVNG_ARGMT_CD,
            OUT_OF_ST_MVD_IND,
            PYMT_STS_CD,
            PYMT_TYP,
            PYMT_STS_RSN_CD,
            DSBLD_ONSET_DT,
            SSI_DNIAL_DT,
            EARND_INCM_AMT,
            SSI_PD_AMT,
            SSI_ELIG_AMT,
            UERND_INCM_AMT,
            SUP_PD_AMT,
            SUP_ELIG_AMT,
            EXCLD_INCM_AMT,
            DT_OF_BIRTH,
            SEX,
            DTH_DT,
            SDX_TRN_CD,
            SDX_TRN_DT,
            SDX_TRN_TYP,
            REC_ID,
            REP_PYEE_TYP_CD,
            T30_REACC_CD,
            SSN_XREF_NUM,
            CNDTL_PYMT_CD,
            DRGAL_ADDCT_CD,
            ST_MAND_ELIG_CD,
            FED_SSI_ELIG_STAT,
            REIMB_ST_CNTY_CD,
            MTH_OF_EARND_INC,
            YR_OF_EARND_INC,
            SELF_EMP_EST_AMT,
            SELF_SUPL_EXCL_AMT,
            COMP_MTH_EARND_INC,
            COMP_MTH_UERND_INC,
            COMP_MTH_DEEMD_INC,
            BDGT_MTH_EARND_INC,
            BDGT_MTH_UERND_INC,
            BDGT_MTH_DEEMD_INC,
            ALN_RES_DT,
            ORG_CNTRY_CD,
            ALN_STS,
            STDNT_IND,
            SSI_LVAR_COMP_MOCD,
            BUDGT_MTH_CD,
            HOUSE_RSRCS,
            PRPTY_RSRCS,
            VHCLE_RSRCS,
            CHILD_RSRCS,
            INSU_RSRCS,
            SEX_ERR_IND,
            DOB_ERR_IND,
            ZIP_CD_ERR_IND,
            PYMT_STSCD_ERR_IND,
            PBLIC_LAW_ERR_IND,
            UERND_INCM_ERR_IND,
            TAPE_PRCSG_DT, FS_EFF_DT, MAABD_APPL_DT,MAABD_ELIG_DT,
            MAIL_ST_RES_DT,MEDIC_EFF_DT,RPYMT_PYE_ACTBG_DT,DOB)
        values (:UPI,
             :PROCESS-DT,
             :LST-NM,
             :FRST-NM,
             :MID-INIT,
             :ADR-LINE3,
             :ADR-LINE2,
             :ADR-LINE1,
             :ZIP-CD,
             :RESID-ADR-LINE3,
             :RESID-ADR-LINE2,
             :RESID-ADR-LINE1,
             :SPS-PRNT-SSN,
             :APEAL-DT,
             :ELIG-DT,
             :APPL-FILNG-DT,
             :PB-LAW-CD,
             :APL-DT,
             :DSBLD-PYMT-CD,
             :APEAL-STS-CD,
             :RSDN-DT,
             :FED-LIVNG-ARGMT-CD,
             :ST-LIVNG-ARGMT-CD,
             :OUT-OF-ST-MVD-IND,
             :PYMT-STS-CD,
             :PYMT-TYP,
             :PYMT-STS-RSN-CD,
             :DSBLD-ONSET-DT,
             :SSI-DNIAL-DT,
             :EARND-INCM-AMT,
             :SSI-PD-AMT,
             :SSI-ELIG-AMT,
             :UERND-INCM-AMT,
             :SUP-PD-AMT,
             :SUP-ELIG-AMT,
             :EXCLD-INCM-AMT,
             :DT-OF-BIRTH,
             :SEX,
             :DTH-DT,
             :SDX-TRN-CD,
             :SDX-TRN-DT,
             :SDX-TRN-TYP,
             :REC-ID,
             :REP-PYEE-TYP-CD,
             :T30-REACC-CD,
             :SSN-XREF-NUM,
             :CNDTL-PYMT-CD,
             :DRGAL-ADDCT-CD,
             :ST-MAND-ELIG-CD,
             :FED-SSI-ELIG-STAT,
             :REIMB-ST-CNTY-CD,
             :MTH-OF-EARND-INC,
             :YR-OF-EARND-INC,
             :SELF-EMP-EST-AMT,
             :SELF-SUPL-EXCL-AMT,
             :COMP-MTH-EARND-INC,
             :COMP-MTH-UERND-INC,
             :COMP-MTH-DEEMD-INC,
             :BDGT-MTH-EARND-INC,
             :BDGT-MTH-UERND-INC,
             :BDGT-MTH-DEEMD-INC,
             :ALN-RES-DT,
             :ORG-CNTRY-CD,
             :ALN-STS,
             :STDNT-IND,
             :SSI-LVAR-COMP-MOCD,
             :BUDGT-MTH-CD,
             :HOUSE-RSRCS,
             :PRPTY-RSRCS,
             :VHCLE-RSRCS,
             :CHILD-RSRCS,
             :INSU-RSRCS,
             :SEX-ERR-IND,
             :DOB-ERR-IND,
             :ZIP-CD-ERR-IND,
             :PYMT-STSCD-ERR-IND,
             :PBLIC-LAW-ERR-IND,
             :UERND-INCM-ERR-IND,
             :TAPE-PRCSG-DT, :FS-EFF-DT ,:MAABD-APPL-DT, :MAABD-ELIG-DT,
             :MAIL-ST-RES-DT, :MEDIC-EFF-DT, :RPYMT-PYE-ACTBG-DT,
             :DOB)
      } ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INS4


// ADD SDX UNEARND INC INFO
Function AIN22P9-INS5()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/08/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-SDXI-UERND-INCM";
  VDBCONTROL.UPROC-OBJ = "H2-SDXI-UERND-INCM";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS5";
  VDBCONTROL.UPROC-OPT = "ADD";
  move H2-SDXI-UERND-INCM to H2-SDXI-UERND-INCM byName;
  try
    add H2-SDXI-UERND-INCM
      with #sql{
        insert into TWNSDXI_UERND_INCM
        (UPI, PROCESS_DT, UERND_INCM_TYP, UERND_INC_BEG_DT,
            UERND_INC_END_DT, UERND_INC_AMT, PYMT_FREQ, CLM_ID, VERF_CD)
        values (:UPI, :PROCESS-DT, :UERND-INCM-TYP, :UERND-INC-BEG-DT,
            :UERND-INC-END-DT, :UERND-INC-AMT, :PYMT-FREQ, :CLM-ID, :VERF-CD)
      } ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INS5


// INSERT A CASE_LOG ROW
Function AIN22P9-INS6()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* CBSI START*/

  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-CASE-LOG";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-LOG";
  VDBCONTROL.UPROC-NM = "AIN22P9-INS6";
  VDBCONTROL.UPROC-OPT = "ADD";

  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  try
    add H2-CASE-LOG
      with #sql{
        insert into TWNCASE_LOG
        (ICI, ACTVY_DT, LOG_CRN_TS, PRGM_CASE_TYPE, ACTVY_TM,
             LOG_ENTRY_DESC, LOG_ENTRY_TYPE, CL_ACTVY_DESC)
        values (:ICI, :ACTVY-DT,:GDW.TS, :PRGM-CASE-TYPE, :ACTVY-TM,
            :LOG-ENTRY-DESC, :LOG-ENTRY-TYPE, :CL-ACTVY-DESC)
      } ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end AIN22P9-INS6


// POP H-TFSL REC & INS
Function AIN22P9-INSUID-FSL()
  /*  */
  /* ************************************************************************/
  /* Add automated Screen-level Case Log for all UNIN fields...*/
  /* ************************************************************************/

  set H-TFSLI1 empty;

  H-TFSLI1.UPI = H2-UERND-INCM-DTL.UPI;
  H-TFSLI1.ICI = AIN22W-ICI-ARRAY.IWS-ICI[IWS-ARRAY-IDX];
  H-TFSLI1.SCRN-ID = "UNIN";
  H-TFSLI1.WRKR-ID = "SDX";
  H-TFSLI1.ACTVY-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  H-TFSLI1.STAT-LOG-DESC = AIN22W-UNIN-W1.WS-AUTO-MSG;

  call "TFSLI1A" (VDBCONTROL, VMESSAGE, H-TFSLI1) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  /*  */
end // end AIN22P9-INSUID-FSL


// INS-UPD-UNEARN-INC
Function AIN22P9-IUP-UEN()
  /*  */
  AIN22W.WS-ERR-UERND-INC-AMT = "F";
  if (AIN22W.WS-UERND-REC-EXIST == "T")
    AIN22W.WS-UNIN-BEG-DT = H2-UERND-INCM-DTL.PRD-BEG-DT;
    AIN22W.WS-UNIN-END-DT = H2-UERND-INCM-DTL.PRD-END-DT;
  end
  if (AIN22W.WS-UERND-REC-EXIST == "T")
    if (AIN22W.WS-NUMBER-OF-RECS == 1)

      set AIN22W-UNIN-NEW empty; /* WI 27488*/
      set AIN22W-UNIN-OLD empty; /* WI 27488*/
      AIN22P9-UNIN-OLD(); /* WI 27488*/

  /* ***/
  /* ** if the month and year of prd beg dt of the interface record*/
  /* ** matches with the prd beg dt of the unin record, then the*/
  /* ** existing record is overwritten provided the difference in*/
  /* ** amount is beyond the tolerance limit*/
  /*  */
  /* IF THE SDX START IS BEFORE THE CURRENT UNIN START THEN UPDATE*/
  /* also,the uernd-incm-amt is stored in the prev-amt is field whenever*/
  /* this field is updated on twnuernd_incm_dtl table as a result of*/
  /* data received from the interface*/
  /*  */
      if ((AIN22W.WS-UERND-INCM-AMT != H2-UERND-INCM-DTL.UERND-INC-AMT))
        set H2-UERND-INCM-DTL empty;
        if ((AIN22W.WS-MTH-UNIN-BEG-DT >= AIN22W.WS-NOMADS-PROCESS-MM && 
        AIN22W.WS-YEAR-UNIN-BEG-DT == AIN22W.WS-NOMADS-PROCESS-CCYY) || 
        AIN22W.WS-YEAR-UNIN-BEG-DT > AIN22W.WS-NOMADS-PROCESS-CCYY)
          if (AIN22W.WS-UNIN-END-DT != "9999-12-31")
            AIN22W.WS-ALERT-FLAG = "T";
            return;
          end
          if ((AIN22W.WS-MTH-UNIN-BEG-DT == AIN22W.WS-NOMADS-PROCESS-MM && 
          AIN22W.WS-YEAR-UNIN-BEG-DT == AIN22W.WS-NOMADS-PROCESS-CCYY))
            if (AIN22W.WS-TOLERANCE-LIMIT-FLAG == "F")
              H2-UERND-INCM-DTL.PREV-AMT = AIN22W.WS-PREV-AMT;
              H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
              H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
              H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-PRD-BEG-DT;
              H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-UERND-INCM-AMT;
  /* * 20178*/
  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
              H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-SEQ-NMBR;
  /* * 20178*/
              H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
              H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
              AIN22W.WS-ERR-UERND-INC-AMT = "T";
              AIN22W2.WS-DATE-CCYY = AIN22W.WS-NOMADS-PROCESS-CCYY;
              AIN22W2.WS-DATE-MM = AIN22W.WS-NOMADS-PROCESS-MM;
              AIN22P9-LAST-DAY();
              H2-UERND-INCM-DTL.PRD-END-DT = AIN22W.WS-UNIN-END-DT;
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
              H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/

              AIN22P9-UPD1();

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
              if (sysVar.sqlData.sqlcode == 0)
                AIN22P9-UNIN-NEW();
                AIN22P9-UNIN-SLOG();
                AIN22P9-INSUID-FSL();
              end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

  /* MOVE AIN22W.WS-RECOVER-AMOUNT TO*/
  /* H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'Y' TO H2-UERND-INCM-DTL.FS-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.AFDC-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.MA-CNTBL-CD;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 0 TO H2-UERND-INCM-DTL.FS-CNTBL-AMT;*/
  /* MOVE '42' TO H2-UERND-INCM-DTL.UERND-INC-TYPE-CD;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'T' TO AIN22W.WS-ERR-UERND-INC-AMT;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-UNIN-END-DT TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS2-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS2-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS2-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F2;*/
  /* IF AIN22W.WS-SYS2-MM = 12;*/
  /* AIN22W.WS-SYS2-MM = 01;*/
  /* AIN22W.WS-SYS2-YR = AIN22W.WS-SYS2-YR + 1;*/
  /* ELSE;*/
  /* AIN22W.WS-SYS2-MM = AIN22W.WS-SYS2-MM + 1;*/
  /* END;*/
  /* MOVE AIN22W.WS-SYS2-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
  /* MOVE '9999-12-31' TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* PERFORM AIN22P9-INS2;*/
            else
              H2-UERND-INCM-DTL.PREV-AMT = AIN22W.WS-PREV-AMT;
              H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
              H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
              H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-PRD-BEG-DT;
              H2-UERND-INCM-DTL.INCM-SQ-NMB = 01;

  /* * 20178*/

  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
              H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-SEQ-NMBR;

  /* * 20178*/

              H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
              H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
              AIN22W2.WS-DATE-CCYY = AIN22W.WS-NOMADS-PROCESS-CCYY;
              AIN22W2.WS-DATE-MM = AIN22W.WS-NOMADS-PROCESS-MM;
              AIN22P9-LAST-DAY();
              H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-UERND-INCM-AMT;
              H2-UERND-INCM-DTL.PRD-END-DT = AIN22W.WS-UNIN-END-DT;
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
              H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/

              AIN22P9-UPD1();

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
              if (sysVar.sqlData.sqlcode == 0)
                AIN22P9-UNIN-NEW();
                AIN22P9-UNIN-SLOG();
                AIN22P9-INSUID-FSL();
              end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

  /* MOVE AIN22W.WS-RECOVER-AMOUNT TO*/
  /* H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'Y' TO H2-UERND-INCM-DTL.FS-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.AFDC-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.MA-CNTBL-CD;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 0 TO H2-UERND-INCM-DTL.FS-CNTBL-AMT;*/
  /* MOVE '42' TO H2-UERND-INCM-DTL.UERND-INC-TYPE-CD;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'T' TO AIN22W.WS-ERR-UERND-INC-AMT;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-UNIN-END-DT TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS2-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS2-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS2-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS2-F2;*/
  /* IF AIN22W.WS-SYS2-MM = 12;*/
  /* AIN22W.WS-SYS2-MM = 01;*/
  /* AIN22W.WS-SYS2-YR = AIN22W.WS-SYS2-YR + 1;*/
  /* ELSE;*/
  /* AIN22W.WS-SYS2-MM = AIN22W.WS-SYS2-MM + 1;*/
  /* END;*/
  /* MOVE AIN22W.WS-SYS2-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
  /* MOVE '9999-12-31' TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* PERFORM AIN22P9-INS2;*/
            end
          else
            if (AIN22W.WS-TOLERANCE-LIMIT-FLAG == "F")
              H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
              H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
              H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-PRD-BEG-DT;
              H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-UERND-INCM-AMT;
  /* MOVE 01 TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/

  /* * 20178*/

  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
              H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-SEQ-NMBR;

  /* * 20178*/

              H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
              H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
              AIN22W.WS-ERR-UERND-INC-AMT = "T";
  /* MOVE AIN22W.WS-UNIN-BEG-DT TO AIN22W.WS-DATE;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
              H2-UERND-INCM-DTL.PRD-END-DT = AIN22W.WS-UNIN-END-DT;
              H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/

              AIN22P9-UPD1();

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
              if (sysVar.sqlData.sqlcode == 0)
                AIN22P9-UNIN-NEW();
                AIN22P9-UNIN-SLOG();
                AIN22P9-INSUID-FSL();
              end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

  /* MOVE AIN22W.WS-PREV-AMT TO H2-UERND-INCM-DTL.PREV-AMT;*/
  /* MOVE AIN22W.WS-RECOVER-AMOUNT TO*/
  /* H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'Y' TO H2-UERND-INCM-DTL.FS-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.AFDC-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.MA-CNTBL-CD;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 01 TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
  /* MOVE 0 TO H2-UERND-INCM-DTL.FS-CNTBL-AMT;*/
  /* MOVE '42' TO H2-UERND-INCM-DTL.UERND-INC-TYPE-CD;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'T' TO AIN22W.WS-ERR-UERND-INC-AMT;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-UNIN-END-DT TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* MOVE AIN22W.WS-MTH-UNIN-BEG-DT TO AIN22W2.WS-DATE-MM;*/
  /* MOVE AIN22W.WS-YEAR-UNIN-BEG-DT TO AIN22W2.WS-DATE-CCYY;*/
  /* MOVE 01 TO AIN22W2.WS-DATE-DD;*/
  /* MOVE AIN22W.WS-UNIN-BEG-DT TO AIN22W2.WS-DATE;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS1-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS1-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS1-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F2;*/
  /* MOVE AIN22W.WS-SYS1-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /*  */
  /* * 20178*/
  /*  */
  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
  /*  */
  /* * 20178*/
  /*  */
  /* *       MOVE AIN22W.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* PERFORM AIN22P9-INS2;*/
            else
              H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
              H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
              H2-UERND-INCM-DTL.INCM-SQ-NMB = 01;
              H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
              H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
              H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-PRD-BEG-DT;

  /* * 20178*/

  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
              H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-SEQ-NMBR;

  /* * 20178*/

  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-DUM-MM;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-DUM-YR;*/
  /* PERFORM AIN22P9-DATE-PROC;*/
  /* MOVE AIN22W.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
              H2-UERND-INCM-DTL.PRD-END-DT = AIN22W.WS-UNIN-END-DT;
              H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/

              AIN22P9-UPD1();

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
              if (sysVar.sqlData.sqlcode == 0)
                AIN22P9-UNIN-NEW();
                AIN22P9-UNIN-SLOG();
                AIN22P9-INSUID-FSL();
              end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

  /* MOVE AIN22W.WS-RECOVER-AMOUNT TO*/
  /* H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT;*/
  /* MOVE AIN22W.WS-UPI TO H2-UERND-INCM-DTL.UPI;*/
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO*/
  /* H2-UERND-INCM-DTL.UERND-INC-AMT;*/
  /* MOVE 01 TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/
  /* MOVE 'M' TO H2-UERND-INCM-DTL.UERND-INC-FREQ;*/
  /* MOVE 'Y' TO H2-UERND-INCM-DTL.FS-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.AFDC-CNTBL-IND;*/
  /* MOVE 'N' TO H2-UERND-INCM-DTL.MA-CNTBL-CD;*/
  /* MOVE '42' TO H2-UERND-INCM-DTL.UERND-INC-TYPE-CD;*/
  /* MOVE AIN22W.WS-PRD-BEG-DT TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /* MOVE AIN22W.WS-MTH-UNIN-BEG-DT TO AIN22W2.WS-DATE-MM;*/
  /* MOVE AIN22W.WS-YEAR-UNIN-BEG-DT TO AIN22W2.WS-DATE-CCYY;*/
  /* MOVE 01 TO AIN22W2.WS-DATE-DD;*/
  /* MOVE AIN22W.WS-UNIN-BEG-DT TO AIN22W2.WS-DATE;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W.WS-SYS1-YR;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W.WS-SYS1-MM;*/
  /* MOVE '01' TO AIN22W.WS-SYS1-DD;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F2;*/
  /* MOVE AIN22W.WS-SYS1-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/

  /* * 20178*/

  /* PERFORM AIN22P9-GET-MAX-SQ;*/
  /* MOVE AIN22W.WS-MAX-SQ-NMB TO H2-UERND-INCM-DTL.INCM-SQ-NMB;*/

  /* * 20178*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-CCYY TO AIN22W2.WS-DATE-CCYY;*/
  /* MOVE AIN22W.WS-NOMADS-PROCESS-MM TO AIN22W2.WS-DATE-MM;*/
  /* PERFORM AIN22P9-DATE-PROC;*/
  /* PERFORM AIN22P9-LAST-DAY;*/

  /* MOVE '9999-12-31' TO H2-UERND-INCM-DTL.PRD-END-DT;*/
  /* PERFORM AIN22P9-INS2;*/
            end
          end
        else
          if (AIN22W.WS-UNIN-END-DT != "9999-12-31")
            AIN22W.WS-ALERT-FLAG = "T";
            return;
          end
          if (AIN22W.WS-TOLERANCE-LIMIT-FLAG == "T")
            return;
          end
  /* **/
  /* * the prd end date of the existing record read is updated and a*/
  /* * a new record is inserted with max end date*/
  /* **/
  /* KEY-SETTING-PROCESS*/
          H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
          H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";

      /*  */
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
          H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-PRD-BEG-DT;
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
          H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-SEQ-NMBR;

          H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-UERND-INCM-AMT;
          H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
          H2-UERND-INCM-DTL.FS-CNTBL-IND = "Y";
          H2-UERND-INCM-DTL.AFDC-CNTBL-IND = "N";
          H2-UERND-INCM-DTL.MA-CNTBL-CD = "N";
          AIN22W.WS-ERR-UERND-INC-AMT = "T";
          H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
          H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
          H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
          H2-UERND-INCM-DTL.PRD-END-DT = "9999-12-31";

          AIN22P9-QUERY-S09();
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
          if (sysVar.sqlData.sqlcode == 0)

            set AIN22W-UNIN-NEW empty; /* WI 27488*/
            set AIN22W-UNIN-OLD empty; /* WI 27488*/
            AIN22P9-UNIN-OLD(); /* WI 27488*/


  /* MOVE AIN22W.WS-PRD-BEG-DT TO AIN22W2.WS-DATE;*/
            AIN22W2.WS-DATE-CCYY = AIN22W.WS-NOMADS-PROCESS-CCYY;
            AIN22W2.WS-DATE-MM = AIN22W.WS-NOMADS-PROCESS-MM;
            AIN22W2.WS-DATE-DD = AIN22W.WS-NOMADS-PROCESS-DD;
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO AIN22W2.WS-DATE;*/
            AIN22P9-LAST-DATE();
            H2-UERND-INCM-DTL.PRD-END-DT = AIN22W2.WS-PREV-DATE;
   /* ***/
            AIN22W.WS-PREV-AMT = H2-UERND-INCM-DTL.UERND-INC-AMT;
            H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/
   /* ****/
            AIN22P9-UPD4();
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
            if (sysVar.sqlData.sqlcode == 0)
              AIN22P9-UNIN-NEW();
              AIN22P9-UNIN-SLOG();
              AIN22P9-INSUID-FSL();
            end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

  /* ***/
  /* ** a new record is inserted. the Unearned income amount of the*/
  /* ** previous record is moved to the previous amount of the*/
  /* ** current record*/
  /* ***/
            H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
            H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = "42";
            AIN22W.WS-SYS1-YR = AIN22W.WS-NOMADS-PROCESS-CCYY;
            AIN22W.WS-SYS1-MM = AIN22W.WS-NOMADS-PROCESS-MM;
            AIN22W.WS-SYS1-DD = "01";
            AIN22W.WS-SYS1-F1 = "-";
            AIN22W.WS-SYS1-F2 = "-";
            H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-SYS1-DATE;

  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO*/
  /* H2-UERND-INCM-DTL.PRD-BEG-DT;*/
  /*  */
            AIN22P9-GET-MAX-SQ();
            H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-MAX-SQ-NMB;

            H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-UERND-INCM-AMT;
  /*  */
  /* ***/
            H2-UERND-INCM-DTL.PREV-AMT = AIN22W.WS-PREV-AMT;
  /* ***/
            H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
            H2-UERND-INCM-DTL.FS-CNTBL-IND = "Y";
            H2-UERND-INCM-DTL.AFDC-CNTBL-IND = "N";
            H2-UERND-INCM-DTL.MA-CNTBL-CD = "N";
            H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = AIN22W.WS-RECOVER-AMOUNT;
            H2-UERND-INCM-DTL.PRD-END-DT = "9999-12-31";
            H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/
    /* CURRENT DATE IS MOVED TO CHNG-ENTRY-DT IN AIN22P9-INS2  */
            AIN22P9-INS2();
    /* PERFORM AIN22P9-INS-I02;*/
            if (VDBCONTROL.URC > 104)
              WCM00P2-TO-CEP01A();
            end
            AIN22W.WS-ERR-UERND-INC-AMT = "T";

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
            if (sysVar.sqlData.sqlcode == 0)
              AIN22P9-UNIN-NEW();
              AIN22P9-UNIN-SLOG();
              AIN22P9-INSUID-FSL();
            end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

          end
        end
        AIN22W.WS-ERR-UERND-INC-AMT = "T";
        AIN22W.WS-UNIN-UPDATED = "T";
        AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
        AIN22W.WS-ALERT-FLAG = "T";
      end
    end
  else /* WS-UERND-REC-EXIST NE 'T'*/

    set AIN22W-UNIN-NEW empty; /* WI 27488*/
    set AIN22W-UNIN-OLD empty; /* WI 27488*/
    AIN22P9-UNIN-OLD(); /* WI 27488*/

    set H2-UERND-INCM-DTL empty;
    AIN22W.WS-SYS1-YR = AIN22W.WS-NOMADS-PROCESS-CCYY;
    AIN22W.WS-SYS1-MM = AIN22W.WS-NOMADS-PROCESS-MM;
    AIN22W.WS-SYS1-DD = "01";
    AIN22W.WS-SYS1-F1 = "-";
    AIN22W.WS-SYS1-F2 = "-";
    H2-UERND-INCM-DTL.PRD-BEG-DT = AIN22W.WS-SYS1-DATE;
  /* MOVE AIN22W.WS-NOMADS-PROCESS-DATE TO H2-UERND-INCM-DTL.PRD-BEG-DT;*/
    H2-UERND-INCM-DTL.UPI = AIN22W.WS-UPI;
    H2-UERND-INCM-DTL.UERND-INC-TYPE-CD = 42;
    AIN22P9-GET-MAX-SQ();
    AIN22W.WS-INTERFACE-SSI-AMT = SR-Q22IP-REC.TRE-SSI-GROSS-PAYABLE-AMT     + SR-Q22IP-REC.TRE-STATE-SUPPLEMENT-GROSS-PAY;
    H2-UERND-INCM-DTL.INCM-SQ-NMB = AIN22W.WS-MAX-SQ-NMB;
    H2-UERND-INCM-DTL.PREV-AMT = 0.00;
  /* MOVE AIN22W.WS-UERND-INCM-AMT TO H2-UERND-INCM-DTL.UERND-INC-AMT;*/
    H2-UERND-INCM-DTL.UERND-INC-AMT = AIN22W.WS-INTERFACE-SSI-AMT;
    H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
    H2-UERND-INCM-DTL.FS-CNTBL-IND = "Y";
    H2-UERND-INCM-DTL.AFDC-CNTBL-IND = "N";
    H2-UERND-INCM-DTL.MA-CNTBL-CD = "N";
    H2-UERND-INCM-DTL.INVO-MND-DEDN-AMT = 0.00;
      /* CURRENT DATE IS MOVED TO CHNG-ENTRY-DT IN AIN22P9-INS2*/
    H2-UERND-INCM-DTL.PRD-END-DT = "9999-12-31";
    H2-UERND-INCM-DTL.UNE-INC-VERF-BY = "SDX"; /* WI 27488*/
    AIN22P9-QUERY-I02();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  /* ****************** WI 27488:WNMLS:2005-09-01 START *******************/
    if (sysVar.sqlData.sqlcode == 0)
      AIN22P9-UNIN-NEW();
      AIN22P9-UNIN-SLOG();
      AIN22P9-INSUID-FSL();
    end
  /* ****************** WI 27488:WNMLS:2005-09-01 END *********************/

    AIN22W.WS-ERR-UERND-INC-AMT = "T";
    AIN22W.WS-UNIN-UPDATED = "T";
    AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
  end
  /*  */
end // end AIN22P9-IUP-UEN


// date retrieval process
Function AIN22P9-LAST-DATE()
  /* LAST DAY OF THE PREVIOUS MONTH FROM THE GIVEN DATE*/

  /* MOVE AIN22W.WS-PROCESS-DATE TO AIN22W2.WS-DATE;*/
  if (AIN22W2.WS-DATE-MM == 01)
    AIN22W2.WS-PREV-MM = "12";
    AIN22W2.WS-PREV-DD = "31";
    AIN22W2.WS-DATE-CCYY = AIN22W2.WS-DATE-CCYY - 1;
    AIN22W2.WS-PREV-YY = AIN22W2.WS-DATE-YY;
  else
    AIN22W2.WS-PREV-YY = AIN22W2.WS-DATE-YY-C;
  end

  if (AIN22W2.WS-DATE-YY > 50 && AIN22W2.WS-DATE-YY <= 99)

    AIN22W2.WS-PREV-CC = "19";

  else

    AIN22W2.WS-PREV-CC = "20";

  end


  if (AIN22W2.WS-DATE-MM == 05 || 
  AIN22W2.WS-DATE-MM == 07 || 
  AIN22W2.WS-DATE-MM == 10 || 
  AIN22W2.WS-DATE-MM == 12)
    AIN22W2.WS-TEMP-MM = AIN22W2.WS-DATE-MM;
    AIN22W2.WS-TEMP-MM = AIN22W2.WS-TEMP-MM - 1;
    AIN22W2.WS-PREV-MM = AIN22W2.WS-TEMP-MM-C;
    AIN22W2.WS-PREV-DD = "30";

  end

  if (AIN22W2.WS-DATE-MM == 02 || 
  AIN22W2.WS-DATE-MM == 04 || 
  AIN22W2.WS-DATE-MM == 06 || 
  AIN22W2.WS-DATE-MM == 08 || 
  AIN22W2.WS-DATE-MM == 09 || 
  AIN22W2.WS-DATE-MM == 11)
    AIN22W2.WS-TEMP-MM = AIN22W2.WS-DATE-MM;
    AIN22W2.WS-TEMP-MM = AIN22W2.WS-TEMP-MM - 1;
    AIN22W2.WS-PREV-MM = AIN22W2.WS-TEMP-MM-C;
    AIN22W2.WS-PREV-DD = "31";


  end

  if (AIN22W2.WS-DATE-MM == 03)

    AIN22W2.WS-REM1 = AIN22W2.WS-DATE-CCYY % 4;
    AIN22W2.WS-REM2 = AIN22W2.WS-DATE-CCYY % 100;
    AIN22W2.WS-REM3 = AIN22W2.WS-DATE-CCYY % 400;

    if (AIN22W2.WS-REM1 != 0)
      AIN22W2.WS-PREV-MM = "02";
      AIN22W2.WS-PREV-DD = "28";
    else
      if (AIN22W2.WS-REM2 == 0)
        if (AIN22W2.WS-REM3 == 0)
          AIN22W2.WS-PREV-MM = "02";
          AIN22W2.WS-PREV-DD = "29";
        else
          AIN22W2.WS-PREV-MM = "02";
          AIN22W2.WS-PREV-DD = "28";
        end
      else
        AIN22W2.WS-PREV-MM = "02";
        AIN22W2.WS-PREV-DD = "28";
      end
    end
  end
  AIN22W2.WS-PREV-FILLER1 = "-";
  AIN22W2.WS-PREV-FILLER2 = "-";
  /*  */
  /* cbsi end*/
end // end AIN22P9-LAST-DATE


// date retrieval process
Function AIN22P9-LAST-DAY()
  /* LAST DAY OF THE CURRENT MONTH FROM THE GIVEN DATE*/

  /* MOVE AIN22W.WS-PROCESS-DATE TO AIN22W2.WS-DATE;*/
  AIN22W2.WS-PREV-MM = AIN22W2.WS-DATE-MM;
  AIN22W2.WS-PREV-YY = AIN22W2.WS-DATE-YY;

  if (AIN22W2.WS-DATE-YY > 50)
    AIN22W2.WS-PREV-CC = "19";
  else
    AIN22W2.WS-PREV-CC = "20";
  end
  if (AIN22W2.WS-DATE-MM == 04 || 
  AIN22W2.WS-DATE-MM == 06 || 
  AIN22W2.WS-DATE-MM == 09 || 
  AIN22W2.WS-DATE-MM == 11)
    AIN22W2.WS-PREV-DD = "30";
  end

  if (AIN22W2.WS-DATE-MM == 01 || 
  AIN22W2.WS-DATE-MM == 03 || 
  AIN22W2.WS-DATE-MM == 05 || 
  AIN22W2.WS-DATE-MM == 07 || 
  AIN22W2.WS-DATE-MM == 08 || 
  AIN22W2.WS-DATE-MM == 10 || 
  AIN22W2.WS-DATE-MM == 12)
    AIN22W2.WS-PREV-DD = "31";
  end

  if (AIN22W2.WS-DATE-MM == 02)
    AIN22W2.WS-REM1 = AIN22W2.WS-DATE-CCYY % 4;
    AIN22W2.WS-REM2 = AIN22W2.WS-DATE-CCYY % 100;
    AIN22W2.WS-REM3 = AIN22W2.WS-DATE-CCYY % 400;

    if (AIN22W2.WS-REM1 != 0)
      AIN22W2.WS-PREV-DD = "28";
    else
      if (AIN22W2.WS-REM2 == 0)
        if (AIN22W2.WS-REM3 == 0)
          AIN22W2.WS-PREV-DD = "29";
        else
          AIN22W2.WS-PREV-DD = "28";
        end
      else
        AIN22W2.WS-PREV-DD = "29";
      end
    end
  end
  AIN22W2.WS-PREV-FILLER1 = "-";
  AIN22W2.WS-PREV-FILLER2 = "-";
  /*  */
  /* cbsi end*/
end // end AIN22P9-LAST-DAY


// MAIN-PARA
Function AIN22P9-MAIN()
  /* CVNS START*/
  /* SDX DATA THAT COMES EVERY DAY IS CONCATENATED AND THE PROCESSING*/
  /* PROGRAM IS RUN EVERY DAY. THE INPUT FILE IS SORTED ON THE*/
  /* PROCESS DATE AND THE LATEST RECORD FOR THE BENEFICIARY IS PROCESSED.*/
  /* ALL OTHER RECORDS OF THE SAME BENEFICIARY ARE REJECTED THRU SORT*/
  /* ROUTINES (JCL) EXTERNAL TO THE PROGRAM.*/
  /* PTR 3954 BEGIN*/
  /* THE ABOVE PROCESS WILL BE HANDLED BY NSWD'S PRE-PROCESSING BEFORE*/
  /* THE SDX TAPE IS HANDED TO NOMADS. HENCE NOMADS PROCESSING NO LONGER*/
  /* NEEDS TO IMPLEMENT THE ABOVE JCL SORT/ELIMINATE ROUTINES*/
  /* PTR 3954 END*/

  set SR-Q22CL-REC empty;
  set SR-Q22OP-REC empty;

  AIN22P9-INIT();
  AIN22P9-SCAN-Q22IP();
  while (sysVar.errorCode == "00000000")
    if (SR-Q22IP-REC.TRE-LRECL == " SDX")
  /* ****************** WI 27640:WNMLS:2005-06-21 START *******************/
  /* The header rec will no longer contain the date parm.*/
  /* The EFF-DT will be calc'd by AIN22P9-EFF-DT-CLC which is*/
  /* performed in AIN22P9-INIT.*/
  /* MOVE SR-Q22IP-REC.SDX-TRE-REC TO AIN22W-HDR.AIN22HDR;*/
  /* PERFORM AIN22P9-HEADER;*/
  /* ****************** WI 27640:WNMLS:2005-06-21 END *********************/
    else
  /* 19298 added to prevent processing of recon file(tran code 'rf')*/
  /* 24400 if code t32 do not process 2003-07-25 dave t*/
      if (SR-Q22IP-REC.TRE-TRAN-CODE == "RF" || 
      SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "T32")
        SR-Q22CL-REC.AININT-CNT-REC-SKIP = SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;
      else
  /* 19298 end*/

        AIN22P9-VAL-NUM();
  /* 19298 start added to only process open or pending cases*/
        AIN22P9-CASE-OPEN();
  /* IF AIN22W.WS-CASE-OPEN = 'N' AND*/
  /* SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD(1) ^= 'G';*/
  /* SR-Q22CL-REC.AININT-CNT-REC-SKIP =*/
  /* SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;*/
  /* 19298 end*/
  /* ELSE;*/
  /* if g then kelly goldbery and must process open or closed*/
        if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
          AIN22W.WS-CASE-OPEN = "Y";
        end
        AIN22W.WS-NO-OF-RECS = AIN22W.WS-NO-OF-RECS + 1;
        SR-Q22CL-REC.AININT-CNT-NO-RECS = AIN22W.WS-NO-OF-RECS;
        AIN22P9-PROC();
      end
  /* END;*/
    end
    AIN22P9-SCAN-Q22IP();
  /* WI 15653 ADD NO UPDATE ALERT  02/03/99*/
    AIN22W.WS-UPD-IND = "N";
  end
  AIN22P9-CNL-ADD();
  /* CBSI END*/
end // end AIN22P9-MAIN


// MOVE REST OF DTL INFO
Function AIN22P9-MOV-OTHER()
  H2-INCAP-DSBLTY.UPI = AIN22W.WS-UPI;
  if (SR-Q22IP-REC.TRE-ONSET-DISABILITY-DT > 0)
  /* ** start 23393 ***/
    if (AIN22W.WS-ONSET-DISABILITY-DT != " "
     && AIN22W.WS-ONSET-DISABILITY-DT != "0001-01-01"
     && AIN22W.WS-ONSET-DISABILITY-DT != "9999-12-31")
      H2-INCAP-DSBLTY.DSBL-BEG-DT = AIN22W.WS-ONSET-DISABILITY-DT;
    end
  /* ** end 23393 ***/
  else
    H2-INCAP-DSBLTY.DSBL-BEG-DT = "0001-01-01";
  end
  /* IF H2-INCAP-DSBLTY.SSI-RFRL-STS-CD = 'T';*/
  /* IF AIN22W.WS-SSI-RFRL-STS-CD = 'T';*/
  /* WI 13211 ADDS CENTURY TO INPUT -- 04/20/98 -- KEM -- BEGIN*/
  /* MOVE '01' TO AIN22W.WS-SYS1-DD;*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-MO(1) TO AIN22W.WS-SYS1-MM;*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-YR(1) TO AIN22W.WS-SYS1-YY;*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-CC(1) TO AIN22W.WS-SYS1-CC;*/
    /* IF SR-Q22IP-REC.TRE-MONTH-CHANGE-YR(1) > 50;*/
    /* MOVE 19 TO AIN22W.WS-SYS1-CC;*/
    /* ELSE;*/
    /* MOVE 20 TO AIN22W.WS-SYS1-CC;*/
    /* END;*/
  /* WI 13211 ADDS CENTURY TO INPUT -- 04/20/98 -- KEM -- END*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F1;*/
  /* MOVE '-' TO AIN22W.WS-SYS1-F2;*/
  /* END;*/
  /* MOVE AIN22W.WS-SYS1-DATE TO H2-INCAP-DSBLTY.PRD-BEG-DT;*/
  /* PTR 9589 CALL TO DATEAPP IS NOT NEEDED ------ 02/05/97 -----*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/

  /* MOVE '9999-12-31' TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* MOVE '?' TO H2-INCAP-DSBLTY.INJRY-IND;*/
  /* moVE '?' TO H2-INCAP-DSBLTY.INCAP-DSBL-RSN-CD;*/
  /* PTR 7152/7132 VERIFY THE DISA --- 09/23/96 ---*/
  /* MOVE 'N' TO H2-INCAP-DSBLTY.INCAP-DSBL-VERF-CD;*/
  H2-INCAP-DSBLTY.INCAP-DSBL-VERF-CD = "Y";
  H2-INCAP-DSBLTY.INCAP-DSBL-VERF-BY = "SDX";
  /* PTR3143 BEGIN*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  H2-INCAP-DSBLTY.INCAP-DSBL-VERF-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
    /* *** changes due to ptr# 2849 begin *** */
  H2-INCAP-DSBLTY.NMO-RFRL-STS-DT = "9999-12-31";
    /* *** changes due to ptr# 2849 end   *** */
end // end AIN22P9-MOV-OTHER


// SET UP INCAP_DSBLTY DATA
Function AIN22P9-MOVE-DISA()

  /* PTR3826 BEGIN*/
  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H80"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H10"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H20"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H30"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H40"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H50"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H60"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H70"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "H90"
   || SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "P01")
    AIN22W.WS-SSI-RFRL-STS-CD = "P";
  end
  /* PTR3826 END*/

  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
    if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01")
      AIN22W.WS-SSI-RFRL-STS-CD = "E";
    end
    if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
      AIN22W.WS-SSI-RFRL-STS-CD = "G";
    end
    if (AIN22W.WS-ONSET-DISABILITY-DT < AIN22W.WS-STRT-ELIG-DT)
      AIN22W.WS-STRT-ELIG-DT = AIN22W.WS-ONSET-DISABILITY-DT;
    end
  end
  if (SR-Q22IP-REC.TRE-DENIAL-CD != " ")
    AIN22W.WS-SSI-RFRL-STS-CD = "D";
  else
    if ((SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "T" || 
    SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "E" || 
    SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "M" || 
    SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "N" || 
    SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "S") && 
    SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] != "G")
      AIN22W.WS-SSI-RFRL-STS-CD = "T";
  /* ** wi 21582*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-MO(1) TO*/
  /* AIN22W2.WS-DATE-MM;*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-YR(1) TO*/
  /* AIN22W2.WS-DATE-YY;*/
  /* MOVE SR-Q22IP-REC.TRE-MONTH-CHANGE-CC(1) TO*/
  /* AIN22W2.WS-DATE-CC;*/
  /* MOVE 01 TO AIN22W2.WS-DATE-DD;*/
  /* PERFORM AIN22P9-LAST-DATE;*/
  /* PERFORM AIN22P9-LAST-DAY;*/
  /* ** wi 21582*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.SSI-RFRL-DT;*/
  /* MOVE AIN22W2.WS-PREV-DATE TO H2-INCAP-DSBLTY.PRD-END-DT;*/
  /* MOVE '9999-12-31' TO H2-INCAP-DSBLTY.DSBL-END-DT;*/
    end
  end
end // end AIN22P9-MOVE-DISA


// CHECK-NEVADA-ADDRESS
Function AIN22P9-NEVADA-ADR()
  /* CBSI START*/
  /* THE RESIDENCE ZIP CODE WILL BE CHECKED FOR 89 TO DETERMINE IF THE*/
  /* BENEFICIARY IS A RESIDENT OF NEVADA.IF THE BENEFICIARY IS NOT A*/
  /* RESIDENT OF NEVADA THEN AN ALERT WOULD BE GENERATED*/

  AIN22W.WS-ERR-ZIP-CD = "F";
  /* PTR3949 BEGIN*/
  /*  */
  if (SR-Q22IP-REC.TRE-RESIDENCE-ZIP == " ")
    AIN22W.WS-ZIP-CODE = SR-Q22IP-REC.TRE-PAYEE-ZIP;
  else
    AIN22W.WS-ZIP-CODE = SR-Q22IP-REC.TRE-RESIDENCE-ZIP;
  end
  /* PTR3949 END*/
  if (AIN22W.WS-NEVADA-ZIP-CODE != "89")
    AIN22W.WS-ERR-ZIP-CD = "T";
    AIN22W.WS-ALERT-FLAG = "T";
    H2-PERSON-ADRS-HST.UPI = H2-2-CMH-PER.UPI;
    H2-PERSON-ADRS-HST.ADR-TYPE = "CM";
    AIN22P9-CHK-PADRS();
  end
  /* CBSI END*/
end // end AIN22P9-NEVADA-ADR


// WRITE REPORT RECORD
Function AIN22P9-OP01-WRITE()
  /* CBSI START*/
  VGVar.handleHardIOErrors = 1;
  try
    add SR-Q22OP-REC ;
  end
  if (SR-Q22OP-REC is ioError)
    VDBCONTROL.UPROC-OBJ = "SR-Q22OP-REC";
    VDBCONTROL.UPROC-NM = "AIN22P9-OP01-WRITE";
    VDBCONTROL.UPROC-OPT = "ADD";
  /* PTR 12560 CALL CEP01A ON ERROR -------------------- 08/03/97 ---*/
    AIN22W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AIN22W.WS-ERR-LAST-FOUR;
    VMESSAGE.UMSGCODE-JCL-ERR = 10;
    VMESSAGE.UMSGINS[2] = "AIN22A";
    WCM00P2-TO-CEP01A();
  end
  /* CBSI END*/
end // end AIN22P9-OP01-WRITE


// CHECK-OUT-OF-STATE
Function AIN22P9-OUT-STATE()
  /* wi 15502 fix setting of out-of-state flag*/
  /* IF TRE-TRAN-CODE IS 05 - INDIVIDUAL HAS MOVED TO OTHER STATE*/
  /* otherwise the BENEFICIARY IS in The STATE*/

  AIN22W.WS-MOVED-OUT-OF-STATE = " ";
  if (SR-Q22IP-REC.TRE-TRAN-CODE == "05")
    AIN22W.WS-MOVED-OUT-OF-STATE = "Y";
    AIN22W.WS-ALERT-FLAG = "T";
    AIN22P9-UPD-FAM();
  /* ELSE;*/
  /* IF SR-Q22IP-REC.TRE-TRAN-CODE = '04';*/
  /* MOVE 'N' TO AIN22W.WS-MOVED-OUT-OF-STATE;*/
  /* PERFORM AIN22P9-UPD-FAM;*/
  /* END;*/
  end
  /*  */
end // end AIN22P9-OUT-STATE


// CHECK-PAYMENT-STATUS
Function AIN22P9-PAY-STS()
  /* CBSI START*/
  /* THE WORKER WILL BE ALERTED IF THE PAYMENT STATUS IS CHANGED*/
  /* FROM NON PAYMENT STATUS TO PAYMENT STATUS AND VICE VERSA. A CHECK*/
  /* WILL ALSO BE MADE TO VALIDATE THE TERMINATION STATUS.*/

  AIN22W.WS-END-SEARCH = "F";
  AIN22W.WS-TERMINATION-STATUS = "F";
  AIN22W.WS-ERR-PYMT-STS-CD = "F";
  AIN22W.WS-INDEX = 01;
  /* PTR3823 while loop not needed as can always check first month*/
  /* WHILE (AIN22W.WS-INDEX < 9 AND AIN22W.WS-END-SEARCH = 'F');*/
  /* PTR3143 BEGIN check TRE-MONTH-CHANGE-MO with PIIN-SDX-PROCESS-MN*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/
  /* MOVE AIN22W.WS-SYS-MM TO AIN22W.WS-TEMP-MM;*/
  /* PTR 12710 CHECK YEAR AND MONTH BELOW  ---------------- 08/12/97 -----*/
  if (PIIN-SDX-PROCESS.PIIN-SDX-PROCESS-YY < 
  SR-Q22IP-REC.TRE-MONTH-CHANGE-YR[1] || 
  (PIIN-SDX-PROCESS.PIIN-SDX-PROCESS-YY == 
  SR-Q22IP-REC.TRE-MONTH-CHANGE-YR[1] && 
  PIIN-SDX-PROCESS.PIIN-SDX-PROCESS-MM < 
  SR-Q22IP-REC.TRE-MONTH-CHANGE-MO[1]))
  /* IF AIN22W.WS-TEMP1-MM = SR-Q22IP-REC.TRE-MONTH-CHANGE-MO(WS-INDEX);*/
  /* PTR3143 END*/
  /* CHANGES DUE TO PTR# 2834 BEGIN*/
  /* MOVE 'T' TO AIN22W.WS-ERR-PYMT-STS-CD;*/
  /* MOVE 'T' TO AIN22W.WS-ALERT-FLAG;*/
  /* MOVE SR-Q22IP-REC.TRE-PAY-STATUS-CD(WS-INDEX) TO*/
  /* AIN22W.WS-TERMINATION-CODE;*/
  /* PTR 7055 ALERT FOR THE FOLLOWING TRAN CODES*/
    if (SR-Q22IP-REC.TRE-TRAN-CODE == "0P"
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '0W'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '0X'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '0Y'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '0Z'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '01'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '02'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '03'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '04'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '08'*/
     /* OR SR-Q22IP-REC.TRE-TRAN-CODE = '09'*/
     || SR-Q22IP-REC.TRE-TRAN-CODE == "BJ")
      AIN22W.WS-ERR-PYMT-STS-CD = "T";
      AIN22W.WS-ALERT-FLAG = "T";
    end
  /* CHANGES DUE TO PTR# 7055 END*/
    AIN22W.WS-END-SEARCH = "T";
  /* CHANGES DUE TO PTR# 2834 END*/
  end
  AIN22W.WS-INDEX = AIN22W.WS-INDEX + 1;
  /* END; PTR3823 END*/
  /* CBSI END*/
end // end AIN22P9-PAY-STS


// GET THE MONTH FOR SDX PROCESS
Function AIN22P9-PIINSDX()
  try
    get next PIIN-SDX-PROCESS ;
  end
  if (PIIN-SDX-PROCESS is ioError && PIIN-SDX-PROCESS not endOfFile)
    VDBCONTROL.UPROC-OPT = "SCAN";
    WEZERT8-TO-URC();
    VMESSAGE.UMSGCODE = VDBCONTROL.URC;
    VDBCONTROL.UPROC-NM = "AIN22P9-PIINSDX";
    VDBCONTROL.UPROC-OBJ = "PIIN-SDX-PROCESS";
   /* PTR 12560 CALL CEP01A ON ERROR -------------------- 08/03/97 ----*/
    AIN22W.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AIN22W.WS-ERR-LAST-FOUR;
    VMESSAGE.UMSGCODE = "AML0009E";
    VMESSAGE.UMSGCODE-JCL-ERR = 10;
    VMESSAGE.UMSGINS[2] = "AIN22A";
    WCM00P2-TO-CEP01A();
    exit program;
  end
end // end AIN22P9-PIINSDX


// POPULATE THE ARRAY
Function AIN22P9-POP-ARRAY()
  /*  */
  AIN22W-COST-ARRAY.CWS-UPI[CWS-ARRAY-IDX] = AIN22W.WS-UPI;

  AIN22W-COST-ARRAY.CWS-ICI[CWS-ARRAY-IDX] = H2-2-CMH-FCH.ICI;

  AIN22W-COST-ARRAY.CWS-PRGM-CASE-TYPE[CWS-ARRAY-IDX] = H2-ELIG-VERSION.PRGM-CASE-TYPE;

  AIN22W-COST-ARRAY.CWS-BNFT-MTH[CWS-ARRAY-IDX] = H2-ELIG-VERSION.BNFT-MTH;

  AIN22W-COST-ARRAY.CWS-BNFT-YR[CWS-ARRAY-IDX] = H2-ELIG-VERSION.BNFT-YR;

  AIN22W-COST-ARRAY.CWS-INFC-BDATE[CWS-ARRAY-IDX] = AIN22W.WS-NOMADS-PROCESS-DATE;

  AIN22W-COST-ARRAY.CWS-INFC-TYPE[CWS-ARRAY-IDX] = "SDX     ";

  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  AIN22W-COST-ARRAY.CWS-INFC-TS[CWS-ARRAY-IDX] = GDW.TS;

  AIN22W-COST-ARRAY.CWS-PRIOR-VER-NMB[CWS-ARRAY-IDX] = H2-ELIG-VERSION.VER-NMB;

  if (H2-ELIG-VERSION.PRGM-CASE-TYPE == "MA")
    AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-VER-AMT[CWS-ARRAY-IDX] = H2-ELIG-VERSION.PTNT-LBLTY-AMT;
  else
    AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-VER-AMT[CWS-ARRAY-IDX] = H2-ELIG-VERSION.ENTLM-AMT;
  end

  AIN22W-COST-ARRAY.CWS-PRIOR-CASE-RSLT-CD[CWS-ARRAY-IDX] = H2-ELIG-VERSION.CASE-RSLT-CD;

  if (H2-ELIG-VERSION.PRGM-CASE-TYPE == "FS")
    AIN22W-COST-ARRAY.CWS-PRIOR-AID-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.FS-AID-CD;
    AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.FS-ELIG-CD;
  end

  if (H2-ELIG-VERSION.PRGM-CASE-TYPE == "AF")
    AIN22W-COST-ARRAY.CWS-PRIOR-AID-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.AFDC-AID-CD;
    AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.AFDC-ELIG-CD;
  end

  if (H2-ELIG-VERSION.PRGM-CASE-TYPE == "MA")
    AIN22W-COST-ARRAY.CWS-PRIOR-AID-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.MA-AID-CD;
    AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-CD[CWS-ARRAY-IDX] = H2-2-CMH-FCH.MA-ELIG-CD;
  end

  AIN22W-COST-ARRAY.CWS-REC-PROCESS-DT[CWS-ARRAY-IDX] = AIN22W2-COST.WS-CMH-FCH-PRD-END-DT;

  AIN22W-COST-ARRAY.CWS-MAINT-DT[CWS-ARRAY-IDX] = "0001-01-01";

  AIN22W-COST-ARRAY.CWS-ARRAY-SIZE = AIN22W-COST-ARRAY.CWS-ARRAY-SIZE + 1;

  AIN22W-COST-ARRAY.CWS-ARRAY-IDX = AIN22W-COST-ARRAY.CWS-ARRAY-IDX + 1;

  /*  */
end // end AIN22P9-POP-ARRAY


// POP ARRAY WITH BGT STS & DATES
Function AIN22P9-POP-ARY-BG()
  /*  */

  AIN22W-COST-ARRAY.CWS-ARRAY-IDX = 1;

  while (AIN22W-COST-ARRAY.CWS-ARRAY-IDX <= 
  AIN22W-COST-ARRAY.CWS-ARRAY-SIZE)

    if (AIN22W-COST-ARRAY.CWS-ICI[CWS-ARRAY-IDX] == 
    AIN22W-ICI-ARRAY.IWS-ICI[IWS-ARRAY-IDX])

      if (AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT == " ")
        AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT = "0001-01-01";
      end
      AIN22W-COST-ARRAY.CWS-TRAN-PRD-FM-DT[CWS-ARRAY-IDX] = AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT;

      if (AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT == " ")
        AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT = "9999-12-31";
      end
      AIN22W-COST-ARRAY.CWS-TRAN-PRD-TO-DT[CWS-ARRAY-IDX] = AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT;

      AIN22W-COST-ARRAY.CWS-BG-TRAN-STS-CD[CWS-ARRAY-IDX] = AIN22W2-COST.INFC-BG-TRAN-STS;
    end

    AIN22W-COST-ARRAY.CWS-ARRAY-IDX = AIN22W-COST-ARRAY.CWS-ARRAY-IDX + 1;
  end
  /*  */
end // end AIN22P9-POP-ARY-BG


// POP-INS FR ARRAY TO COST TBL
Function AIN22P9-POP-I-COST()
  /*  */
  /* ****************** WI 25803:WNMLS:2005-09-01 START *******************/
  /* Check for existence of BG-TRAN (PE) for each ICI in case for UPI.*/
  /* Loop thru array to update BG-TRAN info.*/
  /* Pop array where ICI = ICI.*/
  /* INSERT array data into INFC table.*/
  /*  */
  AIN22W-ICI-ARRAY.IWS-ARRAY-IDX = 1;

  while ((AIN22W-ICI-ARRAY.IWS-ARRAY-IDX <= 
  AIN22W-ICI-ARRAY.IWS-ARRAY-SIZE))

    AIN22W2-COST.INFC-BG-TRAN-STS = " ";
    AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT = " ";
    AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT = " ";

    set H2-BG-TRN empty;
    H2-BG-TRN.ICI = AIN22W-ICI-ARRAY.IWS-ICI[IWS-ARRAY-IDX];


    AIN22Q1-S-BG-EXIST();
    if (sysVar.sqlData.sqlcode == 0)
      AIN22Q1-SCAN-BG-TR();

      if (sysVar.sqlData.sqlcode == 0)
        AIN22W2-COST.INFC-BG-TRAN-STS = H2-BG-TRN.TRAN-STS-CD;
        AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT = H2-BG-TRN.TRAN-PRD-FM-DT;
        AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT = H2-BG-TRN.TRAN-PRD-TO-DT;
      else
        AIN22W2-COST.INFC-BG-TRAN-STS = " ";
        AIN22W2-COST.INFC-BG-TRAN-PRD-FM-DT = "0001-01-01";
        AIN22W2-COST.INFC-BG-TRAN-PRD-TO-DT = "9999-12-31";
      end /* IF BG SCAN EZE = 0*/

      AIN22P9-POP-ARY-BG();

    end /* IF BG EZE = 0*/

    AIN22W-ICI-ARRAY.IWS-ARRAY-IDX = AIN22W-ICI-ARRAY.IWS-ARRAY-IDX + 1;
  end /* WHILE IWS-ARRAY-IDX*/

  AIN22P9-POPIFC-AF2(); /* LOOPS THRU COST ARRAY & INSERTS*/

  /* ****************** WI 25803:WNMLS:2005-09-01 END *********************/
  /*  */
end // end AIN22P9-POP-I-COST


// POP-INS TO TBL FROM THE ARRAY
Function AIN22P9-POPIFC-AF2()
  /*  */

  AIN22W-COST-ARRAY.CWS-ARRAY-IDX = 1;

  while (AIN22W-COST-ARRAY.CWS-ARRAY-IDX <= 
  AIN22W-COST-ARRAY.CWS-ARRAY-SIZE)

    set H2-COST-INFC-DTLS empty;

    H2-COST-INFC-DTLS.UPI = AIN22W-COST-ARRAY.CWS-UPI[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.ICI = AIN22W-COST-ARRAY.CWS-ICI[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRGM-CASE-TYPE = AIN22W-COST-ARRAY.CWS-PRGM-CASE-TYPE[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.BNFT-MTH = AIN22W-COST-ARRAY.CWS-BNFT-MTH[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.BNFT-YR = AIN22W-COST-ARRAY.CWS-BNFT-YR[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.INFC-BDATE = AIN22W-COST-ARRAY.CWS-INFC-BDATE[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.INFC-TYPE = AIN22W-COST-ARRAY.CWS-INFC-TYPE[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.INFC-TS = AIN22W-COST-ARRAY.CWS-INFC-TS[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRIOR-VER-NMB = AIN22W-COST-ARRAY.CWS-PRIOR-VER-NMB[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRIOR-ELIG-VER-AMT = AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-VER-AMT[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRIOR-CASE-RSLT-CD = AIN22W-COST-ARRAY.CWS-PRIOR-CASE-RSLT-CD[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRIOR-AID-CD = AIN22W-COST-ARRAY.CWS-PRIOR-AID-CD[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.PRIOR-ELIG-CD = AIN22W-COST-ARRAY.CWS-PRIOR-ELIG-CD[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.TRAN-PRD-FM-DT = AIN22W-COST-ARRAY.CWS-TRAN-PRD-FM-DT[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.TRAN-PRD-TO-DT = AIN22W-COST-ARRAY.CWS-TRAN-PRD-TO-DT[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.REC-PROCESS-DT = AIN22W-COST-ARRAY.CWS-REC-PROCESS-DT[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.BG-TRAN-STS-CD = AIN22W-COST-ARRAY.CWS-BG-TRAN-STS-CD[CWS-ARRAY-IDX];

    H2-COST-INFC-DTLS.MAINT-DT = AIN22W-COST-ARRAY.CWS-MAINT-DT[CWS-ARRAY-IDX];

    AIN22Q1-I-COST-IFC();

    AIN22W-COST-ARRAY.CWS-ARRAY-IDX = AIN22W-COST-ARRAY.CWS-ARRAY-IDX + 1;
  end
  /*  */
end // end AIN22P9-POPIFC-AF2


// PROCESS-PARA
Function AIN22P9-PROC()
  /* CBSI START*/
  /* CHECK IF THE BENEFICIARY IS KNOWN TO NOMADS. IF THE RECORD IS NOT*/
  /* KNOWN TO NOMADS NO PROCESSING WOULD BE DONE*/
  /* WI 15689 IF NO PAY-STATUS IGNORE THE RECORD  01/04/99*/
  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == " ")
    SR-Q22CL-REC.AININT-CNT-REC-SKIP = SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;
    return;
  end
  AIN22W.WS-SSN1 = SR-Q22IP-REC.TRE-SSN;
  AIN22W.WS-NEW-SSN = " ";
  set H2-2-CMH-PER empty;
  H2-2-CMH-PER.SSN = AIN22W.WS-SSN;
  H2-2-CMH-PER.PRD-END-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  AIN22P9-QUERY-S01();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN22W.WS-ACTIVE-NOM = "N";
  AIN22P9-QRYS1-SCN();
  if (sysVar.sqlData.sqlcode == 100)
    AIN22W.WS-ACTIVE-NOM = "X";
  end
  while (AIN22W.WS-ACTIVE-NOM == "N" && sysVar.sqlData.sqlcode == 00)
  /* WI#14768 DON'T UPDATE CLOSED CASES   04/02/99REDONE 11/17/99*/
                                 /* ** AF ***/
    if ((H2-2-CMH-PER.AFDC-ELIG-CD != "9"
     && H2-2-CMH-PER.AFDC-ELIG-CD != "3"
     && H2-2-CMH-PER.AFDC-ELIG-CD != " ")
     /* ** FS ***/
     || (H2-2-CMH-PER.FS-ELIG-CD != "9"
     && H2-2-CMH-PER.FS-ELIG-CD != " ")
     /* ** MA ***/
     || (H2-2-CMH-PER.MA-ELIG-CD != "9"
     && H2-2-CMH-PER.MA-ELIG-CD != "3"
     && H2-2-CMH-PER.MA-ELIG-CD != " ")
     /* ** TN ***/
     || (H2-2-CMH-PER.TN-ELIG-CD != "9"
     && H2-2-CMH-PER.TN-ELIG-CD != "3"
     && H2-2-CMH-PER.TN-ELIG-CD != " ")
     /* ** TP ***/
     || (H2-2-CMH-PER.TP-ELIG-CD != "9"
     && H2-2-CMH-PER.TP-ELIG-CD != "3"
     && H2-2-CMH-PER.TP-ELIG-CD != " ")
     /* ** TC ***/
     || (H2-2-CMH-PER.TC-ELIG-CD != "9"
     && H2-2-CMH-PER.TC-ELIG-CD != "3"
     && H2-2-CMH-PER.TC-ELIG-CD != " ")
     /* ** TL ***/
     || (H2-2-CMH-PER.TL-ELIG-CD != "9"
     && H2-2-CMH-PER.TL-ELIG-CD != "3"
     && H2-2-CMH-PER.TL-ELIG-CD != " ")
     /* ** SG ***/
     || (H2-2-CMH-PER.SG-ELIG-CD != "9"
     && H2-2-CMH-PER.SG-ELIG-CD != "3"
     && H2-2-CMH-PER.SG-ELIG-CD != " "))
      AIN22W.WS-ACTIVE-NOM = "Y";
    end
    AIN22P9-QRYS1-SCN();
  end
  if (AIN22W.WS-ACTIVE-NOM == "X")
    /* PTR 5508 -- ADD NEW-SSN TO OUTPUT REPORT --- 11/11/96 --- BEGIN*/
    H2-ALTERNATE-SSN.ALT-SSN = SR-Q22IP-REC.TRE-SSN;
    AIN22P9-SETINQ16();
  /* ** start wi 21582 ***/
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  /* ** start wi 21582 ***/
    if (sysVar.sqlData.sqlcode == 0)
      AIN22P9-SCAN16();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  /* ** end wi 21582 ***/
    while (sysVar.sqlData.sqlcode == 00)
      AIN22W.WS-UPI = H2-ALTERNATE-SSN.UPI;
      WS-NOMADS-SSI-AMT = 0;
      AIN22W.WS-NEW-SSN = SR-Q22IP-REC.TRE-SSN;
  /* ** wi24400 use paid amount instead of eligible amount*/
      AIN22W.WS-INTERFACE-SSI-AMT = SR-Q22IP-REC.TRE-SSI-MONTHLY-ASSIST-AMT;
      AIN22P9-BUILD-REP();
      AIN22P9-SCAN16();
  /* ** start wi 21582 ***/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /* ** end wi 21582 ***/
    end
    /* PTR 5508 -- ADD NEW-SSN TO OUTPUT REPORT --- 11/11/96 --- END*/
    SR-Q22CL-REC.AININT-CNT-REC-SKIP = SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;
    return;
  end
  if (AIN22W.WS-ACTIVE-NOM == "N")
    SR-Q22CL-REC.AININT-CNT-REC-SKIP = SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;
    AIN22P9-SDX-SSI();
    H2-CASE-MEMBER-HST.UPI = H2-2-CMH-PER.UPI;
    H2-CASE-MEMBER-HST.PRD-END-DT = "9999-12-31";
  /* ** start wi 21582 ***/
  /* PERFORM AIN22P9-QUERY-S04;*/
    AIN22P9-CMH-QUERY();
  /* ** end wi 21582 ***/
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    while (sysVar.sqlData.sqlcode == 0)
  /* WI 21582 START*/
      H2-FAM-CASE-HSTRY.ICI = H2-CASE-MEMBER-HST.ICI;
      AIN22W2.WS-DATE-CCYY = AIN22W.WS-PROCESS-DATE-CCYY;
      AIN22W2.WS-DATE-MM = AIN22W.WS-PROCESS-DATE-MO;
      AIN22W2.WS-DATE-DD = AIN22W.WS-PROCESS-DATE-DT;
      AIN22P9-LAST-DAY();
      H2-FAM-CASE-HSTRY.PRD-END-DT = AIN22W2.WS-PREV-DATE;
  /* MOVE '9999-12-31' TO H2-FAM-CASE-HSTRY.PRD-END-DT;*/
      AIN22P9-CASE-STS();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
      if (H2-FAM-CASE-HSTRY not ioError)
  /* WI 21582 END*/
        if (AIN22W.WS-CASE-OPEN == "Y" || 
        SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
          AIN22W.WS-ICI = H2-CASE-MEMBER-HST.ICI;
          AIN22W1.PALERT-ALERT-ID = 129015;
          AIN22W1.PALERT-SUFX = " ";
          AIN22W1.PALERT-ACTION = "C";
          PCALINP.PAL-ALERT-CD = AIN22W1.PALERT-ALERT-ID;
          PCALINP.PAL-CASE-ID = AIN22W1.PALERT-CASE-ID;
          PCALINP.PAL-ALERT-ACTION = AIN22W1.PALERT-ACTION;
          PCALINP.PAL-DISPL-DT = AIN22W1.PALERT-DISP-DT;
          call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        end
  /* ** start wi 21582 ***/
  /* PERFORM AIN22P9-SCAN4;*/
        AIN22P9-CMH-SCAN();
  /* ** end wi 21582 ***/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
  /* ** start wi 21582 ***/
      end
  /* ** end wi 21582 ***/
    end
    return;
  end
  AIN22W.WS-UPI = H2-2-CMH-PER.UPI;
  AIN22W.WS-DSGNT-IND = " ";
  if (H2-2-CMH-PER.IVA-CASE-MBR-FG != "Y")
    set H2-RESP-PRSN-DBTR empty;
    AIN22W.WS-SSN1 = SR-Q22IP-REC.TRE-SSN;
    H2-RESP-PRSN-DBTR.DBTR-SSN = AIN22W.WS-SSN;
    AIN22P9-QUERY-S10();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  /* PTR 11679 ALSO CHK FOR CERTAIN "N" PEOPLE --- 06/02/97 ---*/
    if (H2-RESP-PRSN-DBTR.DSGNT-DBTR-IND != "Y")
  /* ** start wi 21582 ***/
  /* Check for IVE-case-id is commented as per the discussion with Dave T.*/
  /* any IVE case could be a hoh for a tanf or fs case so no need for this*/
  /* check. There will be not any change even if elig trig for IVE case.*/
   /* MOVE H2-2-CMH-PER.UPI TO H2-CASE-MEMBER-HST.UPI;*/
   /* PERFORM AIN22P9-CHKPEND;*/
   /* IF H2-FAM-CASE.IVE-CASE-ID > ' ';*/
   /* SR-Q22CL-REC.AININT-CNT-REC-SKIP =*/
   /* SR-Q22CL-REC.AININT-CNT-REC-SKIP + 1;*/
   /* EZERTN;*/
   /* ELSE;*/
  /* ** end wi 21582 ***/
      AIN22W.WS-DSGNT-IND = "F";
  /* ** start wi 21582 ***/
  /* END;*/
  /* ** end wi 21582 ***/
    else
      AIN22W.WS-DSGNT-IND = "T";
    end
  else
    AIN22W.WS-DSGNT-IND = "F";
  end
  SR-Q22CL-REC.AININT-CNT-REC-PRO = SR-Q22CL-REC.AININT-CNT-REC-PRO + 1;

  AIN22P9-BILD-ARRYS(); /* WI 25803*/

  AIN22P9-EDIT();

  AIN22P9-POP-I-COST(); /* WI 25803*/

  if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "C01" || 
  SR-Q22IP-REC.TRE-PAY-STATUS-CD-1[1] == "T" || 
  SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "G")
    AIN22P9-BUILD-REP();
  end
  /* CBSI END*/
end // end AIN22P9-PROC


// CHECK-PUBLIC-LAW
Function AIN22P9-PUBLIC-LAW()
  /* CBSI START*/
  /* THE PUBLIC LAW CODE FIELD DISPLAYS CERTAIN CODES BASED ON COMBINATION*/
  /* OF DATA COLLECTED.THE WORKER IS ALERTED WHEN THIS INFORMATION IS*/
  /* GENERATED*/
  /* THE PUBLIC LAW CODE HAS BEEN DERIVED AS PER DIS LOGIC*/

  AIN22W.WS-ERR-PB-LAW-CD = "F";
  AIN22W.WS-PUBLIC-LAW = " ";
  if (SR-Q22IP-REC.TRE-TRAN-CODE == "BJ")
    AIN22W.WS-PUBLIC-LAW = "B";
    AIN22W.WS-ALERT-FLAG = "T";
    AIN22W.WS-ERR-PB-LAW-CD = "T";
  else
    if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "D")
      AIN22W.WS-PUBLIC-LAW = SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1];
      AIN22W.WS-ERR-PB-LAW-CD = "T";
      AIN22W.WS-ALERT-FLAG = "T";
    else
      if (((SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "E01") || 
      (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "N01") || 
      (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "P01")) && 
      ((SR-Q22IP-REC.TRE-MEDICAID-TEST-IND == "A") || 
      (SR-Q22IP-REC.TRE-MEDICAID-TEST-IND == "B") || 
      (SR-Q22IP-REC.TRE-MEDICAID-TEST-IND == "F")))
        AIN22W.WS-ERR-PB-LAW-CD = "T";
        AIN22W.WS-PUBLIC-LAW = "I";
        AIN22W.WS-ALERT-FLAG = "T";
      else
        /* ---------CHANGES DUE TO PHASE IV MAABD IMPACT START-------*/
        set H2-SDX-SSI-BNFDTL empty;
        H2-SDX-SSI-BNFDTL.UPI = H2-2-CMH-PER.UPI;
  /* PTR3143 BEGIN use nomads process date instead of system date*/
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  /* MOVE GDW.DTLC TO AIN22W.WS-SYS-DATE;*/
  /* MOVE AIN22W.WS-SYS-MM TO AIN22W.WS-SYS1-MM;*/
  /* MOVE AIN22W.WS-SYS-DD TO AIN22W.WS-SYS1-DD;*/
  /* MOVE AIN22W.WS-SYS-YY TO AIN22W.WS-SYS1-YY;*/
  /* MOVE AIN22W.WS-SYS-CC TO AIN22W.WS-SYS1-CC;*/
        H2-SDX-SSI-BNFDTL.PROCESS-DT = AIN22W.WS-NOMADS-PROCESS-DATE;
  /* PTR3143 END*/
        AIN22P9-QUERY-S12();
        if (sysVar.sqlData.sqlcode == 0)
          if (H2-SDX-SSI-BNFDTL.PB-LAW-CD == "I")
  /* WI 21582 START*/
            AIN22W.WS-ERR-PB-LAW-CD = "T";
  /* WI 21582 END*/
            AIN22W.WS-TRIGGER-ELIGIBILITY = "T";
            AIN22W.WS-ALERT-FLAG = "T";
          end
        end

       /* ---------CHANGES DUE TO PHASE IV MAABD IMPACT END----------*/

        if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "C")
          AIN22W.WS-PUBLIC-LAW = SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1];
          AIN22W.WS-ALERT-FLAG = "T";
          AIN22W.WS-ERR-PB-LAW-CD = "T";
        else
          if (SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1] == "W")
            AIN22W.WS-PUBLIC-LAW = SR-Q22IP-REC.TRE-MEDICAID-ELIG-CD[1];
            AIN22W.WS-ALERT-FLAG = "T";
            AIN22W.WS-ERR-PB-LAW-CD = "T";

          /* --- CHANGES DUE TO PHASE IV MAABD IMPACT START-------*/

          else
            AIN22W.WS-CLAIM-NBR = SR-Q22IP-REC.TRE-CLAIM-NBR;
            if (SR-Q22IP-REC.TRE-PAY-STATUS-CD[1] == "N01" && 
            SR-Q22IP-REC.TRE-UNEARNED-INC-TYPE-CD[1] == "A" && 
            SR-Q22IP-REC.TRE-UNEARNED-INC-FREQ[1] == "C" && 
            (AIN22W.WS-CLAIM-LAST-TWO == "W" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W1" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W2" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W3" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W4" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W5" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W6" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W7" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W8" || 
            AIN22W.WS-CLAIM-LAST-TWO == "W9" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WB" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WC" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WF" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WG" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WJ" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WR" || 
            AIN22W.WS-CLAIM-LAST-TWO == "WT" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DC" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DM" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DS" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DX" || 
            AIN22W.WS-CLAIM-LAST-TWO == "D6" || 
            AIN22W.WS-CLAIM-LAST-TWO == "D7" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DV" || 
            AIN22W.WS-CLAIM-LAST-TWO == "DW" || 
            AIN22W.WS-CLAIM-LAST-TWO == "D"))
              AIN22W.WS-PUBLIC-LAW = "S";
              AIN22W.WS-ALERT-FLAG = "T";
              AIN22W.WS-ERR-PB-LAW-CD = "T";
            end

          /* ----- CHANGES DUE TO PHASE IV MAABD IMPACT END---------*/

          end
        end
      end
    end
  end
  /* CBSI END*/
end // end AIN22P9-PUBLIC-LAW


Function AIN22P9-QRYS1-SCN()
  /* 05/19/99              CREATION*/
  /*  */
  VDBCOMMON.USQLREC = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-OBJ = "H2-2-CMH-PER";
  VDBCONTROL.UPROC-NM = "AIN22P9-QRYS1-SCN";
  VDBCONTROL.UPROC-OPT = "SCAN";
  /*  */
  try
    get next H2-2-CMH-PER ;
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;
  end
  /*  */
end // end AIN22P9-QRYS1-SCN


// CNTRL INSERT OF BG_TRN
Function AIN22P9-QUERY-I01()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  /*  */
  /* Perform process to retrieve data*/
  /* CBSI START*/
  AIN22P9-INS1();
  /* CBSI END*/
  /*  */
  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
end // end AIN22P9-QUERY-I01


// CNTRL INSERT OF UNEARNED INC
Function AIN22P9-QUERY-I02()
  /* DATE      PGR.       DESCRIPTION*/
  /* --------- ---------- -----------*/
  /* 03/07/95  TBST195     CREATION*/
  /*  */
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN22A";
  /*  */
  /* Perform process to retrieve data*/
  /* CBSI START*/
  AIN22P9-INS2();
  /* CBSI END*/
  /*  */
  /* Set error control flags*/
  /* UNRF - No record found flag (Y,N,1)*/
  /* UDUP - Duplicate key flag (Y,N)*/
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
end // end AIN22P9-QUERY-I02