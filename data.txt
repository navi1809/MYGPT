//WNM00M38 JOB 'WN91P','NOMADS-AIN97A',
//         CLASS=9,MSGCLASS=5,
//         COND=(10,LE),
//         REGION=64M,
//         NOTIFY=WNMJH,
//         USER=WSS01
//*        RESTART=
/*ROUTE  PRINT LOCAL
//OUT1  OUTPUT ADDRESS='WELFARE NSWD',
//             BUILDING='WELFARE CENTRAL OFFICE',
//             DEPT='NEVADA STATE WELFARE DIVISION',
//             TITLE=' REPORT -       ',DEFAULT=YES,JESDS=ALL
//JOBLIB       DD DSN=SYSP.DB.DB26.SDSNLOAD,DISP=SHR
//             DD DSN=WNM.WN91.ZOSBATCH.EMERG.LOAD,DISP=SHR
//             DD DSN=WNM.WN91.ZOSBATCH.PROD.LOAD,DISP=SHR
//*
//AIN97A01 EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14
//********************************************************************
//DD01         DD DSN=WNP.WN91.AIN97A.SCHOOL,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//DD02         DD DSN=WNP.WN91.AIN97A.PRNFILE,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//*
//AIN97A02 EXEC PGM=IKJEFT01,DYNAMNBR=20,REGION=32M,TIME=30
//********************************************************************
//*        AIN97A
//********************************************************************
//ELAPRINT     DD SYSOUT=*,DCB=(RECFM=FBA,BLKSIZE=1330)
//ELASNAP      DD SYSOUT=*,DCB=(RECFM=VBA,BLKSIZE=4096)
//EZEPRINT     DD SYSOUT=*,DCB=(RECFM=VBA,BLKSIZE=4096)
//CEEDUMP      DD SYSOUT=M
//SYSABOUT     DD SYSOUT=M
//SYSDBOUT     DD SYSOUT=M
//SYSOUT       DD SYSOUT=*
//SYSOUX       DD SYSOUT=*
//SYSPRINT     DD SYSOUT=*
//SYSTSPRT     DD SYSOUT=*
//APPLERR      DD SYSOUT=*,DCB=(RECFM=FB,LRECL=80,BLKSIZE=800)
//SYSTSIN      DD *
  DSN SYSTEM(DB26)
  RUN PROG(AIN97A)  PLAN(WNMDB6P1)
  END
//INFILE       DD *
$WBOMYYYYMMDD
/*
//* $WBOMYYYYMMDD
//* CCYYMMDD - FIRST DAY OF CURRENT MONTH
//*
//SCHLEXT      DD DSN=WNP.WN91.AIN97A.SCHOOL,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM030,
//             DCB=(RECFM=FB,LRECL=275,BLKSIZE=0)
//PRNFILE      DD DSN=WNP.WN91.AIN97A.PRNFILE,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(1,25),RLSE),VOL=SER=WNM030,
//             DCB=(RECFM=FBA,LRECL=133,BLKSIZE=0)
//*
//AIN97A03 EXEC PGM=IEBGENER
//********************************************************************
//*        IEBGENER - BACKUP FILE TO A GDG
//********************************************************************
//SYSPRINT     DD SYSOUT=*
//SYSUT1       DD DISP=SHR,DSN=WNP.WN91.AIN97A.SCHOOL
//SYSUT2       DD DSN=WNP.WN91.AIN97A.SCHOOL.GDG(+1),
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM032,
//             DCB=WNP.WN91.AIN97A.SCHOOL
//SYSIN        DD DUMMY
//*
//AIN97A04 EXEC PGM=IEBGENER
//********************************************************************
//*        IEBGENER - PRINT FILE(S) FROM PREVIOUS STEP(S)
//********************************************************************
//SYSPRINT     DD SYSOUT=*
//SYSUT1       DD DISP=SHR,DSN=WNP.WN91.AIN97A.PRNFILE
//SYSUT2       DD SYSOUT=(6,,F1L8),
//             DEST=LOCAL,
//             FCB=FXL8,
//             RECFM=FBA
//SYSIN        DD DUMMY
//*
//AIN97A05 EXEC PGM=IEBGENER
//********************************************************************
//*        IEBGENER - PRINT FILE(S) FROM PREVIOUS STEP(S)
//********************************************************************
//SYSPRINT     DD SYSOUT=*
//SYSUT1       DD DISP=SHR,DSN=WNP.WN91.AIN97A.PRNFILE
//SYSUT2       DD SYSOUT=(Z,,F1L8),
//             DEST=LOCAL,
//             FCB=FXL8,
//             RECFM=FBA,
//             COPIES=1
//SYSIN        DD DUMMY
//*
//AIN98A01 EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14
//********************************************************************
//DD01         DD DSN=WNP.WN91.AIN98A.SCHOOL,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//DD02         DD DSN=WNP.WN91.AIN98A.SORTED,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//DD03         DD DSN=WNP.WN91.AIN98A.UNIQUE,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//DD04         DD DSN=WNP.WN91.AIN98A.PRNFILE,
//             DISP=(MOD,DELETE,DELETE),SPACE=(TRK,(0,0))
//*
//AIN98A02 EXEC PGM=IKJEFT01,DYNAMNBR=20,REGION=32M,TIME=30
//********************************************************************
//*        AIN98A - SCHOOL LUNCH PROGRAM
//********************************************************************
//ELAPRINT     DD SYSOUT=*,DCB=(RECFM=FBA,BLKSIZE=1330)
//ELASNAP      DD SYSOUT=*,DCB=(RECFM=VBA,BLKSIZE=4096)
//EZEPRINT     DD SYSOUT=*,DCB=(RECFM=VBA,BLKSIZE=4096)
//CEEDUMP      DD SYSOUT=M
//SYSABOUT     DD SYSOUT=M
//SYSDBOUT     DD SYSOUT=M
//SYSOUT       DD SYSOUT=*
//SYSOUX       DD SYSOUT=*
//SYSPRINT     DD SYSOUT=*
//SYSTSPRT     DD SYSOUT=*
//APPLERR      DD SYSOUT=*,DCB=(RECFM=FB,LRECL=80,BLKSIZE=800)
//SYSTSIN      DD *
  DSN SYSTEM(DB26)
  RUN PROG(AIN98A)  PLAN(WNMDB6P1)
  END
//INFILE       DD *
$WBOMYYYYMMDD
/*
//* $WBOMYYYYMMDD
//* CCYYMMDD - FIRST DAY OF CURRENT MONTH
//*
//SCHLNCH      DD DSN=WNP.WN91.AIN98A.SCHOOL,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM032,
//             DCB=(RECFM=FB,LRECL=470,BLKSIZE=0)
//PRNFILE      DD DSN=WNP.WN91.AIN98A.PRNFILE,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(1,25),RLSE),VOL=SER=WNM032,
//             DCB=(RECFM=FBA,LRECL=133,BLKSIZE=0)
//*
//AIN98A03 EXEC PGM=IEBGENER
//********************************************************************
//*        IEBGENER - BACKUP FILE TO A GDG
//********************************************************************
//SYSPRINT     DD SYSOUT=*
//SYSUT1       DD DISP=SHR,DSN=WNP.WN91.AIN98A.SCHOOL
//SYSUT2       DD DSN=WNP.WN91.AIN98A.SCHOOL.GDG(+1),
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM032,
//             DCB=WNP.WN91.AIN98A.SCHOOL
//SYSIN        DD DUMMY
//*
//AIN98A04 EXEC PGM=SORT,PARM='CORE=MAX'
//********************************************************************
//*            DFSORT - SORT STEP
//********************************************************************
//SORTIN       DD DSN=WNP.WN91.AIN98A.SCHOOL,
//             DISP=SHR
//SORTOUT      DD DSN=WNP.WN91.AIN98A.SORTED,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM032,
//             DCB=(RECFM=FB,LRECL=470,BLKSIZE=0)
//SYSPRINT     DD SYSOUT=*
//SYSOUT       DD SYSOUT=*
//SYSIN        DD *
  SORT FIELDS=(11,9,CH,A,84,1,CH,A)
//*
//*    SORT FIELDS=(11,9,CH,A,84,1,CH,A)
//*
//AIN98A05 EXEC PGM=ICETOOL,PARM='CORE=MAX'
//********************************************************************
//*            ICE - SORT STEP TO ELIMINATE DUPS
//********************************************************************
//SORTIN       DD DSN=WNP.WN91.AIN98A.SORTED,
//             DISP=SHR
//SORTOUT      DD DSN=WNP.WN91.AIN98A.UNIQUE,
//             DISP=(,CATLG,DELETE),UNIT=3390,
//             SPACE=(CYL,(5,25),RLSE),VOL=SER=WNM032,
//             DCB=(RECFM=FB,LRECL=470,BLKSIZE=0)
//SORTWK01     DD UNIT=SYSDA,SPACE=(CYL,(15,15),RLSE)
//SORTWK02     DD UNIT=SYSDA,SPACE=(CYL,(15,15),RLSE)
//SORTWK03     DD UNIT=SYSDA,SPACE=(CYL,(15,15),RLSE)
//TOOLMSG      DD SYSOUT=*
//DFSMSG       DD SYSOUT=*
//SYSOUT       DD SYSOUT=*
//SORTDIAG     DD DUMMY
//TOOLIN       DD *
  SELECT FROM(SORTIN) TO(SORTOUT) ON(11,9,CH) FIRST
//*
//*  SELECT FROM(SORTIN) TO(SORTOUT) ON(11,9,CH) FIRST
//*
//*
//*  FTP THIS FILE TO DOE - WNP.WN91.AIN98A.UNIQUE
//*
//*
//* ***************************************************************** *
//* SECURE FTP NEVADA DEPARTMENT OF EDUCATION (DOE) FILE
//*   AIN98A - WNM00M38
//*   MONTHLY EXTRACT FILE-CHILDREN ELIG SCHOOL LUNCH PROGRAM
//*
//* ***************************************************************** *
//*
//* ================================================================= *
//     SET SCPATH='/u/NMD/wss01'                <== UNIX PATH LOC     *
//     SET PWDSCRPT='school_pwd.sh'             <== PASSWORD SCRIPT   *
//     SET FILENAME='SCHOOL_AIN98A_OUTPUT.DAT'  <== DELETE THIS FILE  *
//     SET SCRIPT='SCHOOL_AIN98A_PUT.SCRIPT'    <== SCRIPT NAME       *
//     SET USERID='DWSS'                        <== SFTP PROD USERID  *
//     SET IPADDR='SCHOOL_AIN98A_FTPSCRPT.SH'   <== DESTINATION IP/DNS*
//     SET STDENV='CDP.DATALIB(WSFTPSCH)'       <== STDENV DATASET    *
//*       CDP.DATALIB(WSFTPSCH) contains the following:               *
//*        DISPLAY=FOO
//*        SSH_ASKPASS=/u/NMD/wss01/vital_statspwd.sh
//*    SET INDSN='WNP.WN91.AIN98A.UNIQUE'       <== INPUT DATA        *
//* ================================================================= *
//*
//*                                                                   *
//*********************************************************************
//* DYNAMICALLY CREATE/UPDATE THE UNIX SFTP BATCH SCRIPT PASSWORD     *
//* THE PASSWORD FILE NEEDS THE WORD 'ECHO' WITH THE PASSWORD IN      *
//* IN SINGLE QUOTES.  PASSWORD IS CASE SENSITIVE SO 'CAPS OFF'.      *
//*********************************************************************
//STEPPWD  EXEC PGM=ICEGENER
//SYSPRINT DD DUMMY
//SYSIN DD DUMMY
//SYSUT2       DD PATH=('&SCPATH./&PWDSCRPT'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//SYSUT1 DD *
echo 'EDZdVH@'
/*
//STEP0    EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14 - DELETE FILE IN OMVS
//********************************************************************
//DD01         DD  PATH='&SCPATH./&FILENAME',
//             FILEDATA=TEXT,PATHOPTS=ORDONLY,PATHDISP=DELETE
//*
//STEP1    EXEC PGM=ICEGENER
//*****************************************
//* COPY MVS DATAST TO OMVS UNIX DIRECTORY
//*****************************************
//SYSPRINT     DD DUMMY
//SYSIN        DD DUMMY
//SYSUT1       DD DSN=WNP.WN91.AIN98A.UNIQUE,DISP=OLD
//*SYSUT1       DD DSN=WNM.TF1.D9999XXX.JN.AIN97B.SCHOOL,DISP=OLD
//SYSUT2       DD PATH='&SCPATH./&FILENAME',
//             FILEDATA=TEXT,
//             PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//LISTDIR2 EXEC PGM=IKJEFT01,REGION=2M
//******************************************************
//* LIST ALL FILES IN THE UNIX DIRECTORY FOR USER=WSS01
//******************************************************
//SYSEXEC      DD DSN=SYS1.SBPXEXEC,DISP=SHR
//SYSTSPRT     DD SYSOUT=*
//SYSTSIN      DD *
OSHELL ls -al
//*
//BLDSCRPT EXEC PGM=ICEGENER
//************************************************
//* DYNAMICALLY CREATE THE UNIX SFTP BATCH SCRIPT
//************************************************
//SYSPRINT     DD DUMMY
//SYSIN        DD DUMMY
//SYSUT2       DD PATH=('&SCPATH./&SCRIPT'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//SYSUT1 DD *
ascii
PUT SCHOOL_AIN98A_OUTPUT.DAT 'AIN98A.DAT'
ls -l
quit
/*
//*
//* ascii
//* PUT SCHOOL_AIN98A_OUTPUT.DAT 'AIN98A.DAT'
//* ls -l
//*
//STEP3    EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14 - DELETE FILE IN OMVS
//********************************************************************
//DD01         DD  PATH='&SCPATH./&IPADDR',
//             FILEDATA=TEXT,PATHOPTS=ORDONLY,PATHDISP=DELETE
//*
//BLDSFTP  EXEC PGM=ICEGENER
//********************************************************************
//* COPY THE SFTP CONNECTION SCRIPT FROM A DATASET TO UNIX FILE
//*  PROD ===> DSN=WNP.WN91.AIN98A.SFTP.PUT.CONN.PROD
//*            FOR THE NEVADA DEPARTMENT OF EDUCATION (DOE)
//********************************************************************
//SYSUT1      DD DISP=SHR,DSN=WNP.WN91.AIN98A.SFTP.PUT.CONN.PROD
//SYSUT2      DD PATH=('&SCPATH./&IPADDR'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT),PATHMODE=SIRWXU
//SYSPRINT     DD DUMMY
//SYSIN        DD DUMMY
/*
//*
//* PROD SFTP SITE DSN=WNP.WN91.AIN98A.SFTP.PUT.CONN.PROD :
//*   sftp -o Batchmode=no -o PubkeyAuthentication=no -vv
//*   -b /u/NMD/wss01/SCHOOL_AIN98A_PUT.SCRIPT
//*   DWSS@167.154.10.16
//*
//SFTP6    EXEC PGM=BPXBATCH
//***********************************************************
//* RUN UNIX SFTP BATCH SCRIPT JUST CREATED IN STEP BLDSCRPT
//***********************************************************
//STDIN        DD PATH='&SCPATH./&IPADDR',PATHOPTS=(ORDONLY)
//STDENV       DD DISP=SHR,DSN=&STDENV
//STDOUT       DD SYSOUT=*
//STDERR       DD SYSOUT=*
//STDOUT       DD SYSOUT=*
//SYSOUT       DD SYSOUT=*
//SYSPRINT     DD SYSOUT=*
//*
//*
//* *************************************************************** *
//*         NDA (NEVADA DEPARTMENT OF AGRICULTURE) -
//*                  SCHOOL LUNCH FILES
//*
//* AIN98A - WNM00M38
//* AIN98A - WNM00M87
//* TWICE MONTHLY EXTRACT FILE-CHILDREN ELIG SCHOOL LUNCH PROGRAM
//* *************************************************************** *
//*
//* *************************************************************** *
//* PUT SCHOOL_AIN98A_OUTPUT.DAT AIN98_$WYYYYMMDD..dat
//* ***************************************************************** *
//*
//* ================================================================= *
//  SET SCPATH='/u/NMD/wss01'                   <= UNIX PATH LOC      *
//  SET PWDSCRPT='nda_pwd.sh'                   <= PASSWORD SCRIPT    *
//  SET FILENAME='SCHOOL_AIN98A_OUTPUT.DAT'     <== DELETE THIS FILE  *
//* SET USERID='WelfareFTP'                     <= SFTP PROD USERID   *
//  SET IPADDR='NDA_FTPSCRPT.sh'                <= DESTINATION IP/DNS *
//  SET STDENV='CDP.DATALIB(WSFTPNDA)'          <= STDENV DATASET     *
//*       CDP.DATALIB(WSFTPNDA) contains the following:               *
//*        DISPLAY=FOO                                                *
//*        SSH_ASKPASS=/u/NMD/wss01/nda_pwd.sh
//* ================================================================= *
//*
//*
//*********************************************************************
//* DYNAMICALLY CREATE/UPDATE THE UNIX SFTP BATCH SCRIPT PASSWORD     *
//* THE PASSWORD FILE NEEDS THE WORD 'ECHO' WITH THE PASSWORD IN      *
//* IN SINGLE QUOTES.  PASSWORD IS CASE SENSITIVE SO 'CAPS OFF'.      *
//*********************************************************************
//STEPPWD  EXEC PGM=ICEGENER
//SYSPRINT DD DUMMY
//SYSIN DD DUMMY
//SYSUT2       DD PATH=('&SCPATH./&PWDSCRPT'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//SYSUT1 DD *
echo 'Uq532XJB'
/*
//*STEP7    EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14 - DELETE FILE IN OMVS
//********************************************************************
//*DD01         DD  PATH='&SCPATH./&FILENAME',
//*             FILEDATA=TEXT,PATHOPTS=ORDONLY,PATHDISP=DELETE
//*
//*STEP8    EXEC PGM=ICEGENER
//*****************************************
//* COPY MVS DATAST TO OMVS UNIX DIRECTORY
//*****************************************
//*SYSPRINT     DD DUMMY
//*SYSIN        DD DUMMY
//*SYSUT1       DD DSN=WNP.WN91.AIN98A.UNIQUE,DISP=OLD
//*SYSUT2       DD PATH='&SCPATH./&FILENAME',
//*             FILEDATA=TEXT,
//*             PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//LISTDIR2 EXEC PGM=IKJEFT01,REGION=2M
//******************************************************
//* LIST ALL FILES IN THE UNIX DIRECTORY FOR USER=WSS01
//******************************************************
//SYSEXEC      DD DSN=SYS1.SBPXEXEC,DISP=SHR
//SYSTSPRT     DD SYSOUT=*
//SYSTSIN      DD *
OSHELL ls -al
//*
//*==============================================                    *
//  SET SCPATH='/u/NMD/wss01'                  <== SCRIPT LOCATION    *
//  SET SCRIPT='NDA_PUT.SCRIPT'                <== SCRIPT NAME        *
//  SET IPADDR='NDA_FTPSCRPT.sh'               <== DESTINATION IP/DNS *
//*==============================================                    *
//*
//BLDSCRPT EXEC PGM=ICEGENER
//************************************************
//* DYNAMICALLY CREATE THE UNIX SFTP BATCH SCRIPT
//************************************************
//SYSPRINT     DD DUMMY
//SYSIN        DD DUMMY
//SYSUT2       DD PATH=('&SCPATH./&SCRIPT'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT,OTRUNC),PATHMODE=SIRWXU
//*
//SYSUT1 DD *
ascii
PUT SCHOOL_AIN98A_OUTPUT.DAT AIN98A_$WYYYYMMDD..dat
ls -l
quit
/*
//*
//* ascii
//* PUT SCHOOL_AIN98A_OUTPUT.DAT AIN98A_$WYYYYMMDD..dat
//* ls -l
//* quit
//*
//STEP9    EXEC PGM=IEFBR14
//********************************************************************
//*        IEFBR14 - DELETE FILE IN OMVS
//********************************************************************
//DD01         DD  PATH='&SCPATH./&IPADDR',
//             FILEDATA=TEXT,PATHOPTS=ORDONLY,PATHDISP=DELETE
//*
//BLDSFTP  EXEC PGM=ICEGENER
//********************************************************************
//* COPY THE SFTP CONNECTION SCRIPT FROM A DATASET TO UNIX FILE
//*  PROD ===> DSN=WNP.WN91.NDA.SFTP.PUT.CONN.SCRIPT
//*                  for the EITS 'ftp.state.nv.us:22' site
//********************************************************************
//SYSUT1      DD DISP=SHR,DSN=WNP.WN91.NDA.SFTP.PUT.CONN.SCRIPT
//SYSUT2       DD PATH=('&SCPATH./&IPADDR'),FILEDATA=TEXT,
// PATHOPTS=(OWRONLY,OCREAT),PATHMODE=SIRWXU
//SYSPRINT     DD DUMMY
//SYSIN        DD DUMMY
//*
//* PROD SFTP SITE DSN=WNP.WN91.NDA.SFTP.PUT.CONN.SCRIPT
//*   sftp -o Batchmode=no -o PubkeyAuthentication=no -v
//*   -b /u/NMD/wss01/NDA_PUT.SCRIPT
//*   WelfareFTP@ftp.state.nv.us
//*
/*
//SFTP10   EXEC PGM=BPXBATCH
//***********************************************************
//* RUN UNIX SFTP BATCH SCRIPT JUST CREATED IN STEP BLDSCRPT
//***********************************************************
//STDIN        DD PATH='&SCPATH./&IPADDR',PATHOPTS=(ORDONLY)
//STDENV       DD DISP=SHR,DSN=&STDENV
//STDOUT       DD SYSOUT=*
//STDERR       DD SYSOUT=*
//STDOUT       DD SYSOUT=*
//SYSOUT       DD SYSOUT=*
//SYSPRINT     DD SYSOUT=*
//*
