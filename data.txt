CREATE TABLE NAC_BULK_PARTICIPANT_STG (
    RUN_DATE                 DATE           NOT NULL,
    UPI                      VARCHAR(20)    NOT NULL,
    ICI                      VARCHAR(20)    NOT NULL,
    LAST_NAME_NORM           VARCHAR(50)    NOT NULL,
    DOB_NORM                 DATE           NOT NULL,
    SSN_NORM                 VARCHAR(11)    NOT NULL,
    VULNERABLE_FLAG          CHAR(1)        NOT NULL,
    PARTICIPANT_CLOSE_DATE   DATE,
    RECENT_CERT_MONTHS       VARCHAR(50),
    LDS_HASH                 VARCHAR(128),
    FILE_NAME                VARCHAR(200),
    PROCESS_STATUS           VARCHAR(20),
    ERROR_MESSAGE            VARCHAR(2000),
    CREATED_TS               TIMESTAMP      NOT NULL DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (RUN_DATE, UPI)
);

CREATE TABLE NAC_BULK_UPLOAD_RUN (
    UPLOAD_ID                 VARCHAR(200) NOT NULL,
    RUN_DATE                  DATE         NOT NULL,
    FILE_NAME                 VARCHAR(200),
    INITIAL_STATUS            VARCHAR(20),
    INITIAL_MESSAGE           VARCHAR(2000),
    INITIAL_ERROR_MESSAGE     VARCHAR(2000),
    FINAL_STATUS              VARCHAR(20),
    TOTAL_PARTICIPANTS        INTEGER,
    PARTICIPANTS_UPLOADED     INTEGER,
    DELETION_START_TIME       TIMESTAMP,
    DELETION_END_TIME         TIMESTAMP,
    DELETION_STATUS           VARCHAR(50),
    TOTAL_DELETED_COUNT       INTEGER,
    DELETION_ERRORS           VARCHAR(2000),
    HTTP_STATUS_CODE          VARCHAR(10),
    TRANSPORT_ERROR_MESSAGE   VARCHAR(2000),
    CREATED_TS                TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    UPDATED_TS                TIMESTAMP,
    PRIMARY KEY (UPLOAD_ID)
);

CREATE TABLE NAC_DP_REQUEST (
    ICI                    VARCHAR(20)    NOT NULL,
    EVENT_TYPE             VARCHAR(30)    NOT NULL,
    EVENT_TS               TIMESTAMP      NOT NULL,
    UPI                    VARCHAR(20)    NOT NULL,
    SEARCH_REASON          VARCHAR(50),
    LAST_NAME_NORM         VARCHAR(50),
    DOB_NORM               DATE,
    SSN_NORM               VARCHAR(11),
    VULNERABLE_FLAG        CHAR(1),
    LDS_HASH               VARCHAR(128),
    NAC_VERIFY_FLAG        CHAR(1),
    VERIFY_FAIL_REASON     VARCHAR(500),
    PROCESS_STATUS         VARCHAR(20),
    MATCH_FOUND_FLAG       CHAR(1),
    RETRY_COUNT            INTEGER DEFAULT 0,
    ERROR_TYPE             VARCHAR(20),
    HTTP_STATUS_CODE       VARCHAR(10),
    TRANSPORT_ERROR_MSG    VARCHAR(2000),
    CREATED_TS             TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    UPDATED_TS             TIMESTAMP,
    PRIMARY KEY (ICI, EVENT_TYPE, EVENT_TS, UPI)
);

CREATE TABLE NAC_DP_RESPONSE_MATCH (
    ICI                       VARCHAR(20) NOT NULL,
    EVENT_TYPE                VARCHAR(30) NOT NULL,
    EVENT_TS                  TIMESTAMP   NOT NULL,
    UPI                       VARCHAR(20) NOT NULL,
    MATCH_ID                  VARCHAR(200) NOT NULL,
    MATCH_STATE               VARCHAR(2),
    MATCH_CASE_ID             VARCHAR(50),
    MATCH_PARTICIPANT_ID      VARCHAR(50),
    PARTICIPATION_CLOSE_DATE  DATE,
    RECENT_CERT_MONTHS        VARCHAR(200),
    CREATED_TS                TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (ICI, EVENT_TYPE, EVENT_TS, UPI, MATCH_ID)
);


CREATE TABLE NAC_DP_RESPONSE_ERROR (
    ICI            VARCHAR(20) NOT NULL,
    EVENT_TYPE     VARCHAR(30) NOT NULL,
    EVENT_TS       TIMESTAMP   NOT NULL,
    UPI            VARCHAR(20) NOT NULL,
    HTTP_STATUS    VARCHAR(20),
    ERROR_CODE     VARCHAR(100),
    ERROR_TITLE    VARCHAR(500),
    ERROR_DETAIL   VARCHAR(2000),
    CREATED_TS     TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (ICI, EVENT_TYPE, EVENT_TS, UPI, ERROR_CODE)
);

CREATE TABLE NAC_MATCH_HEADER (
    MATCH_ID                       VARCHAR(200) NOT NULL,
    INITIATOR_STATE                VARCHAR(50),
    CREATED_AT                     TIMESTAMP,
    STATUS                         VARCHAR(50),
    MBM_CREATED_AT                 TIMESTAMP,
    INIT_STATE_PRIMARY_EMAIL       VARCHAR(200),
    INIT_STATE_PHONE               VARCHAR(50),
    MATCH_STATE_PRIMARY_EMAIL      VARCHAR(200),
    MATCH_STATE_PHONE              VARCHAR(50),
    LAST_UPDATED_AT                TIMESTAMP,
    CREATED_TS                     TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (MATCH_ID)
);

CREATE TABLE NAC_MATCH_PARTICIPANT (
    MATCH_ID                  VARCHAR(200) NOT NULL,
    STATE_CODE                VARCHAR(2)   NOT NULL,
    ICI                       VARCHAR(50),
    UPI                       VARCHAR(50),
    PARTICIPANT_CLOSE_DATE    DATE,
    VULNERABLE_FLAG           CHAR(1),
    CREATED_TS                TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (MATCH_ID, STATE_CODE, ICI, UPI)
);


CREATE TABLE NAC_MATCH_DISPOSITION (
    MATCH_ID                        VARCHAR(200) NOT NULL,
    STATE_CODE                      VARCHAR(2)   NOT NULL,
    INITIAL_ACTION_AT               TIMESTAMP,
    INITIAL_ACTION_TAKEN            VARCHAR(100),
    INVALID_MATCH_FLAG              CHAR(1),
    INVALID_MATCH_REASON            VARCHAR(200),
    OTHER_INVALID_REASON            VARCHAR(200),
    FINAL_DISPOSITION               VARCHAR(100),
    FINAL_DISPOSITION_DATE          DATE,
    RESOLUTION_STATUS               VARCHAR(100),
    VULNERABLE_FLAG                 CHAR(1),
    CREATED_TS                      TIMESTAMP DEFAULT CURRENT TIMESTAMP,
    PRIMARY KEY (MATCH_ID, STATE_CODE)
);
