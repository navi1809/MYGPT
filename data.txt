package IVA_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=AIN49A ****
// COMPONENT NAME: AIN49A
// ===============
// 
// DESCRIPTION:
// ============
// THIS PROCESS CREATES A IV-E CASE IN THE IVA
// SYSTEM WHENEVER DCFC'S REFERS A CHILD.
// THREE TYPES OF RECORDS ARE SENT.
// 1. RECORD TYPE - "N".
//    ALL NEW CASES ARE RECEIVED IN THIS RECORD TYPE.
//    THE REFERRAL TO IVD IS DONE ONLY AFTER THE NCP
//    DATA IS ENTERED ON THE NCP1 SCREEN.
// 2. RECORD TYPE - 'U'
//    ALL UPDATES FOR AN EXISTING CASE ARE RECEIVED IN
//    THIS RECORD TYPE. REFERRAL TO IVD IS DONE ONLY
//    WHEN THE AID CODE OT ELIG CODE CHANGES.
// 3. RECORD TYPE - 'G'
//    ALL GRANT INFORMATION FOR AN EXISTING CASE ARE
//    RECEIVED THRU THIS RECORD TYPE. NO REFERRAL IS
//    DONE ON RECEIPT OF GRANT AMOUNT. THE GRANT
//    AMOUNT IS REFERRED TO IVD AS PART OF THE MONTH
//    END BATCH JOBS.
// WI #1002 - Add LAST-UPD-DT to insert of TWNPERSON_ADRS_HST.
// ***********************
Program AIN49A type basicProgram //VAGen Info - main batch program
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  AIF25W1 AIF25W1; // record
  AIN49W AIN49W; // record
  AIN49W1 AIN49W1; // record
  AIN49W2 AIN49W2; // record
  AIN49W3 AIN49W3; // record
  AIN49W4 AIN49W4; // record
  AIN49W5 AIN49W5; // record
  AIN49W6 AIN49W6; // record
  AIN49W7 AIN49W7; // record
  AIN49W8 AIN49W8; // record
  AIN49W9 AIN49W9; // record
  APO04W1 APO04W1; // record
  BDATEREC BDATEREC; // record
  CEP01W CEP01W; // record
  CMR01W1 CMR01W1; // record
  CMR02W1 CMR02W1; // record
  FAPO-POST-PARM FAPO-POST-PARM; // record
  G-IV-D G-IV-D; // record
  GDW GDW; // record
  GNOMADS GNOMADS; // record
  H-TUIDS3 H-TUIDS3; // record
  H2-2-FAC-SPT H2-2-FAC-SPT; // record
  H2-2-MCD-MRM H2-2-MCD-MRM; // record
  H2-3-CMH-FCE-PER H2-3-CMH-FCE-PER; // record
  H2-ALTERNATE-SSN H2-ALTERNATE-SSN; // record
  H2-CASE-LOG H2-CASE-LOG; // record
  H2-CASE-MEMBER H2-CASE-MEMBER; // record
  H2-CASE-MEMBER-HST H2-CASE-MEMBER-HST; // record
  H2-CASELD-DEBTLD H2-CASELD-DEBTLD; // record
  H2-CASLD-CASE-HST H2-CASLD-CASE-HST; // record
  H2-CODE-TBL H2-CODE-TBL; // record
  H2-ELG-VER-MBR H2-ELG-VER-MBR; // record
  H2-ELIG-DCFS H2-ELIG-DCFS; // record
  H2-ELIG-VERSION H2-ELIG-VERSION; // record
  H2-FAM-ACTNS H2-FAM-ACTNS; // record
  H2-FAM-ALT-PAYEE H2-FAM-ALT-PAYEE; // record
  H2-FAM-CASE H2-FAM-CASE; // record
  H2-FAM-CASE-HSTRY H2-FAM-CASE-HSTRY; // record
  H2-FAM-CASELD-CASE H2-FAM-CASELD-CASE; // record
  H2-FAM-NCP H2-FAM-NCP; // record
  H2-IVD-CASE H2-IVD-CASE; // record
  H2-IVD-CASE-CHILD H2-IVD-CASE-CHILD; // record
  H2-MA-BILL-SQ-NMB H2-MA-BILL-SQ-NMB; // record
  H2-MEMBER-REL H2-MEMBER-REL; // record
  H2-OFFICE H2-OFFICE; // record
  H2-PERSON H2-PERSON; // record
  H2-PERSON-ADRS-HST H2-PERSON-ADRS-HST; // record
  H2-PERSON-DTLS H2-PERSON-DTLS; // record
  H2-PERSON-HSTRY H2-PERSON-HSTRY; // record
  H2-PRGM-CASE-DTLS H2-PRGM-CASE-DTLS; // record
  H2-PRGM-CASE-HSTRY H2-PRGM-CASE-HSTRY; // record
  H2-REUNIF-DATA H2-REUNIF-DATA; // record
  H2-UERND-INCM-DTL H2-UERND-INCM-DTL; // record
  H3-PERSON H3-PERSON; // record
  P-DATE-REC2 P-DATE-REC2; // record
  PALERT-PARMS PALERT-PARMS; // record
  PCAL16A-INP PCAL16A-INP; // record
  PCALINP PCALINP; // record
  PCMR-ICI PCMR-ICI; // record
  PDCM-CASE-TRACKING PDCM-CASE-TRACKING; // record
  POUT-AIN62A POUT-AIN62A; // record
  SR-AIN49-RPT-REC SR-AIN49-RPT-REC; // record
  SR-Q-01F-REC SR-Q-01F-REC; // record
  SR-Q-03F-REC SR-Q-03F-REC; // record
  SR-Q-04F-REC SR-Q-04F-REC; // record
  SR-Q-CNT-REC SR-Q-CNT-REC; // record
  SR-Q-DCF-REC SR-Q-DCF-REC; // record
  SR-Q-REGRNT-REC SR-Q-REGRNT-REC; // record
  VCOMMON VCOMMON; // record
  VCONTROL VCONTROL; // record
  VDBCOMMON VDBCOMMON; // record
  VDBCONTROL VDBCONTROL; // record
  VMESSAGE VMESSAGE; // record
  VSTRREC VSTRREC; // record
  VSTRREC4 VSTRREC4; // record
  VWORKSTOR VWORKSTOR; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    AIN49P9-MAIN: AIN49P9-MAIN();
  end // end main
end // end AIN49A


Function AIN49P9-AGDOUT-PRC()
  set H2-PERSON-DTLS empty;

  if (SR-Q-DCF-REC.D-AGED-OUT-FOSTER-FG == "Y")
    H2-PERSON-DTLS.UPI = AIN49W.WS-UPI;
    H2-PERSON-DTLS.AGEDOUT-FSTR-CARE = "01";

    AIN49P9-UPD-PED();
    if (sysVar.sqlData.sqlcode == 100)
      AIN49P9-INS-PED();
    end

  end
  /*  */
end // end AIN49P9-AGDOUT-PRC


// ALERT IVD WORKER
Function AIN49P9-ALRT-IVD()
  /* THIS PROCESS CREATED DUE TO PTR 4631*/
  /* PTR 3360 BEGIN*/
  if (AIN49W5.WS-NCP-FG == "Y"
   || AIN49W5.WS-CHD-FG == "Y"
   || AIN49W5.WS-CST-FG == "Y")
    PCALINP.PAL-ALERT-CD = AIN49W.WS-ALERT-IVD-ID;
    PCALINP.PAL-UPI = AIN49W.WS-IVA-UPI;
    PCALINP.PAL-SUFFIX = " ";
    PCALINP.PAL-ALERT-ACTION = "C";
  /*  */
  /* -----------------------PTR 6273 BEGIN-----------------------*/
    PCALINP.PAL-DISPL-DT = AIN49W.WS-PROCESS-DT;
  /* -----------------------PTR 6273 BEGIN-----------------------*/
  /*  */
    call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
    WDB00PI();
  end
  /* PTR 3360 END*/
end // end AIN49P9-ALRT-IVD


// CALLS IVA/IVD ALERT PROCESS
Function AIN49P9-ALRT-WRK()
  /* ALERT WORKER*/
  /* ------------------- PTR 4631 BEGIN -----------------------*/
  /* the IVA / IVD alerts are rewritten. Either the IVA worker is alerted*/
  /* or the IVD worker is alerted. The process of alerting is therefore*/
  /* done in two paragraphs. The ALERT-WORKER-PROCESS alerts the IVA*/
  /* worker and the ALERT-IVD-WORKER alerts the IVD worker*/

  if (AIN49W5.WS-IVA-CASE-MBR-FG == "Y"
   || AIN49W5.WS-IVE-MMBR-IND == "Y")
  /*  */
  /* *****-------- Changes due to ptr 3049 begin ------ *******/
  /*  */
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "N" || 
    SR-Q-DCF-REC.D-RECORD-TYPE == "G")
      PCALINP.PAL-UPI = AIN49W.WS-ICI;

  /* ** WI 13293 ***  BEGIN*/
      if (AIN49W.WS-FS-CASE == "T" && SR-Q-DCF-REC.D-RECORD-TYPE == "G")
        PCALINP.PAL-UPI = AIN49W.WS-FS-ICI;
      end
  /* ** WI 13293 *** END ****/

    else
      PCALINP.PAL-UPI = AIN49W.WS-IVA-ICI;
    end
  /*  */
  /* *****-------- Changes due to ptr 3049 end -------- *******/
  /*  */
    PCALINP.PAL-ALERT-CD = 129006;
    PCALINP.PAL-ALERT-ACTION = "C";

    call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
  end
  /* ------------------- PTR 4631 END ----------------------------*/


  if (AIN49W5.WS-NCP-FG == "Y")
  /*  */
  /* DB  INITIALIZATION*/
    H2-IVD-CASE.NCP-UPI = H2-PERSON.UPI;
    AIN49P9-READ-S10();
    VDBCOMMON.UNRF = "Y";
    VDBCOMMON.UDUP = "N";
    /* perform sql error processing*/
    /*  */
    WDB00PE-SQLERR();
    /* check for fatal errors*/
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  /*  */
    while (sysVar.sqlData.sqlcode == 0)
      AIN49P9-SCAN-S10();
      if (sysVar.sqlData.sqlcode == 0)
  /* RE ARRANGEMENT BEFORE CONCATENATING WITH CASE-SUFX*/
        AIN49W4.WS-UPI = H2-IVD-CASE.NCP-UPI;
  /*  */
  /* ******** -------- Changes due to ptr 3049 begin ------- ********/
  /*  */
        VSTRREC.UCONCAT = "U";
  /*  */
  /* ******** -------- Changes due to ptr 3049 end --------- ********/
  /*  */
        VSTRREC.UCONLEN = 1;
        VSTRREC.USTRING = AIN49W4.WS-UPI-CHAR;
        VSTRREC.USTRLEN = 10;

        call "WST25A" (VSTRREC) {isNoRefresh = yes};

        if (VCONTROL.URC == 0)
          AIN49W4.WS-STR = VSTRREC.USTRING;
          PCALINP.PAL-CASE-ID = AIN49W4.WS-STR1;
          AIN49P9-CAL-ALRT();
        end
      end
    end
    VDBCOMMON.UNRF = "1";
    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  end

  if (AIN49W5.WS-CST-FG == "Y")

  /* DB  INITIALIZATION*/
    H2-IVD-CASE.CST-UPI = H2-PERSON.UPI;
    AIN49P9-READ-S11();

    while (sysVar.sqlData.sqlcode == 0)
      AIN49P9-SCAN-S11();
      if (sysVar.sqlData.sqlcode == 0)
  /* RE ARRANGEMENT BEFORE CONCATENATING WITH CASE-SUFX*/
        AIN49W4.WS-UPI = H2-IVD-CASE.NCP-UPI;
  /* ******** -------- Changes due to ptr 3049 begin ------- ********/
  /*  */
        VSTRREC.UCONCAT = "U";
  /*  */
  /* ******** -------- Changes due to ptr 3049 end --------- ********/
  /*  */
        VSTRREC.UCONLEN = 1;
        VSTRREC.USTRING = AIN49W4.WS-UPI-CHAR;
        VSTRREC.USTRLEN = 10;

        call "WST25A" (VSTRREC) {isNoRefresh = yes};

        if (VCONTROL.URC == 0)
          AIN49W4.WS-STR = VSTRREC.USTRING;
          PCALINP.PAL-CASE-ID = AIN49W4.WS-STR1;
          AIN49P9-CAL-ALRT();
        end

      end
    end
    VDBCOMMON.UNRF = "1";
    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end


  if (AIN49W5.WS-CHD-FG == "Y")

  /* DB  INITIALIZATION*/
    H2-IVD-CASE-CHILD.CHD-UPI = H2-PERSON.UPI;
    AIN49P9-READ-S12();

    while (sysVar.sqlData.sqlcode == 0)
      AIN49P9-SCAN-S12();
      if (sysVar.sqlData.sqlcode == 0)
  /* RE ARRANGEMENT BEFORE CONCATENATING WITH CASE-SUFX*/
        AIN49W4.WS-UPI = H2-IVD-CASE-CHILD.NCP-UPI;
  /* ******** -------- Changes due to ptr 3049 begin ------- ********/
  /*  */
        VSTRREC.UCONCAT = "U";
  /*  */
  /* ******** -------- Changes due to ptr 3049 end --------- ********/
  /*  */
        VSTRREC.UCONLEN = 1;
        VSTRREC.USTRING = AIN49W4.WS-UPI-CHAR;
        VSTRREC.USTRLEN = 10;

        call "WST25A" (VSTRREC) {isNoRefresh = yes};

        if (VCONTROL.URC == 0)
          AIN49W4.WS-STR = VSTRREC.USTRING;
          PCALINP.PAL-CASE-ID = AIN49W4.WS-STR1;
  /*  */
  /* -------------------PRT 6273 BEGIN-----------------------------*/
          PCALINP.PAL-DISPL-DT = AIN49W.WS-PROCESS-DT;
  /* -------------------PRT 6273 END-------------------------------*/
  /*  */
          AIN49P9-CAL-ALRT();
        end

      end
    end
    VDBCOMMON.UNRF = "1";
    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end
end // end AIN49P9-ALRT-WRK


// PROCESS ALTERNATE PAYEE CHANGE
Function AIN49P9-ALTP-CHG()
  /* ALTP CHANGE PROCESS*/
  /* -----------------------------------------------------------------------*/
  /* if the resident county code changes, the TWNFAM CASE HSTRY is split*/
  /* If the zip code changes the TWNFAM CASE HSTRY is split*/
  /* -----------------------------------------------------------------------*/

  if (SR-Q-DCF-REC.D-ADDR-RESIDENT-COUNTY != " "
   || SR-Q-DCF-REC.D-ADDR-MAILING-ZIP != " ")
    AIN49P9-SPLIT-FCH();
  end

  /* -----------------------------------------------------------------------*/
  /* For an update case, if the D-ADDR-CHANGED flag is set to 'Y', the*/
  /* following data fields received from the interface are unconditionally*/
  /* updated in the TWN_ALT_PAYEE table.*/
  /* D-ADDR-MAILING-NBR, D-ADDR-MAILING-DIR, D-ADDR-MAILING-STREET,*/
  /* D-ADDR-MAILING-TYPE, D-ADDR-MAILING-APT, D-ADDR-MAILING-OTHER,*/
  /* D-ADDR-HOME-TELEPHONE*/
  /* The IF .... = LOW-VALUES check is therefore removed.*/
  /* -----------------------------------------------------------------------*/

  WDB00PI();

  set H2-FAM-ALT-PAYEE empty;

  H2-FAM-ALT-PAYEE.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-FAM-ALT-PAYEE.EFF-FR-DT = AIN49W.WS-FIRST-DATE;
  H2-FAM-ALT-PAYEE.ALT-PYE-TYP = "D";

  AIN49P9-READ-S13();

  if (sysVar.sqlData.sqlcode == 0)

    if (H2-FAM-ALT-PAYEE.EFF-FR-DT == AIN49W.WS-FIRST-DATE)
      if (SR-Q-DCF-REC.D-ADDR-CHANGED == "Y")

        H2-FAM-ALT-PAYEE.HOUSE-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-NBR;
        H2-FAM-ALT-PAYEE.STR-DIR = SR-Q-DCF-REC.D-ADDR-MAILING-DIR;
        H2-FAM-ALT-PAYEE.STR-NM = SR-Q-DCF-REC.D-ADDR-MAILING-STREET;
        H2-FAM-ALT-PAYEE.STR-TYPE = SR-Q-DCF-REC.D-ADDR-MAILING-TYPE;
        H2-FAM-ALT-PAYEE.APT-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-APT;
        H2-FAM-ALT-PAYEE.OTH-ADDR = SR-Q-DCF-REC.D-ADDR-MAILING-OTHER;
        H2-FAM-ALT-PAYEE.CITY = SR-Q-DCF-REC.D-ADDR-MAILING-CTY;
        H2-FAM-ALT-PAYEE.ST-CD = SR-Q-DCF-REC.D-ADDR-MAILING-STATE;
        H2-FAM-ALT-PAYEE.ZIP-CD = SR-Q-DCF-REC.D-ADDR-MAILING-ZIP;
        H2-FAM-ALT-PAYEE.PHN-NMB = SR-Q-DCF-REC.D-ADDR-HOME-TELEPHONE;
      end
      if (SR-Q-DCF-REC.D-ALTP-CHANGED == "Y")
        H2-FAM-ALT-PAYEE.ALT-PYE-FRST-NM = SR-Q-DCF-REC.D-ALTP-FIRST-NAME;
        H2-FAM-ALT-PAYEE.ALT-PYE-MID-NM = SR-Q-DCF-REC.D-ALTP-MIDDLE-NAME;
        if (SR-Q-DCF-REC.D-ALTP-LAST-NAME > " ")
          H2-FAM-ALT-PAYEE.ALT-PYE-LST-NM = SR-Q-DCF-REC.D-ALTP-LAST-NAME;
        end
      end

      H2-FAM-ALT-PAYEE.ICI = H2-3-CMH-FCE-PER.ICI;
      H2-FAM-ALT-PAYEE.EFF-TO-DT = AIN49W.WS-FIRST-DATE;
      H2-FAM-ALT-PAYEE.ALT-PYE-TYP = "D";

      AIN49P9-REP-U03();

      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    else
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-LAST-DATE();
      H2-FAM-ALT-PAYEE.EFF-TO-DT = AIN49W.WS-LAST-DATE;

      AIN49P9-UPD-U25(); /* set EFF-TO-DT*/
      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end

      if (SR-Q-DCF-REC.D-ADDR-CHANGED == "Y")

        H2-FAM-ALT-PAYEE.HOUSE-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-NBR;
        H2-FAM-ALT-PAYEE.STR-DIR = SR-Q-DCF-REC.D-ADDR-MAILING-DIR;
        H2-FAM-ALT-PAYEE.STR-NM = SR-Q-DCF-REC.D-ADDR-MAILING-STREET;
        H2-FAM-ALT-PAYEE.STR-TYPE = SR-Q-DCF-REC.D-ADDR-MAILING-TYPE;
        H2-FAM-ALT-PAYEE.APT-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-APT;
        H2-FAM-ALT-PAYEE.OTH-ADDR = SR-Q-DCF-REC.D-ADDR-MAILING-OTHER;
        H2-FAM-ALT-PAYEE.CITY = SR-Q-DCF-REC.D-ADDR-MAILING-CTY;
        H2-FAM-ALT-PAYEE.ST-CD = SR-Q-DCF-REC.D-ADDR-MAILING-STATE;
        H2-FAM-ALT-PAYEE.ZIP-CD = SR-Q-DCF-REC.D-ADDR-MAILING-ZIP;
        H2-FAM-ALT-PAYEE.PHN-NMB = SR-Q-DCF-REC.D-ADDR-HOME-TELEPHONE;
      end
      if (SR-Q-DCF-REC.D-ALTP-CHANGED == "Y")
        H2-FAM-ALT-PAYEE.ALT-PYE-FRST-NM = SR-Q-DCF-REC.D-ALTP-FIRST-NAME;
        H2-FAM-ALT-PAYEE.ALT-PYE-MID-NM = SR-Q-DCF-REC.D-ALTP-MIDDLE-NAME;
        if (SR-Q-DCF-REC.D-ALTP-LAST-NAME > " ")
          H2-FAM-ALT-PAYEE.ALT-PYE-LST-NM = SR-Q-DCF-REC.D-ALTP-LAST-NAME;
        end
      end
      H2-FAM-ALT-PAYEE.EFF-FR-DT = AIN49W.WS-FIRST-DATE;
      H2-FAM-ALT-PAYEE.EFF-TO-DT = "9999-12-31";
      H2-FAM-ALT-PAYEE.ALT-PYE-TYP = "D";

      AIN49P9-INS-I16();

      VDBCOMMON.UDUP = "Y";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  end
end // end AIN49P9-ALTP-CHG


// PROCESS APPLICATION CHANGE
Function AIN49P9-APPL-CHG()
  AIN49P9-DATE-CHG();
  AIN49P9-DIST-OFF();
end // end AIN49P9-APPL-CHG


// BUILD CHILD WELFARE REPORT
Function AIN49P9-BLD-CHWELF()
  /* ----------------------PTR 7826 BEGIN--------------------------------*/
  /*  */
  /* ws-upi is moved to TWNCASE_MEMBER_HST.UPI, instead of*/
  /* TWNPERSON.UPI because TWNPERSON.UPI will not have any value*/
  /* if the person is not known to nomads or when a pseudo ssn*/
  /* is sent.*/
  /*  */
  AIN49A-01-SSN = SR-Q-DCF-REC.D-MEMB-SSN;

  if (AIN49W.WS-BASE-DATA-EXISTS == "Y")
  /* ----------------------PTR 7826 - 6 BEGIN----------------------------*/
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
      AIN49W.WS-PSEUDO-SSN = SR-Q-DCF-REC.D-MEMB-SSN;
      if (AIN49W.WS-PSEUDO-SSN-1-R is numeric
       && AIN49W.WS-PSEUDO-SSN-2-R is numeric) /* PTR 7826 - 7*/
        H2-PERSON.SSN = SR-Q-DCF-REC.D-MEMB-SSN;

        WDB00PI();
        AIN49P9-READ-S01();
        VDBCOMMON.UNRF = "Y";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC >= 104)
          WCM00P2-TO-CEP01A();
        end
        AIN49W.WS-CASE-MEMB-UPI = H2-PERSON.UPI;
      end
    else
      if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
  /* **  PTR 8170 - 4 Begin  ------*/
        AIN49W.WS-CASE-MEMB-UPI = H2-3-CMH-FCE-PER.UPI;
  /* ** PTR 8170 - 4 End ---*/
      end
    end
  /* -----------------PTR 7826 - 6 END--------------------------------*/

  /*  */
    H2-3-CMH-FCE-PER.UPI = AIN49W.WS-CASE-MEMB-UPI;
    H2-3-CMH-FCE-PER.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;
    AIN49P9-RD-S08();
    VDBCOMMON.UNRF = "Y";
    VDBCOMMON.UDUP = "N";
    /* perform sql error processing*/
    /*  */
    WDB00PE-SQLERR();
    /* check for fatal errors*/
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    if (sysVar.sqlData.sqlcode == 0)
      set SR-Q-01F-REC empty;
      SR-Q-01F-REC.AIN49A-01-SSN = H2-3-CMH-FCE-PER.SSN;
      H2-2-FAC-SPT.ICI = H2-3-CMH-FCE-PER.ICI;
  /* ------------------PTR 4685 BEGIN ----------------------------*/
  /* the WS-PROCESS-DT is also used to access the TWNSUP_UNT_POS_HST*/
      H2-2-FAC-SPT.ASMNT-BEG-DT = AIN49W.WS-PROCESS-DT;
      H2-2-FAC-SPT.ASMNT-END-DT = AIN49W.WS-PROCESS-DT;
  /* ------------------PTR 4685 END -------------------------------*/
  /*  */
  /* Perform the process to fetch the worker id*/
  /*  */
      AIN49P9-READ-S22();
  /*  */
  /* Set the value for NRF flag*/
  /*  */
      VDBCOMMON.UNRF = "Y";
  /*  */
      WDB00PE-SQLERR();
  /*  */
  /* Check for fatal errors*/
  /*  */
      if (VDBCONTROL.URC >= 104)
        WCM00P2-TO-CEP01A();
      end
      SR-Q-01F-REC.AIN49A-01-WORKER-NUMBER = H2-2-FAC-SPT.NOMADS-USRID;
    end
  end
  /*  */
  /* Move the fetched value to the output serial record*/
  /*  */
  SR-Q-01F-REC.AIN49A-01-IVE-CASE-NUMBER = SR-Q-DCF-REC.D-KEY-CASE-NUMBER;
  AIN49W.WS-LAST-NAME = SR-Q-DCF-REC.D-MEMB-LAST-NAME;
  AIN49W.WS-MIDDLE-NAME = SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME;
  AIN49W.WS-FIRST-NAME = SR-Q-DCF-REC.D-MEMB-FIRST-NAME;
  SR-Q-01F-REC.AIN49A-01-NAME = AIN49W.WS-NAME;
  /*  */
  /* ******* --------- Changes due to ptr 2819 end ---------- **********/
  /*  */
  if (AIN49W.WS-REJECT-RECORD == "Y")
    SR-Q-01F-REC.AIN49A-01-STATUS = "REJECTED";
  /*  */
  /* ******* ---------- Changes due to ptr 5492 BEGIN -------- *********/
  /*  */
  /* the reasons for rejection are derived in a seperate para*/
  /*  */
    AIN49P9-REJ-RSN();
  /* ******* ---------- Changes due to ptr 5492 end ---------- *********/
  else
    SR-Q-01F-REC.AIN49A-01-STATUS = "CREATED";
    SR-Q-01F-REC.AIN49A-01-RSN = " ";
  end
  AIN49P9-WR-01-REC();
  /*  */
  VDBCOMMON.UNRF = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
end // end AIN49P9-BLD-CHWELF


// CALLS CAL11A PROCESS
Function AIN49P9-CAL-ALRT()
  /* CALL ALERT*/
  /*  */
  /* ---------PTR # AIN49001 CHANGE BEGINS--------------*/
  /*  */
  if (AIN49W5.WS-IVA-CASE-MBR-FG == "Y")
    PALERT-PARMS.PALERT-ALERT-ID = 129006;
  else
    if (AIN49W5.WS-NCP-FG == "Y" || 
    AIN49W5.WS-CST-FG == "Y" || 
    AIN49W5.WS-CHD-FG == "Y")
      PALERT-PARMS.PALERT-ALERT-ID = 390041;
    else
      return;
    end
  end
  /*  */
  /* ---------PTR # AIN49001 CHANGE ENDS----------------*/
  /*  */
  PALERT-PARMS.PALERT-ACTION-ID = "C";
  PALERT-PARMS.PALERT-DISP-DT = AIN49W.WS-CURRENT-DATE;
  /*  */
  /* ******** -------- Changes due to ptr 3049 begin --------- ********/
  /*  */
  /* Move to plaert-case-id is removed from here as it is already*/
  /* done in ALERT-WORKER-PROCESS*/
  /*  */
  /*  */
  /* ******** -------- Changes due to ptr 3049 end ----------- ********/
  /*  */
  /* ---------------------------PTR 6820 BEGIN--------------------------*/
  PCALINP.PAL-ALERT-CD = PALERT-PARMS.PALERT-ALERT-ID;
  PCALINP.PAL-ALERT-ACTION = PALERT-PARMS.PALERT-ACTION-ID;
  PCALINP.PAL-DISPL-DT = PALERT-PARMS.PALERT-DISP-DT;
  /* ---------------------------PTR 6820 END----------------------------*/
  call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CAL-ALRT


// CHECK FOR DUPLICATE ASSISTANCE
Function AIN49P9-CHECK-DUP()
  /* ******--------- PHASE3 REWORK START----------***********/

  set H2-CASE-MEMBER-HST empty;
  AIN49W.WS-POST-TYPE = "A";
  H2-CASE-MEMBER-HST.UPI = AIN49W.WS-UPI;
  /* ****/
  /* *** p-10> changes due to ptr # ain49003 start ------- ******/
  /* ***/
  /* ---------------------PTR 3144 BEGIN -----------------------*/
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;
  H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-PROCESS-DT;
  /* ---------------------PTR 3144 END -------------------------*/
  /* *** p-10> changes due to ptr # ain49003 end --------- ******/
  /* ***/
  if (AIN49W.WS-DUPLICATE-HOH == "Y")
    H2-CASE-MEMBER-HST.ICI = 0;
  else
    H2-CASE-MEMBER-HST.ICI = AIN49W.WS-ICI;
  end
  AIN49W.WS-DCFS-ICI = AIN49W.WS-ICI;
  WDB00PI();
  AIN49P9-READ-S16();
  while (sysVar.sqlData.sqlcode == 0)
    AIN49P9-SCAN-S16();
    if (sysVar.sqlData.sqlcode == 0)
  /*  */
  /* -----------------------------PTR 4628 BEGIN -------------------*/
  /* reference to Elig code '6' is removed when checking AFDC Elig codes*/
      if ((H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "B" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "5" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "A" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "P" || 
      H2-CASE-MEMBER-HST.AFDC-ELIG-CD == "E" || 
      H2-CASE-MEMBER-HST.SG-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.TC-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.TL-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.TN-ELIG-CD == "1" || 
      H2-CASE-MEMBER-HST.TP-ELIG-CD == "1") || 
      (H2-CASE-MEMBER-HST.MA-ELIG-CD == "A" || 
       /* ----------------------PTR 4629*/
       /* ---------------*/
       /* the elig code '6' is also used to*/
       /* determine duplicate assistance*/
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "B" || 
       /* ----------------------PTR 4629*/
       /* END------------*/
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "5" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "M" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "C" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "D" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "L" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "S" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "W" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "P" || 
      H2-CASE-MEMBER-HST.MA-ELIG-CD == "E")
       || (H2-CASE-MEMBER-HST.FS-ELIG-CD == "1")) /* PTR 7652*/
        AIN49W.WS-POST-TYPE = "M";
  /* ----------------PTR 4628 END --------------------------------*/
  /*  */
  /* ******** ---------- Changes due to ptr 3049 begin --------- *******/
  /*  */
        AIN49W.WS-ICI = H2-CASE-MEMBER-HST.ICI;
  /*  */
  /* ******** ---------- Changes due to ptr 3049 end ----------- *******/
  /*  */
        AIN49P9-ALRT-WRK();

  /* **7826 - 19 For duplicate assistance on FS case,the case is auto posted*/
        if ((H2-CASE-MEMBER-HST.FS-ELIG-CD == "1"))
          AIN49W.WS-POST-TYPE = "A";
        end
      end
    end
  end
  VDBCOMMON.UNRF = "1";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN49W.WS-ICI = AIN49W.WS-DCFS-ICI;
  /* ********------------ PHASE3 REWORK END -----------***********/
end // end AIN49P9-CHECK-DUP


// CREATE PERSON DATA
Function AIN49P9-CHK-BLNGNO()
  set H3-PERSON empty;

  /*  */
  if (SR-Q-DCF-REC.D-MEMB-MA-NBR != " ")
    if (SR-Q-DCF-REC.D-MEMB-MA-NBR is numeric)
      AIN49W5.WS-MEMB-MA-NBR = SR-Q-DCF-REC.D-MEMB-MA-NBR;
      AIN49W5.WS-MEMB-MA-NBR2 = AIN49W5.WS-MEMB-MA-NBR;
      H3-PERSON.MEDIC-BLNG-SQ-NMB = AIN49W5.WS-MEMB-MA-NBR2;
    else
      AIN49W5.WS-MEMB-MA-NBR = SR-Q-DCF-REC.D-MEMB-MA-NBR;
      AIN49W5.WS-COUNT1 = 11;
      AIN49W5.WS-COUNT2 = 11;
      while (AIN49W5.WS-COUNT1 > 0)
        if (AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT1] == " ")
        else
          AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT2] = AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT1];
          AIN49W5.WS-COUNT2 = AIN49W5.WS-COUNT2 - 1;
        end
        AIN49W5.WS-COUNT1 = AIN49W5.WS-COUNT1 - 1;
      end
      while (AIN49W5.WS-COUNT2 > 0)
        AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT2] = "0";
        AIN49W5.WS-COUNT2 = AIN49W5.WS-COUNT2 - 1;
      end
      AIN49W5.WS-MEMB-MA-NBR2 = AIN49W5.WS-MEMB-MA-NBR;
      H3-PERSON.MEDIC-BLNG-SQ-NMB = AIN49W5.WS-MEMB-MA-NBR2;
    end

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";
    VDBCOMMON.UAPPLNAM = "AIN49A";

    AIN49P9-READ-S41();
    VDBCOMMON.UNRF = "Y";
    VDBCOMMON.UDUP = "N";
    WDB00PE-SQLERR();

    if (VDBCONTROL.URC >= 104)
      WCM00P2-TO-CEP01A();
    end

    if (sysVar.sqlData.sqlcode == 0)
      if (SR-Q-DCF-REC.D-MEMB-SSN != H3-PERSON.SSN)
        SR-Q-CNT-REC.AININT-CNT-REC-SKIP = SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;
        AIN49W.WS-REJECT-RSN = "DP";
        AIN49W.WS-REJECT-RECORD = "Y";

        SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO - 1;
      end
    end
  end
end // end AIN49P9-CHK-BLNGNO


// PERSON RESOLUTION FOR CHILD
Function AIN49P9-CHK-CHLD()
  /* CHECK IF THE CHILD IS KNOWN TO NOMADS.*/

  /* KEY SETTING PROCESS*/
  H2-PERSON.SSN = SR-Q-DCF-REC.D-MEMB-SSN;

  AIN49W.WS-REJECT-RECORD = "N";
  AIN49W.WS-DUPLICATE-HOH = " ";
  /* *********-------- PHASE3 REWORK START---------***************/

  /* MOVE 'N' TO AIN49W.WS-CHILD-KNOWN;*/

  /* *********-------- PHASE3 REWORK END---------***************/

  /* MOVING THE LAST NAME AND FIRST NAME INTO WORKING STORAGE FOR*/
  /* COMPARISON.*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-LAST-NAME TO AIN49W1.WS-MEMB-LAST-NAME;*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-FIRST-NAME TO AIN49W1.WS-MEMB-FIRST-NAME;*/

  if (SR-Q-DCF-REC.D-MEMB-DOB not blanks)
    AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-MEMB-DOB;
    AIN49W.WS-DD = AIN49W5.WS-DD3;
    AIN49W.WS-MM = AIN49W5.WS-MM3;
    AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
    AIN49W.WS-YY-CC1 = AIN49W5.WS-CC3;
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
  end
  WDB00PI();
  AIN49P9-READ-S01();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /* perform sql error processing*/
  /*  */
  WDB00PE-SQLERR();
  /* check for fatal errors*/
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
  /* ** move values retrieved, to working storage*/
    AIN49W5.WS-UPI1 = H2-PERSON.UPI;
    AIN49W5.WS-IVA-CASE-MBR-FG = H2-PERSON.IVA-CASE-MBR-FG;
    AIN49W5.WS-IVE-MMBR-IND = H2-PERSON.IVE-MMBR-IND;
    AIN49W5.WS-NCP-FG = H2-PERSON.NCP-FG;
    AIN49W5.WS-CHD-FG = H2-PERSON.CHD-FG;
    AIN49W5.WS-CST-FG = H2-PERSON.CST-FG;
  /* IF THE FIRST CHARACTER OF THE FIRST NAME AND LAST NAME OF THE PERSON*/
  /* RECORD MATCHES WITH THE FIRST CHARACTER OF THE FIRST NAME AND LAST*/
  /* NAME OF THE INTERFACE RECORD, THEN THE PERSON IS THE SAME.*/
  /* MOVE H2-PERSON.LST-NM TO AIN49W1.WS-LAST-NAME;*/
  /* MOVE H2-PERSON.FRST-NM TO AIN49W1.WS-FIRST-NAME;*/

    if (AIN49W.WS-DATE == H2-PERSON.DOB)
  /* IF (AIN49W1.WS-LAST-NAME-1 = AIN49W1.WS-MEMB-LAST-NAME-1) AND*/
  /* (AIN49W1.WS-FIRST-NAME-1 = AIN49W1.WS-MEMB-FIRST-NAME-1);*/
  /*  */
  /* ******---------- CHANGES DUE TO PTR 2819 BEGIN ---------- **********/
  /*  */
  /* If person is known to nomads,check to see if he is the HOH of an*/
  /* active IV-A case. If so,reject the record.*/
  /*  */
      H2-FAM-CASE.HOH-UPI = H2-PERSON.UPI;
  /* Read the table TWNFAM_CASE to check if the person is the*/
  /* hoh of an active iva-case.*/
      WDB00PI();
      VDBCONTROL.UACCTYP = "R";
      VDBCOMMON.UAPPLNAM = "AIN49A";
      AIN49P9-READ-S21();
      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC >= 104)
        WCM00P2-TO-CEP01A();
      end
      if (sysVar.sqlData.sqlcode == 0)
        H2-PRGM-CASE-HSTRY.ICI = H2-FAM-CASE.ICI;
        AIN49P9-READ-S40();
        VDBCOMMON.UNRF = "Y";
        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC >= 104)
          WCM00P2-TO-CEP01A();
        end
        if (sysVar.sqlData.sqlcode == 0)
          SR-Q-CNT-REC.AININT-CNT-REC-SKIP = SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;
          AIN49W.WS-REJECT-RSN = "DP";
          AIN49W.WS-REJECT-RECORD = "Y";
        else
          if (sysVar.sqlData.sqlcode == 100)
  /* CHANGES FOR WI14240 - DUPLICATE HOH PROCESSING - START;*/
            AIN49W.WS-DUPLICATE-HOH = "Y";

            SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
            AIN49W.WS-CHILD-KNOWN = "Y";
            AIN49W.WS-UPI = H2-PERSON.UPI;
            AIN49W.WS-ICI = H2-FAM-CASE.ICI;
          end
        end
      else
        SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
        AIN49W.WS-CHILD-KNOWN = "Y";
        AIN49W.WS-UPI = H2-PERSON.UPI;
      end
    else
      SR-Q-CNT-REC.AININT-CNT-REC-SKIP = SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;
      AIN49W.WS-REJECT-RECORD = "Y";
  /* MOVE 'NM' TO AIN49W.WS-REJECT-RSN;*/
  /* WI# 25430: IF SSN MATCHES AND DOB DOES NOT MATCH REJECT WITH CODE 'DB'*/
      AIN49W.WS-REJECT-RSN = "DB";
    end
  else
    if (VDBCONTROL.UROWR < 1)
      SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
      AIN49W.WS-CHILD-KNOWN = "N";
    end
  end
  VDBCOMMON.UNRF = "1";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CHK-CHLD


// CHECK FOR FS PARTICIPATION
Function AIN49P9-CHK-FS()

  set H2-CASE-MEMBER-HST empty;
  H2-CASE-MEMBER-HST.UPI = AIN49W.WS-UPI;
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
  H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-FIRST-DATE;
  H2-CASE-MEMBER-HST.ICI = AIN49W.WS-ICI;
  AIN49W.WS-FS-CASE = "F";

  WDB00PI();

  AIN49P9-READ-S16();
  while (sysVar.sqlData.sqlcode == 0)
    AIN49P9-SCAN-S16();
    if (sysVar.sqlData.sqlcode == 0)

      if (H2-CASE-MEMBER-HST.FS-ELIG-CD == "1")

        AIN49W.WS-FS-ICI = H2-CASE-MEMBER-HST.ICI;
        AIN49W.WS-FS-CASE = "T";
        AIN49P9-ALRT-WRK();
        AIN49W.WS-FS-CASE = "F";

      end

    end

  end
  VDBCOMMON.UNRF = "1";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN49W.WS-ICI = AIN49W.WS-DCFS-ICI;
  /* ********------------ PHASE3 REWORK END -----------***********/
end // end AIN49P9-CHK-FS


Function AIN49P9-CHK-IVAFAP()
  /* NEW PROCESS FOR WI 15289;*/
  /* STORE THE CHILD DETAILS IN WORKING STORAGE BEFORE SELECTING THE*/
  /* DEMOGRAPHICS FOR ALTERNATE PAYEE;*/
  AIN49W.WS-TEMP-SSN = H2-PERSON.SSN;
  AIN49W.WS-TEMP-UPI = H2-PERSON.UPI;
  AIN49W.WS-TEMP-FRST-NM = H2-PERSON.FRST-NM;
  AIN49W.WS-TEMP-LST-NM = H2-PERSON.LST-NM;
  AIN49W.WS-TEMP-NCP-FG = H2-PERSON.NCP-FG;
  AIN49W.WS-TEMP-CST-FG = H2-PERSON.CST-FG;
  AIN49W.WS-TEMP-CHD-FG = H2-PERSON.CHD-FG;
  AIN49W.WS-TEMP-IVA-CASE-MBR-FG = H2-PERSON.IVA-CASE-MBR-FG;
  AIN49W.WS-TEMP-IVE-MMBR-IND = H2-PERSON.IVE-MMBR-IND;
  /*  */
  if (SR-Q-DCF-REC.D-ALTP-SSN != " ")
    AIN49W.WS-ALTP-SSN = SR-Q-DCF-REC.D-ALTP-SSN;
    if (AIN49W.WS-ALTP-SSN-1 != " ")
      H2-PERSON.SSN = SR-Q-DCF-REC.D-ALTP-SSN;
      WDB00PI();
      AIN49P9-READ-S01();
      VDBCOMMON.UNRF = "Y";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC >= 104)
        WCM00P2-TO-CEP01A();
      end
      if (sysVar.sqlData.sqlcode == 0)
        AIN49W.WS-FILE-LST-NM = SR-Q-DCF-REC.D-ALTP-LAST-NAME;
        AIN49W.WS-FILE-FRST-NM = SR-Q-DCF-REC.D-ALTP-FIRST-NAME;
        AIN49W.WS-DB-LST-NM = H2-PERSON.LST-NM;
        AIN49W.WS-DB-FRST-NM = H2-PERSON.FRST-NM;
        if ((AIN49W.WS-FILE-LST-NM-1 == AIN49W.WS-DB-LST-NM-1 && 
        AIN49W.WS-FILE-FRST-NM-1 == AIN49W.WS-DB-FRST-NM-1))
          H2-CASE-MEMBER-HST.UPI = H2-PERSON.UPI;
          H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-CURRENT-DATE;
          H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-CURRENT-DATE;
          WDB00PI();
          AIN49P9-READ-S38();
          VDBCOMMON.UNRF = "Y";
          WDB00PE-SQLERR();
          if (VDBCONTROL.URC >= 104)
            WCM00P2-TO-CEP01A();
          end
          if (sysVar.sqlData.sqlcode == 0)
            AIN49W.WS-ALERT-ICI = H2-CASE-MEMBER-HST.ICI;
            PCALINP.PAL-CASE-ID = AIN49W.WS-ALERT-ICI;
            PCALINP.PAL-ALERT-ACTION = "C";
            PCALINP.PAL-DISPL-DT = AIN49W.WS-PROCESS-DT;
            PCALINP.PAL-ALERT-CD = 129040;
            call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
            WS-LOG-ENTRY-DE = "DCFS  - INTERFACE";
            AIN49W.WS-CASE-LOG-DESC-1 = SR-Q-DCF-REC.D-ALTP-SSN;
            AIN49W.WS-CASE-LOG-DESC-2 = "  HAS TEMPORARY CUSTODY OF DCFS CHILD ";
            AIN49W.WS-CASE-LOG-DESC-3 = AIN49W.WS-CASE-LOG-CHILDS-SSN;
            H2-CASE-LOG.ICI = H2-CASE-MEMBER-HST.ICI;
            H2-CASE-LOG.ACTVY-DT = AIN49W.WS-PROCESS-DT;
            call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
            H2-CASE-LOG.LOG-CRN-TS = GDW.TS;
            H2-CASE-LOG.CL-ACTVY-DESC = AIN49W.WS-CASE-LOG-DESC;
            H2-CASE-LOG.PRGM-CASE-TYPE = "CW";
            AIN49W.WS-TIME = VGVar.currentFormattedTime;
            AIN49W.WS-TIME-SEP1 = ".";
            AIN49W.WS-TIME-SEP2 = ".";
            H2-CASE-LOG.ACTVY-TM = AIN49W.WS-TIME;
            H2-CASE-LOG.LOG-ENTRY-DESC = AIN49W.WS-LOG-ENTRY-DE;
            H2-CASE-LOG.LOG-ENTRY-TYPE = "SYSTEM";

            WDB00PI();
            AIN49P9-INS-I22();
            VDBCOMMON.UNRF = "Y";
            VDBCOMMON.UDUP = "N";
            WDB00PE-SQLERR();
            if (VDBCONTROL.URC >= 104)
              WCM00P2-TO-CEP01A();
            end
          end
        end
      end
    end
  end
  /* REPLACE THE CHILD DETAILS FROM WORKING STORAGE TO H2-PERSON RECORD*/
  H2-PERSON.SSN = AIN49W.WS-TEMP-SSN;
  H2-PERSON.UPI = AIN49W.WS-TEMP-UPI;
  H2-PERSON.FRST-NM = AIN49W.WS-TEMP-FRST-NM;
  H2-PERSON.LST-NM = AIN49W.WS-TEMP-LST-NM;
  H2-PERSON.NCP-FG = AIN49W.WS-TEMP-NCP-FG;
  H2-PERSON.CST-FG = AIN49W.WS-TEMP-CST-FG;
  H2-PERSON.CHD-FG = AIN49W.WS-TEMP-CHD-FG;
  H2-PERSON.IVA-CASE-MBR-FG = AIN49W.WS-TEMP-IVA-CASE-MBR-FG;
  H2-PERSON.IVE-MMBR-IND = AIN49W.WS-TEMP-IVE-MMBR-IND;
  /*  */
end // end AIN49P9-CHK-IVAFAP


// CHECK REFERRAL CATEGORIES
Function AIN49P9-CHK-REF()
  /* ---------------------PTR 4613 BEGIN--------------------------------*/
  /*  */
  /* The referral process is triggered for the current month and next month*/
  /* The case member history is read for the next month. The Aid Code*/
  /* existing in the table is compared with the aid code received from*/
  /* the interface. If the aid code has changed accross categories*/
  /* , the flag for triggering the referral process is set. The actual*/
  /* process of referral is done after the updates to the case member*/
  /* history have been carried out.*/
  /*  */
  AIN49W.WS-TRIGGER-CURRENT-MTH-REF = "N";
  AIN49W.WS-TRIGGER-NEXT-MTH-REF = "N";
  /*  */
  /* Referral for the month is checked*/
  /*  */
  set H2-CASE-MEMBER-HST empty;
  H2-CASE-MEMBER-HST.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-CASE-MEMBER-HST.UPI = H2-3-CMH-FCE-PER.UPI;

  AIN49W.WS-TEMP-DATE = AIN49W.WS-CASE-MEMBER-DATE;
  AIN49P9-NXT-MNTH();
  AIN49W.WS-TEMP-DD = "01";
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;

  WDB00PI();
  AIN49P9-READ-S07();

  /* Medicaid only cases*/
  if (H2-CASE-MEMBER-HST.IVE-AID-CD == 22
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 26
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 27
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 52
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 58
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 59
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 60
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 62
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 63
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 65
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 67
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 69
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 76
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 77)

  /* IVE Cash and Medicaid cases*/
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "53"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "54"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "55"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "56"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "57"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "70"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "72"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "73"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "75"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "8"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9"
     || AIN49W3.RPT-ELIG-CD == "8"
     || AIN49W3.RPT-ELIG-CD == "9")
      AIN49W.WS-TRIGGER-NEXT-MTH-REF = "Y";
    end
  end

  /* Cash and Medicaid cases*/
  if (H2-CASE-MEMBER-HST.IVE-AID-CD == 53
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 54
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 55
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 56
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 57)
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "22"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "26"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "27"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "52"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "58"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "59"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "60"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "62"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "63"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "65"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "67"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "69"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "76"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "77"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "70"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "72"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "73"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "75"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "8"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9"
     || AIN49W3.RPT-ELIG-CD == "8"
     || AIN49W3.RPT-ELIG-CD == "9")
      AIN49W.WS-TRIGGER-NEXT-MTH-REF = "Y";
    end
  end

  if (H2-CASE-MEMBER-HST.IVE-ELIG-CD == "8" || 
  H2-CASE-MEMBER-HST.IVE-ELIG-CD == "9" || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 70 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 72 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 73 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 75)
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "22"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "26"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "27"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "52"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "58"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "59"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "60"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "62"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "63"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "65"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "67"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "69"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "76"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "77"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "53"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "54"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "55"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "56"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "57")
      AIN49W.WS-TRIGGER-NEXT-MTH-REF = "Y";
    end
  end

  /* Referral for the current month is checked*/
  /*  */
  set H2-CASE-MEMBER-HST empty;
  H2-CASE-MEMBER-HST.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-CASE-MEMBER-HST.UPI = H2-3-CMH-FCE-PER.UPI;
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-CASE-MEMBER-DATE;

  WDB00PI();
  AIN49P9-READ-S07();

  /* Medicaid only cases*/
  if (H2-CASE-MEMBER-HST.IVE-AID-CD == 22
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 26
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 27
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 52
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 58
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 59
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 60
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 62
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 63
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 65
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 67
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 69
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 76
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 77)

  /* IVE Cash and Medicaid cases*/
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "53"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "54"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "55"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "56"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "57"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "70"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "72"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "73"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "75"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "8"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9"
     || AIN49W3.RPT-ELIG-CD == "8"
     || AIN49W3.RPT-ELIG-CD == "9")
      AIN49W.WS-TRIGGER-CURRENT-MTH-REF = "Y";
    end
  end

  /* Cash and Medicaid cases*/
  if (H2-CASE-MEMBER-HST.IVE-AID-CD == 53
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 54
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 55
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 56
   || H2-CASE-MEMBER-HST.IVE-AID-CD == 57)
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "22"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "26"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "27"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "52"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "58"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "59"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "60"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "62"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "63"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "65"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "67"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "69"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "76"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "77"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "70"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "72"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "73"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "75"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "8"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9"
     || AIN49W3.RPT-ELIG-CD == "8"
     || AIN49W3.RPT-ELIG-CD == "9")
      AIN49W.WS-TRIGGER-CURRENT-MTH-REF = "Y";
    end
  end

  if (H2-CASE-MEMBER-HST.IVE-ELIG-CD == "8" || 
  H2-CASE-MEMBER-HST.IVE-ELIG-CD == "9" || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 70 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 72 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 73 || 
  H2-CASE-MEMBER-HST.IVE-AID-CD == 75)
    if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "22"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "26"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "27"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "52"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "58"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "59"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "60"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "62"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "63"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "65"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "67"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "69"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "76"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "77"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "53"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "54"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "55"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "56"
     || SR-Q-DCF-REC.D-MEMB-MA-AID-CODE == "57")
      AIN49W.WS-TRIGGER-CURRENT-MTH-REF = "Y";
    end
  end

  /* ----------------------PTR 4613 END----------------------------------*/
end // end AIN49P9-CHK-REF


// CHECK DUPLICATE SSN
Function AIN49P9-CHK-SSN()
  /* -------------------------PTR 7458 BEGIN---------------------------*/
  /*  */
  AIN49W.WS-DUPLICATE-SSN = "F";

  H2-PERSON.SSN = SR-Q-DCF-REC.D-MEMB-SSN;

  WDB00PI();

  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";

  AIN49P9-READ-S01();

  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end

  if (sysVar.sqlData.sqlcode == 0)
    if (AIN49W.WS-IVA-UPI != H2-PERSON.UPI)
      AIN49W.WS-DUPLICATE-SSN = "T";
    end
  end

  /* -------------------------PTR 7458 END ----------------------------*/
end // end AIN49P9-CHK-SSN


Function AIN49P9-CHK-TANF()
  H2-CASE-MEMBER-HST.UPI = AIN49W.WS-UPI;
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-CURRENT-DATE;
  H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-CURRENT-DATE;
  WDB00PI();
  AIN49P9-READ-S37();
  VDBCOMMON.UNRF = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  if (sysVar.sqlData.sqlcode == 0)
    AIN49W.WS-ALERT-ICI = H2-CASE-MEMBER-HST.ICI;
    PCALINP.PAL-CASE-ID = AIN49W.WS-ALERT-ICI;
    PCALINP.PAL-ALERT-ACTION = "C";
    PCALINP.PAL-DISPL-DT = AIN49W.WS-PROCESS-DT;
    if (SR-Q-DCF-REC.D-REUNIF-IND == "P")
      PCALINP.PAL-ALERT-CD = 129035;
      call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
      AIN49W.WS-ALERT-IVD-ID = 129035;
      AIN49P9-ALRT-IVD();
    end
    if (SR-Q-DCF-REC.D-REUNIF-IND == "Y")
      PCALINP.PAL-ALERT-CD = 129036;
      call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
      AIN49W.WS-ALERT-IVD-ID = 129036;
      AIN49P9-ALRT-IVD();
    end
    if (SR-Q-DCF-REC.D-REUNIF-IND == "N")
      PCALINP.PAL-ALERT-CD = 129037;
      call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
      AIN49W.WS-ALERT-IVD-ID = 129037;
      AIN49P9-ALRT-IVD();
    end
    if (SR-Q-DCF-REC.D-REUNIF-STOP-DATE != " ")
      PCALINP.PAL-ALERT-CD = 129038;
      call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
      AIN49W.WS-ALERT-IVD-ID = 129038;
      AIN49P9-ALRT-IVD();
    end
  end
end // end AIN49P9-CHK-TANF


Function AIN49P9-CLS-REUNIF()
  H2-REUNIF-DATA.ICI = WS-IVA-ICI;
  H2-REUNIF-DATA.UPI = WS-IVA-UPI;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-TEMP-MM = AIN49W.WS-YYMM-MM;
  AIN49W.WS-TEMP-CCYY = AIN49W.WS-YYMM-YY;
  AIN49W.WS-TEMP-DD = "01";
  AIN49P9-LAST-DATE();
  H2-REUNIF-DATA.REUNIF-STOP-DATE = AIN49W.WS-LAST-DATE;
  AIN49P9-UPD-U35();
  if (sysVar.sqlData.sqlcode != 0 && 
  sysVar.sqlData.sqlcode != 100)
    WCM00P2-TO-CEP01A();
  end
  /*  */
end // end AIN49P9-CLS-REUNIF


// INSERT CASE MEMB HIST ( SQL )
Function AIN49P9-CMH-I04()
  VDBCONTROL.UPROC-NM = "AIN49P9-CMH-I04";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-OBJ = "H2-CASE-MEMBER-HST";
  VDBCOMMON.USQLREC = "H2-CASE-MEMBER-HST";
  try
    add H2-CASE-MEMBER-HST
      with #sql{
        insert into TWNCASE_MEMBER_HST
        (UPI, ICI, PRD_BEG_DT, FS_ASST_IND,AFDC_ASST_IND,MA_ASST_IND,
             JOIN_HH_DT,FS_DUPL_ASST_IND,MA_DUPL_ASST_IND,
             PRD_END_DT,IVE_ELIG_CD, IVE_AID_CD,MA_30_1_3_D1_DT,
             MA_30_BEG_DT,AFDC_30_BEG_DT,FS_QUIT_SANC_DT,HH_LEFT_DT,
             JOIN_RPRTD_DT,AFDC_30_1_3_D1_DT,AFDC_30_1_3_D2_DT,AFDC_30_1_3_D3_DT,
             AFDC_30_1_3_D4_DT,MA_30_1_3_D2_DT,MA_30_1_3_D3_DT,MA_30_1_3_D4_DT,
             AFDC_BEG_DT,FS_BEG_DT,AFDCAID_CD_CHNG_DT,MAAID_CD_CHNG_DT,
             TC_ASST_IND, TC_BEG_DT, TL_ASST_IND, TL_BEG_DT,
             TN_ASST_IND, TN_BEG_DT, TP_ASST_IND,TP_BEG_DT)
        values (:UPI, :ICI, :PRD-BEG-DT, :FS-ASST-IND,:AFDC-ASST-IND,:MA-ASST-IND,
             :JOIN-HH-DT,:FS-DUPL-ASST-IND,:MA-DUPL-ASST-IND,
             :PRD-END-DT,:IVE-ELIG-CD,:IVE-AID-CD,:MA-30-1-3-D1-DT,
             :MA-30-BEG-DT,:AFDC-30-BEG-DT,:FS-QUIT-SANC-DT,:HH-LEFT-DT,
             :JOIN-RPRTD-DT,:AFDC-30-1-3-D1-DT,:AFDC-30-1-3-D2-DT,
             :AFDC-30-1-3-D3-DT,:AFDC-30-1-3-D4-DT,:MA-30-1-3-D2-DT,
             :MA-30-1-3-D3-DT,:MA-30-1-3-D4-DT,:AFDC-BEG-DT,:FS-BEG-DT,
             :AFDCAID-CD-CHNG-DT,:MAAID-CD-CHNG-DT,
             :TC-ASST-IND, :TC-BEG-DT, :TL-ASST-IND, :TL-BEG-DT,
             :TN-ASST-IND, :TN-BEG-DT, :TP-ASST-IND, :TP-BEG-DT)
      } ;
  end

  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
end // end AIN49P9-CMH-I04


// PRINT CONTROL REPORT
Function AIN49P9-CON-REP()
  VGVar.handleHardIOErrors = 1;
  try
    add SR-Q-CNT-REC ;
  end
  if (SR-Q-CNT-REC is ioError)
    VDBCONTROL.UPROC-NM = "AIN49P9-CON-REP";
    VDBCONTROL.UPROC-OBJ = "SR-Q-AIN-CNT-REC";
    VDBCONTROL.UPROC-OPT = "ADD";
    VMESSAGE.UMSGINS[2] = "AIN49A";
    AIN49W1.WS-ERR-CD = sysVar.errorCode;
    VMESSAGE.UMSGINS[1] = AIN49W1.WS-ERR-LAST-FOUR;
     /*  */
     /* the following conditions are added to move the corresponding*/
     /* error message*/
   /*  */
    if (SR-Q-CNT-REC is fileNotAvailable)
      VDBCONTROL.UEZESQRRM = "FILE IS NOT AVAILABLE";
    else
      if (SR-Q-CNT-REC is fileNotFound)
        VDBCONTROL.UEZESQRRM = "FILE NOT FOUND";
      else
        if (SR-Q-CNT-REC is invalidFormat)
          VDBCONTROL.UEZESQRRM = "FILE FORMAT MISMATCH";
        end /* ** end check for format mismatch*/
      end /* ** end check for file not found*/
    end /* ** end check for file not available*/
    WCM00P2-TO-CEP01A();
  end /* ** end check for errors found*/
end // end AIN49P9-CON-REP


// CREATE CASE LOG
Function AIN49P9-CRE-CLOG()
  /* --------------------PTR 4651 BEGIN-------------------------------*/
  /*  */
  /* CREATE CASE LOG*/
  /*  */
  /* The case log is created when ever a new case is referred or when*/
  /* a update of the aid code and elig code is referred to DCFS*/
  /*  */
  AIN49W.WS-LOG-ENTRY-DE = "DCFS - INTERFACE";

  if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
    AIN49W.WS-CL-ACTVY-DESC = "RECORD CREATED BY DCFS - NEW CASE CREATED";
    H2-CASE-LOG.ICI = AIN49W.WS-ICI;
  else
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
      AIN49W.WS-CL-ACTVY-DESC = "UPDATE ON AID CODE / ELIG CODE RECEIVED";
      H2-CASE-LOG.ICI = AIN49W.WS-IVA-ICI;
    end
  end

  H2-CASE-LOG.ACTVY-DT = AIN49W.WS-PROCESS-DT;
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  H2-CASE-LOG.LOG-CRN-TS = GDW.TS;
  H2-CASE-LOG.CL-ACTVY-DESC = AIN49W.WS-CL-ACTVY-DESC;
  H2-CASE-LOG.PRGM-CASE-TYPE = "CW";

  AIN49W.WS-TIME = VGVar.currentFormattedTime;
  AIN49W.WS-TIME-SEP1 = ".";
  AIN49W.WS-TIME-SEP2 = ".";
  H2-CASE-LOG.ACTVY-TM = AIN49W.WS-TIME;
  H2-CASE-LOG.LOG-ENTRY-DESC = AIN49W.WS-LOG-ENTRY-DE;
  H2-CASE-LOG.LOG-ENTRY-TYPE = "SYSTEM";

  WDB00PI();
  AIN49P9-INS-I22();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  WDB00PE-SQLERR();
  /*  */
  /* Check for fatal errors*/
  /*  */
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  /* -------------------------PTR 4651 END-----------------------------*/
end // end AIN49P9-CRE-CLOG


// CREATES ELIG VERSION
Function AIN49P9-CRE-I14()
  VDBCONTROL.UPROC-NM = "AIN49P9-CRE-I14";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-OBJ = "H2-ELIG-VERSION";
  VDBCOMMON.USQLREC = "H2-ELIG-VERSION";

  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  try
    add H2-ELIG-VERSION
      with #sql{
        insert into TWNELIG_VERSION
        (ICI, PRGM_CASE_TYPE, BNFT_YR, BNFT_MTH, VER_NMB,BNFT_TYPE,
             ELIG_NUM, POSTD_DT, POSTD_BY,TOT_MTHLY_BNFT_AMT,
             POST_TYPE,CHD_NMB,LST_POSTD_VER_IND,BNFT_DUE_DT,POTNL_BNFT_RDCTN,
             SYS_CLOSURE_RSN_CD,
             ELG_VER_COMP_TM,
             LST_PRCSD_TS,ESTM_TRMNT_DT,RCPT_DT,RPRTD_DT,
             LSUM_DISQ_ST_DT,LSUM_DISQ_END_DT,CRY_FWD_PRC_IND,
             CASE_RSLT_CD, SCHD_PAY_DT, ISSUE_IND)
        values (:ICI, :PRGM-CASE-TYPE, :BNFT-YR, :BNFT-MTH, :VER-NMB,
             :BNFT-TYPE,:ELIG-NUM,
            :POSTD-DT, :POSTD-BY,:TOT-MTHLY-BNFT-AMT,:POST-TYPE,
            :CHD-NMB, :LST-POSTD-VER-IND,:BNFT-DUE-DT,:POTNL-BNFT-RDCTN,
            :SYS-CLOSURE-RSN-CD,
            :GDW.TS,
            :LST-PRCSD-TS,:ESTM-TRMNT-DT,:RCPT-DT,:RPRTD-DT,
            :LSUM-DISQ-ST-DT,:LSUM-DISQ-END-DT,:CRY-FWD-PRC-IND,
            :CASE-RSLT-CD, :SCHD-PAY-DT, :ISSUE-IND)
      } ;
  end
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
end // end AIN49P9-CRE-I14


// CREATE ALTERNATE SSN
Function AIN49P9-CRT-ALTSSN()
  /* CREATE ALTERNATE SSN*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-ALTERNATE-SSN empty;

  H2-ALTERNATE-SSN.UPI = AIN49W.WS-UPI;
  H2-ALTERNATE-SSN.ALT-SSN = SR-Q-DCF-REC.D-MEMB-SSN;

  /* MOVE HIGH VALUES TO DATES*/
  H2-ALTERNATE-SSN.VRFN-DT = "9999-12-31";

  AIN49P9-INS-I10();

  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-ALTSSN


// CREATE CASELOAD CASE HISTORY
Function AIN49P9-CRT-CCH()
  /* -------------------- PTR 4646 BEGIN --------------------------------*/
  /* the caseload case history is also maintained for the dcfs cases*/
  /*  */
  H2-CASLD-CASE-HST.ICI = AIN49W.WS-ICI;
  H2-CASLD-CASE-HST.OFC-CD = SR-Q-DCF-REC.D-APPL-DISTRICT-OFFICE;
  H2-CASLD-CASE-HST.SPRVS-UNIT = AIN49W.WS-SPRVS-UNIT;
  H2-CASLD-CASE-HST.PSN-NMB = AIN49W.WS-PSN-NMB;
  H2-CASLD-CASE-HST.FUNC-AREA-CD = AIN49W.WS-FUNC-AREA-CODE;
  H2-CASLD-CASE-HST.WRKR-TYPE = AIN49W.WS-WRKR-TYPE;
  /*  */
  /* Changes due to PTR 7826 - 13*/
  H2-CASLD-CASE-HST.PRGM-OFC-TYPE = "A";
  /*  */
  /* the caseload effective date read from the caseload debtload table*/
  /* is moved to the caseload effective date of TWNCASLD CASE HST*/
  /*  */
  H2-CASLD-CASE-HST.CASLD-EFF-DT = H2-CASELD-DEBTLD.CASLD-EFF-DT;
  H2-CASLD-CASE-HST.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
  H2-CASLD-CASE-HST.PRD-END-DT = "9999-12-31";
  AIN49P9-INS-I20();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /* perform sql error processing*/
  /*  */
  WDB00PE-SQLERR();
  /* check for fatal errors*/
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  /* -----------------------PTR 4646 END --------------------------*/
end // end AIN49P9-CRT-CCH


// CREATE CASE MEMBER HISTORY
Function AIN49P9-CRT-CMH()
  /* CREATE CASE MEMBER HISTORY PROCESS*/

  /* DB INITIALIZATION*/
  /*  */
  /* 7826 - 12 . The GEN ICI process is trigegered from FAM CASE Ccreation*/
  /* process. The following line of code is commented.*/
  /* PERFORM AIN49P9-GEN-ICI;*/
  /*  */
  /* -------------------------PTR 4613 BEGIN----------------------------*/
  /* Data sent by DCFS for a new case is true for the current month and*/
  /* the next month*/
  /*  */
  WDB00PI();

  set H2-CASE-MEMBER-HST empty;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  AIN49W.WS-DD = "01";
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-DATE;

  H2-CASE-MEMBER-HST.UPI = AIN49W.WS-UPI;
  H2-CASE-MEMBER-HST.ICI = AIN49W.WS-ICI;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  AIN49W.WS-DD = "01";
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  AIN49W.WS-CASE-MEMB-BEG-DATE = AIN49W.WS-DATE;

  AIN49W.WS-TEMP-DATE = AIN49W.WS-DATE;
  AIN49P9-LST-DATE();
  AIN49W.WS-CASE-MEMB-END-DATE = AIN49W.WS-LAST-DATE;

  AIN49P9-INS-CMHD();
  AIN49W.WS-TEMP-DATE = AIN49W.WS-DATE;
  AIN49W.WS-TEMP-MM-NUM = AIN49W.WS-TEMP-MM-NUM + 1;
  if (AIN49W.WS-TEMP-MM-NUM > 12)
    AIN49W.WS-TEMP-MM-NUM = 1;
    AIN49W.WS-TEMP-CCYY-NUM = AIN49W.WS-TEMP-CCYY-NUM + 1;
  end
  AIN49W.WS-TEMP-DD = "01";

  AIN49W.WS-CASE-MEMB-BEG-DATE = AIN49W.WS-TEMP-DATE;
  AIN49W.WS-CASE-MEMB-END-DATE = "9999-12-31";

  AIN49P9-INS-CMHD();

  /* --------------------PTR 4613 END--------------------------------*/
end // end AIN49P9-CRT-CMH


// CREATE CASE MEMBER DETAILS
Function AIN49P9-CRT-CMM()
  /* CREATE CASE MEMBER*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-CASE-MEMBER empty;
  /*  */
  H2-CASE-MEMBER.UPI = AIN49W.WS-UPI;
  H2-CASE-MEMBER.ICI = AIN49W.WS-ICI;
  /*  */
  AIN49P9-INS-I05();
  /*  */
  VDBCOMMON.UDUP = "Y";
  /*  */
  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-CMM


// CREATE ELIGIBILITY DATA
Function AIN49P9-CRT-ELIG()
  /* 05/06/2003 - logic is changed in update case.*/
  /* For the retro month, the elig. version will be created only for the*/
  /* retro month.*/
  /* -----------------------PTR 4654 BEGIN-----------------------------*/
  /*  */
  /* Create Elig Process*/
  /*  */
  /* 1. For a new case, the eligibility version is created for the current*/
  /* month and next month. For an update case, the eligibility version*/
  /* is created based on the benefit month. For a retro month, the*/
  /* eligibility version is created for the retro month, the current month*/
  /* and next month. In all other update case, the eligibility version is*/
  /* created for the current month and next month*/
  /*  */
  /* 2. If the medicaid card for a given month has already been issued, Then*/
  /* the elig version is created with benefit type = 'SU'. If the*/
  /* benefits are not issued for a given month and another version of*/
  /* eligibility is being created, then the current existing eligibility*/
  /* version is created with the ISSUE_IND as 'X'. The new version of*/
  /* eligibility is created with ISSUE_IND = 'N' and BNFT_TYPE = 'RG'*/
  /*  */
  /*  */
  /* If record type is new and the child is known to NOMADS as a 'IVA'*/
  /* member, then manual posting would be done and the IVA worker would*/
  /* be alerted. If the child is known only as a 'IVD' member then auto*/
  /* posting would be done and the IVD worker would be alerted. In all*/
  /* other cases auto posting would be done*/
  /*  */

  /* -----------------CHANGE DUE TO WI# 13992------------*/
  AIN49W9.WS-MONTH-IND = " ";
  /* -----------------CHANGE DUE TO WI# 13992------------*/

  if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
    if (AIN49W.WS-CHILD-KNOWN == "Y")
      if (H2-PERSON.IVA-CASE-MBR-FG == "Y")
  /*  */
  /* -------------PHASE III REWORK BEGIN-----------------------*/
  /* Check if person is an active member in any AFDC or MA case*/
  /*  */
        AIN49P9-CHECK-DUP();
  /*  */
  /* -------------PHASE III REWORK END-------------------------*/
      else
        if (H2-PERSON.NCP-FG == "Y"
         || H2-PERSON.CST-FG == "Y"
         || H2-PERSON.CHD-FG == "Y")
          AIN49W.WS-POST-TYPE = "A";
          AIN49W.WS-ALERT-IVD-ID = 390041;
          AIN49P9-ALRT-IVD();
        end
      end
    else
      AIN49W.WS-POST-TYPE = "A";
    end
  else
  /*  */
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
  /* -------------------CHANGES DUE TO PHASE III REWORK BEGIN-------------*/

      AIN49W.WS-POST-TYPE = "A";

  /* ----------------P09 CHANGES DUE TO PTR # AIN49003 BEGIN--------------*/
  /* Read on TWNELIG_VERSION is deleted*/
  /* ----------------P09 CHANGES DUE TO PTR # AIN49003 END----------------*/
  /* -------------------CHANGES DUE TO PHASE III REWORK END---------------*/
    end
  /* --------------------PTR 8170 -56 BEGIN-----------------------*/
    if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "8"
     || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9"
     || AIN49W3.RPT-ELIG-CD == "8"
     || AIN49W3.RPT-ELIG-CD == "9")
      set PCAL16A-INP empty;
      PCAL16A-INP.PCAL16A-ALERT-CD = 390041;
  /*  */
  /* CHANGES FOR WI 20590 - STARTS;*/
  /* ISNTEAD OF PERFORMING THE PROCESS AIN49P9-ALRT-IVD,THE CAL16A APPLICAT*/
  /* ION IS CALLED FOR CREATING THE IVD ALERT WITH THE SSN*/
  /* PERFORM AIN49P9-ALRT-IVD;*/
  /*  */
      PCAL16A-INP.PCAL16A-UPI = AIN49W.WS-IVA-UPI;
      PCAL16A-INP.PCAL16A-PARTICIPANT-UPI = AIN49W.WS-IVA-UPI;
      PCAL16A-INP.PCAL16A-CASE-SUFX = " ";
      call "CAL16A" (VDBCONTROL, VMESSAGE, PCAL16A-INP) {isNoRefresh = yes};
  /*  */
  /* CHANGES FOR WI 20590 - END;*/
    end
  /* --------------------PTR 8170 -56 END-------------------------*/

  end
  /*  */
  if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
  /*  */
  /* For a new case, the data sent by DCFS is true for the current month*/
  /* and next month. Elig version are therefore created for the current*/
  /* month and next month.*/
  /*  */
    AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-YYMM-MM-NUM;
  /*  */
  /* IF AIN49W.WS-YYMM-YY-NUM > 90;*/
  /* MOVE 19 TO AIN49W.WS-ELIG-VER-CC;*/
  /* ELSE;*/
  /* MOVE 20 TO AIN49W.WS-ELIG-VER-CC;*/
  /* END;*/
  /* MOVE AIN49W.WS-YYMM-YY-NUM TO AIN49W.WS-ELIG-VER-YY;*/
    AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-YYMM-YY-NUM;
    call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};

    AIN49P9-DER-CRC();

    AIN49W.WS-SCHD-PAY-DATE = GDW.DTCD;
    AIN49W.WS-BNFT-TYPE = "RG";
    AIN49W.WS-ELIG-NUM = 1;
    AIN49W.WS-VER-NMB = 1;

  /* --------------START CHANGES DUE TO WI# 13992-----------*/
    if (SR-Q-DCF-REC.D-MED-CARD-CUT == "Y")
      AIN49W.WS-ISSUE-IND = "Y";
    else
      AIN49W.WS-ISSUE-IND = "N";
    end
    AIN49W.WS-CRY-FWD-PRC-IND = "Y";
  /* --------------END CHANGES DUE TO WI# 13992-------------*/

    AIN49P9-INS-EVER();
    AIN49P9-INS-EVERM();
    AIN49P9-INS-ELIGDC();

  /* The elig version is created for the next month using D-BENEFIT-START*/
  /* -MONTH as base*/
  /*  */
    AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-YYMM-MM-NUM = AIN49W.WS-YYMM-MM-NUM + 1;
    if (AIN49W.WS-YYMM-MM-NUM > 12)
      AIN49W.WS-YYMM-MM-NUM = 1;
  /* IF AIN49W.WS-YYMM-YY-NUM = 99;*/
  /* MOVE 0 TO AIN49W.WS-YYMM-YY-NUM;*/
  /* ELSE;*/
      AIN49W.WS-YYMM-YY-NUM = AIN49W.WS-YYMM-YY-NUM + 1;
  /* END;*/
    end

    AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-YYMM-MM-NUM;

  /* IF AIN49W.WS-YYMM-YY-NUM > 90;*/
  /* MOVE 19 TO AIN49W.WS-ELIG-VER-CC;*/
  /* ELSE;*/
  /* MOVE 20 TO AIN49W.WS-ELIG-VER-CC;*/
  /* END;*/
  /* MOVE AIN49W.WS-YYMM-YY-NUM TO AIN49W.WS-ELIG-VER-YY;*/
    AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-YYMM-YY-NUM;

    AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-TEMP-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-TEMP-YY;*/
    AIN49W.WS-TEMP-CCYY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YYMM-YY-NUM > 90;*/
  /* MOVE '19' TO AIN49W.WS-TEMP-CC;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-TEMP-CC;*/
  /* END;*/
    AIN49W.WS-TEMP-DD = "01";
    AIN49P9-NXT-MNTH();
    AIN49W.WS-SCHD-PAY-DATE = AIN49W.WS-TEMP-DATE;

    AIN49P9-DER-CRC();

    AIN49W.WS-BNFT-TYPE = "RG";
    AIN49W.WS-ELIG-NUM = 1;
    AIN49W.WS-VER-NMB = 1;
  /* TEMPORARY;*/
    if (SR-Q-DCF-REC.D-MED-CARD-CUT == "Y")
      AIN49W.WS-ISSUE-IND = "Y";
    else
      AIN49W.WS-ISSUE-IND = "N";
    end
  /* TEMPORARY;*/
  /* MOVE 'N' TO AIN49W.WS-ISSUE-IND;*/
    AIN49W.WS-CRY-FWD-PRC-IND = "Y";

    AIN49P9-INS-EVER();
    AIN49P9-INS-EVERM();
    AIN49P9-INS-ELIGDC();
  else
  /*  */
  /* For an update case, the Elig version record is read to determine if*/
  /* the version is posted. If the version is posted, the next version*/
  /* is created and auto posted. If the existing version is not posted*/
  /* the unposted version is overwritten and auto posted.*/
  /*  */
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
  /*  */
  /* If data for a retro month is set, than an eligibility version is*/
  /* created/updated for the retro month*/
  /*  */
      AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
      AIN49W.WS-TEMP-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-TEMP-YY;*/
      AIN49W.WS-TEMP-CCYY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YYMM-YY-NUM > 90;*/
  /* MOVE '19' TO AIN49W.WS-TEMP-CC;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-TEMP-CC;*/
  /* END;*/
      AIN49W.WS-TEMP-DD = "01";
      AIN49W.WS-DATE = AIN49W.WS-PROCESS-DT;
      AIN49W.WS-DD = "01";

      if (AIN49W.WS-TEMP-DATE < AIN49W.WS-DATE)
        AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-TEMP-MM-NUM;
        AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-TEMP-CCYY-NUM;

  /* -----------------CHANGE DUE TO WI# 13992------------*/
        AIN49W9.WS-MONTH-IND = "RM"; /* RM --- RETRO MONTH*/
  /* -----------------CHANGE DUE TO WI# 13992------------*/

        AIN49P9-PROC-ELIG();

/* Begin WI 2445 mt - allow updates to future month only */     
      end  
       
      if (AIN49W.WS-TEMP-DATE > AIN49W.WS-DATE)
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-NXT-MNTH();
        AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-TEMP-MM-NUM;
        AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-TEMP-CCYY-NUM;

        AIN49W9.WS-MONTH-IND = "FM"; /* FM --- FUTURE MONTH*/
        AIN49P9-PROC-ELIG();
/* End WI 2445 mt - allow updates to future month only */         
        
      end //2445  
//mt2445      else
      if (AIN49W.WS-TEMP-DATE == AIN49W.WS-DATE) //2445

  /* The elig version is created for the current and next month*/
        AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-PROCESS-DT-MM;
        AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-PROCESS-DT-CCYY;

  /* -----------------CHANGE DUE TO WI# 13992------------*/
        AIN49W9.WS-MONTH-IND = "CM"; /* --- CURRENT MONTH*/
  /* -----------------CHANGE DUE TO WI# 13992------------*/

        AIN49P9-PROC-ELIG();

        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-NXT-MNTH();
        AIN49W.WS-ELIG-VER-MTH = AIN49W.WS-TEMP-MM-NUM;
        AIN49W.WS-ELIG-VER-YEAR = AIN49W.WS-TEMP-CCYY-NUM;

  /* -----------------CHANGE DUE TO WI# 13992------------*/
        AIN49W9.WS-MONTH-IND = "  "; /* RESET*/
  /* -----------------CHANGE DUE TO WI# 13992------------*/

        AIN49P9-PROC-ELIG();

      end
    end


  end
end // end AIN49P9-CRT-ELIG


// CREATE FAM ACTIONS
Function AIN49P9-CRT-FAA()
  /* *********-------- PHASE3 REWORK START---------***************/
  set H2-FAM-ACTNS empty;
  H2-FAM-ACTNS.ICI = AIN49W.WS-ICI;
  H2-FAM-ACTNS.PRGM-TYP = "CW";
  H2-FAM-ACTNS.AID-CD = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
  if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
    H2-FAM-ACTNS.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
  else
    H2-FAM-ACTNS.ELIG-CD = AIN49W3.RPT-ELIG-CD;
  end
  H2-FAM-ACTNS.ACTN-TYP = "AP";
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-TEMP-YY;*/
  /* MOVE AIN49W.WS-YYMM-MM TO AIN49W.WS-TEMP-MM;*/
  /* IF AIN49W.WS-TEMP-YY > '90';*/
  /* MOVE '19' TO AIN49W.WS-TEMP-CC;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-TEMP-CC;*/
  /* END;*/

  /* MOVE AIN49W.WS-TEMP-CCYY-NUM TO H2-FAM-ACTNS.BNFT-YR;*/
  /* MOVE AIN49W.WS-TEMP-MM-NUM TO H2-FAM-ACTNS.BNFT-MTH;*/
  H2-FAM-ACTNS.BNFT-YR = AIN49W.WS-YYMM-YY-NUM;
  H2-FAM-ACTNS.BNFT-MTH = AIN49W.WS-YYMM-MM-NUM;
  H2-FAM-ACTNS.VER-NMB = H2-ELIG-VERSION.VER-NMB;
  AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-APPL-MA-APPLICATION-DATE;
  AIN49W.WS-MM = AIN49W5.WS-MM3;
  AIN49W.WS-YY-CC1 = AIN49W5.WS-CC3;
  AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
  AIN49W.WS-DD = AIN49W5.WS-DD3;
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-FAM-ACTNS.APPL-DT = AIN49W.WS-DATE;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-DD = "01";
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-FAM-ACTNS.INIT-APRVL-DT = AIN49W.WS-DATE;
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  H2-FAM-ACTNS.ACTN-TS = GDW.TS;
  H2-FAM-ACTNS.ACTN-EFF-DT = GDW.DTCD;
  AIN49P9-INS-I18();
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-FAA


// CREATE FAM ALTERNATE PAYEE
Function AIN49P9-CRT-FAP()
  /* CREATE FAM-ALT-PAYEE*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-FAM-ALT-PAYEE empty;

  H2-FAM-ALT-PAYEE.ICI = AIN49W.WS-ICI;
  /*  */
  /* CHANGES FOR WI 14240 - START;*/
  H2-FAM-ALT-PAYEE.ALT-PYE-TYP = "D";
  /* CHANGES FOR WI 14240 - END;*/
  /*  */
  H2-FAM-ALT-PAYEE.ALT-PYE-LST-NM = SR-Q-DCF-REC.D-ALTP-LAST-NAME;
  H2-FAM-ALT-PAYEE.ALT-PYE-FRST-NM = SR-Q-DCF-REC.D-ALTP-FIRST-NAME;
  H2-FAM-ALT-PAYEE.ALT-PYE-MID-NM = SR-Q-DCF-REC.D-ALTP-MIDDLE-NAME;
  H2-FAM-ALT-PAYEE.HOUSE-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-NBR;
  H2-FAM-ALT-PAYEE.STR-DIR = SR-Q-DCF-REC.D-ADDR-MAILING-DIR;
  H2-FAM-ALT-PAYEE.STR-NM = SR-Q-DCF-REC.D-ADDR-MAILING-STREET;
  H2-FAM-ALT-PAYEE.STR-TYPE = SR-Q-DCF-REC.D-ADDR-MAILING-TYPE;
  H2-FAM-ALT-PAYEE.APT-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-APT;
  H2-FAM-ALT-PAYEE.OTH-ADDR = SR-Q-DCF-REC.D-ADDR-MAILING-OTHER;
  H2-FAM-ALT-PAYEE.CITY = SR-Q-DCF-REC.D-ADDR-MAILING-CTY;
  H2-FAM-ALT-PAYEE.ST-CD = SR-Q-DCF-REC.D-ADDR-MAILING-STATE;
  H2-FAM-ALT-PAYEE.ZIP-CD = SR-Q-DCF-REC.D-ADDR-MAILING-ZIP;
  H2-FAM-ALT-PAYEE.PHN-NMB = SR-Q-DCF-REC.D-ADDR-HOME-TELEPHONE;
  /* beg comment*/
  /* ***** p-12> changes due to ptr # ain49003 begin --------- ******/
  /* ***/
  /* * move first date of d-benefit start month to eff_fr_dt*/
  /* **/
  /* CHANGES FOR WI# 25048 - START*/
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  AIN49W.WS-DD = "01";
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  /* MOVE AIN49W.WS-DATE TO H2-FAM-ALT-PAYEE.EFF-FR-DT;*/
  if (AIN49W.WS-PROCESS-DT < AIN49W.WS-DATE)
    AIN49W.WS-DATE = AIN49W.WS-PROCESS-DT;
    AIN49W.WS-DD = "01";
    H2-FAM-ALT-PAYEE.EFF-FR-DT = AIN49W.WS-DATE;
  else
    H2-FAM-ALT-PAYEE.EFF-FR-DT = AIN49W.WS-DATE;
  end
  /* CHANGES FOR WI# 25048 - END*/
  /*  */
  /* ----------------------PTR 6311 BEGIN -------------------------*/
  /*  */
  H2-FAM-ALT-PAYEE.EFF-TO-DT = "9999-12-31";
  /*  */
  /* -----------------------PTR 6311 END -----------------------------*/
  H2-FAM-ALT-PAYEE.DOB = "0001-01-01";
  /*  */
  H2-FAM-ALT-PAYEE.SSN = SR-Q-DCF-REC.D-ALTP-SSN;
  H2-FAM-ALT-PAYEE.PHN-EXT = "     ";
  H2-FAM-ALT-PAYEE.PYEE-RSN-CD = " ";
  H2-FAM-ALT-PAYEE.ISS-NTCE-IND = " ";
  AIN49P9-INS-I09();
  VDBCOMMON.UNRF = "N";
  VDBCOMMON.UDUP = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  /* CHANGES DUE TO WI#15289 - BEGIN;*/
  /*  */
  AIN49P9-CHK-IVAFAP();
  /*  */
  /* CHANGES DUE TO WI#15289 - END;*/
  /*  */
end // end AIN49P9-CRT-FAP


// CREATE FAM CASELOAD CASE
Function AIN49P9-CRT-FCC()
  /*  */
  /* ********* ------- Changes due to ptr 2819 begin --------- ************/
  /*  */
  /* Read the table TWNCASELD_DEBTLD to fetch the value of*/
  /* CASLD_EFF_DT which should be used for insertion into the table*/
  /* TWNFAM_CASELD_CASE*/
  /*  */
  H2-CASELD-DEBTLD.OFC-CD = SR-Q-DCF-REC.D-APPL-DISTRICT-OFFICE;
  H2-CASELD-DEBTLD.PRGM-OFC-TYPE = "A";
  /* MOVE SR-Q-DCF-REC.D-APPL-CASLD-ID TO AIN49W.WS-APPL-CASLD-ID;*/
  AIN49W.WS-APPL-CASLD-ID = "XBW01";
  H2-CASELD-DEBTLD.SPRVS-UNIT = AIN49W.WS-SPRVS-UNIT;
  H2-CASELD-DEBTLD.PSN-NMB = AIN49W.WS-PSN-NMB;
  H2-CASELD-DEBTLD.FUNC-AREA-CD = AIN49W.WS-FUNC-AREA-CODE;
  H2-CASELD-DEBTLD.WRKR-TYPE = AIN49W.WS-WRKR-TYPE;
  /*  */
  /* Perform the standard database app initialisation*/
  /*  */
  WDB00PI();
  /*  */
  /* Set the values for access type and applicaton name*/
  /*  */
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "AIN49A";
  /*  */
  /* Perform the process to read the table TWNCASELD_DEBTLD*/
  /*  */
  AIN49P9-READ-S20();
  /*  */
  /* Set the values for NRF and DUP flags*/
  /*  */
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  /* Perform the process for sql error processing*/
  /*  */
  WDB00PE-SQLERR();
  /*  */
  /* Check for fatal errors*/
  /*  */
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  /* If record found in TWNCASELD_DEBTLD,insert a record into the*/
  /* table TWNFAM_CASELD_CASE*/
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
  /*  */
  /* ********* ------- Changes due to ptr 2819 end   --------- ************/
  /* Create case load*/
  /*  */
  /* DB initialisation*/
  /*  */
    WDB00PI();
  /*  */
  /* Set the sql row record empty*/
  /*  */
    set H2-FAM-CASELD-CASE empty;
  /*  */
  /* Move values to the host variables for insertion*/
  /*  */
    H2-FAM-CASELD-CASE.OFC-CD = SR-Q-DCF-REC.D-APPL-DISTRICT-OFFICE;
  /* MOVE SR-Q-DCF-REC.D-APPL-CASLD-ID TO AIN49W.WS-APPL-CASLD-ID;*/
    AIN49W.WS-APPL-CASLD-ID = "XBW01";
    H2-FAM-CASELD-CASE.SPRVS-UNIT = AIN49W.WS-SPRVS-UNIT;
    H2-FAM-CASELD-CASE.PSN-NMB = AIN49W.WS-PSN-NMB;
    H2-FAM-CASELD-CASE.FUNC-AREA-CD = AIN49W.WS-FUNC-AREA-CODE;
    H2-FAM-CASELD-CASE.WRKR-TYPE = AIN49W.WS-WRKR-TYPE;
  /*  */
  /* ********* ------- Changes due to ptr 2819 begin --------- ************/
  /*  */
    H2-FAM-CASELD-CASE.CASLD-EFF-DT = H2-CASELD-DEBTLD.CASLD-EFF-DT;
  /*  */
  /* ********* ------- Changes due to ptr 2819 end   --------- ************/
  /*  */
    H2-FAM-CASELD-CASE.PRGM-OFC-TYPE = "A";
  /* MOVE SR-Q-DCF-REC.D-APPL-CASLD-ID TO H2-FAM-CASELD-CASE.CASLD-ID;*/
    H2-FAM-CASELD-CASE.CASLD-ID = "XBW01";
    H2-FAM-CASELD-CASE.IVE-CASLD-ID = SR-Q-DCF-REC.D-APPL-CASLD-ID;
    H2-FAM-CASELD-CASE.ICI = AIN49W.WS-ICI;
  /*  */
    AIN49P9-INS-I15();
  /*  */
  /* Set the values for DUP flags*/
  /*  */
    VDBCOMMON.UDUP = "Y";
  /*  */
  /* Perform the sql error processing*/
  /*  */
    WDB00PE-SQLERR();
  /*  */
  /* Check for fatal errors*/
  /*  */
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  else
  /*  */
  /* If record not found in TWNCASELD_DEBTLD, log the error*/
  /*  */
    VDBCONTROL.UPROC-NM = "AIN49P9-CRT-FCC";
    VDBCONTROL.UPROC-OBJ = "SR-Q-DCF-REC";
    VDBCONTROL.UPROC-OPT = "EXECUTE";
    VMESSAGE.UMSGINS[2] = "AIN49A";
    /*  */
    AIN49W4.WS-MSGTEXT-1 = "RECORD NOT FOUND IN TWNCASELD_DEBTLD FOR RECD ";
    AIN49W4.WS-MSGTEXT-N = SR-Q-CNT-REC.AININT-CNT-NO-RECS;
    AIN49W4.WS-MSGTEXT-2 = " PROCESS ROLLED BACK";
    VDBCONTROL.UEZESQRRM = AIN49W4.WS-MESSAGE;
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-FCC


// CREATE FAM CASE
Function AIN49P9-CRT-FCE()
  /* CREATE MEMBER RELATION*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-FAM-CASE empty;
  /* GENERATE ICI*/
  AIN49P9-GEN-ICI();
  H2-FAM-CASE.HOH-UPI = AIN49W.WS-UPI;
  H2-FAM-CASE.ICI = AIN49W.WS-ICI;
  H2-FAM-CASE.APPL-UPI = AIN49W.WS-UPI;
  H2-FAM-CASE.CASE-ESTBL-DT = AIN49W.WS-CURRENT-DATE;
  /*  */
  /* DUE TO DDL CHANGE,DATA TYPE OF THE COLUMN IVE-CASE-ID IN FAM-CASE*/
  /* HAS BEEN CHANGED TO INTEGER FROM CHARACTER. BUT, IVE-CASE-ID IS*/
  /* RECEIVED AS CHARACTER FROM THE INPUT FILE. FOR NOW IT IS ASSUMED*/
  /* THAT ONLY A VALID NUMERIC VALUE WILL BER RECEIVED IN*/
  /* D-KEY-CASE-NUMBER. ISSUE RAISED.*/
  AIN49W4.WS-CASE-NUMBER = SR-Q-DCF-REC.D-KEY-CASE-NUMBER;
  H2-FAM-CASE.IVE-CASE-ID = AIN49W4.WS-CASE-NUMBER;
  H2-FAM-CASE.IVE-RFRL-DT = AIN49W.WS-CURRENT-DATE;
  H2-FAM-CASE.LVNG-ARRGT-CD = "IL";
  H2-FAM-CASE.OOS-SSP-RCVD-IND = "N";
  AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-APPL-MA-APPLICATION-DATE;
  AIN49W.WS-MM = AIN49W5.WS-MM3;
  AIN49W.WS-YY-CC1 = AIN49W5.WS-CC3;
  AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
  AIN49W.WS-DD = AIN49W5.WS-DD3;
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-FAM-CASE.CASE-APPL-DT = AIN49W.WS-DATE;
  /*  */
  if (SR-Q-DCF-REC.D-MED-CARD-CUT == "Y")
  /* MOVE FIRST DATE OF NEXT MONTH OF D-BENEFIT-START-MONTH*/
    AIN49W5.WS-DATE4 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W5.WS-MM4 = AIN49W5.WS-MM4 + 1;
    if (AIN49W5.WS-MM4 > 12)
      AIN49W5.WS-MM4 = 1;
      AIN49W5.WS-YY4 = AIN49W5.WS-YY4 + 1;
    end
    AIN49W.WS-YYMM-DATE = AIN49W5.WS-DATE4;
    AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
    AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
    AIN49W.WS-DD = "01";
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
    H2-FAM-CASE.FRST-BNFT-DT = AIN49W.WS-DATE;

  else
    AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
    AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC2;*/
  /* END;*/
    AIN49W.WS-DD = "01";
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
    H2-FAM-CASE.FRST-BNFT-DT = AIN49W.WS-DATE;
  end
  H2-FAM-CASE.MVD-DT = "9999-12-31";
  H2-FAM-CASE.FS-ISNCE-CD-EFF-DT = "9999-12-31";
  H2-FAM-CASE.PRGD-DT = "0001-01-01";
  /* ------------------------------PTR 6785 BEGIN-----------------------*/
  H2-FAM-CASE.MAABD-MR-CD = "N";
  H2-FAM-CASE.OOS-SSP-RCVD-IND = "N";
  /* ------------------------------PTR 6785 BEGIN-----------------------*/

  /* ------------------------------PTR 7783 BEGIN-----------------------*/
  /* 1. The ALT PAYEE IND in H2-FAM-CASE IS UPDATED TO 'Y'*/
  /* 2. The AFDC APLD IND,FS-APLD-IND IS SET TO 'N' IN H2-FAM-CASE*/
  H2-FAM-CASE.ALT-PAYEE-IND = "Y";

  H2-FAM-CASE.TC-APLD-IND = "N"; /* WI 28413*/
  H2-FAM-CASE.TL-APLD-IND = "N"; /* WI 28413*/
  H2-FAM-CASE.TN-APLD-IND = "N"; /* WI 28413*/
  H2-FAM-CASE.TP-APLD-IND = "N"; /* WI 28413*/

  H2-FAM-CASE.AFDC-APLD-IND = "N";
  H2-FAM-CASE.FS-APLD-IND = "N";
  H2-FAM-CASE.MAABD-APLD-IND = "N";
  /* ------------------------------PTR 7783 END-------------------------*/

  /*  */
  AIN49P9-INS-I07();
  /*  */
  VDBCOMMON.UDUP = "Y";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-FCE


// CREATE FAM CASE HISTORY
Function AIN49P9-CRT-FCH()
  /* CREATE FAM-CASE-HISTORY*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-FAM-CASE-HSTRY empty;

  H2-FAM-CASE-HSTRY.ICI = AIN49W.WS-ICI;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-DD = "01";
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-DATE;
  H2-FAM-CASE-HSTRY.PRD-END-DT = "9999-12-31";
  H2-FAM-CASE-HSTRY.HOH-UPI-CHNG-DT = "9999-12-31";
  H2-FAM-CASE-HSTRY.VERF-DUE-DT = "9999-12-31";
  H2-FAM-CASE-HSTRY.MTHLY-RPTR-IND = "N";
  H2-FAM-CASE-HSTRY.AUTO-POST-IND = "Y";
  H2-FAM-CASE-HSTRY.CASE-STS = "O";
  H2-FAM-CASE-HSTRY.APPL-UPI = AIN49W.WS-UPI;
  H2-FAM-CASE-HSTRY.HOH-UPI = AIN49W.WS-UPI;
  /*  */
  /* -------------------PTR 5485 BEGIN -----------------------------*/
  /* the resident county received from the interface is also stored*/
  /* in the RSDN_CNTY_CD field*/
  /*  */
  H2-FAM-CASE-HSTRY.DCFS-OFC-CNTY-CD = SR-Q-DCF-REC.D-ADDR-RESIDENT-COUNTY;
  /* -------------------PTR 5485 END -------------------------------*/

  AIN49P9-INS-I08();
  /*  */
  VDBCOMMON.UDUP = "Y";
  /*  */
  WDB00PE-SQLERR();
  /*  */
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-FCH


// CREATE MEMBER RELATION
Function AIN49P9-CRT-MRR()
  /* CREATE MEMBER RELATION*/

  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-MEMBER-REL empty;

  H2-MEMBER-REL.FROM-UPI = AIN49W.WS-UPI;
  H2-MEMBER-REL.ICI = AIN49W.WS-ICI;
  H2-MEMBER-REL.TO-UPI = AIN49W.WS-UPI;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-DD = "01";
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-MEMBER-REL.PRD-BEG-DT = AIN49W.WS-DATE;
  H2-MEMBER-REL.PRD-END-DT = "9999-12-31";
  H2-MEMBER-REL.RELSH-CD = "01";
  H2-MEMBER-REL.REL-VERF-BY = "DCFS";
  /* MOVE CURRENT DATE TO VERIFICATION DATE*/
  H2-MEMBER-REL.REL-VERF-DT = AIN49W.WS-CURRENT-DATE;
  H2-MEMBER-REL.REL-VERF-CD = "Y";
  /*  */
  AIN49P9-INS-I06();
  /*  */
  VDBCOMMON.UDUP = "Y";
  WDB00PE-SQLERR();
  /*  */
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-CRT-MRR