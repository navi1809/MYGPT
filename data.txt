After 180013204 section
<%-- ======================= Residence Information (NEW) ======================= --%>
<AP:FwSubsectionTag textID="1800RESIDENCE" headerLevel="<%=FwConstants.HEADER_LEVEL_H3%>">
    <TABLE role="presentation">
        <TR>
            <TD>
                <label><AP:FwPageLabelTag textID="1800RES_Q1"/></label>
            </TD>
            <TD>
                <input type="radio" name="isIllinoisResident" id="isIllinoisResidentYes" value="Y"/>
                <AP:FwPageLabelTag textID="18000895"/><%-- Yes --%>
                <input type="radio" name="isIllinoisResident" id="isIllinoisResidentNo" value="N"/>
                <AP:FwPageLabelTag textID="90666"/><%-- No --%>
            </TD>
        </TR>
        <TR>
            <TD>
                <label for="residenceLocation"><AP:FwPageLabelTag textID="1800RES_Q2"/></label>
            </TD>
            <TD>
                <select id="residenceLocation" name="residenceLocation">
                    <option value=""></option>
                    <option value="opt1"><AP:FwPageLabelTag textID="1800RES_OPT1"/></option>
                    <option value="opt2"><AP:FwPageLabelTag textID="1800RES_OPT2"/></option>
                    <option value="opt3"><AP:FwPageLabelTag textID="1800RES_OPT3"/></option>
                </select>
            </TD>
        </TR>
    </TABLE>
</AP:FwSubsectionTag>
<%-- ===================== End Residence Information (NEW) ===================== --%>





<div id="people">   

  <%-- ========== People in your Household/Tax Filing Group (NEW) ========== --%>
<AP:FwSubsectionTag textID="1800HH_GROUP" headerLevel="<%=FwConstants.HEADER_LEVEL_H3%>">
    <TABLE role="presentation" width="100%">
        <TR>
            <TD><label for="peopleLivingWithYou"><AP:FwPageLabelTag textID="1800HH_Q1"/></label></TD>
            <TD>
                <select id="peopleLivingWithYou" name="peopleLivingWithYou">
                    <option value=""></option>
                    <option value="1">1</option><option value="2">2</option>
                    <option value="3">3</option><option value="4">4</option>
                    <option value="5">5</option><option value="6">6</option>
                </select>
            </TD>
        </TR>
        <TR>
            <TD><label for="peopleOutsideHousehold"><AP:FwPageLabelTag textID="1800HH_Q2"/></label></TD>
            <TD>
                <select id="peopleOutsideHousehold" name="peopleOutsideHousehold">
                    <option value=""></option>
                    <option value="1">1</option><option value="2">2</option>
                    <option value="3">3</option><option value="4">4</option>
                    <option value="5">5</option><option value="6">6</option>
                </select>
            </TD>
        </TR>
        <TR>
            <TD><label for="peopleDependent"><AP:FwPageLabelTag textID="1800HH_Q3"/></label></TD>
            <TD>
                <select id="peopleDependent" name="peopleDependent">
                    <option value=""></option>
                    <option value="1">1</option><option value="2">2</option>
                    <option value="3">3</option><option value="4">4</option>
                    <option value="5">5</option><option value="6">6</option>
                </select>
            </TD>
        </TR>
        <TR>
            <TD><strong><AP:FwPageLabelTag textID="1800HH_TOTAL"/></strong></TD>
            <TD>
                <input type="text" id="totalPeopleHousehold" name="totalPeopleHousehold" value="0" readonly="readonly"/>
            </TD>
        </TR>
    </TABLE>
</AP:FwSubsectionTag>
<%-- ======== End People in your Household/Tax Filing Group (NEW) ======== --%>


function setupHouseholdTotals() {
    var live = document.getElementById("peopleLivingWithYou");
    var outside = document.getElementById("peopleOutsideHousehold");
    var dependent = document.getElementById("peopleDependent");
    var totalField = document.getElementById("totalPeopleHousehold");

    if (!live || !outside || !dependent || !totalField) return;

    function num(v) { return v ? parseInt(v, 10) : 0; }

    function updateTotal() {
        var total = num(live.value) + num(outside.value) + num(dependent.value);
        totalField.value = total || 0;
    }

    live.addEventListener("change", updateTotal);
    outside.addEventListener("change", updateTotal);
    dependent.addEventListener("change", updateTotal);

    // initialize on page load
    updateTotal();
}

document.addEventListener("DOMContentLoaded", setupHouseholdTotals);




/**
 * Page-level validator for Household Composition + Residence Info
 * This is called automatically by <AP:FwNavButtonTag buttonType="NEXT"/>
 */
function validateABAWAHouseholdComposition() {
    var messages = [];

    // --- Residence Information Validation ---
    // Grab the selected Illinois residency radio button
    var residentYes = document.querySelector('input[name="isIllinoisResident"][value="Y"]');
    var residentNo = document.querySelector('input[name="isIllinoisResident"][value="N"]');
    var residenceDropdown = document.getElementById("residenceLocation");

    if (residentYes && residentNo) {
        if (!residentYes.checked && !residentNo.checked) {
            messages.push("Please select whether this person is a resident of Illinois.");
        }
    }

    if (residenceDropdown && residenceDropdown.value === "") {
        messages.push("Please select where the person lives.");
    }

    // --- Household/Tax Filing Group Validation ---
    var peopleLiving = document.getElementById("peopleLivingWithYou");
    var peopleOutside = document.getElementById("peopleOutsideHousehold");
    var peopleDependent = document.getElementById("peopleDependent");
    var totalPeopleField = document.getElementById("totalPeopleHousehold");

    var livingVal = peopleLiving ? parseInt(peopleLiving.value, 10) || 0 : 0;
    var outsideVal = peopleOutside ? parseInt(peopleOutside.value, 10) || 0 : 0;
    var dependentVal = peopleDependent ? parseInt(peopleDependent.value, 10) || 0 : 0;
    var totalVal = totalPeopleField ? parseInt(totalPeopleField.value, 10) || 0 : 0;

    // auto-calc total into the field if it's present
    if (totalPeopleField) {
        totalPeopleField.value = livingVal + outsideVal + dependentVal;
    }

    // Rule 1: total = sum of above
    if (totalVal !== (livingVal + outsideVal + dependentVal)) {
        messages.push("Total people in the household/tax filing group must equal the sum of questions 1, 2, and 3.");
    }

    // Rule 2: total must equal number of persons added on the page
    var personSections = document.querySelectorAll(".personSection");
    var personsAddedCount = personSections ? personSections.length : 0;

    if (totalVal !== personsAddedCount) {
        messages.push("Total people in the household/tax filing group must match the number of persons added.");
    }

    // --- Return Results ---
    if (messages.length > 0) {
        displayDynaSectionMessages(messages); // existing framework function
        return false; // stop NEXT navigation
    }
    return true;
}
