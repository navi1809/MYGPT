function DCP27P9-GET-CSLD()

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-IVD-CASELD-CASE";

    /*  */

    VDBCONTROL.UPROC-OBJ = "H2-IVD-CASELD-CASE";

    VDBCONTROL.UPROC-OPT = "SETINQ";

    VDBCONTROL.UPROC-NM = "DCP27P9-GET-CSLD";

    VDBCOMMON.USQLREC = "H2-IVD-CASELD-CASE";

    /*  */

    try

        open DCP27P9-GET-CSLD_RSI01

                with #sql{

        select CASELD_IND, RSP_CNTY

        from twnivd_caseld_case T1

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

        WHERE UPI = :UPI

          AND CASE_SUFX = :CASE-SUFX

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into CASELD-IND, RSP-CNTY for H2-IVD-CASELD-CASE;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

end // end DCP27P9-GET-CSLD



// GET the cst ssn



function DCP27P9-GET-CSTUPI()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 29 may 1997               CREATION*/

/* -----------------------------------------------------------*/

/*  */

/* Perform standard database application initialization*/

    WDB00PI();

    /* Initialize:*/

    /* UACCTYP - Access type (R=read, W=write)*/

    /* UAPPLNAM - Application name*/

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /* Initialize SQL row record*/

    /*  */

    set H2-PERSON empty;

    H2-PERSON.UPI = H-TIDCQ7.CST-UPI;

    /* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-PERSON";

    VDBCONTROL.UPROC-OBJ = "H2-PERSON";

    VDBCONTROL.UPROC-NM = "DCP27P9-GET-CSTUPI";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    /*  */

    try

        get H2-PERSON singleRow

                with #sql{

        select SSN

        from TWNPERSON T1

        WHERE UPI    = :UPI

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into SSN;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* Set error control flags*/

    /* UNRF - No record found flag (Y,N,1)*/

    /* UDUP - Duplicate key flag (Y,N)*/

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    /*  */

    /*  */

end // end DCP27P9-GET-CSTUPI



// PERFORM GET H2-2-PAH-PER



function DCP27P9-GET-NCCNTY()

/* PTR 7780 START*/

    if(H-TIDCQ7.FUNC-AREA-CD == "N")

        DCP27W2.WS-CST-CNTY = "99";

        DCP27W2.WS-NCP-CNTY = "99";

        return;

    end

    /* PTR 7780 END*/

    /* PTR 6262 START*/



    set H2-2-PAH-PER empty;

    DCP27W2.WS-EXIT-FLAG = "N";

    H2-2-PAH-PER.UPI = DCP27W.PI1-NCP-UPI;

    DCP27P9-CL1();

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    if(VDBCONTROL.URC == 100)

        set H2-JOB-HISTORY empty;

        DCP27W2.WS-EXIT-FLAG = "N";

        H2-JOB-HISTORY.UPI = DCP27W.PI1-NCP-UPI;

        DCP27P9-JHSCL1();

        if(VDBCONTROL.URC > 104)

            exit program;

        end

        if(VDBCONTROL.URC == 100)

            DCP27W2.WS-CST-CNTY = "99";

            DCP27W2.WS-NCP-CNTY = "99";

            return;

        /* ptr 9287 start*/

        /* ELSE;*/

        /* MOVE H2-JOB-HISTORY.CITY TO DCP27W2.WS-NCP-CITY;*/

        /* ptr 9287 end*/

        end

    else

        DCP27W2.WS-NCP-CITY = DCP27W2.WS-CITY;

    end

    H-TCDTSL.CODE-TBL-TYP = "CITYCNTY";

    H-TCDTSL.CODE-DESC = DCP27W2.WS-NCP-CITY;

    call "TCDTSLA"(VDBCONTROL, VMESSAGE, H-TCDTSL){isNoRefresh = yes};

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    if(VDBCONTROL.URC == 0)

        DCP27W2.WS-CST-CNTY = H-TCDTSL.CODE-TBL-CD;

        DCP27W2.WS-NCP-CNTY = H-TCDTSL.CODE-TBL-CD;

    else

        DCP27W2.WS-CST-CNTY = "99";

        DCP27W2.WS-NCP-CNTY = "99";

    end

    /* ptr 9287 start*/

    if(DCP27W2.WS-NCP-CITY == " ")

        DCP27W2.WS-CST-CNTY = "99";

        DCP27W2.WS-NCP-CNTY = "99";

    end

    /* ptr 9287 start*/

    /* PTR 6262 END*/

end // end DCP27P9-GET-NCCNTY



// READ FROM JOB HISTORY



function DCP27P9-JHS-S12L1()

/*  */

// WI 2920 - Select status 'V', not "'C' or 'V'"

// WI 3042 - Undo last change

    WDB00PI();

    /*  */

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    VDBCONTROL.UPROC-NM = "DCP27P9-JHS-S12L1";

    try

        get H2-JOB-HISTORY singleRow

                with #sql{

        select COUNT(*)

        from TWNJOB_HISTORY T1

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

         --** INSERT ORDER BY CLAUSE HERE **

        WHERE JOB_END_DT > :DCP27W2.WS-PROC-DATE

          AND JOB_BEG_DT <= :DCP27W2.WS-PROC-DATE

          AND VRFN_STS in ('C', 'V')

          AND ST_CD = 'NV'

          AND UPI = :UPI

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into DCP27W2.WS-S12-ROWS;

    end

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "Y";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

end // end DCP27P9-JHS-S12L1



// READ FROM EMPLOYER JOB HISTORY



function DCP27P9-JHS-S13L1()

/*  */

/* PTR # 8214 - READ FROM JOB HISTORY TABLE*/

/*  */

// WI 2920 - Select status 'V', not "'C' or 'V'"

// WI 3042 - Undo last change

    WDB00PI();

    /*  */

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    VDBCOMMON.USQLREC = "H2-2-EMP-JHS";

    VDBCONTROL.UPROC-OBJ = "H2-2-EMP-JHS";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    VDBCONTROL.UPROC-NM = "DCP27P9-JHS-S13L1";

    try

        get H2-2-EMP-JHS singleRow

                with #sql{

        select COUNT(*)

        from TWNJOB_HISTORY T1,

             TWNEMPLOYER T2

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

         --** INSERT ORDER BY CLAUSE HERE **

        WHERE T1.JOB_END_DT > :DCP27W2.WS-PROC-DATE

          AND T1.JOB_BEG_DT <= :DCP27W2.WS-PROC-DATE

          AND T1.VRFN_STS in ('C', 'V')

          AND T2.ST_CD = 'NV'

          AND T1.UPI = :UPI

          AND T1.EMPLR_ID = T2.EMPLR_ID

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into DCP27W2.WS-S13-ROWS;

    end

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "Y";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

end // end DCP27P9-JHS-S13L1



// LUW for DB Access



function DCP27P9-JHSCL1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/* CBSI START*/

    WDB00PI();

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    DCP27P9-JHSCP1();

    if(DCP27W2.WS-EXIT-FLAG == "Y")

        return;

    end

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

end // end DCP27P9-JHSCL1



// Control Retrieve of Data



function DCP27P9-JHSCP1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/* CBSI START*/

    DCP27P9-JHSCQ1();



    /* PTR 9287 START*/

    DCP27W2.WS-NCP-CITY = " ";

    DCP27W2.WS-SQLCODE1 = sysVar.sqlData.sqlcode;

    /* WHILE EZESQCOD = 0;*/

    while(DCP27W2.WS-SQLCODE1 == 0)

        DCP27P9-JHSCQS();

        DCP27W2.WS-SQLCODE1 = sysVar.sqlData.sqlcode;

        if(sysVar.sqlData.sqlcode == 0)

            /* PTR 9287 START*/

            if(H2-JOB-HISTORY.ST-CD == "NV")

                DCP27W2.WS-NCP-CITY = H2-JOB-HISTORY.CITY;

                DCP27W2.WS-EXIT-FLAG = "Y";

                return;

            else

                H2-EMPLOYER.EMPLR-ID = H2-JOB-HISTORY.EMPLR-ID;

                DCP27P9-EMPLR-L1();

                if(sysVar.sqlData.sqlcode == 0)

                    if(H2-EMPLOYER.ST-CD == "NV")

                        DCP27W2.WS-NCP-CITY = H2-EMPLOYER.CITY;

                        DCP27W2.WS-EXIT-FLAG = "Y";

                        return;

                    else

                        if(H2-EMPLOYER.AGNT-ST == "NV")

                            DCP27W2.WS-NCP-CITY = H2-EMPLOYER.AGNT-CITY;

                            DCP27W2.WS-EXIT-FLAG = "Y";

                            return;

                        end

                    end

                end

            end

        end

    end

    /* CBSI END*/

end // end DCP27P9-JHSCP1



// SETINQ H2-JOB-HISTORY



function DCP27P9-JHSCQ1()

/* -----------------------------------------------------------*/

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* 5/1/15      WI 2920     Select only status 'V', not "'C' or 'V'" */

/* 6/19/15     WI 3042     Undo last change                         */

/* -----------------------------------------------------------*/

/* CBSI START*/

/*  */

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-NM = "DCP27P9-JHSCQ1";

    VDBCONTROL.UPROC-OPT = "SETINQ";

    /*  */

    try

        open DCP27P9-JHSCQ1_RSI01

                with #sql{

        select EMPLR_ID,

            ST_CD,

            CRTN_DT,

            CITY

        from TWNJOB_HISTORY T1

        WHERE

            UPI        = :H2-JOB-HISTORY.UPI  AND

            JOB_END_DT = '9999-12-31'         AND

            VRFN_STS in ('C', 'V')       AND

            ST_CD     in ( 'NV' , '  ')

        ORDER BY CRTN_DT DESC

      }

                into EMPLR-ID, ST-CD, CRTN-DT, CITY for H2-JOB-HISTORY;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* CBSI END*/

end // end DCP27P9-JHSCQ1



// SCAN H2-JOB-HISTORY



function DCP27P9-JHSCQS()

/* -----------------------------------------------------------*/

/* This process SCANs the retrieved rows from the previous SETINQ.*/

/*  */

/*  */

/* Change History*/

/* ==============*/

/* DATE        NAME        DESCRIPTION*/

/* ----        -----       ----------*/

/* 3 Apr 1995   TBST149      CREATION*/

/* -----------------------------------------------------------*/

/* CBSI START*/

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-OBJ = "H2-JOB-HISTORY";

    VDBCONTROL.UPROC-NM = "DCP27P9-JHSCQS";

    VDBCONTROL.UPROC-OPT = "SCAN";

    /*  */

    try

        get next H2-JOB-HISTORY;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

    /* CBSI END*/

end // end DCP27P9-JHSCQS



// Find next child for Alerts



function DCP27P9-NXT-CHDALT()

/*  */

    VDBCOMMON.USQLREC = "H3-IVD-CASE-CHD";

    VDBCONTROL.UPROC-OBJ = "H3-IVD-CASE-CHD";

    VDBCONTROL.UPROC-OPT = "SCAN";

    VDBCONTROL.UPROC-NM = "DCP27P9-NXT-CHDALT";

    try

        get next H3-IVD-CASE-CHD;

    end

    /*  */

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

        DCP27P9-GEN-CHDALT();

    end

    /*  */

end // end DCP27P9-NXT-CHDALT



// CREATE ALERTS ON FUNC AREA



function DCP27P9-ORDEREXIST()

/*  */

    DCP27P9-DAA-S15Q1();

    if(sysVar.sqlData.sqlcode == 0)

        DCP27W2.WS-ORDER-FOUND = "Y";

    else

        DCP27W2.WS-ORDER-FOUND = "N";

    end

    /*  */

end // end DCP27P9-ORDEREXIST



// CREATE ALERTS ON FUNC AREA



function DCP27P9-OUST-ALRT()

/*  */

    set H2-PERSON-ADRS-HST empty;

    DCP27W2.WS-S11-ROWS = 0;

    H2-PERSON-ADRS-HST.UPI = DCP27W2.WS-NCP-UPI;

    DCP27P9-PAH-S11L1();

    if(DCP27W2.WS-S11-ROWS > 0)

    /*  */

    /*  */

    else

        /*  */

        set H2-JOB-HISTORY empty;

        H2-JOB-HISTORY.UPI = DCP27W2.WS-NCP-UPI;

        DCP27W2.WS-S12-ROWS = 0;

        DCP27P9-JHS-S12L1();

        if(DCP27W2.WS-S12-ROWS == 0)

            DCP27W2.WS-S13-ROWS = 0;

            set H2-2-EMP-JHS empty;

            H2-2-EMP-JHS.UPI = DCP27W2.WS-NCP-UPI;

            DCP27P9-JHS-S13L1();

            if(DCP27W2.WS-S13-ROWS == 0)

                /*  */

                if(DCP27W2.WS-FUNC-AREA-CD != "L" && DCP27W2.WS-CASE-TYPE !=

                                "Q")

                    PCALINP.PAL-ALERT-CD = 390001;

                    PCALINP.PAL-UPI = DCP27W2.WS-NCP-UPI;

                    PCALINP.PAL-SUFFIX = DCP27W2.WS-CASE-SUFX;

                    PCALINP.PAL-ALERT-ACTION = "C";

                    PCALINP.PAL-DISPL-DT = "0001-01-01";

                    PCALINP.PAL-DUE-DT = "0001-01-01";

                    /*  */

                    DCP27S01-CAL11();

                end

            end

        end

    end

    /*  */

end // end DCP27P9-OUST-ALRT



// READ FROM PERSON ADRS HST



function DCP27P9-PAH-S11L1()

/*  */

// WI 2920 - Select status 'V', not "'C' or 'V'"

// WI 3042 - Undo last change and add 'P'

    WDB00PI();

    /*  */

    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    /*  */

    VDBCOMMON.USQLREC = "H2-PERSON-ADRS-HST";

    VDBCONTROL.UPROC-OBJ = "H2-PERSON-ADRS-HST";

    VDBCONTROL.UPROC-OPT = "INQUIRY";

    VDBCONTROL.UPROC-NM = "DCP27P9-PAH-S11L1";

    try

        get H2-PERSON-ADRS-HST singleRow

                with #sql{

        select COUNT(*)

        from TWNPERSON_ADRS_HST T1

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

         --** INSERT ORDER BY CLAUSE HERE **

        WHERE PRD_END_DT > :DCP27W2.WS-PROC-DATE

          AND ADR_STS in ('C', 'P', 'V')

          AND ST_CD = 'NV'

          AND UPI = :UPI

          AND ADR_TYPE <> 'BI'

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into DCP27W2.WS-S11-ROWS;

    end

    VDBCOMMON.UNRF = "Y";

    VDBCOMMON.UDUP = "Y";

    /*  */

    /* Perform DBM error processing*/

    WDB00PE-SQLERR();

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

end // end DCP27P9-PAH-S11L1



// SETINQ for Pop-Up List Data



function DCP27P9-PRC-CHDALT()

    WDB00PI();



    VDBCONTROL.UACCTYP = "R";

    VDBCOMMON.UAPPLNAM = "DCP27A";

    set H3-IVD-CASE-CHD empty;

    /*  */

    VDBCOMMON.USQLREC = "H3-IVD-CASE-CHD";

    VDBCONTROL.UPROC-OBJ = "H3-IVD-CASE-CHD";

    VDBCONTROL.UPROC-OPT = "SETINQ";

    VDBCONTROL.UPROC-NM = "DCP27P9-PRC-CHDALT";

    /*  */

    H3-IVD-CASE-CHD.NCP-UPI = DCP27W2.WS-NCP-UPI;

    H3-IVD-CASE-CHD.CASE-SUFX = DCP27W2.WS-CASE-SUFX;

    try

        open DCP27P9-PRC-CHDALT_RSI01

                with #sql{

        select T2.FUNC_AREA_CD, T1.PATRN_STS_CD, T1.CHD_UPI

        from TWNIVD_CASE_CHILD T1,

             TWNIVD_CASE T2

         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **

        WHERE

           T1.NCP_UPI = T2.NCP_UPI AND

           T1.CASE_SUFX = T2.CASE_SUFX AND

           T1.NCP_UPI = :NCP-UPI AND

           T1.CASE_SUFX = :CASE-SUFX AND

           T1.CHILD_RMVD_RSN = ' '

         --** INSERT ORDER BY CLAUSE HERE **

      }

                into FUNC-AREA-CD, PATRN-STS-CD, CHD-UPI for H3-IVD-CASE-CHD;

    end

    VDBCOMMON.UNRF = "N";

    VDBCOMMON.UDUP = "N";

    WDB00PE-SQLERR();

    VDBCONTROL.UPROC-OBJ = "H3-IVD-CASE-CHD";

    VDBCOMMON.USQLREC = "H3-IVD-CASE-CHD";

    VDBCONTROL.UPROC-OPT = "SCAN";

    while(sysVar.sqlData.sqlcode == 0)

        DCP27P9-NXT-CHDALT();

    end

end // end DCP27P9-PRC-CHDALT



// used in dcp27a



function DCP27P9-SCAN-CSLD()

/* Move name of SQL row record used to common record*/

    VDBCOMMON.USQLREC = "H2-IVD-CASE";

    /*  */

    VDBCONTROL.UPROC-OBJ = "H2-IVD-CASE";

    VDBCONTROL.UPROC-OPT = "SCAN";

    VDBCONTROL.UPROC-NM = "DCP27P9-SCAN-CSLD";

    VDBCOMMON.USQLREC = "H2-IVD-CASE";

    /*  */

    try

        get next H2-IVD-CASELD-CASE;

    end

    /*  */

    /* Increment count of rows retrieved*/

    if(sysVar.sqlData.sqlcode == 0)

        VDBCONTROL.UROWR = VDBCONTROL.UROWR + 1;

    end

end // end DCP27P9-SCAN-CSLD



// CALL TO CAL11A FOR ALERT



function DCP27S01-CAL11()

/*  */

    PCALINP.PAL-PROCESS-DT = DCP27W2.WS-PROC-DATE;

    /*  */

    call "CAL11A"(VDBCONTROL, VMESSAGE, PCALINP){isNoRefresh = yes};

    /*  */

    if(VDBCONTROL.URC > 104)

        exit program;

    end

    /*  */

end // end DCP27S01-CAL11