/* Full benefits by office (total, PA, NA) for Jan 2025
   Derived from AME37A S04 logic:
   - Approvals are action types ('FA','RE','RI') on TWNFAM_ACTNS (FAM_ACTNS) :contentReference[oaicite:0]{index=0}
   - Office comes from TWNFAM_CASELD_CASE with PRGM_OFC_TYPE='A' :contentReference[oaicite:1]{index=1}
*/
SELECT
  C.OFC_CD,
  COUNT(*) AS full_benefits_total,
  SUM(CASE WHEN H.FS_SUFX IN ('P','S','G','A') THEN 1 ELSE 0 END) AS pa_benefits,
  SUM(CASE WHEN H.FS_SUFX IN ('P','S','G','A') THEN 0 ELSE 1 END) AS na_benefits
FROM W026DTF1.TWNFAM_ACTNS       A
JOIN W026DTF1.TWNFAM_CASELD_CASE C
  ON C.ICI = A.ICI
JOIN W026DTF1.TWNFAM_CASE_HSTRY  H
  ON H.ICI = A.ICI
WHERE C.PRGM_OFC_TYPE = 'A'
  AND A.PRGM_TYP = 'FS'
  AND A.ACTN_TYP IN ('FA','RE','RI')
  AND A.ACTN_TS BETWEEN TIMESTAMP '2025-01-01 00:00:00'
                    AND TIMESTAMP '2025-01-31 23:59:59'
GROUP BY C.OFC_CD
ORDER BY C.OFC_CD;
