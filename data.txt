//clonedappIndvCollArray=appIndvColl.cloneResults();
			clonedappIndvCollArray = appIndvColl.cloneResults();
			if(clonedappIndvCollArray != null && clonedappIndvCollArray.length > 0){
				for(int i=1; i<= clonedappIndvCollArray.length; i++){
					for(APP_INDV_Cargo cargo : clonedappIndvCollArray){
						if(cargo.getIndv_seq_num() != null  && !cargo.getIndv_seq_num().isEmpty())
							seqNum = Integer.valueOf(cargo.getIndv_seq_num());
						if(seqNum == i){
							appColl.add(cargo);
							break;
						}
					}
				}
			}
			
			clonedTaxCollArray = taxIndvColl.cloneResults();
			if(clonedTaxCollArray != null && clonedTaxCollArray.length > 0){
				for(int i=1; i<= clonedTaxCollArray.length; i++){
					for(APP_TAX_RLT_Cargo cargo : clonedTaxCollArray){
						if(cargo.getSrc_indv_seq_num() != null  && !cargo.getSrc_indv_seq_num().isEmpty())
							srcSeqNum = Integer.valueOf(cargo.getSrc_indv_seq_num());
						if(srcSeqNum == i){
							taxColl.add(cargo);
							break;
						}
					}
				}
			}
			//ILIES-282238 changes end here.
			
			if(errorMessageList != null && abhhqObj.hasMessages())
			{
					//Translate Profile Response After Validation
					applicationManager.translateProfileResponseAfterValidation(pageCollAppInPrflColl, 
							sesAppInPrflColl, questionsArray);
					List compList = new ArrayList();
					INDIVIDUAL_Custom_Collection fosterIndvColl ;				
					request.put(FwConstants.MESSAGE_LIST, errorMessageList); 
					
					//load maps into page collection
					createAndLoadABHHQResponseMapsToPageCollection(pageCollAppInPrflColl, pageCollection, peopleHandler, false, 0);	
					fosterIndvColl = PeopleRulesBO.getIndividualsAgeGreaterOrEqualTo18AndLessOrEqualTo25(indivColl);							
					pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);
					pageCollection.put("APP_IN_PRFL_Collection", pageCollAppInPrflColl);
					
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix.
					pageCollection.put(AppConstants.PEOPLE_56, beforeCollection.get(AppConstants.PEOPLE_56));
					pageCollection.put(AppConstants.PEOPLE_58, beforeCollection.get(AppConstants.PEOPLE_58));
		    		// Added for ILIES-129516
					pageCollection.put(AppConstants.PEOPLE_5218, beforeCollection.get(AppConstants.PEOPLE_5218));
					pageCollection.put(AppConstants.PEOPLE_5219, beforeCollection.get(AppConstants.PEOPLE_5219));
					pageCollection.put(AppConstants.PEOPLE_41, beforeCollection.get(AppConstants.PEOPLE_41));
					//Added by Uma for SSExpansion -- SSI Benefits and Clash benefits
					pageCollection.put("PEOPLE_418", beforeCollection.get("PEOPLE_418"));
					pageCollection.put("PEOPLE_419", beforeCollection.get("PEOPLE_419"));
					pageCollection.put(AppConstants.PEOPLE_421, beforeCollection.get(AppConstants.PEOPLE_421));
					pageCollection.put(AppConstants.PEOPLE_43, beforeCollection.get(AppConstants.PEOPLE_43));
					txnBean.setPageCollection(pageCollection);
					pageCollection.put(FwConstants.PAGE_COMPONENT_LIST, beforeCollection.get(FwConstants.PAGE_COMPONENT_LIST));
					if(fosterIndvColl == null || fosterIndvColl.isEmpty()){
						compList = (List)pageCollection.get(FwConstants.PAGE_COMPONENT_LIST);
						if(compList.contains("43")){
							compList.remove("43");
							pageCollection.put(FwConstants.PAGE_COMPONENT_LIST, compList);
						}
						
					}
					if(beforeCollection!=null){
						pageCollection.put(AppConstants.ALL_APP_INDIVS_TAX, beforeCollection.get(AppConstants.ALL_APP_INDIVS_TAX));
						// added by sai nagandla for ILIES-313147 
					}
					pageCollection.put("APP_TAX_RLT_INDIVS", taxIndvColl);
					pageCollection.put("APP_INDV_Collection", appIndvColl);
				    pageCollection.put("APP_TAX_RLT_Collection", taxIndvColl);
				    if(appJointlyFilingTax != null) {
				        pageCollection.put("APP_JOINTLY_FILING_TAX", appJointlyFilingTax);
				    }
                    // added by sai nagandla for ILIES-313147 end
					
					ABRelevanceBO relevanceBO = new ABRelevanceBO();
	 				APP_HSHL_RLT_Collection houseHoldCollection;
	 				houseHoldCollection=relevanceBO.loadHSHLRLT((String)session.get(AppConstants.APP_NUMBER));
	 				String language = null;	
	 				List<String> houseHold=new ArrayList<String>();
	 				List<String> houseHoldInverse=new ArrayList<String>();	
	 			 	Map httpSessionMap = (Map)session.get(FwConstants.HTTP_SESSION);
	 				language = (String)httpSessionMap.get(AppConstants.LANGUAGE);
	 			    IReferenceTableManager iref = ReferenceTableManager.getInstance();
	 				
	 			   for(APP_HSHL_RLT_Cargo cargo:houseHoldCollection.getResults()){								
						 String desc = iref.getColumnValue("IREL",137,cargo.getRlt_cd(),language);
						 houseHold.add("\""+cargo.getSrc_indv_seq_num()+cargo.getRef_indv_seq_num()+"\":\""+desc+"\"");		
					     request.put("DISPLAY_MAP", houseHold.toString().replace("[", "{").replace("]", "}"));
					}

		 		   	for(APP_HSHL_RLT_Cargo cargo:houseHoldCollection.getResults()){
		
						String gender = peopleHandler.getIndividual(cargo.getRef_indv_seq_num()).getSex_ind();
		 		   		 if("M".equalsIgnoreCase(gender)){
						 String desc = iref.getColumnValue("IREL",138,cargo.getRlt_cd(),language);
		 				 houseHoldInverse.add("\""+cargo.getRef_indv_seq_num()+cargo.getSrc_indv_seq_num()+"\":\""+desc+"\"");
		 				 }	
		 				else{
		 				 String desc = iref.getColumnValue("IREL",139,cargo.getRlt_cd(),language);
		 				 houseHoldInverse.add("\""+cargo.getRef_indv_seq_num()+cargo.getSrc_indv_seq_num()+"\":\""+desc+"\"");
		 				}
		 		   		request.put("INVERSE_MAP", houseHoldInverse.toString().replace("[", "{").replace("]", "}"));
					}
					txnBean.setRequest(request);
					txnBean.setPageCollection(pageCollection);
					//Added by Nancy Jain for ILIES-282238 : Added collection in the request.
					request.put(FwConstants.PAGE_COLL_0, prflColl);
					request.put(FwConstants.PAGE_COLL_1, taxColl);
					request.put(FwConstants.NUMBER_OF_COLLECTIONS_FOR_WARNING_MSG, 2);
					//ILIES-282238 changes end here
					return;
				
			} 
				// Added for ILIES-137846
				if (pageRltColl != null && !pageRltColl.isEmpty()) {

					
					ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
					
					Map criteriaMap = null;
					FwDataCriteria[] criteria = null;
					APP_HSHL_RLT_Collection rltCollection = new APP_HSHL_RLT_Collection();
					criteriaMap = new HashMap();
					criteria = new FwDataCriteria[1];
					criteria[0] = new FwDataCriteria();
					criteria[0].setColumn_name(AppConstants.APP_NUM);
					criteria[0].setColumn_value(appNumber);
					criteria[0].setData_type(FwConstants.LONG);
					criteriaMap.put(FwConstants.CRITERIA, criteria);
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					APP_HSHL_RLT_Cargo[] dbRltCargos = (APP_HSHL_RLT_Cargo[]) rltCollection
					.select(FwConstants.DAO, criteriaMap);
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					Map<String, APP_HSHL_RLT_Cargo> dbMap=new HashMap<String, APP_HSHL_RLT_Cargo>();
					for(APP_HSHL_RLT_Cargo db_rlt_cargo:dbRltCargos){
						db_rlt_cargo.setTax_dependent_sw("N");
						db_rlt_cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						String k = key(db_rlt_cargo.getRef_indv_seq_num(),db_rlt_cargo.getSrc_indv_seq_num());
						dbMap.put(k, db_rlt_cargo);
					}
					
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					APP_HSHL_RLT_Collection updateRltColl=new APP_HSHL_RLT_Collection();
					for(APP_TAX_RLT_Cargo page_rlt_cargo:pageRltColl.getResults()){
						APP_HSHL_RLT_Cargo dbRltCargo;
						//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
						String pageRltRel= key(page_rlt_cargo.getRef_indv_seq_num(),page_rlt_cargo.getSrc_indv_seq_num());
						String pageRltRelRev=key(page_rlt_cargo.getSrc_indv_seq_num(),page_rlt_cargo.getRef_indv_seq_num());
						if(null!=page_rlt_cargo.getTax_dependent_sw() && page_rlt_cargo.getTax_dependent_sw().equals("Y")){
							if(dbMap.containsKey(pageRltRel)){
								dbRltCargo=dbMap.get(pageRltRel);
								dbRltCargo.setTax_dependent_sw("I");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							}else if(dbMap.containsKey(pageRltRelRev)){
								dbRltCargo=dbMap.get(pageRltRelRev);
								dbRltCargo.setTax_dependent_sw("Y");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							}
						}
					}
					updateRltColl.addAll(dbMap.values());
					houseHoldRelationBo.storeHousholdRelationshipDetails(updateRltColl,null,null);
				}
				
				//USERAN - Tax Jointly Filing Changes
				if (appJointlyFilingTax != null && !appJointlyFilingTax.isEmpty()) {

					
					ABHouseHoldRelationshipBO houseHoldRelationBo = new ABHouseHoldRelationshipBO();
					
					Map criteriaMap = null;
					FwDataCriteria[] criteria = null;
					APP_HSHL_RLT_Collection rltCollection = new APP_HSHL_RLT_Collection();
					criteriaMap = new HashMap();
					criteria = new FwDataCriteria[1];
					criteria[0] = new FwDataCriteria();
					criteria[0].setColumn_name(AppConstants.APP_NUM);
					criteria[0].setColumn_value(appNumber);
					criteria[0].setData_type(FwConstants.LONG);
					criteriaMap.put(FwConstants.CRITERIA, criteria);
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					APP_HSHL_RLT_Cargo[] dbRltCargos = (APP_HSHL_RLT_Cargo[]) rltCollection
					.select(FwConstants.DAO, criteriaMap);
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					Map<String, APP_HSHL_RLT_Cargo> dbMap=new HashMap<String, APP_HSHL_RLT_Cargo>();
					for(APP_HSHL_RLT_Cargo db_rlt_cargo:dbRltCargos){
						db_rlt_cargo.setTax_jointly_filed_sw("N");
						db_rlt_cargo.setRowAction(FwConstants.ROWACTION_UPDATE);
						String k = key(db_rlt_cargo.getRef_indv_seq_num(),db_rlt_cargo.getSrc_indv_seq_num());
						dbMap.put(k, db_rlt_cargo);
					}
					//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
					APP_HSHL_RLT_Collection updateRltColl=new APP_HSHL_RLT_Collection();
					for(APP_TAX_RLT_Cargo jointlyFilingCargo:appJointlyFilingTax.getResults()){
						APP_HSHL_RLT_Cargo dbRltCargo;
						//Modified by Nancy Jain for ILIES-282238 : Sonar Fix-Changed variable name.
						String pageRltRel=key(jointlyFilingCargo.getRef_indv_seq_num(),jointlyFilingCargo.getSrc_indv_seq_num());
						String pageRltRelRev=key(jointlyFilingCargo.getSrc_indv_seq_num(),jointlyFilingCargo.getRef_indv_seq_num());
						if(null!=request.get("taxJointlyFiled_"+jointlyFilingCargo.getSrc_indv_seq_num()))
							jointlyFilingCargo.setTax_jointly_filed_sw(request.get("taxJointlyFiled_"+jointlyFilingCargo.getSrc_indv_seq_num()).toString());
						if(null!=request.get("taxJointlyFiled_"+jointlyFilingCargo.getRef_indv_seq_num()))
							jointlyFilingCargo.setTax_jointly_filed_sw(request.get("taxJointlyFiled_"+jointlyFilingCargo.getRef_indv_seq_num()).toString());
						
						if(null!=jointlyFilingCargo.getTax_jointly_filed_sw() && jointlyFilingCargo.getTax_jointly_filed_sw().equals("Y")){
							if(dbMap.containsKey(pageRltRel)){
								dbRltCargo=dbMap.get(pageRltRel);
								dbRltCargo.setTax_jointly_filed_sw("Y");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							}else if(dbMap.containsKey(pageRltRelRev)){
								dbRltCargo=dbMap.get(pageRltRelRev);
								dbRltCargo.setTax_jointly_filed_sw("Y");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							}
						}
						//ILIES-314659 | 11/25/2025 | susmanov | Taxes related info issue | START
						else if (null!=jointlyFilingCargo.getTax_jointly_filed_sw() && jointlyFilingCargo.getTax_jointly_filed_sw().equals("U")) {
							if (dbMap.containsKey(pageRltRel)) {
								dbRltCargo=dbMap.get(pageRltRel);
								dbRltCargo.setTax_jointly_filed_sw("U");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							} else if(dbMap.containsKey(pageRltRelRev)) {
								dbRltCargo=dbMap.get(pageRltRelRev);
								dbRltCargo.setTax_jointly_filed_sw("U");
								dbRltCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
							}
						}
						//ILIES-314659 | 11/25/2025 | susmanov | Taxes related info issue | END
					}
					updateRltColl.addAll(dbMap.values());
					houseHoldRelationBo.storeHousholdRelationshipDetails(updateRltColl,null,null);
				}
				INDIVIDUAL_Custom_Collection appIndvPrevColl = peopleHandler.getAllIndividuals();
				for(APP_INDV_Cargo appIndvCargoOld:appIndvColl.getResults()){
					
				}
				appIndvCargo = (APP_INDV_Cargo)isChanged(appIndvBeforeCargo,appIndvCargo);
			//	app
				//appIndvCargo.setRlvn_ind(appIndvBeforeCargo.getRlvn_ind());
				if(appIndvCargo.isDirty()){
					
					IndividualAge indvBeforeAge = peopleHandler.getIndividualAge(appIndvCargo.getIndv_seq_num());
				
					//if the cargo is dirty then we are updating the data base
					peopleHandler.updateIndividual(appIndvCargo);
					
					}
				
				
				//define a boolean array (size of SES_A_I_P + 1)
				int persistPeopleArraySize = applicationManager.getMaxSeqNumer(sesAppInPrflColl) + 1;
				boolean[] persistPeople = new boolean[persistPeopleArraySize];
				int persistPeopleSize = persistPeople.length; 
				
				//initialize array to false
				for(int i = 0; i < persistPeopleSize; i++){persistPeople[i] = false;}
				
				int pageCollAppInPrflCollSize = pageCollAppInPrflColl.size();
				
				//Loop for each Cargo in the Session APP_IN_PRFL collection
				for(int i = 0; i < sesAppPrflCollSize; i++)
				{
					//Get cargo i from the collection
					sesAppInPrflCargo = (APP_IN_PRFL_Cargo) sesAppInPrflColl.get(i);	
					
					//Get I_S_N for current cargo
					indivSeqNum = sesAppInPrflCargo.getIndv_seq_num();
					indivSeqNumInt = Integer.parseInt(indivSeqNum);
				
					//Get the matching indiv_seq_num cargo from the page collection
					for(int j = 0; j < pageCollAppInPrflCollSize; j++)
					{
						//Get cargo i from the collection
						pageCollAppInPrflCargo = (APP_IN_PRFL_Cargo) pageCollAppInPrflColl.get(j);	
						
						//does this match the SES_A_I_P cargo?
						if(Integer.parseInt(pageCollAppInPrflCargo.getIndv_seq_num()) ==
							indivSeqNumInt)
						{
							break;
						}
						else
						{
							pageCollAppInPrflCargo = null;
						}
					}
					
					//Did this person answer any questions? (Does the cargo contain responses?)
					if(pageCollAppInPrflCargo != null)
					{
						//Initialize indivResponseArray = new string array for current person
						indivResponseArray = new String[numQuestions];
						if(blindId != null && (blindId.equalsIgnoreCase("N") || blindId.equalsIgnoreCase("K"))){
							sesAppInPrflCargo.setDabl_resp(blindId);
							//pageCollAppInPrflCargo.setDabl_resp(blindId);
							trackPeopleToPersist(persistPeople, indivSeqNumInt);
						}
					
						//blindDisabled  = IApplicationManager.DISABLED_PERSON
							//Does AppManager.DetermineDirtyStatus() on this response return true?
							sesAppInPrflCargo.setDabl_resp(fixSelectionValue(sesAppInPrflCargo.getDabl_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getDabl_resp(),
								sesAppInPrflCargo.getDabl_resp(), dirtyIndicator, pageStatus))
							{					
								trackPeopleToPersist(persistPeople, indivSeqNumInt);
							}
							
							//Call AppManager.TranslateProfileResponses() to update the session
							applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getDabl_resp(),
								sesAppInPrflCargo.getDabl_resp(), pageStatus, IApplicationManager.DISABLED_PERSON,
								sesAppInPrflCargo);
						
							//Add the SES_RESP to the indivResponsesArray
							indivResponseArray[0] = sesAppInPrflCargo.getDabl_resp();
							//Check for Disability & Blindness -- if Yes set True -- Starts
							if(sesAppInPrflCargo.getDabl_resp().equalsIgnoreCase("R"))
								dablFlag = true;
							//Check for Disability & Blindness -- if Yes set True -- Ends

						
						//drugFelonies = IApplicationManager.DRUG_FELON
							//Does AppManager.DetermineDirtyStatus() on this response return true?
							sesAppInPrflCargo.setDrug_feln_resp(fixSelectionValue(sesAppInPrflCargo.getDrug_feln_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getDrug_feln_resp(),
								sesAppInPrflCargo.getDrug_feln_resp(), dirtyIndicator, pageStatus))
							{					
								trackPeopleToPersist(persistPeople, indivSeqNumInt);
							}
								
							//Call AppManager.TranslateProfileResponses() to update the session
							applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getDrug_feln_resp(),
								sesAppInPrflCargo.getDrug_feln_resp(), pageStatus, IApplicationManager.DRUG_FELON,
								sesAppInPrflCargo);
							
							//Add the SES_RESP to the indivResponsesArray
							indivResponseArray[1] = sesAppInPrflCargo.getDrug_feln_resp();
						    // Added for ILIES-129516 - Starts
							sesAppInPrflCargo.setDrug_trtmnt_prg_resp(fixSelectionValue(sesAppInPrflCargo.getDrug_trtmnt_prg_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getDrug_trtmnt_prg_resp(),
								sesAppInPrflCargo.getDrug_trtmnt_prg_resp(), dirtyIndicator, pageStatus))
							{					
								trackPeopleToPersist(persistPeople, indivSeqNumInt);
							}
								
							//Call AppManager.TranslateProfileResponses() to update the session
							applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getDrug_trtmnt_prg_resp(),
								sesAppInPrflCargo.getDrug_trtmnt_prg_resp(), pageStatus, IApplicationManager.DRUG_TRTMNT_PROG,
								sesAppInPrflCargo);
							
							//Add the SES_RESP to the indivResponsesArray
							indivResponseArray[2] = sesAppInPrflCargo.getDrug_trtmnt_prg_resp();
							sesAppInPrflCargo.setParole_prob_viol_resp(fixSelectionValue(sesAppInPrflCargo.getParole_prob_viol_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getParole_prob_viol_resp(),
								sesAppInPrflCargo.getParole_prob_viol_resp(), dirtyIndicator, pageStatus))
							{					
								trackPeopleToPersist(persistPeople, indivSeqNumInt);
							}
								
							//Call AppManager.TranslateProfileResponses() to update the session
							applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getParole_prob_viol_resp(),
								sesAppInPrflCargo.getParole_prob_viol_resp(), pageStatus, IApplicationManager.PAROLE_PROB_VIOL,
								sesAppInPrflCargo);
							
							//Add the SES_RESP to the indivResponsesArray
							indivResponseArray[3] = sesAppInPrflCargo.getParole_prob_viol_resp();
					        // Added for ILIES-129516 - Ends
						//otherFoodStamp = IApplicationManager.RECEIVE_FS_IN_OTHER_STATE
							//Does AppManager.DetermineDirtyStatus() on this response return true?
							sesAppInPrflCargo.setRcv_fs_oth_st_resp(fixSelectionValue(sesAppInPrflCargo.getRcv_fs_oth_st_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getRcv_fs_oth_st_resp(),
								sesAppInPrflCargo.getRcv_fs_oth_st_resp(), dirtyIndicator, pageStatus))
							{					
								trackPeopleToPersist(persistPeople, indivSeqNumInt);
							}
										
							//Call AppManager.TranslateProfileResponses() to update the session
							applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getRcv_fs_oth_st_resp(),
								sesAppInPrflCargo.getRcv_fs_oth_st_resp(), pageStatus, 
								IApplicationManager.RECEIVE_FS_IN_OTHER_STATE, sesAppInPrflCargo);
									
							//Add the SES_RESP to the indivResponsesArray
							indivResponseArray[4] = sesAppInPrflCargo.getRcv_fs_oth_st_resp();
						
							//Added by Uma for SSI Benefits
							sesAppInPrflCargo.setSsi_benefit_resp(fixSelectionValue(sesAppInPrflCargo.getSsi_benefit_resp()));
							if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getSsi_benefit_resp(),
									sesAppInPrflCargo.getSsi_benefit_resp(), dirtyIndicator, pageStatus))
								{					
									trackPeopleToPersist(persistPeople, indivSeqNumInt);
								}
														
								//Call AppManager.TranslateProfileResponses() to update the session
								applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getSsi_benefit_resp(),
									sesAppInPrflCargo.getSsi_benefit_resp(), pageStatus, 
									IApplicationManager.SSI_BENEFIT_RESP, sesAppInPrflCargo);
													
								//Add the SSI_BENEFITS to the indivResponsesArray
								indivResponseArray[5] = sesAppInPrflCargo.getSsi_benefit_resp();
								//Added by Uma for Cash Benefits
								sesAppInPrflCargo.setCash_benefit_resp(fixSelectionValue(sesAppInPrflCargo.getCash_benefit_resp()));
								if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getCash_benefit_resp(),
										sesAppInPrflCargo.getCash_benefit_resp(), dirtyIndicator, pageStatus))
									{					
										trackPeopleToPersist(persistPeople, indivSeqNumInt);
									}
															
									//Call AppManager.TranslateProfileResponses() to update the session
									applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getCash_benefit_resp(),
										sesAppInPrflCargo.getCash_benefit_resp(), pageStatus, 
										IApplicationManager.CASH_BENEFIT_RESP, sesAppInPrflCargo);
														
									//Add the SSI_BENEFITS to the indivResponsesArray
									indivResponseArray[6] = sesAppInPrflCargo.getCash_benefit_resp();
									//Added for Department of Aging Service
									sesAppInPrflCargo.setAging_sw(fixSelectionValue(sesAppInPrflCargo.getAging_sw()));
									if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getAging_sw(),
											sesAppInPrflCargo.getAging_sw(), dirtyIndicator, pageStatus)){								
										trackPeopleToPersist(persistPeople, indivSeqNumInt);
									}
									applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getAging_sw(),
											sesAppInPrflCargo.getAging_sw(), pageStatus, 
											IApplicationManager.AGING_SERVICE_SW, sesAppInPrflCargo);
									indivResponseArray[7] = sesAppInPrflCargo.getAging_sw();
									//Added for Former Foster Care
									sesAppInPrflCargo.setFormer_foster_sw(fixSelectionValue(sesAppInPrflCargo.getFormer_foster_sw()));
									if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getFormer_foster_sw(),
											sesAppInPrflCargo.getFormer_foster_sw(), dirtyIndicator, pageStatus)){								
										trackPeopleToPersist(persistPeople, indivSeqNumInt);
									}							
									applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getFormer_foster_sw(),
											sesAppInPrflCargo.getFormer_foster_sw(), pageStatus, 
											IApplicationManager.FOSTER_CARE_SW, sesAppInPrflCargo);
									indivResponseArray[8] = sesAppInPrflCargo.getFormer_foster_sw();
									
									// ffcs starts
									AFBHouseHoldMemberQuestionsBO afbHHMembQustBO = new AFBHouseHoldMemberQuestionsBO();
									if(afbHHMembQustBO.determineFosterStateCdStatus(pageCollAppInPrflCargo, appNumber, sesAppInPrflCargo)){
										afbHHMembQustBO.storeFormerFosterStateCd(pageCollAppInPrflCargo,appNumber,sesAppInPrflCargo);
									}
									
									//ffcs ends
									
									// Check for Disability & Blindness -- if Yes set True -- Starts
							if(sesAppInPrflCargo.getYeohc_resp().equalsIgnoreCase("R"))
								yeohCount=yeohCount+1;;
						
					
						//Add the indivResponsesArray to the indivResponsesMap
						indivResponseMap.put(indivSeqNum, indivResponseArray);
					}					
				}
				
				//Does persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] = true?
				if(persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] == true)
				{
					//For each I_S_N
					for(int i = 0; i < sesAppPrflCollSize; i++)
					{
						//Get cargo i from the collection
						sesAppInPrflCargo = (APP_IN_PRFL_Cargo) sesAppInPrflColl.get(i);	
						
						//Get I_S_N for current cargo
						indivSeqNum = sesAppInPrflCargo.getIndv_seq_num();
						indivSeqNumInt = Integer.parseInt(indivSeqNum);					
						
						//Does persistPeople[I_S_N] = true?
						if(persistPeople[indivSeqNumInt] == true)
						{				
							//yes, data is dirty, call persist()
							applicationManager.persist(appNumber, indivSeqNum, questionsArray, 
								(String[])indivResponseMap.get(indivSeqNum));;
						}
					}
				}
			//check for Disability and Blindness for each individual and set Driver R for Disability page -- starts
				String reqPages = "ABDIS";
				int pageABDISStatus = driverManager.getAFBStatus(
						FwConstants.AFB_DRIVER,	"ABDIS", driverArray);
				
				if(dablFlag)
					driverManager.makeRequired(FwConstants.AFB_DRIVER,reqPages,driverArray,appNumber);
				else{
						DisabilityBO disBO = new DisabilityBO();
						APP_IN_DABL_Collection dablColl = disBO.loadDABLDetailsAFB(appNumber);
						if(dablColl.isEmpty())
							driverManager.makeAbsoluteNotRequired(FwConstants.AFB_DRIVER,reqPages,driverArray,appNumber);
						if(pageABDISStatus == FwConstants.DRIVER_ADD_NEW)
							driverManager.makeComplete(FwConstants.AFB_DRIVER,reqPages,driverArray,appNumber);
					
				}
				//ILIES-133651 - ravrajendran - ABE - SSA Edits (State List) - Asset screens - Complete Application Development  -- Start
				ABSaveAndExitBO saveAndExitBO = new ABSaveAndExitBO();
				String[] liquidPages = {AppConstants.ABLAQ_PAGE_ID, AppConstants.ABLAS_PAGE_ID,AppConstants.ABOAQ_PAGE_ID,AppConstants.ABOAS_PAGE_ID};
				short[] programKey = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);
				if (saveAndExitBO.isAABDMedical(appNumber).equals(AppConstants.YES) || programManager.isMSPProgramRequested(programKey)) {
					driverManager.makeRequired(FwConstants.AFB_DRIVER,liquidPages,driverArray,appNumber);
				}
				//ILIES-133651 - ravrajendran - ABE - SSA Edits (State List) - Asset screens - Complete Application Development  -- END
				
				// Added by vinoj kannan, ILIES-282289
				boolean drvComplete = true;
				if ((driverManager.getAFBStatus(FwConstants.AFB_DRIVER, AppConstants.ABLAQ_PAGE_ID,
						driverArray) > 1)
						|| (driverManager.getAFBStatus(FwConstants.AFB_DRIVER,
								AppConstants.ABLAS_PAGE_ID, driverArray) > 1)) {
					drvComplete = false;
				}
				//ILIES-279945
				String[] liquidPagess = {AppConstants.ABLAQ_PAGE_ID, AppConstants.ABLAS_PAGE_ID};
				if (programManager.isSNAPProgramRequested(programKey) && drvComplete) {
					driverManager.makeRequired(FwConstants.AFB_DRIVER,liquidPagess,driverArray,appNumber);
				}
				
				//Call Driver.MakeComplete() on this page
				driverManager.makeComplete(FwConstants.AFB_DRIVER, 
					(String) request.get(FwConstants.CURRENT_PAGE_ID), driverArray, appNumber);
				
				//Added by Nancy Jain for ILIES-282238 : Removing the values from session.
				regBo.clearSessionOfWarningMsgOnSaveAndExitFunc(session);
				//ILIES-282238 changes end here
		} 
		catch(FwException fe) 
		{
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID(AppConstants.STORE_HOUSE_HOLD_MEMBERS_QUESTIONS);
			we.setFwException(fe);
			throw we;
		}
		catch(Exception e) 
		{
			ctx.setRollbackOnly();
			throw createFwException(this.getClass().getName(), AppConstants.STORE_HOUSE_HOLD_MEMBERS_QUESTIONS, e);
		
		}
	}


	private String key(String ref_indv_seq_num, String src_indv_seq_num) {
		return String.valueOf(ref_indv_seq_num)+"_"+String.valueOf(src_indv_seq_num);
	}


	/**
	* Comment here
	*/
	public void getHouseHoldPregnancyQuestions(FwTransaction txnBean) throws javax.ejb.EJBException 
	{
	
		try 
		{
			//Declarations
			Map session = txnBean.getSession();
			Map request = txnBean.getRequest();
			Map pageCollection = txnBean.getPageCollection();
			int[] driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);
			//String indivSeqNum = null;
			PeopleHandler peopleHandler =(PeopleHandler)session.get(AppConstants.INDIV_MASTER_HANDLER);
			//PCR# 32248 - 33826 - load people handle with only in-home individuals for asking pregnancy questions.	
			peopleHandler=new PeopleHandler();
			peopleHandler.loadPeopleHandler((String)session.get(AppConstants.APP_NUMBER));
			session.put(AppConstants.INDIV_MASTER_HANDLER,peopleHandler);
			
			//Read in APP_IN_PROFILE from session
			APP_IN_PRFL_Collection appInPrflColl =
			(APP_IN_PRFL_Collection) session.get(
				AppConstants.APP_IN_PRFL_MASTER);
			String appNumber =(String) session.get(AppConstants.APP_NUMBER);
			//Determine driver status
			int driverStatus =
				(int) driverManager.getAFBStatus(
					FwConstants.AFB_DRIVER,
					(String) request.get(FwConstants.CURRENT_PAGE_ID),
					driverArray);
					
			//run component manager
			//call Component manager to get list of components
			//component ids are put into the pageCollection via this method
			//if rules exist, the individual custom collection is put into the page collection
			componentManager.getComponents(
				(String) (request.get(FwConstants.CURRENT_PAGE_ID)),
				txnBean);
			//Call create and load response maps to create the maps needed to create the AFBIndividuals tags
			createAndLoadABPRGResponseMapsToPageCollection(appInPrflColl, pageCollection, peopleHandler, true, driverStatus);
			AFBHouseHoldPregnancyQuestionsBO finalBo = new AFBHouseHoldPregnancyQuestionsBO();
			APP_RQST_Collection appRqstCollection = finalBo.loadRqstApplication(appNumber);
			APP_RQST_Cargo appRqstCargo = null;
			Map beforeCollection = (Map)session.get(FwConstants.BEFORE_COLLECTION);
			APP_IN_PRFL_Cargo appInCargo = null;
			NO_ONE_Cargo noCargo = new NO_ONE_Cargo();
			NO_ONE_Collection	noOneColl = null;
			int appInCollSize = appInPrflColl.size();
			int appRqstSize = appRqstCollection.size();
			boolean indvFound = false;
			for (int i = 0; i < appRqstSize; i++) {
				appRqstCargo = (APP_RQST_Cargo) appRqstCollection.get(i);
				if (appRqstCargo != null && appRqstCargo.getHpe_app_stat_cd() != null && appRqstCargo.getHpe_app_stat_cd().equals("PE")) {
					for (int j = 0; j < appInCollSize; j++) {
						appInCargo = (APP_IN_PRFL_Cargo) appInPrflColl.get(j);
						if (appInCargo != null && appInCargo.getPreg_resp() != null	&& !(appInCargo.getPreg_resp().equals("N"))) {
							indvFound = true;
						}
					}
					if (!indvFound) {
						Map noOneCheckedMap = (Map) pageCollection.get(AppConstants.NO_ONE_CHECKED_MAP);
						noCargo.setNo_one_name("PREG");
						noCargo.setNo_one_value("FwConstants.YES");
						noOneCheckedMap.put("NO_ONE_CHECKED_344",FwConstants.YES);
					}
				}
			}
		//set page collection to before collection
			session.put(
				FwConstants.BEFORE_COLLECTION,
				txnBean.getPageCollection());
			//ILIES-282296 changes start here .Removing the values from session
			ABRegistrationBO regBo = new ABRegistrationBO();
			regBo.clearSessionOfWarningMsgOnSaveAndExitFunc(session);
			//ILIES-282296 changes end here
			
		}
		catch(FwException fe) 
		{
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("getHouseHoldPregnancyQuestions");
			we.setFwException(fe);
			throw we;
		}
		catch(Exception e) 
		{
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "getHouseHoldPregnancyQuestions", e);
			throw fe;
		}
	}
	/**
	* Comment here
	*/
	public void storeHouseHoldPregnancyQuestions(FwTransaction txnBean) throws javax.ejb.EJBException {
	
		try 
		{
			//declarations
			int numQuestions = 1;
			APP_IN_PRFL_Collection pageCollAppInPrflColl = null;
			//APP_PRFL_Collection appPrflColl = null;
			NO_ONE_Collection noOneColl = null;
			//NO_ONE_Cargo noOneCargo = null;
			FwMessageList errorMessageList = null;
			String indivSeqNum = null;
			int indivSeqNumInt = 0;
			APP_IN_PRFL_Cargo sesAppInPrflCargo = null;
			APP_IN_PRFL_Cargo pageCollAppInPrflCargo = null;
			AFBHouseHoldPregnancyQuestionsBO abprgObj = new AFBHouseHoldPregnancyQuestionsBO();		
			boolean isSaveBtnClicked  = false;
			boolean isDataChanged = false;
			//ILIES-282236 Changes start here
			APP_IN_PRFL_Cargo[] clonedPrflCollArray=null;
			APP_IN_PRFL_Collection prflColl=new  APP_IN_PRFL_Collection();
			ArrayList<ICargoCollection> collList = new ArrayList();
			//changes end here

			//define a short array for the questions
			short[] questionsArray = new short[numQuestions];
			questionsArray[0] = IApplicationManager.PREGNANCY;			//pregnancy

			
			//page scheduling indicators
			int[] dirtyIndicator = {IApplicationManager.NOT_DIRTY};
			
			//Create string array for persist
			String[] indivResponseArray = null;

			//Create INDIV_RESP_MAP for persist
			Map indivResponseMap = new HashMap();
			
			//get variables from session and page collection
			Map session = txnBean.getSession();
			Map pageCollection = txnBean.getPageCollection();
			Map request = txnBean.getRequest();
			int[] driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);
			PeopleHandler peopleHandler = (PeopleHandler)session.get(AppConstants.INDIV_MASTER_HANDLER);

			
			//get current page status
			int pageStatus = (int) driverManager.getAFBStatus(
				FwConstants.AFB_DRIVER,
				(String) request.get(FwConstants.CURRENT_PAGE_ID),driverArray);
			
			//get the appNumber from session
			String appNumber = (String)session.get(AppConstants.APP_NUMBER);

			//Read in APP_IN_PROFILE from session
			APP_IN_PRFL_Collection sesAppInPrflColl =
			(APP_IN_PRFL_Collection) session.get(
				AppConstants.APP_IN_PRFL_MASTER);		

			//get size of the collection
			int sesAppPrflCollSize = sesAppInPrflColl.size();
			
			//Read in APP_IN_PROFILE from page coll.
			pageCollAppInPrflColl = (APP_IN_PRFL_Collection) pageCollection.get("APP_IN_PRFL_Collection");	

			//get the beforecollection map
			Map beforeCollection = (Map)session.get(FwConstants.BEFORE_COLLECTION);

			//get the NoOneChecked map from the beforecollection
			Map noOneCheckedMap = (Map)beforeCollection.get(AppConstants.NO_ONE_CHECKED_MAP);

			//Get the NO ONE Collection
			noOneColl = (NO_ONE_Collection)pageCollection.get("NO_ONE_Collection");

			//check for missing cargos for people that don't have any questions answered, 
			//and populate with empty cargos
			applicationManager.preparePageColl(pageCollAppInPrflColl,sesAppInPrflColl,questionsArray);

			boolean[] componentsDisplayed = new boolean[]{false};
			componentsDisplayed = abprgObj.getComponentsDisplayed(beforeCollection, componentsDisplayed);
			short[] programKeyArray = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);

			//RUN VALIDATIONS
			errorMessageList =  abprgObj.validateABPRG(pageCollAppInPrflColl, noOneColl, noOneCheckedMap,true, componentsDisplayed, programKeyArray, sesAppInPrflColl);
			//ILIES-282236 changes start here. Modified by Anvesh added logic to display Warning message on click on Save And Exit button
			
			int seqNum = 0; 
			clonedPrflCollArray = pageCollAppInPrflColl.cloneResults();
			if(clonedPrflCollArray != null && clonedPrflCollArray.length > 0)
			{ 
				for(int i=1; i<= clonedPrflCollArray.length; i++)
				{ 
					for(APP_IN_PRFL_Cargo cargo : clonedPrflCollArray)
					{ 
						if(cargo.getIndv_seq_num() != null && !cargo.getIndv_seq_num().isEmpty())
							seqNum = Integer.valueOf(cargo.getIndv_seq_num()); 
						if(seqNum == i)
						{ 
							prflColl.add(cargo);
							collList.add(prflColl);
							break; } 
						} 
					} 
				}
			//ILIES-282236 changes end here.
			
			
			
			if(errorMessageList != null && abprgObj.hasMessages())
			{
			
				//Translate Profile Response After Validation
				applicationManager.translateProfileResponseAfterValidation(pageCollAppInPrflColl, 
						sesAppInPrflColl, questionsArray);

				request.put(FwConstants.MESSAGE_LIST, errorMessageList); 
				
				//load maps into page collection
				createAndLoadABPRGResponseMapsToPageCollection(pageCollAppInPrflColl, pageCollection, peopleHandler, false, 0);		
				pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);
				pageCollection.put("APP_IN_PRFL_Collection", pageCollAppInPrflColl);				
				
				pageCollection.put(FwConstants.PEOPLE_344, beforeCollection.get(FwConstants.PEOPLE_344));
				pageCollection.put(FwConstants.PAGE_COMPONENT_LIST, beforeCollection.get(FwConstants.PAGE_COMPONENT_LIST));

				txnBean.setRequest(request);
				txnBean.setPageCollection(pageCollection);
				//ILIES-282236 changes start here. Modified by Anvesh
				request.put(FwConstants.PAGE_COLL_0, prflColl);
				request.put(FwConstants.NUMBER_OF_COLLECTIONS_FOR_WARNING_MSG, 1);
				//ILIES-282236 changes end here.
				return;
			} 
		
			//define a boolean array (size of SES_A_I_P + 1)
			boolean[] persistPeople = new boolean[applicationManager.getMaxSeqNumer(sesAppInPrflColl)+1];
	
			int pageCollAppInPrflCollSize = pageCollAppInPrflColl.size();
			boolean  pregAddedFlag = false;
			//Loop for each Cargo in the Session APP_IN_PRFL collection
			for(int i = 0; i < sesAppPrflCollSize; i++)
			{
				//Get cargo i from the collection
				sesAppInPrflCargo = (APP_IN_PRFL_Cargo) sesAppInPrflColl.get(i);	
				
				//Get I_S_N for current cargo
				indivSeqNum = sesAppInPrflCargo.getIndv_seq_num();
				indivSeqNumInt = Integer.parseInt(indivSeqNum);
			
				//Get the matching indiv_seq_num cargo from the page collection
				for(int j = 0; j < pageCollAppInPrflCollSize; j++)
				{
					//Get cargo i from the collection
					pageCollAppInPrflCargo = (APP_IN_PRFL_Cargo) pageCollAppInPrflColl.get(j);	
					
					//does this match the SES_A_I_P cargo?
					if(Integer.parseInt(pageCollAppInPrflCargo.getIndv_seq_num()) ==
						indivSeqNumInt)
					{
						break;
					}
					else
					{
						pageCollAppInPrflCargo = null;
					}
				}
				//Did this person answer any questions? (Does the cargo contain responses?)
				if(pageCollAppInPrflCargo != null)
				{
					//Initialize indivResponseArray = new string array for current person
					indivResponseArray = new String[numQuestions];
				
					//pregnancy  = IApplicationManager.PREGNANCY
						//Does AppManager.DetermineDirtyStatus() on this response return true?
						if(applicationManager.determineDirtyStatus(pageCollAppInPrflCargo.getPreg_resp(),
							sesAppInPrflCargo.getPreg_resp(), dirtyIndicator, pageStatus))
						{					
							trackPeopleToPersist(persistPeople, indivSeqNumInt);
							//now i am checking for the driver indicator 
							if(pageStatus != FwConstants.DRIVER_REQUIRED && pageCollAppInPrflCargo.getPreg_resp() == null){
								//now we need to delete absent parent information and preg information because they unchecked the preg
								ABHouseHoldMemberBO houseHoldMemberBo = new ABHouseHoldMemberBO();
								houseHoldMemberBo.deleteAbsentParent(String.valueOf(indivSeqNumInt),appNumber);								
								houseHoldMemberBo.deletePregnancy(String.valueOf(indivSeqNumInt),appNumber);
							}
							else{
								pregAddedFlag = true;
							}
						}
						
						//Call AppManager.TranslateProfileResponses() to update the session
						applicationManager.translateProfileResponses(pageCollAppInPrflCargo.getPreg_resp(),
							sesAppInPrflCargo.getPreg_resp(), pageStatus, IApplicationManager.PREGNANCY,
							sesAppInPrflCargo);
					
						//Add the SES_RESP to the indivResponsesArray
						indivResponseArray[0] = sesAppInPrflCargo.getPreg_resp();				
				
					//Add the indivResponsesArray to the indivResponsesMap
					indivResponseMap.put(indivSeqNum, indivResponseArray);
				}					
			}
			
			//Does persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] = true?
			if(persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] == true)
			{
				//For each I_S_N
				for(int i = 0; i < sesAppPrflCollSize; i++)
				{
					//Get cargo i from the collection
					sesAppInPrflCargo = (APP_IN_PRFL_Cargo) sesAppInPrflColl.get(i);	
					
					//Get I_S_N for current cargo
					indivSeqNum = sesAppInPrflCargo.getIndv_seq_num();
					indivSeqNumInt = Integer.parseInt(indivSeqNum);					
					
					//Does persistPeople[I_S_N] = true?
					if(persistPeople[indivSeqNumInt] == true)
					{				
						//yes, data is dirty, call persist()
						applicationManager.persist(appNumber, indivSeqNum, questionsArray, 
							(String[])indivResponseMap.get(indivSeqNum));
					}
				}
			}
						
			
			//Does the page scheduling indicator != NOT_DIRTY?
				//Call RunDirtyLogic on driver (this page doesn't schedule other pages)
				
			//Call Driver.MakeComplete() on this page
			driverManager.makeComplete(FwConstants.AFB_DRIVER, 
				(String) request.get(FwConstants.CURRENT_PAGE_ID), driverArray, appNumber);

			if(dirtyIndicator[0]!=IApplicationManager.NOT_DIRTY) {
				applicationManager.runDirtyLogicOnDriver(appNumber,dirtyIndicator[0] ,"ABPRD",driverArray);
			}
			//ILIES-282236 changes start here.Modified by Anvesh 
			ABRegistrationBO regBo = new ABRegistrationBO();
			regBo.clearSessionOfWarningMsgOnSaveAndExitFunc(session);//Removing the values from session.
			//ILIES-282236 changes end here
			//start of BRGUS00286206 added by rotanak
			//commented by rotanak
/*			//schedule ABHHR page
			if(peopleHandler.getNumberOfIndividuals() == 1)
			{
				//get the ISN
				INDIVIDUAL_Custom_Collection indivColl = peopleHandler.getAllIndividuals();
				INDIVIDUAL_Custom_Cargo indivCargo = (INDIVIDUAL_Custom_Cargo)indivColl.get(0);
				
				if(indivCargo.getSex_ind().equals(AppConstants.SEX_IND_FEMALE))
				{
					//Get cargo i from the collection
					sesAppInPrflCargo = (APP_IN_PRFL_Cargo) sesAppInPrflColl.get(0);
					
					if(!sesAppInPrflCargo.getPreg_resp().equals(String.valueOf(IApplicationManager.STATUS_NOT_REQUIRED))){
						// driverManager.makeRequired(FwConstants.AFB_DRIVER,"ABHHR", driverArray, appNumber);
						//Indrani
						driverManager.makeRequired(FwConstants.AFB_DRIVER,"ABPRD", driverArray, appNumber);
					}
					else{
						//Indrani
					//	driverManager.makeAbsoluteNotRequired(FwConstants.AFB_DRIVER,"ABHHR", driverArray, appNumber);
						driverManager.makeAbsoluteNotRequired(FwConstants.AFB_DRIVER,"ABPRD", driverArray, appNumber);
						driverManager.makeRequired(FwConstants.AFB_DRIVER,"ABHHR", driverArray, appNumber);
						
					}
				}									
			}
			else if(pregAddedFlag){
				driverManager.makeRequired(FwConstants.AFB_DRIVER,"ABPRD", driverArray, appNumber);
			}

			// absent parent display logic	
			ABAbsentParentBO absentParentBo = new ABAbsentParentBO();
			short[] programKeyArray = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);
			boolean requiredFlag  = absentParentBo.checkAbsentParentRequired(peopleHandler,sesAppInPrflColl,appNumber,programKeyArray);
			if(requiredFlag){
				driverManager.makeRequired(FwConstants.AFB_DRIVER,"ABAPD", driverArray, appNumber);
			}
			else{
				driverManager.makeAbsoluteNotRequired(FwConstants.AFB_DRIVER,"ABAPD", driverArray, appNumber);
			}*/
			
			//end of BRGUS00286206 added by rotanak
		} 
		catch(FwException fe) 
		{
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeHouseHoldPregnancyQuestions");
			we.setFwException(fe);
			throw we;
		}
		catch(Exception e) 
		{
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "storeHouseHoldPregnancyQuestions", e);
			throw fe;
		}
	}
	

	/**
	* 
	*/
	private Map createAndLoadABHHQResponseMapsToPageCollection(APP_IN_PRFL_Collection appInPrflColl, 
					Map pageCollection, PeopleHandler peopleHandler, boolean pageLoad, int driverStatus)
	{
		try 
		{
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "56", 
					IApplicationManager.DISABLED_PERSON, pageLoad, driverStatus, true);
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "58", 
					IApplicationManager.DRUG_FELON,	pageLoad, driverStatus, true);
    		// Added for ILIES-129516
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "5218", 
					IApplicationManager.DRUG_TRTMNT_PROG, pageLoad, driverStatus, true);
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "5219", 
					IApplicationManager.PAROLE_PROB_VIOL, pageLoad, driverStatus, true);
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "41", 
					IApplicationManager.RECEIVE_FS_IN_OTHER_STATE, pageLoad, driverStatus, true);
			//Added by Uma patil
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "418", 
					IApplicationManager.SSI_BENEFIT_RESP, pageLoad, driverStatus, true);
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "419", 
					IApplicationManager.CASH_BENEFIT_RESP, pageLoad, driverStatus, true);
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "421", 
					IApplicationManager.AGING_SERVICE_SW, pageLoad, driverStatus, true);

			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "43", 
							 IApplicationManager.FOSTER_CARE_SW, pageLoad, driverStatus, true);
			pageCollection.put("APP_IN_PRFL_Collection", appInPrflColl);				
			return pageCollection;
			//exit
		}
		catch(FwException fe) 
		{
			throw fe;
		} 
		catch(Exception e) 
		{
			FwException fe = createFwException(this.getClass().getName(), "createAndLoadABHHQResponseMapsToPageCollection", e);
			throw fe;
		}	
	}
	
	private Map createAndLoadABHMSResponseMapsToPageCollection(APP_IN_PRFL_Collection appInPrflColl, Map pageCollection, PeopleHandler peopleHandler, boolean pageLoad){
		try {
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "56", IApplicationManager.DISABLED_PERSON, pageLoad, true);
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "58", IApplicationManager.DRUG_FELON, pageLoad, true);
    		// Added for ILIES-129516
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "5218", IApplicationManager.DRUG_TRTMNT_PROG, pageLoad, true);
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "5219", IApplicationManager.PAROLE_PROB_VIOL, pageLoad, true);
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "41", IApplicationManager.RECEIVE_FS_IN_OTHER_STATE, pageLoad, true);
			//Added by Uma for S Expansion
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "418", IApplicationManager.SSI_BENEFIT_RESP, pageLoad, true);
			getPeopleCollectionAndUpdateMapsForSummary(appInPrflColl, pageCollection, peopleHandler, "419", IApplicationManager.CASH_BENEFIT_RESP, pageLoad, true);
			return pageCollection;
		} catch(FwException fe){
			throw fe;
		} catch(Exception e){
			FwException fe = createFwException(this.getClass().getName(), "createAndLoadABHMSResponseMapsToPageCollection", e);
			throw fe;
		}	
	}
	
	/**
	* 
	*/
	private Map createAndLoadABPRGResponseMapsToPageCollection(APP_IN_PRFL_Collection appInPrflColl, 
					Map pageCollection, PeopleHandler peopleHandler, boolean pageLoad, int driverStatus)
	{
		try 
		{
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "344", 
					IApplicationManager.PREGNANCY, pageLoad, driverStatus, false);

			return pageCollection;	
		}
		catch(FwException fe) 
		{
			throw fe;
		} 
		catch(Exception e) 
		{
			FwException fe = createFwException(this.getClass().getName(), "createAndLoadABPRGResponseMapsToPageCollection", e);
			throw fe;
		}	
	}
	
	// added by avtsingh for ILIES-129330
	/**
	* 
	*/
	private Map createAndLoadABHHRResponseMapsToPageCollection(APP_IN_PRFL_Collection appInPrflColl, 
					Map pageCollection, PeopleHandler peopleHandler, boolean pageLoad, int driverStatus)
	{
		try 
		{
			getPeopleCollectionAndUpdateMaps(appInPrflColl, pageCollection, peopleHandler, "32", 
					IApplicationManager.CARETAKER_RESP, pageLoad, driverStatus, false);

			return pageCollection;	
		}
		catch(FwException fe) 
		{
			throw fe;
		} 
		catch(Exception e) 
		{
			FwException fe = createFwException(this.getClass().getName(), "createAndLoadABHHRResponseMapsToPageCollection", e);
			throw fe;
		}	
	}
	/**
	* 
	*/
	private boolean[] trackPeopleToPersist(boolean[] persistPeople, int indivSeqNumInt)
	{
		try 
		{
			//Set persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] = true;
			persistPeople[IApplicationManager.ARE_PEOPLE_DIRTY] = true;
								
			//Set persistPeople[I_S_N] = TRUE;
			persistPeople[indivSeqNumInt] = true;
			
			return persistPeople;
		}
		catch(FwException fe) 
		{
			throw fe;
		} 
		catch(Exception e) 
		{
			FwException fe = createFwException(this.getClass().getName(), "trackPeopleToPersist", e);
			throw fe;
		}	
	}
	/**
	* Method sort the relationship cargos in a sequence order of indv seq num
	*@param appHshlRltColl gov.wisconsin.access.business.entities.APP_HSHL_RLT_Collection
	*@param sortedRetionshipColl gov.wisconsin.access.business.entities.APP_HSHL_RLT_Collection
	*@author govinpr 
	*/
	private APP_HSHL_RLT_Collection sortRelationshipCargoOnIndvSeq(APP_HSHL_RLT_Collection appHshlRltColl) throws javax.ejb.EJBException {

		try {
			APP_HSHL_RLT_Collection sortedRetionshipColl = new APP_HSHL_RLT_Collection();
			APP_HSHL_RLT_Cargo tempCargo = null; 
			boolean found = false;			
			if(appHshlRltColl != null ){
				if(appHshlRltColl.size() > 1){
					int appHshlRltCollSize = appHshlRltColl.size();
					for(int i=0;i<appHshlRltCollSize;i++){
						int indSeq = Integer.parseInt(appHshlRltColl.getCargo(i).getSrc_indv_seq_num());
						for(int j=0;j<appHshlRltCollSize;j++){
							int tempSeq = Integer.parseInt(appHshlRltColl.getCargo(j).getSrc_indv_seq_num());
							if(indSeq > tempSeq){
								indSeq = tempSeq;
								tempCargo = appHshlRltColl.getCargo(j);
								found = true;
							}
						}
						if(!found){
							tempCargo = appHshlRltColl.getCargo(i);
							found = false;
						}
						if(tempCargo != null) {
							sortedRetionshipColl.addCargo(tempCargo);
							appHshlRltColl.remove(tempCargo);
							i--;
							appHshlRltCollSize--;
							tempCargo = null;
							found = false;
						}
					}
					if(appHshlRltColl.size() > 0) {
						sortedRetionshipColl.addAll(appHshlRltColl);
					}
				}else{
					sortedRetionshipColl = appHshlRltColl;
				}
			}
			return sortedRetionshipColl;
		} catch(FwException fe) {
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("sortRelationshipCargoOnIndvSeq");
			we.setFwException(fe);
			throw we;
		} catch(Exception e) {
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "sortRelationshipCargoOnIndvSeq", e);
			throw fe;
		}
	}
	
	/**
	* Comment here
	*/
	public void getInstitutionDetails(FwTransaction txnBean) throws javax.ejb.EJBException {

		try 
		{
			log(ILog.INFO, "HouseHoldInfoEJBBEan::getInstitutionDetails:Start");
			Map session = txnBean.getSession();
			Map request = txnBean.getRequest();
			Map pageCollection = txnBean.getPageCollection();
			String pageId = null;
			Map beforeColl = null;
			PeopleHandler peopleHandler = null;
			int[] driverArray = null;
			String appNumber = null;
			int currentPageStatus = 0;
			List instEnrolledList = null;
			String indvSeqNumber = null;
			boolean detailKeyFlag = false;
			int currentRecordIndex = 0;
			String indvSeqNum = null;
			String spouseIndvSeqNum = null;
			peopleHandler = (PeopleHandler)session.get(AppConstants.INDIV_MASTER_HANDLER);
			appNumber =(String) session.get(AppConstants.APP_NUMBER);
			driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);
			pageId = (String)request.get(FwConstants.CURRENT_PAGE_ID);
			currentPageStatus = driverManager.getAFBStatus(FwConstants.AFB_DRIVER,pageId,driverArray);
			
			
				InstitutionBO instBO = new InstitutionBO();
				if(!pageId.equals((String)request.get(FwConstants.PREVIOUS_PAGE_ID))){
					//we need to remove the values from the session
					session.remove(FwConstants.BEFORE_COLLECTION);
					beforeColl = new HashMap();
					short[] programKeyArray = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);				
					instEnrolledList =instBO.findInstitutionEnrolledPeople(appNumber);		
					beforeColl.put("InstEnrollList",instEnrolledList);
					session.put(FwConstants.BEFORE_COLLECTION,beforeColl);
					if(!request.get(FwConstants.PREVIOUS_PAGE_ID).equals("ABHMS")){
						pageCollection.remove(FwConstants.DETAIL_KEY_BEAN);
					}
				}
				else{
					beforeColl =(Map) session.get(FwConstants.BEFORE_COLLECTION);
					beforeColl.remove("APP_IN_INST_Collection");
					beforeColl.remove("APP_IN_SPS_IMPOV_Collection");
				}
				if(beforeColl != null){
					if(beforeColl.containsKey("InstEnrollList")){
						instEnrolledList = (List)beforeColl.get("InstEnrollList");
					}
					if(beforeColl.containsKey(FwConstants.CURRENT_RECORD_INDEX)){
						currentRecordIndex = Integer.parseInt(String.valueOf(beforeColl.get(FwConstants.CURRENT_RECORD_INDEX)));
						currentRecordIndex = currentRecordIndex+1;
					}
				}
				
				if(pageCollection.containsKey(FwConstants.DETAIL_KEY_BEAN)){
					IndivTypeSeqBean indvSeqBean =(IndivTypeSeqBean)pageCollection.get(FwConstants.DETAIL_KEY_BEAN);
					indvSeqNumber = indvSeqBean.getIndivSeqNum();
					detailKeyFlag = true;
				}
				else if(currentPageStatus == FwConstants.DRIVER_COMPLETE){
					int instEnrollListSize = 0;
					if(instEnrolledList != null)
						instEnrollListSize = instEnrolledList.size();
					IndivTypeSeqBean indvTypeSeqBean = null;
					for(int i =0 ; i < instEnrollListSize ;  i++){
						indvSeqNumber = instEnrolledList.get(i).toString();
						indvTypeSeqBean = new IndivTypeSeqBean();
						indvTypeSeqBean.setIndivSeqNum(indvSeqNumber);
						populateRecordArray(indvTypeSeqBean,session);
					}
				}
				pageCollection = new HashMap();
				if(currentPageStatus == FwConstants.DRIVER_COMPLETE || currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN || currentPageStatus == FwConstants.DRIVER_REQUIRED || detailKeyFlag)
				{
					//Now i am loading the List Information 
					if(!detailKeyFlag && currentPageStatus != FwConstants.DRIVER_COMPLETE){
						if(instEnrolledList != null)
							indvSeqNumber = (String)instEnrolledList.get(currentRecordIndex);
						//Now i am storing this seq number to the record array 
						IndivTypeSeqBean indvTypeSeqBean = new IndivTypeSeqBean();
						indvTypeSeqBean.setIndivSeqNum(indvSeqNumber);
						populateRecordArray(indvTypeSeqBean,session);
					}
					pageCollection = instBO.loadInstitution(appNumber,indvSeqNumber);
					//SET DEFAULT SPOUSE ADDRESS ON LOAD OF PAGE FROM REGISTRATION TABLE
					/* COMMENTED -- ENABLE TO GET SPOUSE DEFAULT ADDRESS FROM REGISTRATION TABLE
					if(currentPageStatus == FwConstants.DRIVER_REQUIRED){//testing 
						APP_IN_SPS_IMPOV_Collection  appSPSColl = instBO.getSpouseContactInfoOnload(appNumber);
						pageCollection.put("APP_IN_SPS_IMPOV_Collection", appSPSColl);
						spouseIndvSeqNum = instBO.isWifeOrHusband(appNumber,indvSeqNumber);
						pageCollection.put("SPOUSE_SEQ_NUM", spouseIndvSeqNum);
					}
					*/
				}	

				INDIVIDUAL_Custom_Cargo indvlCargo = peopleHandler.getIndividual(indvSeqNumber);
				INDIVIDUAL_Custom_Collection indvCustColl = new INDIVIDUAL_Custom_Collection();
				indvCustColl.addCargo(indvlCargo);
				//pageCollection.put("PEOPLE_362",indvCustColl);
				
				spouseIndvSeqNum = instBO.isWifeOrHusband(appNumber,indvSeqNumber);
				pageCollection.put("SPOUSE_SEQ_NUM", spouseIndvSeqNum);
				pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,indvSeqNumber);
				pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,indvSeqNumber);
				txnBean.setPageCollection(pageCollection);
				beforeColl = (Map)session.get(FwConstants.BEFORE_COLLECTION);
				//Calling Component Manager for Page components
				componentManager.getComponents((String) (request.get(FwConstants.CURRENT_PAGE_ID)), txnBean);
				//Checking for Before Collection is Null 
				if(beforeColl == null)
					beforeColl = new HashMap();
				beforeColl.putAll(pageCollection);
				session.put(FwConstants.BEFORE_COLLECTION, beforeColl);
				log(ILog.INFO, "HouseHoldInfoEJBBEan::getInstitutionDetails:End");
		}  catch(FwException fe) {
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("getInstitutionDetails");
			we.setFwException(fe);
			throw we;
		} catch(Exception e) {
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "getInstitutionDetails", e);
			throw fe;
		}
	}
	/**
	* Comment here
	*/
	public void storeInstitutionDetails(FwTransaction txnBean) throws javax.ejb.EJBException {

	try {
			log(ILog.INFO, "HouseHoldInfoEJBBEan::storeInstitutionDetails:Start");
			Map session = txnBean.getSession();
			Map request = txnBean.getRequest();
			Map pageCollection =txnBean.getPageCollection();
			int[] driverArray = null;
			String appNumber = null;
			Map beforeColl = null;	
			String indvSeqNumber = null;
			int currentPageStatus = 0;
			String pageId = null;
			List instEnrolledList = null;
			APP_IN_INST_Collection appInstBeforeColl = null;
			APP_IN_INST_Collection appInstColl = null;
			APP_IN_INST_Cargo appInstCargo = null;
			APP_IN_INST_Cargo appInstBeforeCargo = null;
			APP_IN_SPS_IMPOV_Collection appSpouseBeforeColl = null;
			APP_IN_SPS_IMPOV_Collection appSpouseColl = null;
			APP_IN_SPS_IMPOV_Cargo appSpouseBeforeCargo = null; 
			APP_IN_SPS_IMPOV_Cargo appSpouseCargo = null;
			FwMessageList validateInfo = null;
			FwMessageList validateInfoSpouse = null;
			String spouseSeqNum = "0";	
				
			
				
				//Get the status of the Driver from Session
				driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);
				//Get the current Page Id from the Request
				pageId = (String)request.get(FwConstants.CURRENT_PAGE_ID);
				//Get the APP_NUM from the Session
				appNumber =(String) session.get(AppConstants.APP_NUMBER);
				//Get the before Collection from the Session
				beforeColl =(Map) session.get(FwConstants.BEFORE_COLLECTION);
				//Get the Status of the page from driver manager
				currentPageStatus = driverManager.getAFBStatus(FwConstants.AFB_DRIVER,pageId,driverArray);
				
				if(pageCollection.get("SPOUSE_SEQ_NUM") != null)
					spouseSeqNum = (String)pageCollection.get("SPOUSE_SEQ_NUM");
				else
					spouseSeqNum = (String)beforeColl.get("SPOUSE_SEQ_NUM");
				instEnrolledList = (List)beforeColl.get("InstEnrollList");
				//Get the INDV_SEQ_NUM from the Before Collection
				indvSeqNumber = (String)beforeColl.get(AppConstants.INDV_SEQUENCE_NUMBERS);
				//Get program key
				short programKey[] = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);
				//First I am getting the before collection
				if(beforeColl.containsKey("APP_IN_INST_Collection")){
					appInstBeforeColl =(APP_IN_INST_Collection)beforeColl.get("APP_IN_INST_Collection");
				}
				if(pageCollection.containsKey("APP_IN_INST_Collection")){
					appInstColl =(APP_IN_INST_Collection)pageCollection.get("APP_IN_INST_Collection");
				}
				//Spouse details Before Collection
				if(beforeColl.containsKey("APP_IN_SPS_IMPOV_Collection")){
					appSpouseBeforeColl =(APP_IN_SPS_IMPOV_Collection)beforeColl.get("APP_IN_SPS_IMPOV_Collection");
				}
				if(pageCollection.containsKey("APP_IN_SPS_IMPOV_Collection")){
					appSpouseColl = (APP_IN_SPS_IMPOV_Collection)pageCollection.get("APP_IN_SPS_IMPOV_Collection");
				}
				List componentList =(ArrayList) beforeColl.get(FwConstants.PAGE_COMPONENT_LIST);
				boolean componentFlag = false;
				if(componentList.contains("369")){
					componentFlag = true;
				}
				//Calling the BO Method
				InstitutionBO instBo = new InstitutionBO();
				ABINDValidator validatorBO = new ABINDValidator();
				
				if(componentFlag){
					if(appSpouseColl != null && !appSpouseColl.isEmpty()){
						appSpouseCargo = appSpouseColl.getCargo(0);
						
						//trim all the address field values to avoid extra spaces in DB
						if(appSpouseCargo.getSps_city_adr() != null)
							appSpouseCargo.setSps_city_adr(appSpouseCargo.getSps_city_adr().trim());
						if(appSpouseCargo.getSps_l1_adr() != null)
							appSpouseCargo.setSps_l1_adr(appSpouseCargo.getSps_l1_adr().trim());
						if(appSpouseCargo.getSps_l2_adr() != null)
							appSpouseCargo.setSps_l2_adr(appSpouseCargo.getSps_l2_adr().trim());
						if(appSpouseCargo.getSps_zip_adr() != null)
							appSpouseCargo.setSps_zip_adr(appSpouseCargo.getSps_zip_adr().trim());
						if(appSpouseCargo.getSps_zip_adr() != null)
							appSpouseCargo.setSps_zip_adr(appSpouseCargo.getSps_zip_adr().trim());
					}	
				}
				
				
				if(appInstColl != null && !appInstColl.isEmpty()){
					appInstCargo = appInstColl.getCargo(0);
						//Now calling the validate method 
						validateInfo = validatorBO.validateInstitutionDetails(appInstCargo, appSpouseCargo, componentFlag);
						if(validateInfo != null && validateInfo.hasMessages()){
								request.put(FwConstants.MESSAGE_LIST, validateInfo);
								pageCollection.put("APP_IN_INST_Collection",appInstColl);
								pageCollection.put("APP_IN_SPS_IMPOV_Collection", appSpouseColl);
								pageCollection.put(FwConstants.PAGE_COMPONENT_LIST, beforeColl.get(FwConstants.PAGE_COMPONENT_LIST));
								pageCollection.put(AppConstants.INDV_SEQUENCE_NUMBERS,indvSeqNumber);
								pageCollection.put(AppConstants.CURRENT_INDIV_SEQ_NUM,indvSeqNumber);
								pageCollection.put("SPOUSE_SEQ_NUM",beforeColl.get("SPOUSE_SEQ_NUM"));
								pageCollection.put("SPOUSE_SEQ_NUM",spouseSeqNum);
								return;
						}
						
						//check for Spouse Address Details--starts
						if(componentFlag){
							if(appSpouseCargo != null){
								appSpouseCargo.setApp_num(appNumber);
								appSpouseCargo.setIndv_seq_num(indvSeqNumber);
							}
							if(appSpouseBeforeColl != null){
								appSpouseBeforeCargo = appSpouseBeforeColl.getCargo(0);
															
								//compare cargos
								appSpouseCargo = (APP_IN_SPS_IMPOV_Cargo)isChanged(appSpouseBeforeCargo,appSpouseCargo);
								if(appSpouseCargo.isDirty()){
									if(appSpouseCargo.getSps_sta_adr().equalsIgnoreCase("SEL"))
										appSpouseCargo.setSps_sta_adr("");
									if(currentPageStatus == FwConstants.DRIVER_REQUIRED){
										appSpouseCargo.setRowAction(FwConstants.ROWACTION_INSERT);
									}else{
										appSpouseCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
									}
									instBo.storeSpouseContactInfo(appSpouseColl);
								}
							}
							else{
								if(appSpouseCargo.getSps_sta_adr().equalsIgnoreCase("SEL"))
									appSpouseCargo.setSps_sta_adr("");
								appSpouseCargo.setRowAction(FwConstants.ROWACTION_INSERT);
								instBo.storeSpouseContactInfo(appSpouseColl);
							}
						}
						appInstCargo.setApp_num(appNumber);
						//Setting the INDV_SEQ_NUM
						appInstCargo.setIndv_seq_num(indvSeqNumber);
						//doing date formatting
						if(appInstCargo.getInst_nam() != null)
							appInstCargo.setInst_nam(appInstCargo.getInst_nam().trim());
						if(appInstCargo.getOrig_inst_dt() == null || appInstCargo.getOrig_inst_dt().trim().length() == 0){
							appInstCargo.setOrig_inst_dt(AppConstants.HIGH_TIMESTAMP);
						}else{
							appInstCargo.setOrig_inst_dt(displayFormatter.getYYYYMMDDTimestamp(appInstCargo.getOrig_inst_dt()));
						}
						if(appInstCargo.getCur_inst_dt().trim().length() == 0){
							appInstCargo.setCur_inst_dt(AppConstants.HIGH_TIMESTAMP);
						}else{
							appInstCargo.setCur_inst_dt(displayFormatter.getYYYYMMDDTimestamp(appInstCargo.getCur_inst_dt()));
						}
						if(appInstCargo.getInst_cnty_cd().equalsIgnoreCase("SEL"))
							appInstCargo.setInst_cnty_cd("0");
						
						//call completeness check and set record complete indicator							
						instBo.completenessCheckInstitutionalDetails(appInstCargo, appSpouseCargo, componentFlag);
											
						//Checking the Before Collection is Null or Not
						if(appInstBeforeColl != null){
							appInstBeforeCargo = appInstBeforeColl.getCargo(0);
							//Now I am comparing the Cargos
							appInstCargo = (APP_IN_INST_Cargo)isChanged(appInstBeforeCargo,appInstCargo);
							if(appInstCargo.isDirty()){
								
								appInstCargo.setRowAction(FwConstants.ROWACTION_UPDATE);
								instBo.storeInstitution(appInstColl);
							}
						}
						else{
							//We need to insert new record to the data base
							appInstCargo.setRowAction(FwConstants.ROWACTION_INSERT);	
							instBo.storeInstitution(appInstColl);
						}
				}
				boolean pageComplete = false;
				if(currentPageStatus == FwConstants.DRIVER_REQUIRED || currentPageStatus == FwConstants.DRIVER_VISIT_AGAIN){
					//Now checking for any persons need to be displayed
					int currentArrayIndex = Integer.parseInt((String)beforeColl.get(FwConstants.CURRENT_RECORD_INDEX));  
					if(currentArrayIndex + 1 == instEnrolledList.size()){
						pageComplete = true;
					}
				}
				//If the driver status is add new and driver status is complete 					
				if( pageComplete || currentPageStatus == FwConstants.DRIVER_ADD_NEW || currentPageStatus == FwConstants.DRIVER_COMPLETE){
					driverManager.makeComplete(FwConstants.AFB_DRIVER,(String)request.get(FwConstants.CURRENT_PAGE_ID),driverArray,appNumber);
				}
				else{
					session.put(FwConstants.BEFORE_COLLECTION,beforeColl);
				}
				pageCollection.put("SPOUSE_SEQ_NUM",spouseSeqNum);
				log(ILog.INFO, "HouseHoldInfoEJBBEan::storeInstitutionDetails:End");
		}catch(FwException fe) {
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("storeInstitutionDetails");
			we.setFwException(fe);
			throw we;
		} catch(Exception e) {
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "storeInstitutionDetails", e);
			throw fe;
		}
	}
	/**
	* Comment here
	*/
	public void changeDisabilityDetails(FwTransaction txnBean) throws javax.ejb.EJBException {
	try {
		Map pageCollection = txnBean.getPageCollection();
		IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
		APP_IN_DABL_Collection appDisabilityColl = (APP_IN_DABL_Collection)pageCollection.get("APP_IN_DABL_Collection");
		indivTypeSeqBean.setIndivSeqNum(appDisabilityColl.getCargo(0).getIndv_seq_num());
		pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);
		
	} catch(FwException fe) {
		ctx.setRollbackOnly();
		FwWrappedException we = new FwWrappedException();
		we.setCallingClassID(this.getClass().getName());
		we.setCallingMethodID("changeDisabilityDetails");
		we.setFwException(fe);
		throw we;
	} catch(Exception e) {
		ctx.setRollbackOnly();
		FwException fe = createFwException(this.getClass().getName(), "changeDisabilityDetails", e);
		throw fe;
	}
}

	/**
	* Comment here
	*/
	public void eraseDisabilityDetails(FwTransaction txnBean) throws javax.ejb.EJBException {

		try {
		
		Map request = txnBean.getRequest();
		Map session = txnBean.getSession();
		Map pageCollection = txnBean.getPageCollection();
		
		// Getting app number from session
		String appNumber = (String)session.get(AppConstants.APP_NUMBER);

		boolean warningMsgFlag = false;
		String warningMesgs = (String)request.get(FwConstants.WARNING_MSG_DETAILS);
						
		// Getting APP_IN_PRFL_Collection from session
		APP_IN_PRFL_Collection sessionAppInPrflCollection = (APP_IN_PRFL_Collection) session.get(AppConstants.APP_IN_PRFL_MASTER);
		// Getting APP_IN_PRFL_Collection from before collection 
		Map beforeCollection = (Map) session.get(FwConstants.BEFORE_COLLECTION);
		// Getting people handler from session
		PeopleHandler peopleHandler = (PeopleHandler) session.get(AppConstants.INDIV_MASTER_HANDLER);
		// Getting APP_IN_PRFL_Collection from page collection
		APP_IN_PRFL_Collection appInPrflAfterCollection = (APP_IN_PRFL_Collection) pageCollection.get("APP_IN_PRFL_Collection");
		// Getting NO_ONE_Collection from page collection
		NO_ONE_Collection noOneCollection = (NO_ONE_Collection) pageCollection.get("NO_ONE_Collection");
		// Getting NO_ONE_CHECKED map from session
		Map noOneCheckedMap = (Map) beforeCollection.get(AppConstants.NO_ONE_CHECKED_MAP);
		//Getting blind and disability collection from before collection
		APP_IN_DABL_Collection appInDisableBeforeColl = (APP_IN_DABL_Collection) beforeCollection.get(AppConstants.BLIND_DISABLE_COLLECTION);				
		
		// Getting indiv seq number from list view component				
		APP_IN_DABL_Collection appInDisableColl = (APP_IN_DABL_Collection)pageCollection.get("APP_IN_DABL_Collection");
		String indvSeqNum = appInDisableColl.getCargo(0).getIndv_seq_num();

		// Initializing/getting the session and page app indv profile collection size 			
		int sessionAppInPrflCollectionSize =  sessionAppInPrflCollection.size();
		// Initializing array for a number of questions (assuming the number of questions is static)
		// Added DRUG_TRTMNT_PROG and PAROLE_PROB_VIOL fields for ILIES-129516
		short[] questionsFieldArray = {IApplicationManager.DISABLED_PERSON, IApplicationManager.DRUG_FELON, IApplicationManager.DRUG_TRTMNT_PROG, IApplicationManager.PAROLE_PROB_VIOL, IApplicationManager.RECEIVE_FS_IN_OTHER_STATE, IApplicationManager.SSI_BENEFIT_RESP,IApplicationManager.CASH_BENEFIT_RESP};
		
		// Calling a method populate dummy cargos into collection, when before collection doesn't match with the after collection			
		applicationManager.preparePageColl(appInPrflAfterCollection,sessionAppInPrflCollection,questionsFieldArray);

		// Calling business validations to check any other validations are there
		ABHouseholdMembersSummaryBO summaryBO = new ABHouseholdMembersSummaryBO();
		summaryBO.validateQuestions(appInPrflAfterCollection, noOneCollection, noOneCheckedMap);

		IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
		indivTypeSeqBean.setIndivSeqNum(indvSeqNum);
		//PCR# 35063 - add type also - so the we will come to know which infor user tried to delete first time
		indivTypeSeqBean.setType("D");
		// Determine to throw warning message or continue with erase logic				
		String name=peopleHandler.getFirstName(indvSeqNum);
		warningMsgFlag = this.determineSummaryErase(beforeCollection, indivTypeSeqBean, warningMesgs, "32106", summaryBO,name);

		if(!warningMsgFlag){
			// Putting messagelist into the request
			request.put(FwConstants.MESSAGE_LIST, summaryBO.getMessageList());
			// Translate response profile after validation
			applicationManager.translateProfileResponseAfterValidation(appInPrflAfterCollection, sessionAppInPrflCollection, questionsFieldArray);
			// populate people components into page collection from before collection
			List compIds = (List)beforeCollection.get(FwConstants.PAGE_COMPONENT_LIST);
			int compIdSize = compIds.size();
			for(int i=0;i<compIdSize;i++){
				String str = new StringBuffer(AppConstants.PEOPLE).append(compIds.get(i)).toString();
				pageCollection.put(str, beforeCollection.get(str));
			}
			// Load Maps into page collection
			this.createAndLoadABHMSResponseMapsToPageCollection(appInPrflAfterCollection, pageCollection, peopleHandler, false);
			pageCollection.put(AppConstants.APP_PREG_COLLECTION, beforeCollection.get(AppConstants.APP_PREG_COLLECTION));
			pageCollection.put(AppConstants.ABSENT_PARENT_COLLECTION, beforeCollection.get(AppConstants.ABSENT_PARENT_COLLECTION));
			pageCollection.put(AppConstants.BLIND_DISABLE_COLLECTION, beforeCollection.get(AppConstants.BLIND_DISABLE_COLLECTION));
			pageCollection.put(AppConstants.NO_ONE_CHECKED_MAP, noOneCheckedMap);	
			pageCollection.put(AppConstants.APP_IN_PRFL_MASTER, appInPrflAfterCollection);
			pageCollection.put("PEOPLE_347", beforeCollection.get("PEOPLE_347"));	
			pageCollection.put("ABHouseHoldMembersListview_ListView", beforeCollection.get("ABHouseHoldMembersListview_ListView"));
			//PCR# 35063 - Child Out of Home collection was missing to set back
			pageCollection.put("ABHouseHoldOutsideHomeMembersListview_ListView", beforeCollection.get("ABHouseHoldOutsideHomeMembersListview_ListView"));
			pageCollection.put("ABHouseHoldMembersPregnancyListview_ListView", beforeCollection.get("ABHouseHoldMembersPregnancyListview_ListView"));
			pageCollection.put("ABHouseHoldMembersRelationshipsListview_ListView", beforeCollection.get("ABHouseHoldMembersRelationshipsListview_ListView"));
			pageCollection.put("ABHouseHoldOtherParentsListview_ListView", beforeCollection.get("ABHouseHoldOtherParentsListview_ListView"));
			pageCollection.put("ABHouseHoldMembersBlindDisableListview_ListView", beforeCollection.get("ABHouseHoldMembersBlindDisableListview_ListView"));
			pageCollection.put("ABHouseHoldMembersInstitutionListview_ListView", beforeCollection.get("ABHouseHoldMembersInstitutionListview_ListView"));
			pageCollection.put(FwConstants.PAGE_COMPONENT_LIST, beforeCollection.get(FwConstants.PAGE_COMPONENT_LIST));
			pageCollection.put(AppConstants.INDV_TYPE_SEQ_BEAN, indivTypeSeqBean);
			session.put(FwConstants.BEFORE_COLLECTION, pageCollection);
			pageCollection.put(AppConstants.FIRST_NAME,	peopleHandler.getFirstName(indvSeqNum));
			//Loading and merging APP_RGST in ABHMD (ILIES-174329)
			setValuesForCard(request, session,appNumber,peopleHandler);			
			return;					
		}

		//Deleting blind and disable information
		APP_IN_DABL_Collection appInDisableAfterColl = new APP_IN_DABL_Collection();
		int appInDisableBeforeCollSize = appInDisableBeforeColl.size();
		for(int p=0;p<appInDisableBeforeCollSize;p++){
			String indSeq = appInDisableBeforeColl.getCargo(p).getIndv_seq_num();
			if(indvSeqNum.equals(indSeq)){
				appInDisableAfterColl.addCargo(appInDisableBeforeColl.getCargo(p));
				break;
			}
		}
		// Deleting blind and disabled information
		summaryBO.deleteDisabilityInfo(appInDisableAfterColl);

		int[] driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);
		//short[] programKeyArray = (short[])session.get(FwConstants.AFB_PROGRAM_KEY);
		short responseId = IApplicationManager.DISABLED_PERSON;
		for(int i =0; i < sessionAppInPrflCollectionSize;i++){
			APP_IN_PRFL_Cargo sessionAppInPrflCargo = sessionAppInPrflCollection.getCargo(i);
			if(sessionAppInPrflCargo.getIndv_seq_num().equals(indvSeqNum)){
				//now i am updating the session cargo
				sessionAppInPrflCargo.setDabl_resp(FwConstants.NO);
				//added new line : to persist in database
				applicationManager.makeAbsoluteNotRequiredAndPersist(responseId,sessionAppInPrflCargo);
				//now i need to check how many people in the house hold 
				DisabilityBO disBO = new DisabilityBO();
				APP_IN_DABL_Collection dablColl = disBO.loadDisability(appNumber);
				int houseHoldSize = dablColl.size();
				if(houseHoldSize == 0){
					driverManager.makeAbsoluteNotRequired(FwConstants.AFB_DRIVER,"ABDIS", driverArray, appNumber);
				}
			}
		}
	
		} catch(FwException fe) {
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("eraseDisabilityDetails");
			we.setFwException(fe);
			throw we;
		} catch(Exception e) {
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "eraseDisabilityDetails", e);
			throw fe;
		}
	}

	/**
	* Comment here
	*/
	public void changeInstitutionDetails(FwTransaction txnBean) throws javax.ejb.EJBException {

		try {
			Map request = txnBean.getSession();
			String indvSeqNum = null;
			indvSeqNum= (String)request.get("firstName");
			Map pageCollection = txnBean.getPageCollection();
			IndivTypeSeqBean indivTypeSeqBean = new IndivTypeSeqBean();
			APP_IN_INST_Collection appInstitutionColl = (APP_IN_INST_Collection)pageCollection.get("APP_IN_INST_Collection");
			indivTypeSeqBean.setIndivSeqNum(appInstitutionColl.getCargo(0).getIndv_seq_num());
			pageCollection.put(FwConstants.DETAIL_KEY_BEAN, indivTypeSeqBean);

		} catch(FwException fe) {
			ctx.setRollbackOnly();
			FwWrappedException we = new FwWrappedException();
			we.setCallingClassID(this.getClass().getName());
			we.setCallingMethodID("changeInstitutionDetails");
			we.setFwException(fe);
			throw we;
		} catch(Exception e) {
			ctx.setRollbackOnly();
			FwException fe = createFwException(this.getClass().getName(), "changeInstitutionDetails", e);
			throw fe;
		}
	}

	
	/**
	* Comment here
	*/
	public void addDisabilityDetails(FwTransaction txnBean) throws javax.ejb.EJBException {

		try {
			log(ILog.INFO, "HouseHoldInfoEJBBean::addDisabilityDetails:Start");	 
			Map session = txnBean.getSession();
			Map request = txnBean.getRequest();
				  
			//Initialize Validator
			ABDISValidator disabilityValidator = new ABDISValidator();
			
			//Initialize short field names
			short responseId = 0 ;
			
			//Get driver info.
			  int[] driverArray = (int[]) session.get(FwConstants.AFB_DRIVER);

			//Get appNumber from the session
			String appNum = (String)session.get(AppConstants.APP_NUMBER);
			
			//Get the session AIP Collection 
				  APP_IN_PRFL_Collection appInPrflColl =
								  (APP_IN_PRFL_Collection) session.get(AppConstants.APP_IN_PRFL_MASTER);
			//Cargo
			APP_IN_PRFL_Cargo appInPrflCargo = new APP_IN_PRFL_Cargo(); 
			
			//Get the firstName 
//			String[] indvSeqNumArray = null;
//			indvSeqNumArray = (String[])request.get("firstName");
//			String indvSeqNum = indvSeqNumArray[0];
			
			
			String indvSeqNum = null;
			indvSeqNum= (String)request.get("firstName");
			
			
			//Run Validation
			disabilityValidator.validateAdd(indvSeqNum,"Disability");
			if(disabilityValidator.hasMessages())
			{
				request.put(FwConstants.MESSAGE_LIST,disabilityValidator.getMessageList()); 
				txnBean.setPageCollection((Map) session.get(FwConstants.BEFORE_COLLECTION));
				return;
			}