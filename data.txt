function attachProgramListenersForPerson(personEl) {
  const yes1 = personEl.querySelector('#programHealthCare_Y');
  const no1  = personEl.querySelector('#programHealthCare_N');
  const yes2 = personEl.querySelector('#programFamilyPlan_Y');
  const no2  = personEl.querySelector('#programFamilyPlan_N');

  const onChange = () => {
    // derive each program's state: 'yes' | 'no' | 'empty'
    const p1 = yes1?.checked ? 'yes' : no1?.checked ? 'no' : 'empty';
    const p2 = yes2?.checked ? 'yes' : no2?.checked ? 'no' : 'empty';

    const anyYes = (p1 === 'yes') || (p2 === 'yes');
    const bothNo = (p1 === 'no') && (p2 === 'no');
    const bothEmpty = (p1 === 'empty') && (p2 === 'empty');

    // Show if any yes; hide only if both no or both empty
    const shouldShow = anyYes || !(bothNo || bothEmpty) ? anyYes || (p1 !== 'no' || p2 !== 'no') : false;

    // simpler/explicit:
    if (anyYes) {
      toggleTaxFieldsMandatoryForPerson(personEl, true);   // show asterisk
    } else if (bothNo || bothEmpty) {
      toggleTaxFieldsMandatoryForPerson(personEl, false);  // hide asterisk
    } else {
      // states like one 'no' + one 'empty' â†’ keep asterisk (per your rule)
      toggleTaxFieldsMandatoryForPerson(personEl, true);
    }
  };

  // attach listeners safely
  [yes1, no1, yes2, no2].forEach(el => el && el.addEventListener('change', onChange));

  // initial evaluation
  onChange();
}

function attachProgramListenersForAllPersons() {
  document.querySelectorAll('[id^="person"]').forEach(attachProgramListenersForPerson);
}
