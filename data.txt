

// insert into person-adrs-hst
Function AIN49P9-INS-I23()
  VDBCONTROL.UPROC-NM = "AIN49P9-INS-I23";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-OBJ = "H2-PERSON-ADRS-HST";
  VDBCOMMON.USQLREC = "H2-PERSON-ADRS-HST";
  try
    add H2-PERSON-ADRS-HST
      with #sql{
        insert into TWNPERSON_ADRS_HST
        (UPI, PRD_BEG_TS, ADR_TYPE, ADR_STS, ADR_SRC,
          ZIP_CD, ST_CD, CITY, OTH_ADDR, APT_NMB,
          STR_TYPE, STR_NM, STR_DIR, HOUSE_NMB,
          ADR_VRFD_BY, ADR_VRFD_DT, AS_OF_DT,
          PRD_END_DT, ADR_VRFD_CD,
          ADR_STS_EFF_DT, NOMADS_USRID, INST_NM,
          RSDN_CNTY_CD, LAST_UPD_DT)
        values (:UPI, :PRD-BEG-TS, :ADR-TYPE, :ADR-STS, :ADR-SRC,
          :ZIP-CD, :ST-CD, :CITY, :OTH-ADDR, :APT-NMB,
          :STR-TYPE, :STR-NM, :STR-DIR, :HOUSE-NMB,
          :ADR-VRFD-BY, :ADR-VRFD-DT, :AS-OF-DT,
          :PRD-END-DT, :ADR-VRFD-CD,
          :ADR-STS-EFF-DT, :NOMADS-USRID, :INST-NM,
          :RSDN-CNTY-CD, :LAST-UPD-DT)
      } ;
  end
end // end AIN49P9-INS-I23


Function AIN49P9-INS-I24()
  try
    add H2-REUNIF-DATA ;
  end
  VDBCONTROL.UPROC-NM = "AIN49P9-INS-I24";
  VDBCONTROL.UPROC-OPT = "ADD   ";
  VDBCONTROL.UPROC-OBJ = "H2-REUNIF-DATA";
  VDBCOMMON.USQLREC = "H2-REUNIF-DATA";
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
end // end AIN49P9-INS-I24


Function AIN49P9-INS-I25()
  try
    add H2-ELIG-DCFS ;
  end
  VDBCONTROL.UPROC-NM = "AIN49P9-INS-I25";
  VDBCONTROL.UPROC-OPT = "ADD   ";
  VDBCONTROL.UPROC-OBJ = "H2-ELIG-DCFS";
  VDBCOMMON.USQLREC = "H2-ELIG-DCFS";
  /*  */
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
end // end AIN49P9-INS-I25


// INSERT PRGM CASE HSTRY ( SQL )
Function AIN49P9-INS-PCH()
  /* -----------------------PTR 4613 BEGIN-----------------------------*/
  /*  */
  /* Insert Prgm Case Hstry*/
  /*  */
  /* DB INITIALIZATION*/
  WDB00PI();

  set H2-PRGM-CASE-HSTRY empty;

  H2-PRGM-CASE-HSTRY.ICI = AIN49W.WS-ICI;
  H2-PRGM-CASE-HSTRY.PRGM-CASE-TYPE = "CW";
  H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-PRGM-CASE-HST-BEG-DATE;
  H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-PRGM-CASE-HST-END-DATE;
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-DD = "01";
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-PRGM-CASE-HSTRY.PRGM-EFF-DT = AIN49W.WS-DATE;
  /* ------------------PTR 7826 - 7 BEGIN--------------------------*/
  H2-PRGM-CASE-HSTRY.STS-EFF-DT = AIN49W.WS-DATE;
  H2-PRGM-CASE-HSTRY.PRGM-EFF-DT = AIN49W.WS-DATE;
  H2-PRGM-CASE-HSTRY.INIT-APRVL-DT = AIN49W.WS-DATE;
  H2-PRGM-CASE-HSTRY.INIT-APPRVD-BY = "DCFS";
  H2-PRGM-CASE-HSTRY.ACTUL-APLD-DT = "9999-12-31";
  /* ------------------PTR 7826 - 7 END----------------------------*/
  H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
  H2-PRGM-CASE-HSTRY.AID-CD = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
  if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
    H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
  else
    H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
  end
  AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-APPL-MA-APPLICATION-DATE;
  AIN49W.WS-MM = AIN49W5.WS-MM3;
  AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
  AIN49W.WS-DD = AIN49W5.WS-DD3;
  if (AIN49W.WS-YY-CC2 > "90")
    AIN49W.WS-YY-CC1 = "19";
  else
    AIN49W.WS-YY-CC1 = "20";
  end
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-PRGM-CASE-HSTRY.APPL-DT = AIN49W.WS-DATE;

  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-DD = "01";
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  /*  */
  /* ------------------PTR 6051 BEGIN-----------------------------------*/
  /* The status effective date is moved to actual status effective date*/
  /* field.*/
  /* ------------------PTR 6051 END-------------------------------------*/

  H2-PRGM-CASE-HSTRY.INIT-APRVL-TM = "00.00.00";
  H2-PRGM-CASE-HSTRY.INIT-APRVL-DT = "0001-01-01";
  H2-PRGM-CASE-HSTRY.ADVR-ACTN-WVD-DT = "9999-12-31";
  H2-PRGM-CASE-HSTRY.EXFS-DSCVR-DT = "9999-12-31";
  H2-PRGM-CASE-HSTRY.RCRT-APL-DT = "9999-12-31";
  H2-PRGM-CASE-HSTRY.AID-CD-CHNG-DT = "9999-12-31";
  H2-PRGM-CASE-HSTRY.TR-STRT-DT = "9999-12-31";
  H2-PRGM-CASE-HSTRY.TR-EXPRN-DT = "9999-12-31";
  /*  */
  /* PERFORM AIN49P9-INS-I12;*/
  AIN49P9-PCH-I12();
  /*  */
  VDBCOMMON.UDUP = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  /* -----------------------PTR 4613 END--------------------------------*/
end // end AIN49P9-INS-PCH


// INSERT TWNPERSON_DTLS
Function AIN49P9-INS-PED()
  WDB00PI();

  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
  VDBCOMMON.USQLREC = "H2-PERSON-DTLS";
  VDBCONTROL.UPROC-OBJ = "H2-PERSON-DTLS";
  VDBCONTROL.UPROC-NM = "AIN49P9-INS-PED";
  VDBCONTROL.UPROC-OPT = "ADD";
  /*  */
  try
    add H2-PERSON-DTLS
      with #sql{
        insert into twnperson_dtls
        (UPI, AGEDOUT_FSTR_CARE)
        values (:UPI, :AGEDOUT-FSTR-CARE)
      } ;
  end
  /*  */
  REPP9-SQL-CHKERR();

  /*  */
end // end AIN49P9-INS-PED


// INSERT UNEARNED INCOME
Function AIN49P9-INS-UNIN()
  /* INSERT UNIN PROCESS;*/
  /* DB INITIALIZATION*/
  WDB00PI();

  /* ** Changes due to ptr 11996 - UAT problem *** Begin*/
  /* 1 is moved to Income seq number unconditionally. This is incorrect.*/
  /* The income sequence number is deriived by calling the DB layer that*/
  /* determines the Income sequence number for a given UPI and PRD BEG DT.*/

  H-TUIDS3.UPI = AIN49W.WS-UPI;
  H-TUIDS3.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
  call "TUIDS3A" (VDBCONTROL, VMESSAGE, H-TUIDS3, GNOMADS) {isNoRefresh = yes};

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (VDBCONTROL.URC == 100)
    H2-UERND-INCM-DTL.INCM-SQ-NMB = 1;
  else
    H-TUIDS3.INCM-SQ-NMB = H-TUIDS3.INCM-SQ-NMB + 1;
    H2-UERND-INCM-DTL.INCM-SQ-NMB = H-TUIDS3.INCM-SQ-NMB;
  end

  /* ** Changes due to ptr 11996 - UAT problem *** End*/

  H2-UERND-INCM-DTL.AFDC-CNTBL-IND = "N";
  /* MOVE 'N' TO H2-UERND-INCM-DTL.FS-CNTBL-IND;*/
  H2-UERND-INCM-DTL.MA-CNTBL-CD = "N";
  H2-UERND-INCM-DTL.UNE-INC-VERF-CD = "Y";
  H2-UERND-INCM-DTL.UERND-INC-FREQ = "M";
  H2-UERND-INCM-DTL.RECUR-IND = "N";
  /*  */
  /* CHANGES DUE TO WI#15289 - BEGIN;*/
  /*  */
  /* CHANGES FOR WI# 20708 - ADDED SUBSCRIPT TO D-UNIN-CODE*/
  /* AND D-IVE-NONIVE-IND;*/
  /*  */
  if (((SR-Q-DCF-REC.D-UNIN-CODE[WS-INDEX] >= 1000 && 
  SR-Q-DCF-REC.D-UNIN-CODE[WS-INDEX] <= 1606) || 
  (SR-Q-DCF-REC.D-UNIN-CODE[WS-INDEX] >= 1900 && 
  SR-Q-DCF-REC.D-UNIN-CODE[WS-INDEX] <= 1911)))
    H2-UERND-INCM-DTL.FS-CNTBL-IND = "Y";
  else
    H2-UERND-INCM-DTL.FS-CNTBL-IND = "N";
  end
  H2-UERND-INCM-DTL.IVE-NONIVE-IND = SR-Q-DCF-REC.D-IVE-NONIVE-IND[WS-INDEX];

  /*  */
  /* CHANGES DUE TO WI#15289 - END;*/
  /*  */
  H2-UERND-INCM-DTL.UERND-INC-AMT = AIN49W.WS-D-CHECK-AMOUNT[WS-INDEX];
  if (H2-UERND-INCM-DTL.UERND-INC-AMT < 0)
    H2-UERND-INCM-DTL.UERND-INC-AMT = 0;
  end
  /* MOVE FIRST DATE OF WS-CHECK-DATE(WS-INDEX) TO THE PRD-BEG-DT*/
  AIN49W.WS-TEMP-DD = "01";
  AIN49W.WS-DD = AIN49W.WS-TEMP-DD;
  AIN49W.WS-MM = AIN49W.WS-TEMP-MM;
  /* MOVE AIN49W.WS-TEMP-YY TO AIN49W.WS-YY-CC2;*/
  AIN49W.WS-YY = AIN49W.WS-TEMP-CCYY;
  /* IF AIN49W.WS-YY-CC2 > '90';*/
  /* MOVE '19' TO AIN49W.WS-YY-CC1;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YY-CC1;*/
  /* END;*/
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  H2-UERND-INCM-DTL.PRD-BEG-DT = AIN49W.WS-DATE;
  H2-UERND-INCM-DTL.UERND-INC-RCVD-DT = AIN49W.WS-DATE;

  H2-UERND-INCM-DTL.CHNG-ENTRY-DT = "0001-01-01";
  H2-UERND-INCM-DTL.UNE-INC-VERF-DT = "0001-01-01";
  H2-UERND-INCM-DTL.RCVD-DT = "0001-01-01";
  H2-UERND-INCM-DTL.RPRTD-DT = "0001-01-01";
  H2-UERND-INCM-DTL.RCPT-DT = "0001-01-01";

  /* Move last date of  ws-check-date to PRD_END_DT*/
  AIN49P9-LST-DATE();
  H2-UERND-INCM-DTL.PRD-END-DT = AIN49W.WS-LAST-DATE;
  /* ---------------------PTR 7975 BEGIN----------------------------*/
  H2-UERND-INCM-DTL.RSDI-CLM-NUM = SR-Q-DCF-REC.D-USDI-RSDI-CLAIM-NBR;
  /* ---------------------PTR 7975 END -----------------------------*/
  /* SET H2-UERND-INCM-DTL.PBLIC-RSDI-STRT-DT NULL;*/
  /*  */
  AIN49P9-INS-I13();
  /*  */
  VDBCOMMON.UDUP = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
end // end AIN49P9-INS-UNIN


// INSERT IVD TABLE
Function AIN49P9-INSERT-IVD()
  /* Begin Changes WI# 15828 ----------------------------------------------*/
  /* Instead the IV-D Payee infomation being place into the IVD alt payee*/
  /* table, it will now be placed in the person_adrs_hst.*/
  /* -----------------------------------------------------------------------*/
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  AIN49W9.WS-TIME-STAMP = GDW.TS;
  H2-PERSON-ADRS-HST.PRD-BEG-TS = AIN49W9.WS-TIME-STAMP;

  H2-PERSON-ADRS-HST.HOUSE-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-NBR;
  H2-PERSON-ADRS-HST.STR-DIR = SR-Q-DCF-REC.D-ADDR-MAILING-DIR;
  H2-PERSON-ADRS-HST.STR-NM = SR-Q-DCF-REC.D-ADDR-MAILING-STREET;
  H2-PERSON-ADRS-HST.STR-TYPE = SR-Q-DCF-REC.D-ADDR-MAILING-TYPE;
  H2-PERSON-ADRS-HST.APT-NMB = SR-Q-DCF-REC.D-ADDR-MAILING-APT;
  H2-PERSON-ADRS-HST.OTH-ADDR = SR-Q-DCF-REC.D-ADDR-MAILING-OTHER;
  H2-PERSON-ADRS-HST.CITY = SR-Q-DCF-REC.D-ADDR-MAILING-CTY;
  H2-PERSON-ADRS-HST.ST-CD = SR-Q-DCF-REC.D-ADDR-MAILING-STATE;
  H2-PERSON-ADRS-HST.ZIP-CD = SR-Q-DCF-REC.D-ADDR-MAILING-ZIP;
  H2-PERSON-ADRS-HST.RSDN-CNTY-CD = SR-Q-DCF-REC.D-ADDR-RESIDENT-COUNTY;
  H2-PERSON-ADRS-HST.ADR-STS = "V";
  H2-PERSON-ADRS-HST.ADR-SRC = "DCFS";
  H2-PERSON-ADRS-HST.ADR-VRFD-BY = "DCFS";
  H2-PERSON-ADRS-HST.ADR-VRFD-DT = AIN49W.WS-PROCESS-DT;
  H2-PERSON-ADRS-HST.AS-OF-DT = AIN49W.WS-PROCESS-DT;
  H2-PERSON-ADRS-HST.PRD-END-DT = "9999-12-31";
  H2-PERSON-ADRS-HST.NOMADS-USRID = "DCFS";
  H2-PERSON-ADRS-HST.ADR-VRFD-CD = "Y";

  if (SR-Q-DCF-REC.D-ALTP-FIRST-NAME is blanks && 
  SR-Q-DCF-REC.D-ALTP-MIDDLE-NAME is blanks)

    H2-PERSON-ADRS-HST.INST-NM = SR-Q-DCF-REC.D-ALTP-LAST-NAME;
  else
    H2-PERSON-ADRS-HST.INST-NM = " ";
  end

  H2-PERSON-ADRS-HST.ADR-STS-EFF-DT = AIN49W.WS-PROCESS-DT;
  H2-PERSON-ADRS-HST.ADR-TYPE = "CR";
  H2-PERSON-ADRS-HST.LAST-UPD-DT = GDW.DTCD;

  AIN49P9-INS-I23();
  VDBCOMMON.UNRF = "Y";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  H2-PERSON-ADRS-HST.ADR-TYPE = "CM";
  call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
  AIN49W9.WS-TIME-STAMP = GDW.TS;
  H2-PERSON-ADRS-HST.PRD-BEG-TS = AIN49W9.WS-TIME-STAMP;
  H2-PERSON-ADRS-HST.LAST-UPD-DT = GDW.DTCD;

  AIN49P9-INS-I23();
  VDBCOMMON.UNRF = "Y";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  /*  */
end // end AIN49P9-INSERT-IVD


Function AIN49P9-IVD-CTRAK()
  H2-FAM-NCP.ICI = AIN49W.WS-IVA-ICI;
  H2-FAM-NCP.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;

  AIN49P9-SETINQ-S26();
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  AIN49P9-SCAN-S26();
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (sysVar.sqlData.sqlcode == 0)

    if (H2-FAM-NCP.RFRL-STS != "N" || H2-FAM-NCP.RFRL-STS != "R" || 
    H2-FAM-NCP.RFRL-STS != "E")

      PDCM-CASE-TRACKING.PDCM-UPI = H2-PERSON.UPI;
      PDCM-CASE-TRACKING.PDCM-CASE-SUFFIX = " ";
      PDCM-CASE-TRACKING.PDCM-PARTICIPANT = "K";
      PDCM-CASE-TRACKING.PDCM-MSG-TYPE = "110";
      PDCM-CASE-TRACKING.PDCM-MANUAL-IND = "N";
      PDCM-CASE-TRACKING.PDCM-TEXT1 = AIN49W.WS-TEXT3;
      AIN49W2.WS-NAME-BY = " BY ";
      AIN49W2.WS-NAME-ID = "DCFS";
      PDCM-CASE-TRACKING.PDCM-TEXT2 = AIN49W2.WS-NAME-TRK;
      call "DCM08A" (VDBCONTROL, VMESSAGE, GNOMADS, G-IV-D, PDCM-CASE-TRACKING) {isNoRefresh = yes};

      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end

    end
  end
end // end AIN49P9-IVD-CTRAK


// CHECK CHILD IF KNOWN
Function AIN49P9-IVE-ADCASE()
  /* IF THE FIRST THREE BYTES OF SSN RECEIVED FROM DCFS ARE NOT NUMERIC*/
  /* THEN A PSEUDO SSN FOR NOMADS HAS TO BE GENERATED.  THE DETAILS ARE*/
  /* ALSO WRITTEN TO THE DISK-FILE TO BE USED LATER FOR PRINTING.*/

  AIN49W.WS-PSEUDO-SSN = SR-Q-DCF-REC.D-MEMB-SSN;
  /* *********-------- PHASE3 REWORK START---------***************/

  AIN49W.WS-CHILD-KNOWN = "N";

  /* *********-------- PHASE3 REWORK END ----------***************/
  AIN49W.WS-PSEUDO-SSN-R = AIN49W.WS-PSEUDO-SSN;
  /* CALL THE APPLICATION WST10A FOR VALIDATING THE NUMERIC STRING.*/
  /* SET VSTRREC EMPTY;*/
  /* MOVE AIN49W.WS-PSEUDO-SSN-1-R TO VSTRREC.USTRING;*/
  /* CALL WST10A VSTRREC (NOMAPS;*/

  /* IF VSTRREC.URC NE 0;*/
  if (AIN49W.WS-PSEUDO-SSN-1-R not numeric)
    AIN49W.WS-PSEUDO-IND = "Y";
    AIN49P9-GEN-SSN();
    AIN49P9-WRITE-REP();
    SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
  else
    AIN49W.WS-PSEUDO-IND = "N";
  /*  */
  /* ******************* Changes due to pcf 2819 begin ***************/
    AIN49W.WS-REJECT-RSN = " ";
  /* ******************* Changes due to pcf 2819 end *****************/
    AIN49P9-CHK-CHLD();
  /* CHANGES FOR WI14240 -  DUPLICATE HOH PROCESSING - BEGIN;*/
    if (AIN49W.WS-DUPLICATE-HOH == "Y")
      AIN49P9-DUPHOH-PRC();
      AIN49W.WS-DUPLICATE-HOH = " ";
      return;
    end
  /* CHANGES FOR WI14240 -  DUPLICATE HOH PROCESSING - END;*/
  /* 08/31/2001 - CHECK IF THE BILLING NO. SENT FOR THIS CHILD & BELONGS*/
  /* TO A NOMADS PERSON WITH A DIFFERENT SSN*/
    AIN49P9-CHK-BLNGNO();
  /*  */

  /*  */
  /* CREATE A RECORD IN AIN49A-04-REC. THE RECORD LAYOUT OF AIN49A-04-REC*/
  /* WOULD BE IDENTICAL TO SR-Q-DCFS-MAS-FILE.  THIS FILE WOULD BE SENT*/
  /* BACK*/
  /* DCFS AS REJECT CASES*/
  /*  */
    if (AIN49W.WS-REJECT-RECORD == "Y")
      set SR-Q-04F-REC empty;
      move SR-Q-DCF-REC to SR-Q-04F-REC withV60Compat;
      AIN49P9-WRITE-04();
  /* -----------------------PTR 7826-3 BEGIN----------------------*/
      AIN49W.WS-BASE-DATA-EXISTS = "Y";
      AIN49P9-BLD-CHWELF();
  /* -----------------------PTR 7826-3 BEGIN----------------------*/
      return;
    end
  end
  /* 08/31/2001 - CHECK IF THE BILLING NO. SENT FOR THIS CHILD & BELONGS*/
  /* TO A NOMADS PERSON WITH A DIFFERENT SSN*/
  AIN49P9-CHK-BLNGNO();
  if (AIN49W.WS-REJECT-RECORD == "Y")
    set SR-Q-04F-REC empty;
    move SR-Q-DCF-REC to SR-Q-04F-REC withV60Compat;
    AIN49P9-WRITE-04();
    AIN49W.WS-BASE-DATA-EXISTS = "Y";
    AIN49P9-BLD-CHWELF();
    return;
  end
  /*  */
  AIN49P9-IVE-CRCASE();
end // end AIN49P9-IVE-ADCASE


// CREATE IVE CASE
Function AIN49P9-IVE-CRCASE()
  /* CREATE IVE CASE*/
  if (AIN49W.WS-CHILD-KNOWN == "N")
  /* A NEW PERSON HAS TO BE CREATED ONLY WHEN THE CHILD IS NEW TO NOMADS*/
    AIN49P9-GEN-UPI();
    AIN49P9-CRT-PER();
    AIN49P9-CRT-PEH();
  /* --------------------------PTR 5483 BEGIN ---------------------*/
  /* the address that comes from the interface is the Payee's address.*/
  /* Hence no record is created for the person in the TWNPERSON_ADRS_HST*/
  /* table. All references to creation and updation of the TWNPERSON_ADRS_*/
  /* HST table is removed*/
  /*  */
  /* PERFORM AIN49P9-CRT-PAH;*/
  /* ------------------------- PTR 5483 END ------------------------*/
  else
    if (AIN49W.WS-CHILD-KNOWN == "Y")
      H2-PERSON.UPI = AIN49W.WS-UPI;
      H2-PERSON.IVE-MMBR-IND = "Y";
      H2-PERSON.LST-NM = SR-Q-DCF-REC.D-MEMB-LAST-NAME;
      H2-PERSON.FRST-NM = SR-Q-DCF-REC.D-MEMB-FIRST-NAME;
      H2-PERSON.MID-NM = SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME;
      AIN49P9-GEN-PHNAME();
  /* IF CHILD IS KNOWN THROUGH IVD, HE MAY NOT HAVE A BILLING NO.*/
  /* SO CREATE BILLING NO. IF HE DOESN'T HAVE ONE.*/
      if (H2-PERSON.MEDIC-BLNG-SQ-NMB == 0)
        if (SR-Q-DCF-REC.D-MEMB-MA-NBR != " ")
          if (SR-Q-DCF-REC.D-MEMB-MA-NBR is numeric)
            AIN49W5.WS-MEMB-MA-NBR = SR-Q-DCF-REC.D-MEMB-MA-NBR;
            AIN49W5.WS-MEMB-MA-NBR2 = AIN49W5.WS-MEMB-MA-NBR;
            H2-PERSON.MEDIC-BLNG-SQ-NMB = AIN49W5.WS-MEMB-MA-NBR2;
          else
            AIN49W5.WS-MEMB-MA-NBR = SR-Q-DCF-REC.D-MEMB-MA-NBR;
            AIN49W5.WS-COUNT1 = 11;
            AIN49W5.WS-COUNT2 = 11;
            while (AIN49W5.WS-COUNT1 > 0)
              if (AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT1] == " ")
              else
                AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT2] = AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT1];
                AIN49W5.WS-COUNT2 = AIN49W5.WS-COUNT2 - 1;
              end
              AIN49W5.WS-COUNT1 = AIN49W5.WS-COUNT1 - 1;
            end
            while (AIN49W5.WS-COUNT2 > 0)
              AIN49W5.WS-MEMB-MA-NBR1[WS-COUNT2] = "0";
              AIN49W5.WS-COUNT2 = AIN49W5.WS-COUNT2 - 1;
            end
            AIN49W5.WS-MEMB-MA-NBR2 = AIN49W5.WS-MEMB-MA-NBR;
            H2-PERSON.MEDIC-BLNG-SQ-NMB = AIN49W5.WS-MEMB-MA-NBR2;
          end
        else
          WDB00PI();
          AIN49P9-READ-S35();
          VDBCOMMON.UNRF = "Y";
          WDB00PE-SQLERR();
          if (VDBCONTROL.URC >= 104)
            WCM00P2-TO-CEP01A();
          end
          H2-MA-BILL-SQ-NMB.LST-MA-BILL-SQ-NMB = H2-MA-BILL-SQ-NMB.LST-MA-BILL-SQ-NMB + 1;
          H2-PERSON.MEDIC-BLNG-SQ-NMB = H2-MA-BILL-SQ-NMB.LST-MA-BILL-SQ-NMB;
          WDB00PI();
          AIN49P9-UPD-U28();
          VDBCOMMON.UNRF = "Y";
          VDBCOMMON.UDUP = "N";
          WDB00PE-SQLERR();
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        end
      end
      AIN49P9-UPD-U27();
      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";
      /* perform sql error processing*/
      /*  */
      WDB00PE-SQLERR();
      /* check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  end
  /*  */
  AIN49W3.RPT-LST-NM = H2-PERSON.LST-NM;
  AIN49W3.RPT-FRST-NM = H2-PERSON.FRST-NM;
  AIN49W3.RPT-SSN = H2-PERSON.SSN;
  AIN49W3.RPT-SSN-VRFN-CODE = H2-PERSON.SSN-VRFN-STS-CD;
  AIN49W3.RPT-DOB = H2-PERSON.DOB;
  AIN49W3.RPT-BLNG-NMB = H2-PERSON.MEDIC-BLNG-SQ-NMB;

  AIN49P9-CRT-FCE();
  AIN49P9-CRT-CMM();
  AIN49P9-CRT-CMH();
  AIN49P9-CRT-MRR();
  AIN49P9-CRT-FCH();
  AIN49P9-CRT-FCC();
  AIN49P9-CRT-FAP();
  /* -----------------------PTR 4646 BEGIN -------------------------*/
  /* the caseload case history is also maintained for DCFS cases*/
  AIN49P9-CRT-CCH();
  /* -----------------------PTR 4646 END ---------------------------*/

  if (AIN49W.WS-PSEUDO-IND == "Y" && 
  SR-Q-DCF-REC.D-MEMB-SSN != " ")
    AIN49P9-CRT-ALTSSN();
  end

  AIN49P9-CRT-PCD();
  AIN49P9-CRT-PCH();
  /*  */
  /* ********* --------- CHANGES DUE TO PTR 7826 - 8 Begin ------*****/
  /* No processing for grant information needs to be done for a new case*/
  /*  */
  /* ********** -------- CHANGES DUE TO PTR 7826 - 8 End ------****/
  /*  */
  /* *******-------- PHASE3 REWORK START---------************/

  AIN49P9-CRT-ELIG();
  AIN49P9-CRT-FAA();

  /* ******--------- PHASE3 REWORK END-----------************/

  /* --------------------------PTR 4651 BEGIN----------------------------*/
  AIN49P9-CRE-CLOG();
  /* --------------------------PTR 4651 END------------------------------*/
  /*  */
  /* chages for ws# 15289 - begin;*/
  if (SR-Q-DCF-REC.D-REUNIF-CHANGED == "Y")
    AIN49P9-PRC-REUNIF();
  end
  /* chages for ws# 15289 - end;*/

  AIN49P9-AGDOUT-PRC(); /* WI 27695*/

  /* CHANGES FOR WI# 24622 - MMIS -START;*/
  set AIF25W1 empty;
  AIF25W1.CALLING-PRGM = "AIN49A";
  AIF25W1.ICI = AIN49W.WS-ICI;
  AIF25W1.UPI = AIN49W.WS-UPI;
  AIF25W1.PRGM-CASE-TYPE = "CW";
  AIF25W1.CASE-FLAG = "Y";
  AIF25W1.DEMO-FLAG = "Y";
  call "AIF25A" (VDBCONTROL, VMESSAGE, AIF25W1) {isNoRefresh = yes};

  /* CHANGES FOR WI# 24622 - MMIS -END;*/
  /*  */
end // end AIN49P9-IVE-CRCASE


// PROCESS IVE GRANT RECORDS
Function AIN49P9-IVE-GRCASE()
  /* IVE GRANT CASE*/
  /*  */
  /* ********* -------- Changes due to ptr 3049 begin --------- ********/
  /*  */
  /* Read on person using ssn is replaced with read on*/
  /* FAM_CASE (SQL S02) with IVE_CASE_ID as SSN will not be*/
  /* always present in the input file during updates*/
  /*  */
  set H2-3-CMH-FCE-PER empty;
  AIN49W4.WS-CASE-NUMBER = SR-Q-DCF-REC.D-KEY-CASE-NUMBER;
  H2-3-CMH-FCE-PER.IVE-CASE-ID = AIN49W4.WS-CASE-NUMBER;
  /* DB INITIALIZATION*/
  WDB00PI();
  AIN49P9-SETINQ-S02();
  /*  */
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /*  */
  WDB00PE-SQLERR();
  /*  */
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  AIN49P9-SCAN-S02();
  VDBCOMMON.UDUP = "N";
  VDBCOMMON.UNRF = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  AIN49W.WS-UPI = H2-3-CMH-FCE-PER.UPI;
  AIN49W.WS-ICI = H2-3-CMH-FCE-PER.ICI;
  AIN49W5.WS-IVA-CASE-MBR-FG = H2-3-CMH-FCE-PER.IVA-CASE-MBR-FG;
  if (sysVar.sqlData.sqlcode == 0)
    /*  */
    AIN49W.WS-UPI = H2-3-CMH-FCE-PER.UPI;
  /* ********* -------- Changes due to ptr 3049 end ----------- ********/
  /*  */
    /*  */
    AIN49P9-CRT-UNIN();
  /* -----------------------PTR 8170 - 64 BEGIN------------------------*/
  /* ** -------CMTS - 13293 --- BEGIN*/
  /* A CHECK IS MADE TO DETERMINE IF THE PARTICIPANT IS KNOWN AS A FOOD*/
  /* STAMP CASE. IF SO THE FOOD STAMP WORKER IS ALERTED.*/
  /*  */
    AIN49P9-CHK-FS();
  /*  */
  /* ** -------CMTS - 13293 --- END*/
    SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
  else
    SR-Q-CNT-REC.AININT-CNT-REC-SKIP = SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;
    AIN49W.WS-REJECT-RSN = "IG"; /* invalid GRANT CASE referred*/
    move SR-Q-DCF-REC to SR-Q-04F-REC withV60Compat;
    AIN49P9-WRITE-04();
    AIN49W.WS-BASE-DATA-EXISTS = "N";
    AIN49W.WS-REJECT-RECORD = "Y";
    AIN49P9-BLD-CHWELF();
  /* -----------------------PTR 8170 - 64 END -------------------------*/

  end
end // end AIN49P9-IVE-GRCASE


// PROCESS IVE UPDATE RECORDS
Function AIN49P9-IVE-UPCASE()
  /* IVE UPDATE CASE*/
  set H2-3-CMH-FCE-PER empty;
  AIN49W4.WS-CASE-NUMBER = SR-Q-DCF-REC.D-KEY-CASE-NUMBER;
  H2-3-CMH-FCE-PER.IVE-CASE-ID = AIN49W4.WS-CASE-NUMBER;
  /* DB INITIALIZATION*/
  WDB00PI();
  AIN49P9-SETINQ-S02();
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
  end
  AIN49P9-SCAN-S02();
  VDBCOMMON.UDUP = "N";
  VDBCOMMON.UNRF = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  /* ---------------------------PTR 8170 - 1 BEGIN------------------*/
  if (sysVar.sqlData.sqlcode == 100)
    SR-Q-CNT-REC.AININT-CNT-REC-SKIP = SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;
    AIN49W.WS-BASE-DATA-EXISTS = "N";
    SR-Q-04F-REC.D-REC = SR-Q-DCF-REC.D-RECORD;
    AIN49P9-WRITE-04();
    AIN49W.WS-REJECT-RECORD = "Y";
    AIN49W.WS-REJECT-RSN = "IC";
    AIN49P9-BLD-CHWELF();
    return;
  else
  /* -----------------PTR 8170 - 2 BEGIN-----------------------------------**/
  /*  */
  /* ---------------changes due to PTR 5492 Begin------------*/
  /* A check is made to determine valid Aid codes, Eligibility codes,*/
  /* office code and country code. If an invalid code is determined  the*/
  /* record is written into the reject file and the child welfare report is*/
  /* built. If all the codes received are valid then the updates are done.*/
  /*  */
    AIN49P9-VAL-CD();
    if (AIN49W.WS-VALID-CODES == "F")
  /* ----------------------PTR 7826 BEGIN--------------------------------*/
      AIN49W.WS-BASE-DATA-EXISTS = "Y";
  /* ----------------------PTR 7826 END ---------------------------------*/
      AIN49P9-BLD-CHWELF();
      return;
    end
  /* -----------------changes due to PTR 5492 End----------------*/
  /* -----------------PTR 8170 - 2 END-------------------------------------**/

  end
  /* ---------------------------PTR 8170 - 1 END--------------------*/
  /* -----------------------PTR 3360 BEGIN --------------------------*/
  /* the ICI and UPI read from the FAM CASE tables are stored in working*/
  /* storage variables. This is used for later processing*/
  /*  */
  AIN49W.WS-IVA-ICI = H2-3-CMH-FCE-PER.ICI;
  AIN49W.WS-IVA-UPI = H2-3-CMH-FCE-PER.UPI;
  AIN49W5.WS-CST-FG = H2-3-CMH-FCE-PER.CST-FG;
  AIN49W5.WS-NCP-FG = H2-3-CMH-FCE-PER.NCP-FG;
  AIN49W5.WS-CHD-FG = H2-3-CMH-FCE-PER.CHD-FG;
  /* ------------------------PTR 3360 END ----------------------------*/
  AIN49W.WS-UPI = H2-3-CMH-FCE-PER.UPI;

  /* -----------------------PTR 7458 BEGIN------------------------------*/
  if (SR-Q-DCF-REC.D-MEMB-CHANGED == "Y")
    if (SR-Q-DCF-REC.D-MEMB-SSN > " ")
      AIN49P9-CHK-SSN();
  /* MOVE H2-PERSON.MEDIC-BLNG-SQ-NMB TO AIN49W3.RPT-BLNG-NMB;*/
      if (AIN49W.WS-DUPLICATE-SSN == "T")
  /* IGNORE THIS SSN AND PROCESS THE REMAINING CHANGES IN THE RECORD*/
  /* WI#22805 - START*/
  /*  */
        SR-Q-DCF-REC.D-MEMB-SSN = " ";
  /*  */
  /* SR-Q-CNT-REC.AININT-CNT-REC-SKIP =*/
  /* SR-Q-CNT-REC.AININT-CNT-REC-SKIP + 1;*/
  /* MOVE 'SM' TO AIN49W.WS-REJECT-RSN;/* SSN MISMATCH, DUPLICATE SSN*/
  /* ----------------------PTR 7826 BEGIN--------------------------------*/
  /* MOVE 'Y' TO AIN49W.WS-BASE-DATA-EXISTS;*/
  /* MOVE 'Y' TO AIN49W.WS-REJECT-RECORD;*/
  /* ----------------------PTR 7826 END ---------------------------------*/
  /* PERFORM AIN49P9-BLD-CHWELF;*/
  /* ----------------------------PTR 7826 - 4 BEGIN---------------------*/
  /* SET SR-Q-04F-REC EMPTY;*/
  /* MOVE SR-Q-DCF-REC TO SR-Q-04F-REC;*/
  /* PERFORM AIN49P9-WRITE-04;*/
  /* EZERTN;*/
  /* ----------------------------PTR 7826 - 4 END-----------------------*/
  /* WI#22805 - END;*/
      end
    end
  end
  /*  */
  /* CHANGES DUE TO WI#15289 - BEGIN;*/
  /*  */
  if (SR-Q-DCF-REC.D-MEMB-SSN > " ")
    AIN49W.WS-CASE-LOG-CHILDS-SSN = SR-Q-DCF-REC.D-MEMB-SSN;
  else
    AIN49W.WS-CASE-LOG-CHILDS-SSN = H2-3-CMH-FCE-PER.SSN;
  end
  /*  */
  /* CHANGES DUE TO WI#15289 - END;*/
  /*  */
  SR-Q-CNT-REC.AININT-CNT-REC-PRO = SR-Q-CNT-REC.AININT-CNT-REC-PRO + 1;
  /* ------------------------PTR 7458 END-------------------------------*/

  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (SR-Q-DCF-REC.D-APPL-CHANGED == "Y")
    AIN49P9-APPL-CHG();
  end

  /* -------------------------- PTR 5485 begin --------------------*/
  /* the address that comes from the interface is the PAYEES address. Hence*/
  /* no record is created for the person in the TWNPERSON_ADDR_HST table.*/
  /* All references to creation and updation of the TWNPERSON_ADRS_HST*/
  /* table is removed. The ADDR_CHANGE-PROCESS is deleted.*/
  /*  */
  if (SR-Q-DCF-REC.D-ADDR-CHANGED == "Y"
   || SR-Q-DCF-REC.D-ALTP-CHANGED == "Y")
  /*  */
  /* CHANGES DUE TO WI15289 - BEGIN;*/
  /*  */
    AIN49P9-CHK-IVAFAP();
  /*  */
  /* CHANGES DUE TO WI15289 - END;*/
  /*  */
  /* PERFORM AIN49P9-ADDR-CHG;*/
    AIN49P9-ALTP-CHG();
  /*  */
  /* ----------------------------PTR 4618 BEGIN ------------------*/
  /* whenever alternate payee data changes the IVD tables holding*/
  /* alternate payee information are also updated*/
  /*  */
    AIN49P9-SPLIT-DAP();
  /* --------------------------PTR 4618 END -------------------------*/
  /* -------------------------- PTR 3360 BEGIN -------------------*/
  /* the IVD worker needs to be alerted when the information on the*/
  /* alternate Payee (address or name) changes*/
  /*  */
    AIN49W.WS-ALERT-IVD-ID = 390046;
    AIN49P9-ALRT-IVD();
  /* -------------------------- PTR 3360 END ----------------------*/

  /* --------------------------- PTR 5485 END -----------------------*/
  end

  if (SR-Q-DCF-REC.D-MEMB-CHANGED == "Y")
    AIN49P9-MEMB-CHG();
  end

  /* IF SR-Q-DCF-REC.D-UNIN-CHANGED = 'Y';*/
  /* PERFORM AIN49P9-UNIN-CHG;*/
  /* *****---------- PHASE3 REWORK START --------------************/
  /*  */
  /* ***  PERFORM AIN49P9-CRT-BG;*/
  /*  */
  /* ******--------- PHASE3 REWORK END ----------------************/
  /* END;*/
  /* chages for ws# 15289 - begin;*/
  if (SR-Q-DCF-REC.D-REUNIF-CHANGED == "Y")
    AIN49P9-PRC-REUNIF();
  end
  /* chages for ws# 15289 - end;*/

  AIN49P9-AGDOUT-PRC(); /* WI 27695*/

  /* CHANGES FOR WI# 24622 - MMIS -START;*/
  set AIF25W1 empty;
  AIF25W1.CALLING-PRGM = "AIN49A";
  AIF25W1.ICI = AIN49W.WS-IVA-ICI;
  AIF25W1.UPI = AIN49W.WS-IVA-UPI;
  AIF25W1.PRGM-CASE-TYPE = "CW";
  if (SR-Q-DCF-REC.D-ADDR-CHANGED == "Y"
   || SR-Q-DCF-REC.D-ALTP-CHANGED == "Y"
   || SR-Q-DCF-REC.D-APPL-CHANGED == "Y")
    AIF25W1.CASE-FLAG = "Y";
  end
  if (SR-Q-DCF-REC.D-MEMB-CHANGED == "Y")
    AIF25W1.DEMO-FLAG = "Y";
  end
  call "AIF25A" (VDBCONTROL, VMESSAGE, AIF25W1) {isNoRefresh = yes};

  /* CHANGES FOR WI# 24622 - MMIS -END;*/
end // end AIN49P9-IVE-UPCASE


// date retrieval process
Function AIN49P9-LAST-DATE()
  /* LAST DAY OF THE PREVIOUS MONTH FROM THE GIVEN DATE*/
  AIN49W.WS-PREV-CCYY = AIN49W.WS-TEMP-CCYY-NUM;
  if (AIN49W.WS-TEMP-MM-NUM == 1)
    AIN49W.WS-PREV-MM = 12;
    AIN49W.WS-PREV-CCYY = AIN49W.WS-TEMP-CCYY-NUM - 1;
    AIN49W.WS-PREV-DD = 31;
  end
  /* IF AIN49W.WS-PREV-YY > 90 AND AIN49W.WS-PREV-YY =< 99;*/
  /* MOVE 19 TO AIN49W.WS-PREV-CC;*/
  /* ELSE;*/
  /* MOVE 20 TO AIN49W.WS-PREV-CC;*/
  /* END;*/
  if (AIN49W.WS-TEMP-MM-NUM == 05 || 
  AIN49W.WS-TEMP-MM-NUM == 07 || 
  AIN49W.WS-TEMP-MM-NUM == 10 || 
  AIN49W.WS-TEMP-MM-NUM == 12)
    AIN49W.WS-PREV-MM = AIN49W.WS-TEMP-MM-NUM - 1;
    AIN49W.WS-PREV-DD = 30;
  end

  if (AIN49W.WS-TEMP-MM-NUM == 02 || 
  AIN49W.WS-TEMP-MM-NUM == 04 || 
  AIN49W.WS-TEMP-MM-NUM == 06 || 
  AIN49W.WS-TEMP-MM-NUM == 08 || 
  AIN49W.WS-TEMP-MM-NUM == 09 || 
  AIN49W.WS-TEMP-MM-NUM == 11)

    AIN49W.WS-PREV-MM = AIN49W.WS-TEMP-MM-NUM - 1;
    AIN49W.WS-PREV-DD = 31;
  end
  if (AIN49W.WS-TEMP-MM-NUM == 03)

    AIN49W.WS-REM1 = AIN49W.WS-PREV-CCYY % 4;
    AIN49W.WS-REM2 = AIN49W.WS-PREV-CCYY % 100;
    AIN49W.WS-REM3 = AIN49W.WS-PREV-CCYY % 400;

    if (AIN49W.WS-REM1 != 0)
      AIN49W.WS-PREV-MM = 02;
      AIN49W.WS-PREV-DD = 28;
    else
      if (AIN49W.WS-REM2 == 0)
        if (AIN49W.WS-REM3 == 0)
          AIN49W.WS-PREV-MM = 02;
          AIN49W.WS-PREV-DD = 29;
        else
          AIN49W.WS-PREV-MM = 02;
          AIN49W.WS-PREV-DD = 28;
        end
      else
        AIN49W.WS-PREV-MM = 02;
        AIN49W.WS-PREV-DD = 29;
      end
    end
  end
  AIN49W.WS-LAST-DATE-CC = AIN49W.WS-PREV-CC-C;
  AIN49W.WS-LAST-DATE-YY = AIN49W.WS-PREV-YY-C;
  AIN49W.WS-LAST-DATE-MM = AIN49W.WS-PREV-MM-C;
  AIN49W.WS-LAST-DATE-DD = AIN49W.WS-PREV-DD-C;
  AIN49W.WS-LAST-DATE-F1 = "-";
  AIN49W.WS-LAST-DATE-F2 = "-";
  /* cbsi end*/
end // end AIN49P9-LAST-DATE


// date retrieval process
Function AIN49P9-LST-DATE()
  /* LAST DAY OF THE mONTH FROM THE GIVEN DATE*/
  AIN49W.WS-PREV-YY-C = AIN49W.WS-TEMP-YY;
  AIN49W.WS-PREV-MM-C = AIN49W.WS-TEMP-MM;
  if (AIN49W.WS-PREV-YY > 90 && AIN49W.WS-PREV-YY <= 99)
    AIN49W.WS-PREV-CC = 19;
  else
    AIN49W.WS-PREV-CC = 20;
  end
  if (AIN49W.WS-TEMP-MM == "04" || 
  AIN49W.WS-TEMP-MM == "06" || 
  AIN49W.WS-TEMP-MM == "09" || 
  AIN49W.WS-TEMP-MM == "11")
    AIN49W.WS-PREV-DD = 30;
  end

  if (AIN49W.WS-TEMP-MM == "01" || 
  AIN49W.WS-TEMP-MM == "03" || 
  AIN49W.WS-TEMP-MM == "05" || 
  AIN49W.WS-TEMP-MM == "07" || 
  AIN49W.WS-TEMP-MM == "08" || 
  AIN49W.WS-TEMP-MM == "10" || 
  AIN49W.WS-TEMP-MM == "12")
    AIN49W.WS-PREV-DD = 31;
  end
  if (AIN49W.WS-TEMP-MM == "02")

    AIN49W.WS-REM1 = AIN49W.WS-PREV-CCYY % 4;
    AIN49W.WS-REM2 = AIN49W.WS-PREV-CCYY % 100;
    AIN49W.WS-REM3 = AIN49W.WS-PREV-CCYY % 400;

    if (AIN49W.WS-REM1 != 0)
      AIN49W.WS-PREV-MM = 02;
      AIN49W.WS-PREV-DD = 28;
    else
      if (AIN49W.WS-REM2 == 0)
        if (AIN49W.WS-REM3 == 0)
          AIN49W.WS-PREV-MM = 02;
          AIN49W.WS-PREV-DD = 29;
        else
          AIN49W.WS-PREV-MM = 02;
          AIN49W.WS-PREV-DD = 28;
        end
      else
        AIN49W.WS-PREV-MM = 02;
        AIN49W.WS-PREV-DD = 29;
      end
    end
  end
  AIN49W.WS-LAST-DATE-CC = AIN49W.WS-PREV-CC-C;
  AIN49W.WS-LAST-DATE-YY = AIN49W.WS-PREV-YY-C;
  AIN49W.WS-LAST-DATE-MM = AIN49W.WS-PREV-MM-C;
  AIN49W.WS-LAST-DATE-DD = AIN49W.WS-PREV-DD-C;
  AIN49W.WS-LAST-DATE-F1 = "-";
  AIN49W.WS-LAST-DATE-F2 = "-";
  /* cbsi end*/
end // end AIN49P9-LST-DATE


// MAIN PROCESS
Function AIN49P9-MAIN()
  /* INITIALIZATION PROCESS*/
  set AIN49W empty;
  set AIN49W1 empty;
  set AIN49W2 empty;
  set AIN49W3 empty;
  set AIN49W4 empty;
  set AIN49W5 empty;
  set AIN49W6 empty;
  set AIN49W7 empty;
  set APO04W1 empty;
  /* PERFORM PROCESS TO GET THE CURRENT DATE*/
  AIN49P9-GET-DATE();
  /*  */
  AIN49W.WS-FIL1 = "-";
  AIN49W.WS-FIL2 = "-";
  /* --------changes due to ptr 3144 begin *************/
  /* the changes made to AIN49003 is removed. The WS-MONTH-RUN is not*/
  /* used for processing. Instead the process date is used.*/
  /*  */
  WCM00P3-FETCHBDTS();
  /*  */
  /* populate the ws-process date with dates from the BDATEPARM file*/
  /*  */
  AIN49W.WS-PROCESS-DT-CC = BDATEREC.BDATE-PROCESS-DATE-CC;
  AIN49W.WS-PROCESS-DT-YY = BDATEREC.BDATE-PROCESS-DATE-YY;
  AIN49W.WS-PROCESS-DT-MM-CHA = BDATEREC.BDATE-PROCESS-DATE-MM;
  AIN49W.WS-PROCESS-DT-DD-CHA = BDATEREC.BDATE-PROCESS-DATE-DD;
  AIN49W.WS-PROCESS-DT-SEP1 = "-";
  AIN49W.WS-PROCESS-DT-SEP2 = "-";
  AIN49W.WS-TEMP-SEP1 = "-";
  AIN49W.WS-TEMP-SEP2 = "-";
  /* move first day of month, of process-date, to first-date*/
  AIN49W.WS-FIRST-DATE = AIN49W.WS-PROCESS-DT;
  AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
  AIN49W.WS-FIRST-DD = "01";
  /*  */
  /* ----------CHnges due to ptr 3144---------- end **************/
  set SR-Q-CNT-REC empty;
  /* WHILE NOT END OF FILE READ*/
  set SR-Q-DCF-REC empty;

  AIN49P9-LAST-DATE();


  AIN49P9-READ-DCFSM();
  while (sysVar.errorCode == "00000000")

    move "0000000        0000 " to AIN49W.WS-CHECK-ARRAY[1] for all;
  /* CHANGES FOR WI# 21255 - START;*/
    AIN49W.WS-FIRST-DATE = AIN49W.WS-PROCESS-DT;
    AIN49W.WS-FIRST-DD = "01";
  /* CHANGES FOR WI# 21255 - END;*/
    SR-Q-CNT-REC.AININT-CNT-NO-RECS = SR-Q-CNT-REC.AININT-CNT-NO-RECS + 1;
    AIN49P9-PROC-PARA();

    set SR-Q-DCF-REC empty;
    set AIN49W3 empty;
    AIN49P9-READ-DCFSM();
  end
  AIN49P9-CON-REP();
end // end AIN49P9-MAIN


// PROCESS MEMB CHANGE DETAILS
Function AIN49P9-MEMB-CHG()
  /* MEMB-CHANGE PROCESS*/
  AIN49W.WS-UPDATE-PERSON = "N";
  AIN49W.WS-UPDATE-PRGM-CASE-HSTRY = "N";
  AIN49W.WS-UPDATE-CASE-MEM-HST = "N";
  AIN49W.WS-CREATE-ELIG-VERSIONS = "N";
  AIN49W.WS-REFERAL-PROCESS = "N";

  /* -----------------------------------------------------------------------*/
  /* The Read on the table TWNPERSON, has to be done here. This Read*/
  /* is given , to fetch the values for the columns  given in the*/
  /* update statement so that, if the values for some of the columns*/
  /* is not changed, the old values can be replaced.*/
  /* -----------------------------------------------------------------------*/

  WDB00PI();

  set H2-PERSON empty;

  H2-PERSON.UPI = H2-3-CMH-FCE-PER.UPI;

  AIN49P9-READ-S23();

  VDBCOMMON.UDUP = "N";

  WDB00PE-SQLERR();

  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end

  if (sysVar.sqlData.sqlcode == 0)

    if (SR-Q-DCF-REC.D-ADDR-HOME-TELEPHONE not blanks)
      H2-PERSON.HM-PHN-NMB = SR-Q-DCF-REC.D-ADDR-HOME-TELEPHONE;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if ((H2-PERSON.LST-NM != SR-Q-DCF-REC.D-MEMB-LAST-NAME
     || H2-PERSON.FRST-NM != SR-Q-DCF-REC.D-MEMB-FIRST-NAME
     || H2-PERSON.MID-NM != SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME))

      VSTRREC4.USTRING = H2-PERSON.LST-NM;
      VSTRREC4.UCONCAT = H2-PERSON.FRST-NM;
      VSTRREC4.UCONCAT2 = H2-PERSON.MID-NM;
      VSTRREC4.UCONCAT3 = H2-PERSON.MODFR;
      VSTRREC4.USTRLEN = 21;
      VSTRREC4.UCONLEN = 16;
      VSTRREC4.UCONLEN2 = 16;
      VSTRREC4.UCONLEN3 = 3;
      call "WST50A" (VSTRREC4) {isNoRefresh = yes};
      AIN49W.WS-TEXT3 = VSTRREC4.USTRING;

      VSTRREC4.USTRING = SR-Q-DCF-REC.D-MEMB-LAST-NAME;
      VSTRREC4.UCONCAT = SR-Q-DCF-REC.D-MEMB-FIRST-NAME;
      VSTRREC4.UCONCAT2 = SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME;
      VSTRREC4.USTRLEN = 21;
      VSTRREC4.UCONLEN = 16;
      VSTRREC4.UCONLEN2 = 16;
      call "WST50A" (VSTRREC4) {isNoRefresh = yes};
      AIN49W2.WS-NAME-TEXT = VSTRREC4.USTRING;

      AIN49P9-IVD-CTRAK();

    end

    if (H2-PERSON.SSN != SR-Q-DCF-REC.D-MEMB-SSN)
      AIN49W.WS-TEXT3 = H2-PERSON.SSN;
      AIN49W2.WS-NAME-TEXT = SR-Q-DCF-REC.D-MEMB-SSN;
      AIN49P9-IVD-CTRAK();
    end

    if (SR-Q-DCF-REC.D-MEMB-LAST-NAME not blanks)
      AIN49P9-GEN-PHNAME();
      H2-PERSON.LST-NM = SR-Q-DCF-REC.D-MEMB-LAST-NAME;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (SR-Q-DCF-REC.D-MEMB-FIRST-NAME not blanks)
      AIN49P9-GEN-PHNAME();
      H2-PERSON.FRST-NM = SR-Q-DCF-REC.D-MEMB-FIRST-NAME;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME not blanks)
      H2-PERSON.MID-NM = SR-Q-DCF-REC.D-MEMB-MIDDLE-NAME;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (SR-Q-DCF-REC.D-MEMB-SSN not blanks)
      AIN49W.WS-PSEUDO-SSN = SR-Q-DCF-REC.D-MEMB-SSN;
      if (AIN49W.WS-PSEUDO-SSN-1-R not numeric)
        AIN49W.WS-BASE-DATA-EXISTS = "Y";
        move SR-Q-DCF-REC to SR-Q-04F-REC withV60Compat;
        AIN49P9-WRITE-04();
        AIN49W.WS-REJECT-RECORD = "Y";
        AIN49W.WS-REJECT-RSN = "IP";
        AIN49P9-BLD-CHWELF();
      else
        H2-PERSON.SSN = SR-Q-DCF-REC.D-MEMB-SSN;
        AIN49W.WS-UPDATE-PERSON = "Y";
      end
    end

    if (SR-Q-DCF-REC.D-MEMB-SSN-VERIFY not blanks)
  /* if the SSN is already verified, then the SSN status is not updated*/
  /*  */
      if (H2-PERSON.SSN-VRFN-STS-CD != "V")
        H2-PERSON.SSN-VRFN-STS-CD = SR-Q-DCF-REC.D-MEMB-SSN-VERIFY;
        AIN49W.WS-UPDATE-PERSON = "Y";
      end
    end

    if (SR-Q-DCF-REC.D-MEMB-DOB not blanks)
      AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-MEMB-DOB;
      AIN49W.WS-DD = AIN49W5.WS-DD3;
      AIN49W.WS-MM = AIN49W5.WS-MM3;
      AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
      AIN49W.WS-YY-CC1 = AIN49W5.WS-CC3;
      AIN49W.WS-FIL1 = "-";
      AIN49W.WS-FIL2 = "-";
      H2-PERSON.DOB = AIN49W.WS-DATE;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (SR-Q-DCF-REC.D-MEMB-SEX not blanks)
      H2-PERSON.SEX-CD = SR-Q-DCF-REC.D-MEMB-SEX;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (SR-Q-DCF-REC.D-MEMB-ETHNICITY not blanks)
      H2-PERSON.ETHNC-CD = SR-Q-DCF-REC.D-MEMB-ETHNICITY;
      AIN49W.WS-UPDATE-PERSON = "Y";
    end

    if (AIN49W.WS-UPDATE-PERSON == "Y")

      AIN49P9-UPD-U04();

      VDBCOMMON.UNRF = "Y";
      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();

      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  end

  AIN49W3.RPT-LST-NM = H2-PERSON.LST-NM;
  AIN49W3.RPT-FRST-NM = H2-PERSON.FRST-NM;
  AIN49W3.RPT-SSN = H2-PERSON.SSN;
  AIN49W3.RPT-SSN-VRFN-CODE = H2-PERSON.SSN-VRFN-STS-CD;
  AIN49W3.RPT-DOB = H2-PERSON.DOB;
  AIN49W3.RPT-BLNG-NMB = H2-PERSON.MEDIC-BLNG-SQ-NMB;

  WDB00PI();

  set H2-PERSON-HSTRY empty;
  
/* Begin WI 2445 MT - this is to update person history table to make changes when */  
/* only future month record is received from DCFS */  
  
  AIN49W.WS-DATE_FUT = SR-Q-DCF-REC.D-BENEFIT-START-MONTH; 
  AIN49W.WS-MM_FUT = AIN49W.WS-MM2_FT;
  AIN49W.WS-YY_FUT = AIN49W.WS-YY2_FT;
  AIN49W.WS-DD_FUT  = "01";
  AIN49W.WS-FIL1_FUT  = "-";
  AIN49W.WS-FIL2_FUT  = "-";

  AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;	
  AIN49W.WS-TEMP-DD = "01";
  
  

  if (AIN49W.WS-DATE_FUTURE  > AIN49W.WS-TEMP-DATE)

  /* KEY SETTING PROCESS*/
  if (SR-Q-DCF-REC.D-MEMB-US-CITIZEN not blanks)
    H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;		
    H2-PERSON-HSTRY.PRD-BEG-DT =  AIN49W.WS-DATE_FUTURE;    
    AIN49P9-READ-S15();               
    VDBCOMMON.UDUP = "N";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    if (AIN49W5.WS-SQCOD == 0)                 

      if (H2-PERSON-HSTRY.PRD-BEG-DT ==  AIN49W.WS-DATE_FUTURE) 
  /* ** the previous image of twnperson_hstry is retreived from*/
  /* *** SQL AIN49A_S15 AND STORED.*/
        H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-DATE_FUTURE; 

        H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
        AIN49P9-REP-U05();                     
        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      else                          
  /* ** the period end date of the existing record is made closed*/
  /* ** AND A NEW RECORD WITH ALL DETAILS READ FROM THE INTERFACE*/
  /* ** FILE IS INSERTED.*/
        AIN49W.WS-PRD-END-DT = H2-PERSON-HSTRY.PRD-END-DT;        
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-LST-DATE();                                                 //figures last of month for current month
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
        H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;
        H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;
        AIN49P9-UPD-U26();	         

        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
        
        H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-DATE_FUTURE; 
        H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
        H2-PERSON-HSTRY.US-CTZN-VRFN-IND = "Y";
        H2-PERSON-HSTRY.LST-GR-VRFD-IND = "Y";
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-PRD-END-DT;     //WI 2445 mt

        H2-PERSON-HSTRY.US-CTZN-VRFD-DT = "9999-12-31";
        if (H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT == null) /* WI 69*/
          H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT = "9999-12-31";
        end
        H2-PERSON-HSTRY.PUB-EMP-CHD = "N";
        H2-PERSON-HSTRY.PAST-HLTH-CVRG = "N";
        
        if (H2-PERSON-HSTRY.CVRG-END-DT == null ||
        	H2-PERSON-HSTRY.CVRG-END-DT == " ")
          H2-PERSON-HSTRY.CVRG-END-DT = "9999-12-31";
        end  
        H2-PERSON-HSTRY.CVRG-END-RSN = " ";
        
        if (H2-PERSON-HSTRY.NCU-ENRL-DT == null ||
        	H2-PERSON-HSTRY.NCU-ENRL-DT == " ")
          H2-PERSON-HSTRY.NCU-ENRL-DT = "9999-12-31";
        end
        
        H2-PERSON-HSTRY.TAX-FILE-STS = " ";
        AIN49P9-INS-I02();

        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      end
    else               

      H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-DATE_FUTURE;
      H2-PERSON-HSTRY.PRD-END-DT = "9999-12-31";
      H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
      H2-PERSON-HSTRY.US-CTZN-VRFN-IND = "Y";
      H2-PERSON-HSTRY.LST-GR-VRFD-IND = "Y";
      H2-PERSON-HSTRY.MRTL-STS-CD = "N";
      H2-PERSON-HSTRY.US-CTZN-VRFD-DT = "9999-12-31";
      H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT = "9999-12-31"; /* WI 69*/
      
      H2-PERSON-HSTRY.PUB-EMP-CHD = "N";
      H2-PERSON-HSTRY.PAST-HLTH-CVRG = "N";
        
      H2-PERSON-HSTRY.CVRG-END-DT = "9999-12-31";
      H2-PERSON-HSTRY.CVRG-END-RSN = " ";
        
      H2-PERSON-HSTRY.NCU-ENRL-DT = "9999-12-31";
      H2-PERSON-HSTRY.TAX-FILE-STS = " ";
      AIN49P9-INS-I02();

      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end

    VDBCOMMON.UNRF = "1";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end

 else
/* End WI 2445 MT - this is to update person history table to make changes when */  
/* only future month record is received from DCFS */   
  
  
  /* KEY SETTING PROCESS*/
  if (SR-Q-DCF-REC.D-MEMB-US-CITIZEN not blanks)
    H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;
    H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
    AIN49P9-READ-S15();
    VDBCOMMON.UDUP = "N";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    if (AIN49W5.WS-SQCOD == 0)
      if (H2-PERSON-HSTRY.PRD-BEG-DT == AIN49W.WS-FIRST-DATE)
  /* ** the previous image of twnperson_hstry is retreived from*/
  /* *** SQL AIN49A_S15 AND STORED.*/
        H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-PROCESS-DT;
        H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
        AIN49P9-REP-U05();
        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      else
  /* ** the period end date of the existing record is made closed*/
  /* ** AND A NEW RECORD WITH ALL DETAILS READ FROM THE INTERFACE*/
  /* ** FILE IS INSERTED.*/
        AIN49W.WS-PRD-END-DT = H2-PERSON-HSTRY.PRD-END-DT;
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-LAST-DATE();
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
        H2-PERSON-HSTRY.UPI = H2-3-CMH-FCE-PER.UPI;
        H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;
        AIN49P9-UPD-U26();

        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
        H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
        H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
        H2-PERSON-HSTRY.US-CTZN-VRFN-IND = "Y";
        H2-PERSON-HSTRY.LST-GR-VRFD-IND = "Y";
        H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-PRD-END-DT;
        H2-PERSON-HSTRY.US-CTZN-VRFD-DT = "9999-12-31";
        if (H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT == null) /* WI 69*/
          H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT = "9999-12-31";
        end
        H2-PERSON-HSTRY.PUB-EMP-CHD = "N";
        H2-PERSON-HSTRY.PAST-HLTH-CVRG = "N";
        
        if (H2-PERSON-HSTRY.CVRG-END-DT == null ||
        	H2-PERSON-HSTRY.CVRG-END-DT == " ")
          H2-PERSON-HSTRY.CVRG-END-DT = "9999-12-31";
        end  
        H2-PERSON-HSTRY.CVRG-END-RSN = " ";
        
        if (H2-PERSON-HSTRY.NCU-ENRL-DT == null ||
        	H2-PERSON-HSTRY.NCU-ENRL-DT == " ")
          H2-PERSON-HSTRY.NCU-ENRL-DT = "9999-12-31";
        end
        
        H2-PERSON-HSTRY.TAX-FILE-STS = " ";
        AIN49P9-INS-I02();

        VDBCOMMON.UDUP = "N";
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      end
    else

      H2-PERSON-HSTRY.PRD-BEG-DT = AIN49W.WS-FIRST-DATE;
      AIN49W.WS-TEMP-DATE = AIN49W.WS-FIRST-DATE;
      AIN49P9-LST-DATE();
      H2-PERSON-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
      H2-PERSON-HSTRY.US-CTZN-IND = SR-Q-DCF-REC.D-MEMB-US-CITIZEN;
      H2-PERSON-HSTRY.US-CTZN-VRFN-IND = "Y";
      H2-PERSON-HSTRY.LST-GR-VRFD-IND = "Y";
      H2-PERSON-HSTRY.MRTL-STS-CD = "N";
      H2-PERSON-HSTRY.US-CTZN-VRFD-DT = "9999-12-31";
      H2-PERSON-HSTRY.LST-GRADE-CMPLT-DT = "9999-12-31"; /* WI 69*/
      
      H2-PERSON-HSTRY.PUB-EMP-CHD = "N";
      H2-PERSON-HSTRY.PAST-HLTH-CVRG = "N";
        
      H2-PERSON-HSTRY.CVRG-END-DT = "9999-12-31";
      H2-PERSON-HSTRY.CVRG-END-RSN = " ";
        
      H2-PERSON-HSTRY.NCU-ENRL-DT = "9999-12-31";
      H2-PERSON-HSTRY.TAX-FILE-STS = " ";
      AIN49P9-INS-I02();

      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end

    VDBCOMMON.UNRF = "1";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end
/* Begin WI 2445 MT - this is to update person history table to make changes when */  
/* only future month record is received from DCFS */
 end
/* End WI 2445 MT - this is to update person history table to make changes when */  
/* only future month record is received from DCFS */


  H2-CASE-MEMBER-HST.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-CASE-MEMBER-HST.PRD-END-DT = "9999-12-31";
  H2-CASE-MEMBER-HST.UPI = H2-3-CMH-FCE-PER.UPI;
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-PROCESS-DT;
  /* -----------------------------------------------------------------------*/
  /* The case member history is unconditionally updated. This is because*/
  /* the memb left household has to be irrespective of the value that is*/
  /* received.*/
  /* -----------------------------------------------------------------------*/
  AIN49W.WS-UPDATE-CASE-MEM-HST = "Y";

  if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE not blanks)
  /* -----------------------------------------------------------------------*/
  /* the flags to create program case history, case member history and*/
  /* Elig versions are set to 'Y'. The Inserts/updates to the tables are*/
  /* done once all the changes are identified. The create Elig process is*/
  /* removed from here.*/
  /* -----------------------------------------------------------------------*/

    AIN49W.WS-UPDATE-CASE-MEM-HST = "Y";
    AIN49W.WS-UPDATE-PRGM-CASE-HSTRY = "Y";
    AIN49W.WS-CREATE-ELIG-VERSIONS = "Y";

  end

  if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " "
   || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " "
   || AIN49W3.RPT-ELIG-CD != " ")
    AIN49P9-CRE-CLOG();
  end

  if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9" || 
  AIN49W3.RPT-ELIG-CD == "9")

  /* ---------------------PTR 4625 BEGIN---------------------------*/
  /* when the left house hold date is entered, the elig code associated*/
  /* with the record would be '9'. The elig code change process would*/
  /* trigger the alert creation of elig versions and triggering the*/
  /* referal. The update of the case member history flag is set to 'Y'*/
  /* and the FAM action table is populated. All other code is removed*/
  /*  */
  /* -------------------PTR 4613 BEGIN-----------------------------*/
  /* The update of the left house hold date in case member history table*/
  /* is done when elig code '9' is sent. The setting of 'y' to*/
  /* WS-UPDATE-CASE-MEM-HST is deleted*/
  /* -----------------------------------------------------------------------*/

  /* ** if left-hh-date is given, the child is out of foster care*/
  /* ** and the case status needs to be terminated*/
  /* ***/
    set H2-FAM-ACTNS empty;
    AIN49W.WS-EFF-DT-CCYYMM-X = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-EFF-DT-CCYY = AIN49W.WS-EFF-DT-CCYY-X;
    AIN49W.WS-EFF-DT-MM = AIN49W.WS-EFF-DT-MM-X;
    AIN49W.WS-EFF-DT-DD = "01";
    AIN49W.WS-EFF-DT-DASH1 = "-";
    AIN49W.WS-EFF-DT-DASH2 = "-";
    H2-FAM-ACTNS.ACTN-TYP = "TR";
    H2-FAM-ACTNS.BNFT-MTH = AIN49W.WS-EFF-DT-MM-NUM;
    H2-FAM-ACTNS.BNFT-YR = AIN49W.WS-EFF-DT-CCYY-NUM;
    H2-FAM-ACTNS.ACTN-EFF-DT = AIN49W.WS-EFF-DT;
    H2-FAM-ACTNS.ICI = H2-3-CMH-FCE-PER.ICI;
    H2-FAM-ACTNS.PRGM-TYP = "CW";
    H2-FAM-ACTNS.AID-CD = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
    if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
      H2-FAM-ACTNS.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
    else
      H2-FAM-ACTNS.ELIG-CD = AIN49W3.RPT-ELIG-CD;
    end
    call "DATEAPP" (GDW, VDBCONTROL, VMESSAGE) {isNoRefresh = yes};
    H2-FAM-ACTNS.ACTN-TS = GDW.TS;
    H2-FAM-ACTNS.INIT-APRVL-DT = "9999-12-31";
    H2-FAM-ACTNS.APPL-DT = "9999-12-31";

    WDB00PI();

    AIN49P9-INS-I18();

    VDBCOMMON.UNRF = "Y";
    VDBCOMMON.UDUP = "N";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  end

  /* based on the flags, the case member history and prgm case history is*/
  /* split and the referral process triggered*/
  /* -----------------------------------------------------------------------*/
  /* If the update case member history is 'Y', the PROCESS-CASE-MEMBER*/
  /* -HISTORY is triggered instead of case member split. Similarily if the*/
  /* update prgm case hst flag is 'Y', the PROCESS-PROGRAM-CASE-HISTORY*/
  /* para is performed instead of Program-CASE-HISTROY-SPLIT. The referral*/
  /* process is triggered from the case member history process.*/
  /* -----------------------------------------------------------------------*/
  if (AIN49W.WS-UPDATE-CASE-MEM-HST == "Y")
    AIN49P9-PROC-CMH(); /* case member history*/
  end
  if (AIN49W.WS-UPDATE-PRGM-CASE-HSTRY == "Y")
    AIN49P9-PROC-PCH(); /* program case history*/
  end

  if (AIN49W.WS-CREATE-ELIG-VERSIONS == "Y")
    AIN49P9-CRT-ELIG();
  end

  if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " "
   || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " "
   || AIN49W3.RPT-ELIG-CD != " ")
    AIN49P9-PROC-FCH();
  end
  if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9" || 
  AIN49W3.RPT-ELIG-CD == "9")
    AIN49P9-CLS-REUNIF();
  end

  /*  */
end // end AIN49P9-MEMB-CHG


Function AIN49P9-NEW-REPORT()
  set SR-AIN49-RPT-REC empty;
  SR-AIN49-RPT-REC.RPT-JLC = AIN49W3.RPT-JLC;
  SR-AIN49-RPT-REC.RPT-REC-TYPE = AIN49W3.RPT-REC-TYPE;
  SR-AIN49-RPT-REC.RPT-LST-NM = AIN49W3.RPT-LST-NM;
  SR-AIN49-RPT-REC.RPT-FRST-NM = AIN49W3.RPT-FRST-NM;
  SR-AIN49-RPT-REC.RPT-SSN = AIN49W3.RPT-SSN;
  SR-AIN49-RPT-REC.RPT-SSN-VRFN-CODE = AIN49W3.RPT-SSN-VRFN-CODE;
  SR-AIN49-RPT-REC.RPT-DOB = AIN49W3.RPT-DOB;
  SR-AIN49-RPT-REC.RPT-BLNG-NMB = AIN49W3.RPT-BLNG-NMB;
  SR-AIN49-RPT-REC.RPT-DNL-CODE = AIN49W3.RPT-DNL-CODE;
  SR-AIN49-RPT-REC.RPT-TRM-CODE = AIN49W3.RPT-TRM-CODE;
  SR-AIN49-RPT-REC.RPT-AID-CD = AIN49W3.RPT-AID-CD;
  SR-AIN49-RPT-REC.RPT-ELIG-CD = AIN49W3.RPT-ELIG-CD;
  SR-AIN49-RPT-REC.RPT-BNFT-PERIOD = AIN49W3.RPT-BNFT-PERIOD;
  SR-AIN49-RPT-REC.RPT-PRIOR-MED-IND = AIN49W3.RPT-PRIOR-MED-IND;

  AIN49P9-WR-REP-REC();
  /*  */
end // end AIN49P9-NEW-REPORT


// PROCESS NEXT MNTH DETAILS
Function AIN49P9-NXT-MNTH()
  /* this process computes the next month given the current month(which*/
  /* MUST BE PASSED TO AIN49W.WS-TEMP-DATE*/
  /*  */
  AIN49W.WS-TEMP-MM-NUM = AIN49W.WS-TEMP-MM-NUM + 1;
  if (AIN49W.WS-TEMP-MM-NUM > 12)
    AIN49W.WS-TEMP-MM-NUM = 1;
    AIN49W.WS-TEMP-CCYY-NUM = AIN49W.WS-TEMP-CCYY-NUM + 1;
  end
  /* END NEXT MONTH*/
end // end AIN49P9-NXT-MNTH


// INSERT PRGM CASE HSTRY ( SQL )
Function AIN49P9-PCH-I12()
  VDBCONTROL.UPROC-NM = "AIN49P9-PCH-I12";
  VDBCONTROL.UPROC-OPT = "ADD";
  VDBCONTROL.UPROC-OBJ = "H2-PRGM-CASE-HSTRY";
  VDBCOMMON.USQLREC = "H2-PRGM-CASE-HSTRY";
  try
    add H2-PRGM-CASE-HSTRY
      with #sql{
        insert into TWNPRGM_CASE_HSTRY
        (ICI, PRGM_CASE_TYPE, PRD_BEG_DT, STS_EFF_DT, PRGM_CASE_STS,
             APPL_DT, PRGM_EFF_DT, PRD_END_DT, AID_CD,ELIG_CD,ADVR_ACTN_WVD_IND,
             TR_ADD_COVER_IND,INIT_APRVL_DT,ADVR_ACTN_WVD_DT,
             EXFS_DSCVR_DT,TR_STRT_DT,TR_EXPRN_DT,ACTUL_APLD_DT,
             RCRT_APL_DT,AID_CD_CHNG_DT, INIT_APPRVD_BY,
             ACTUL_STS_EFF_DT, OLD_APPL_DT, REAP_HIGH_AID_FG)
        values (:ICI, :PRGM-CASE-TYPE, :PRD-BEG-DT, :STS-EFF-DT, :PRGM-CASE-STS,
             :APPL-DT,:PRGM-EFF-DT, :PRD-END-DT, :AID-CD, :ELIG-CD,
             :ADVR-ACTN-WVD-IND, :TR-ADD-COVER-IND, :INIT-APRVL-DT,
             :ADVR-ACTN-WVD-DT, :EXFS-DSCVR-DT, :TR-STRT-DT, :TR-EXPRN-DT,
             :ACTUL-APLD-DT, :RCRT-APL-DT, :AID-CD-CHNG-DT, :INIT-APPRVD-BY,
             '0001-01-01', '0001-01-01', ' ')
      } ;
  end

  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "AIN49A";
end // end AIN49P9-PCH-I12


Function AIN49P9-PRC-REUNIF()
  if (SR-Q-DCF-REC.D-REUNIF-IND == "Y" && 
  SR-Q-DCF-REC.D-REUNIF-START-DATE == " " && 
  SR-Q-DCF-REC.D-REUNIF-STOP-DATE == " ")
    return;
  end
  if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
    H2-REUNIF-DATA.ICI = WS-IVA-ICI;
    H2-REUNIF-DATA.UPI = WS-IVA-UPI;
  else
    if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
      H2-REUNIF-DATA.UPI = AIN49W.WS-UPI;
      H2-REUNIF-DATA.ICI = AIN49W.WS-ICI;
    end
  end
  H2-REUNIF-DATA.PRD-BEG-DATE = AIN49W.WS-CURRENT-DATE;
  H2-REUNIF-DATA.PRD-END-DATE = AIN49W.WS-CURRENT-DATE;
  WDB00PI();
  AIN49P9-READ-S36();
  VDBCOMMON.UNRF = "Y";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC >= 104)
    WCM00P2-TO-CEP01A();
  end
  if (sysVar.sqlData.sqlcode == 0)

  /* WI - 21063 NEW ALERT IF THE REUNIF IND CHANGES AMONG 'N','Y','P';*/

    if (SR-Q-DCF-REC.D-REUNIF-IND != H2-REUNIF-DATA.REUNIF-IND)
      AIN49W.WS-ALERT-ICI = H2-REUNIF-DATA.ICI;
      PCALINP.PAL-CASE-ID = AIN49W.WS-ALERT-ICI;
      PCALINP.PAL-ALERT-ACTION = "C";
      PCALINP.PAL-DISPL-DT = AIN49W.WS-PROCESS-DT;
      PCALINP.PAL-ALERT-CD = 129045;
      call "CAL11A" (VDBCONTROL, VMESSAGE, PCALINP) {isNoRefresh = yes};
      AIN49W.WS-ALERT-IVD-ID = 129045;
      AIN49P9-ALRT-IVD();
    end

    AIN49P9-SPLT-REUNI();
  /* This change is to populate the reunification info in the database when*/
  /* it's transmitted first time in the update mode*/
  else
    if (sysVar.sqlData.sqlcode == 100)
      if (SR-Q-DCF-REC.D-RECORD-TYPE == "U")
        H2-REUNIF-DATA.ICI = WS-IVA-ICI;
        H2-REUNIF-DATA.UPI = WS-IVA-UPI;
      else
        if (SR-Q-DCF-REC.D-RECORD-TYPE == "N")
          H2-REUNIF-DATA.UPI = AIN49W.WS-UPI;
          H2-REUNIF-DATA.ICI = AIN49W.WS-ICI;
        end
      end
      AIN49P9-CRT-REUNIF();
    end
  end
  AIN49P9-CHK-TANF(); /* CHECK TANF CASE;*/
end // end AIN49P9-PRC-REUNIF


// PROC CURRENT CASE MEMBER HIST
Function AIN49P9-PROC-CCMH()
  /* ----------------------PTR 4613 BEGIN-----------------------------*/
  /*  */
  /* The referral process needs to be triggered when the aid code changes*/
  /* accross categories. the check is made for the current month and next*/
  /* month*/
  /*  */
  if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " " || 
  SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " " || 
  AIN49W3.RPT-ELIG-CD != " ")
    AIN49P9-CHK-REF();
  end
  set H2-CASE-MEMBER-HST empty;
  /*  */
  H2-CASE-MEMBER-HST.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-CASE-MEMBER-HST.UPI = H2-3-CMH-FCE-PER.UPI;
  H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-CASE-MEMBER-DATE;

  WDB00PI();
  AIN49P9-READ-S07();
  /*  */
  VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
  WDB00PE-SQLERR();
  /* Check for fatal errors*/
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 0) /* RECORD FOUND*/
  /*  */
    AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
    AIN49W.WS-TEMP-DD = "01";

    if (H2-CASE-MEMBER-HST.PRD-BEG-DT < AIN49W.WS-TEMP-DATE)
  /*  */
  /* The data retrieved from the SQL is stored in working storage variables*/
  /* 1. update the period end date of the record read.*/
  /* 2. Insert another record for the current month. All data retrieved*/
  /* from SQL S07 is used. The aid code and elig code is updated as*/
  /* received from the interface. The Prd Beg Date is the first date*/
  /* of the current month and the Prd End Date is the last date of the*/
  /* current month*/
  /* 3. A third record is inserted with the Period Begin Date as the next*/
  /* month's beg date and the Prd End Date as maximum date. All other*/
  /* details are inserted as per step two.*/
  /*  */
      AIN49W.WS-PRD-END-DT = H2-CASE-MEMBER-HST.PRD-END-DT;
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-LAST-DATE();
      H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-LAST-DATE;

      WDB00PI();
      AIN49P9-UPD-U06();
  /*  */
      VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /*  */
      if (AIN49W.WS-PRD-END-DT == "9999-12-31")
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49W.WS-TEMP-DD = "01";
        H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
        H2-CASE-MEMBER-HST.PRD-END-DT = "9999-12-31";

        if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " "
         || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " "
         || AIN49W3.RPT-ELIG-CD != " ")
          AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
          AIN49W5.WS-MEMB-MA-AID-CODE-2 = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
          H2-CASE-MEMBER-HST.IVE-AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2;
          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
            H2-CASE-MEMBER-HST.IVE-ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
          else
            H2-CASE-MEMBER-HST.IVE-ELIG-CD = AIN49W3.RPT-ELIG-CD;
          end
        end

  /* -------------------- PTR 9047 BEGIN ------------------------------*/
  /*  */
  /* IF SR-Q-DCF-REC.D-MEMB-MA-NBR ^= ' ';*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-MA-NBR TO*/
  /* AIN49W5.WS-MEDIC-NMB-CHA;*/
  /* MOVE AIN49W5.WS-MEDIC-NMB-NUM*/
  /* TO H2-CASE-MEMBER-HST.MEDIC-BLNG-SQ-NMB;*/
  /* END;*/
  /*  */
  /* -------------------- PTR 9047 END ----------------------------------*/

  /* ----------------------PTR 7975 BEGIN-----------------------*/
  /* CHANGES FOR WI 21138 - START;*/
  /* IF SR-Q-DCF-REC.D-MEMB-LEFT-HH-DATE = ' ';*/
  /* MOVE '9999-12-31' TO H2-CASE-MEMBER-HST.HH-LEFT-DT;*/
  /* ELSE;*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-LEFT-HH-DATE TO*/
  /* AIN49W.WS-MMDDCCYY-DATE;*/
  /* MOVE AIN49W.WS-MMDDCCYY-MM TO AIN49W.WS-TEMP-MM;*/
  /* MOVE AIN49W.WS-MMDDCCYY-DD TO AIN49W.WS-TEMP-DD;*/
  /* MOVE AIN49W.WS-MMDDCCYY-CC TO AIN49W.WS-TEMP-CC;*/
  /* MOVE AIN49W.WS-MMDDCCYY-YY TO AIN49W.WS-TEMP-YY;*/
  /* MOVE AIN49W.WS-TEMP-DATE TO*/
  /* H2-CASE-MEMBER-HST.HH-LEFT-DT;*/
  /* END;*/
  /* CHANGES FOR WI 21138 - END;*/
  /* ----------------------PTR 7975 END-------------------------*/

        WDB00PI();
        AIN49P9-INS-I04();
  /*  */
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
  /*  */
  /* A record for the next month is inserted*/
      else
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49W.WS-TEMP-DD = "01";
        H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
        H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-PRD-END-DT;
        if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " "
         || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " "
         || AIN49W3.RPT-ELIG-CD != " ")
          AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
          AIN49W5.WS-MEMB-MA-AID-CODE-2 = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
          H2-CASE-MEMBER-HST.IVE-AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2;
          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
            H2-CASE-MEMBER-HST.IVE-ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
          else
            H2-CASE-MEMBER-HST.IVE-ELIG-CD = AIN49W3.RPT-ELIG-CD;
          end
        end
        WDB00PI();
        AIN49P9-INS-I04();
        AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
        AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
        AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
        AIN49W.WS-DD = "01";
        AIN49W.WS-FIL1 = "-";
        AIN49W.WS-FIL2 = "-";
        H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-DATE;
        WDB00PI();
        AIN49P9-UPD-U32();
        WDB00PE-SQLERR();
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      end
    else
      if (SR-Q-DCF-REC.D-MEMB-MA-AID-CODE != " "
       || SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE != " "
       || AIN49W3.RPT-ELIG-CD != " ")
        AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
        AIN49W5.WS-MEMB-MA-AID-CODE-2 = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
        H2-CASE-MEMBER-HST.IVE-AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2;
        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
          H2-CASE-MEMBER-HST.IVE-ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
        else
          H2-CASE-MEMBER-HST.IVE-ELIG-CD = AIN49W3.RPT-ELIG-CD;
        end
      end
  /* ** Changes due to PTR 9047 *** Begin ****/
  /* IF SR-Q-DCF-REC.D-MEMB-MA-NBR ^= ' ';*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-MA-NBR TO*/
  /* AIN49W5.WS-MEDIC-NMB-CHA;*/
  /* MOVE AIN49W5.WS-MEDIC-NMB-NUM*/
  /* TO H2-CASE-MEMBER-HST.MEDIC-BLNG-SQ-NMB;*/
  /* END;*/
  /* ** Changes due to PTR 9047 End ****/
  /* ------------------------PTR 7975 BEGIN----------------------------*/
  /* CHANGES FOR WI 21138 - START;*/
  /* IF SR-Q-DCF-REC.D-MEMB-LEFT-HH-DATE = ' ';*/
  /* MOVE '9999-12-31' TO H2-CASE-MEMBER-HST.HH-LEFT-DT;*/
  /* ELSE;*/
  /* MOVE SR-Q-DCF-REC.D-MEMB-LEFT-HH-DATE TO*/
  /* AIN49W.WS-MMDDCCYY-DATE;*/
  /* MOVE AIN49W.WS-MMDDCCYY-MM TO AIN49W.WS-TEMP-MM;*/
  /* MOVE AIN49W.WS-MMDDCCYY-DD TO AIN49W.WS-TEMP-DD;*/
  /* MOVE AIN49W.WS-MMDDCCYY-CC TO AIN49W.WS-TEMP-CC;*/
  /* MOVE AIN49W.WS-MMDDCCYY-YY TO AIN49W.WS-TEMP-YY;*/
  /* MOVE AIN49W.WS-TEMP-DATE TO*/
  /* H2-CASE-MEMBER-HST.HH-LEFT-DT;*/
  /* END;*/
  /* CHANGES FOR WI 21138 - END;*/
  /* ------------------------PTR 7975 END------------------------------*/
      AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
      AIN49W.WS-MM = AIN49W.WS-YYMM-MM;
      AIN49W.WS-YY = AIN49W.WS-YYMM-YY;
      AIN49W.WS-DD = "01";
      AIN49W.WS-FIL1 = "-";
      AIN49W.WS-FIL2 = "-";
      H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-DATE;
      WDB00PI();
      AIN49P9-UPD-U32();
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
    end
  else

    H2-CASE-MEMBER-HST.UPI = H2-3-CMH-FCE-PER.UPI;
    H2-CASE-MEMBER-HST.ICI = H2-3-CMH-FCE-PER.ICI;

    AIN49W5.WS-DATE1 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-MM = AIN49W5.WS-MM2;
    AIN49W.WS-YY = AIN49W5.WS-YY2;
    AIN49W.WS-DD = "01";
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
    H2-CASE-MEMBER-HST.PRD-BEG-DT = AIN49W.WS-DATE;

    AIN49W.WS-TEMP-DATE = AIN49W.WS-DATE;
    AIN49P9-LST-DATE();
    H2-CASE-MEMBER-HST.PRD-END-DT = AIN49W.WS-LAST-DATE;

    H2-CASE-MEMBER-HST.FS-ASST-IND = "N";

    H2-CASE-MEMBER-HST.TC-ASST-IND = "N"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TL-ASST-IND = "N"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TN-ASST-IND = "N"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TP-ASST-IND = "N"; /* WI 28413*/

    H2-CASE-MEMBER-HST.AFDC-ASST-IND = "N";
    H2-CASE-MEMBER-HST.MA-ASST-IND = "N";
    AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
    AIN49W5.WS-MEMB-MA-AID-CODE-2 = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
    H2-CASE-MEMBER-HST.IVE-AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2;
    if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
      H2-CASE-MEMBER-HST.IVE-ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
    else
      H2-CASE-MEMBER-HST.IVE-ELIG-CD = AIN49W3.RPT-ELIG-CD;
    end
    H2-CASE-MEMBER-HST.MA-30-1-3-D1-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MA-30-BEG-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-30-BEG-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.FS-QUIT-SANC-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.HH-LEFT-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.JOIN-RPRTD-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.JOIN-HH-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-30-1-3-D1-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-30-1-3-D2-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-30-1-3-D3-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-30-1-3-D4-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MA-30-1-3-D1-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MA-30-1-3-D2-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MA-30-1-3-D3-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MA-30-1-3-D4-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDC-BEG-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.FS-BEG-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.AFDCAID-CD-CHNG-DT = "9999-12-31";
    H2-CASE-MEMBER-HST.MAAID-CD-CHNG-DT = "9999-12-31";

    H2-CASE-MEMBER-HST.TC-BEG-DT = "9999-12-31"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TL-BEG-DT = "9999-12-31"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TN-BEG-DT = "9999-12-31"; /* WI 28413*/
    H2-CASE-MEMBER-HST.TP-BEG-DT = "9999-12-31"; /* WI 28413*/

    AIN49P9-CMH-I04();
    VDBCOMMON.UNRF = "N";
    VDBCOMMON.UDUP = "Y";

    WDB00PE-SQLERR();

    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end
  /*  */
  /* The referral process is triggered for the next month and current*/
  /* month based on the value of flags*/
  /*  */
  if (AIN49W.WS-TRIGGER-NEXT-MTH-REF == "Y")
    AIN49W.WS-TEMP-DATE = AIN49W.WS-CASE-MEMBER-DATE;
    AIN49P9-NXT-MNTH();
    AIN49W.WS-TEMP-DD = "01";
    AIN49W.WS-REFERAL-DATE = AIN49W.WS-TEMP-DATE;
    AIN49P9-REF-PRCS();
  end

  if (AIN49W.WS-TRIGGER-CURRENT-MTH-REF == "Y")
    AIN49W.WS-REFERAL-DATE = AIN49W.WS-CASE-MEMBER-DATE;
    AIN49P9-REF-PRCS();
  end
  /* ----------------------PTR 4613 END------------------------------*/
end // end AIN49P9-PROC-CCMH


// PROCESS CURRENT FAM CASE HST
Function AIN49P9-PROC-CFCH()
  H2-FAM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-FAM-CASE-HSTRY-DATE;

  WDB00PI();
  AIN49P9-READ-S24();
  /*  */
  VDBCOMMON.UDUP = "N";
  WDB00PE-SQLERR();
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  if (sysVar.sqlData.sqlcode == 0) /* RECORD FOUND*/
  /* ---------------------PTR 8170 - 39 BEGIN ----------------------------*/
    if (H2-FAM-CASE-HSTRY.PRD-BEG-DT < AIN49W.WS-FIRST-DATE)

  /*  */
  /* The data retrieved from the SQL is stored in working storage variables*/
  /* 1. update the period end date of the record read.*/
  /* 2. Insert another record for the current month. All data retrieved*/
  /* from SQL S24 is used. case status is calculated.*/
  /* The Prd Beg Date is the first date*/
  /* of the current month and the Prd End Date is the last date of the*/
  /* current month*/
  /* 3. A third record is inserted with the Period Begin Date as the next*/
  /* month's beg date and the Prd End Date as maximum date. All other*/
  /* details are inserted as per step two.*/
  /*  */
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-LAST-DATE();
      H2-FAM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
  /* --------------------------PTR 8170 - 12 BEGIN------------------*/
      WDB00PI();
      AIN49P9-UPD-U19();
  /* --------------------------PTR 8170 - 12 END--------------------*/
      VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /*  */
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49W.WS-TEMP-DD = "01";
      H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
      AIN49P9-LST-DATE();
      H2-FAM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;

      AIN49W5.WS-DATE1 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
      AIN49W.WS-MM = AIN49W5.WS-MM2;
      AIN49W.WS-YY = AIN49W5.WS-YY2;
      AIN49W.WS-DD = "01";
      AIN49W.WS-FIL1 = "-";
      AIN49W.WS-FIL2 = "-";
      H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-DATE;
      AIN49P9-GET-CASSTS();
      H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;

      WDB00PI();
      AIN49P9-INS-I19();
  /*  */
      VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /*  */
  /* A record for the next month is inserted*/

      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-NXT-MNTH();
      AIN49W.WS-TEMP-DD = "01";

      H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
      WDB00PI();
      AIN49P9-READ-S24();
  /*  */
      VDBCOMMON.UDUP = "N";
      WDB00PE-SQLERR();
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
      if (sysVar.sqlData.sqlcode == 0)
        H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-TEMP-DATE;
        AIN49P9-GET-CASSTS();
        H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;
        WDB00PI();
        AIN49P9-UPD-U34();
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end

      else
        if (sysVar.sqlData.sqlcode == 100)
          H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
          H2-FAM-CASE-HSTRY.PRD-END-DT = "9999-12-31";

          H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-TEMP-DATE;
          AIN49P9-GET-CASSTS();
          H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;

          WDB00PI();
          AIN49P9-INS-I19();
  /*  */
          VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
          WDB00PE-SQLERR();
  /* Check for fatal errors*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        end
      end
    else
      if (H2-FAM-CASE-HSTRY.PRD-BEG-DT == AIN49W.WS-FIRST-DATE)
        AIN49W5.WS-DATE1 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
        AIN49W.WS-MM = AIN49W5.WS-MM2;
        AIN49W.WS-YY = AIN49W5.WS-YY2;
        AIN49W.WS-DD = "01";
        AIN49W.WS-FIL1 = "-";
        AIN49W.WS-FIL2 = "-";
        H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-DATE;
        AIN49P9-GET-CASSTS();
        H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;

        WDB00PI();
        AIN49P9-UPD-U34();
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end

        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-LST-DATE();
        H2-FAM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
  /* ------------------------------PTR 8170 - 12-BEGIN---------------*/
        WDB00PI();
        AIN49P9-UPD-U19();
  /* ----------------------------PTR 8170 - 12 END--------------------*/
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
  /*  */
  /* -------------------------PTR 8170 - 39 BEGIN----------------------*/
        H2-FAM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-NXT-MNTH();
        AIN49W.WS-TEMP-DD = "01";
        H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;

        WDB00PI();
        AIN49P9-READ-S24();
        VDBCOMMON.UNRF = "Y";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end

        if (sysVar.sqlData.sqlcode == 0)

          H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-TEMP-DATE;
          AIN49P9-GET-CASSTS();
          H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;

          WDB00PI();
          AIN49P9-UPD-U34();
          VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
          WDB00PE-SQLERR();
  /* Check for fatal errors*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        else
          AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
          AIN49P9-NXT-MNTH();
          AIN49W.WS-TEMP-DD = "01";
          H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
          H2-FAM-CASE-HSTRY.PRD-END-DT = "9999-12-31";
          H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-TEMP-DATE;
          AIN49P9-GET-CASSTS();
          H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;

          WDB00PI();
          AIN49P9-INS-I19();
  /*  */
          VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
          WDB00PE-SQLERR();
  /* Check for fatal errors*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        end
      end
    end
  else
    set H2-FAM-CASE-HSTRY empty;
    H2-FAM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
    AIN49W5.WS-DATE1 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-MM = AIN49W5.WS-MM2;
    AIN49W.WS-YY = AIN49W5.WS-YY2;
    AIN49W.WS-DD = "01";
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
    H2-FAM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-DATE;
    AIN49W.WS-TEMP-DATE = AIN49W.WS-DATE;
    AIN49P9-LST-DATE();
    H2-FAM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
    H2-FAM-CASE-HSTRY.HOH-UPI-CHNG-DT = "9999-12-31";
    H2-FAM-CASE-HSTRY.VERF-DUE-DT = "9999-12-31";
    H2-FAM-CASE-HSTRY.MTHLY-RPTR-IND = "N";
    H2-FAM-CASE-HSTRY.AUTO-POST-IND = "Y";
    AIN49W5.WS-DATE1 = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
    AIN49W.WS-MM = AIN49W5.WS-MM2;
    AIN49W.WS-YY = AIN49W5.WS-YY2;
    AIN49W.WS-DD = "01";
    AIN49W.WS-FIL1 = "-";
    AIN49W.WS-FIL2 = "-";
    H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-DATE;
    AIN49P9-GET-CASSTS();
    H2-FAM-CASE-HSTRY.CASE-STS = AIN49W.WS-CAL-CASE-STS;
    H2-FAM-CASE-HSTRY.APPL-UPI = H2-3-CMH-FCE-PER.UPI;
    H2-FAM-CASE-HSTRY.HOH-UPI = H2-3-CMH-FCE-PER.UPI;
    H2-FAM-CASE-HSTRY.DCFS-OFC-CNTY-CD = SR-Q-DCF-REC.D-ADDR-RESIDENT-COUNTY;

    WDB00PI();
    AIN49P9-INS-I08();
    VDBCOMMON.UDUP = "Y";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end

  end
  /* ----------------------PTR 4613 END------------------------------*/
end // end AIN49P9-PROC-CFCH


// PROCESS CASE MEMBER HISTORY
Function AIN49P9-PROC-CMH()
  /* ---------------------PTR 4613 BEGIN-----------------------------*/
  /*  */
  /* The aid code and elig code is made effective based on the following*/
  /* algorithm:*/
  /* 1. If the benefit month is a retro month, the aid code and elig code*/
  /* is effective for the retro month, the current month and current*/
  /* month + 1*/
  /* 2. If the benefit month is the future month, the aid code and elig*/
  /* code is effective for the current month and future month. The*/
  /* future month can never be greater than current month + 1*/
  /* 3. If the benefit month is the current month, the aid code and elig*/
  /* code is true for the current month and next month.*/
  /*  */
  /* the case member history and program case history is accordingly split.*/
  AIN49W.WS-YYMM-DATE = SR-Q-DCF-REC.D-BENEFIT-START-MONTH;
  /* MOVE AIN49W.WS-YYMM-YY TO AIN49W.WS-YYMM1-YY;*/
  AIN49W.WS-YYMM1-CCYY = AIN49W.WS-YYMM-YY;
  AIN49W.WS-YYMM1-MM = AIN49W.WS-YYMM-MM;
  /* IF AIN49W.WS-YYMM-YY > '90';*/
  /* MOVE '19' TO AIN49W.WS-YYMM1-CC;*/
  /* ELSE;*/
  /* MOVE '20' TO AIN49W.WS-YYMM1-CC;*/
  /* END;*/
  AIN49W.WS-YYMM1-FIL = "-";

  AIN49W.WS-TEMP-SEP1 = "-";
  AIN49W.WS-TEMP-SEP2 = "-";

  AIN49W.WS-YYMM2-DATE = AIN49W.WS-PROCESS-DT;


  if (AIN49W.WS-YYMM1-DATE < AIN49W.WS-YYMM2-DATE)
    AIN49P9-PROC-RCM();
  /* MOVE AIN49W.WS-PROCESS-DT TO AIN49W.WS-CASE-MEMBER-DATE;*/
  /* PERFORM AIN49P9-PROC-CCMH;*/
  end

/* Begin WI 2445 mt - check for only future date from DCFS */
  if (AIN49W.WS-YYMM1-DATE > AIN49W.WS-YYMM2-DATE)
    AIN49W.WS-CASE-MEMBER-DATE = AIN49W.WS-DATE_FUTURE;
    AIN49P9-PROC-FCMH();
  end
/* End WI 2445 mt - check for only future date from DCFS */

  if (AIN49W.WS-YYMM1-DATE == AIN49W.WS-YYMM2-DATE) /*wi2445 mt ?removed > */
    AIN49W.WS-CASE-MEMBER-DATE = AIN49W.WS-PROCESS-DT;
    AIN49P9-PROC-CCMH();
  end

  /* -----------------------PTR 4613 END--------------------------------*/
end // end AIN49P9-PROC-CMH




// PROCESS CURRENT PROG CASE HST
Function AIN49P9-PROC-CPCH()
  /* ----------------------PTR 4613 BEGIN-----------------------------*/
  /*  */
  /*  */
  H2-PRGM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
  H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-PROGRAM-CASE-DATE;
  H2-PRGM-CASE-HSTRY.PRGM-CASE-TYPE = "CW";

  WDB00PI();
  AIN49P9-READ-S03();
  /*  */
  VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
  WDB00PE-SQLERR();
  /* Check for fatal errors*/
  if (VDBCONTROL.URC > 104)
    WCM00P2-TO-CEP01A();
  end
  /*  */
  if (sysVar.sqlData.sqlcode == 0) /* RECORD FOUND*/
  /* ---------------------PTR 8170 - 39 BEGIN ----------------------------*/
    if (H2-PRGM-CASE-HSTRY.PRD-BEG-DT < AIN49W.WS-FIRST-DATE)

  /*  */
  /* The data retrieved from the SQL is stored in working storage variables*/
  /* 1. update the period end date of the record read.*/
  /* 2. Insert another record for the current month. All data retrieved*/
  /* from SQL S07 is used. The aid code and elig code is updated as*/
  /* received from the interface. The Prd Beg Date is the first date*/
  /* of the current month and the Prd End Date is the last date of the*/
  /* current month*/
  /* 3. A third record is inserted with the Period Begin Date as the next*/
  /* month's beg date and the Prd End Date as maximum date. All other*/
  /* details are inserted as per step two.*/
  /*  */
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-LAST-DATE();
      H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
  /* --------------------------PTR 8170 - 12 BEGIN------------------*/
      WDB00PI();
      AIN49P9-UPD-U23();
  /* --------------------------PTR 8170 - 12 END--------------------*/
      VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /*  */
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49W.WS-TEMP-DD = "01";
      H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
      AIN49P9-LST-DATE();
      H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;

      AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
      H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
      if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
        H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
      else
        H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
      end
      if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
        if (AIN49W3.RPT-ELIG-CD == "9")
          H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
        else
          H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
        end
      else
        if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
          H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
        else
          H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
        end
      end
      WDB00PI();
      AIN49P9-INS-I12();
  /*  */
      VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end
  /*  */
  /* A record for the next month is inserted if not exists*/
  /*  */
      H2-PRGM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
      AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
      AIN49P9-NXT-MNTH();
      AIN49W.WS-TEMP-DD = "01";
      H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;

      WDB00PI();
      AIN49P9-READ-S03();
      VDBCOMMON.UNRF = "Y";
  /* Perform the process for sql error processing*/
      WDB00PE-SQLERR();
  /* Check for fatal errors*/
      if (VDBCONTROL.URC > 104)
        WCM00P2-TO-CEP01A();
      end

      if (sysVar.sqlData.sqlcode == 0)
        AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
        H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
          H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
        else
          H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
        end

        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
          if (AIN49W3.RPT-ELIG-CD == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        else
          if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        end

        WDB00PI();
        AIN49P9-UPD-U07();
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      else

        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-NXT-MNTH();
        AIN49W.WS-TEMP-DD = "01";
        H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
        H2-PRGM-CASE-HSTRY.PRD-END-DT = "9999-12-31";
        AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
        H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
          H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
        else
          H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
        end

        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
          if (AIN49W3.RPT-ELIG-CD == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        else
          if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        end
        WDB00PI();
        AIN49P9-INS-I12();
  /*  */
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
      end
  /*  */
    else
      if (H2-PRGM-CASE-HSTRY.PRD-BEG-DT == AIN49W.WS-FIRST-DATE)
        AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
        H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
          H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
        else
          H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
        end
  /*  */
        if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
          if (AIN49W3.RPT-ELIG-CD == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        else
          if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
          else
            H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
          end
        end
        WDB00PI();
        AIN49P9-UPD-U07();
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end

        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-LST-DATE();
        H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;
  /* ------------------------------PTR 8170 - 12-BEGIN---------------*/
        WDB00PI();
        AIN49P9-UPD-U23();
  /* ----------------------------PTR 8170 - 12 END--------------------*/
        VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end
  /*  */
  /* -------------------------PTR 8170 - 39 BEGIN----------------------*/
        H2-PRGM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
        AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
        AIN49P9-NXT-MNTH();
        AIN49W.WS-TEMP-DD = "01";
        H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;

        WDB00PI();
        AIN49P9-READ-S03();
        VDBCOMMON.UNRF = "Y";
  /* Perform the process for sql error processing*/
        WDB00PE-SQLERR();
  /* Check for fatal errors*/
        if (VDBCONTROL.URC > 104)
          WCM00P2-TO-CEP01A();
        end

        if (sysVar.sqlData.sqlcode == 0)
          AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
          H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
            H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
          else
            H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
          end

          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
            if (AIN49W3.RPT-ELIG-CD == "9")
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
            else
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
            end
          else
            if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
            else
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
            end
          end

          WDB00PI();
          AIN49P9-UPD-U07();
          VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
          WDB00PE-SQLERR();
  /* Check for fatal errors*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        else

          AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
          AIN49P9-NXT-MNTH();
          AIN49W.WS-TEMP-DD = "01";
          H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
          H2-PRGM-CASE-HSTRY.PRD-END-DT = "9999-12-31";
          AIN49W5.WS-MEMB-MA-AID-CODE = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
          H2-PRGM-CASE-HSTRY.AID-CD = AIN49W5.WS-MEMB-MA-AID-CODE-2DIGITS;
          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
            H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
          else
            H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
          end
          if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
            if (AIN49W3.RPT-ELIG-CD == "9")
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
            else
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
            end
          else
            if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
            else
              H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
            end
          end

          WDB00PI();
          AIN49P9-INS-I12();
  /*  */
          VDBCOMMON.UDUP = "N";
  /* Perform the process for sql error processing*/
          WDB00PE-SQLERR();
  /* Check for fatal errors*/
          if (VDBCONTROL.URC > 104)
            WCM00P2-TO-CEP01A();
          end
        end
      end
    end
  else
    set H2-PRGM-CASE-HSTRY empty;
    H2-PRGM-CASE-HSTRY.ICI = H2-3-CMH-FCE-PER.ICI;
    H2-PRGM-CASE-HSTRY.PRGM-CASE-TYPE = "CW";
    AIN49W.WS-DATE = AIN49W.WS-FIRST-DATE;
  /* MOVE SR-Q-DCF-REC.D-BENEFIT-START-MONTH TO AIN49W5.WS-DATE1;*/
  /* MOVE AIN49W5.WS-MM2 TO AIN49W.WS-MM;*/
  /* MOVE AIN49W5.WS-YY2 TO AIN49W.WS-YY;*/
  /* MOVE '01' TO AIN49W.WS-DD;*/
  /* MOVE '-' TO AIN49W.WS-FIL1;*/
  /* MOVE '-' TO AIN49W.WS-FIL2;*/
    H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-DATE;

    H2-PRGM-CASE-HSTRY.PRGM-EFF-DT = AIN49W.WS-DATE;
    H2-PRGM-CASE-HSTRY.STS-EFF-DT = AIN49W.WS-DATE;
    H2-PRGM-CASE-HSTRY.PRGM-EFF-DT = AIN49W.WS-DATE;
    H2-PRGM-CASE-HSTRY.INIT-APRVL-DT = AIN49W.WS-DATE;
    AIN49W.WS-TEMP-DATE = AIN49W.WS-DATE;
    AIN49P9-LST-DATE();
    H2-PRGM-CASE-HSTRY.PRD-END-DT = AIN49W.WS-LAST-DATE;

    H2-PRGM-CASE-HSTRY.INIT-APPRVD-BY = "DCFS";
    H2-PRGM-CASE-HSTRY.ACTUL-APLD-DT = "9999-12-31";
    if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == "Y")
      if (AIN49W3.RPT-ELIG-CD == "9")
        H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
      else
        H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
      end
    else
      if (SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE == "9")
        H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "T";
      else
        H2-PRGM-CASE-HSTRY.PRGM-CASE-STS = "O";
      end
    end
  /* MOVE 'O' TO H2-PRGM-CASE-HSTRY.PRGM-CASE-STS;*/
    H2-PRGM-CASE-HSTRY.AID-CD = SR-Q-DCF-REC.D-MEMB-MA-AID-CODE;
    if (SR-Q-DCF-REC.D-NEW-LAYOUT-FLAG == " ")
      H2-PRGM-CASE-HSTRY.ELIG-CD = SR-Q-DCF-REC.D-MEMB-MA-ELIG-CODE;
    else
      H2-PRGM-CASE-HSTRY.ELIG-CD = AIN49W3.RPT-ELIG-CD;
    end
    if (SR-Q-DCF-REC.D-APPL-MA-APPLICATION-DATE != " ")
      AIN49W5.WS-DATE3 = SR-Q-DCF-REC.D-APPL-MA-APPLICATION-DATE;
      AIN49W.WS-MM = AIN49W5.WS-MM3;
      AIN49W.WS-YY-CC2 = AIN49W5.WS-YY3;
      AIN49W.WS-DD = AIN49W5.WS-DD3;
      if (AIN49W.WS-YY-CC2 > "90")
        AIN49W.WS-YY-CC1 = "19";
      else
        AIN49W.WS-YY-CC1 = "20";
      end
      AIN49W.WS-FIL1 = "-";
      AIN49W.WS-FIL2 = "-";
      H2-PRGM-CASE-HSTRY.APPL-DT = AIN49W.WS-DATE;
    else
      H2-PRGM-CASE-HSTRY.APPL-DT = "0001-01-01";
    end
    H2-PRGM-CASE-HSTRY.INIT-APRVL-TM = "00.00.00";
    H2-PRGM-CASE-HSTRY.INIT-APRVL-DT = "0001-01-01";
    H2-PRGM-CASE-HSTRY.ADVR-ACTN-WVD-DT = "9999-12-31";
    H2-PRGM-CASE-HSTRY.EXFS-DSCVR-DT = "9999-12-31";
    H2-PRGM-CASE-HSTRY.RCRT-APL-DT = "9999-12-31";
    H2-PRGM-CASE-HSTRY.AID-CD-CHNG-DT = "9999-12-31";
    H2-PRGM-CASE-HSTRY.TR-STRT-DT = "9999-12-31";
    H2-PRGM-CASE-HSTRY.TR-EXPRN-DT = "9999-12-31";
    WDB00PI();
    AIN49P9-PCH-I12();
    VDBCOMMON.UDUP = "Y";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
    AIN49W.WS-TEMP-DATE = AIN49W.WS-PROCESS-DT;
    AIN49P9-NXT-MNTH();
    AIN49W.WS-TEMP-DD = "01";
    H2-PRGM-CASE-HSTRY.PRD-BEG-DT = AIN49W.WS-TEMP-DATE;
    WDB00PI();
    AIN49P9-UPD-U07();
    VDBCOMMON.UDUP = "N";
    WDB00PE-SQLERR();
    if (VDBCONTROL.URC > 104)
      WCM00P2-TO-CEP01A();
    end
  end
  /* ----------------------PTR 4613 END------------------------------*/
end // end AIN49P9-PROC-CPCH