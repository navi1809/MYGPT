package PGM_T_Batch;
import egl.core.*;
import CommonMigratedParts.*;
import DataTables.*;
//*** PROGRAM=TCONIDA ****
// COMPONENT NAME: TCONIDA - THIS IS A DB LAYER APPLICATION
// ===============
// 
// DESCRIPTION:
// ============
// THIS IS A DB LAYER APPLICATION WITH THE FOLLOWING DB2
// ACCESSES:
// 
// SQL COMMAND   TABLE NAME
// ===========   ==========
// INSERT        TWNIVD_CONTACTS
// 
// 
// ************************
Program TCONIDA type basicProgram //VAGen Info - called batch program
  (
   VDBCONTROL VDBCONTROL, // record
   VMESSAGE VMESSAGE, // record
   H-TCONID H-TCONID // record
  )
  {
  includeReferencedFunctions = yes, allowUnqualifiedItemReferences = yes, 
  throwNrfEofExceptions = yes, handleHardIOErrors = no, V60ExceptionCompatibility = yes, 
  I4GLItemsNullable = no, textLiteralDefaultIsString = no, localSQLScope = yes
  }

  // Data Declarations
  GDW GDW; // record
  H2-2-DCC-SPT H2-2-DCC-SPT; // record
  H2-IVD-CONTACTS H2-IVD-CONTACTS; // record
  VDBCOMMON VDBCOMMON; // record

  // VAGen Info - items needed for migration
  VAGen_EZESYS char(8);
  VAGen_EZEREPLY num(1);
  VAGen_EZE_WAIT_TIME bin(9,2);
  VAGen_EZE_ITEMLEN int;

  // Use Declarations
  use VDB00T1 {deleteAfterUse = yes}; // table

  function main()
    // VAGen Info - initialization needed for migration
    VAGen_EZESYS = VGLib.getVAGSysType();
    TCONIDL1: TCONIDL1();
  end // end main
end // end TCONIDA


// LUW for DB Access
Function TCONIDL1()
  /* -----------------------------------------------------------*/
  /* Change History*/
  /* ==============*/
  /* DATE        NAME        DESCRIPTION*/
  /* ----        -----       ----------*/
  /* 28 Dec 1994   TBST155      CREATION*/
  /* -----------------------------------------------------------*/
  /* CBSI START*/
  /*  */
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  /* Initialize:*/
  VDBCONTROL.UACCTYP = "W";
  VDBCOMMON.UAPPLNAM = "TCONIDA";
  /*  */
  /* Initialize application-specific working storage records*/
  set H2-IVD-CONTACTS empty;
  /*  */
  /* Perform process to retrieve data*/
  TCONIDP1();
  /*  */
  /* Set error control flags*/
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "Y";
  /*  */
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
  /* CBSI END*/
end // end TCONIDL1


// Control Retrieve of Data
Function TCONIDP1()
  /* -----------------------------------------------------------*/
  /* Change History*/
  /* ==============*/
  /* DATE        NAME        DESCRIPTION*/
  /* ----        -----       ----------*/
  /* 28 Dec 1994   TBST155      CREATION*/
  /* -----------------------------------------------------------*/
  /* CBSI START*/
  /*  */
  /* Move retrieve key value to SQL row record*/
  if (H-TCONID.CASE-SUFX == " ")
    H-TCONID.CASE-SUFX = "A";
  end
  /*  */
  /* ********* ptr 10361 start ***********/
  H2-2-DCC-SPT.UPI = H-TCONID.UPI;
  H2-2-DCC-SPT.CASE-SUFX = H-TCONID.CASE-SUFX;
  TCONIDP2();
  H-TCONID.WRKR-ID = H2-2-DCC-SPT.NOMADS-USRID;
  /* ********* ptr 10361 end ***********/
  /*  */
  H2-IVD-CONTACTS.UPI = H-TCONID.UPI;
  H2-IVD-CONTACTS.CASE-SUFX = H-TCONID.CASE-SUFX;
  H2-IVD-CONTACTS.CNTCT-TYPE = H-TCONID.CNTCT-TYPE;
  /* *****************START PTR#11710*******************************/
  /* MOVE H-TCONID.CASE-FUNC-AREA TO H2-IVD-CONTACTS.CASE-FUNC-AREA;*/
  H2-IVD-CONTACTS.CASE-FUNC-AREA = " ";
  /* *****************END   PTR#11710*******************************/
  H2-IVD-CONTACTS.CNTCT-SRC = H-TCONID.CNTCT-SRC;
  H2-IVD-CONTACTS.CASE-SPCFC-IND = H-TCONID.CASE-SPCFC-IND;
  H2-IVD-CONTACTS.CNTCT-TXT = H-TCONID.CNTCT-TXT;
  H2-IVD-CONTACTS.WRKR-ID = H-TCONID.WRKR-ID;
  H2-IVD-CONTACTS.CRTD-TS = H-TCONID.CRTD-TS;
  /*  */
  /* Perform process to retrieve data*/
  TCONIDQ1();
  /* CBSI END*/
end // end TCONIDP1


// READ  H2-2-DCC-SPT
Function TCONIDP2()
  /* Perform standard database application initialization*/
  WDB00PI();
  /*  */
  /* Initialize:*/
  /* UACCTYP - Access type (R=read, W=write)*/
  /* UAPPLNAM - Application name*/
  VDBCONTROL.UACCTYP = "R";
  VDBCOMMON.UAPPLNAM = "TCONIDA";
  VDBCOMMON.USQLREC = "H2-2-DCC-SPT";
  VDBCONTROL.UPROC-OBJ = "H2-2-DCC-SPT";
  VDBCONTROL.UPROC-NM = "TCONIDP2";
  VDBCONTROL.UPROC-OPT = "INQUIRY";
  try
    get H2-2-DCC-SPT
      with #sql{
        select T2.NOMADS_USRID
        from twnivd_caseld_case T1,
             twnsup_unt_pos_hst T2
         --** INSERT WHERE, GROUP BY AND HAVING CLAUSES HERE **
        WHERE T1.UPI = :UPI
          AND T1.CASE_SUFX = :CASE-SUFX
          AND T1.OFC_CD = T2.OFC_CD
          AND T1.PRGM_OFC_TYPE = T2.PRGM_OFC_TYPE
          AND T1.SPRVS_UNIT = T2.SPRVS_UNIT
          AND T1.PSN_NMB    = T2.PSN_NMB
          AND T1.CASELD_IND = 'N'
         --WI 29007
          AND CURRENT DATE BETWEEN T2.ASMNT_BEG_DT AND T2.ASMNT_END_DT
         --AND T2.ASMNT_BEG_DT BETWEEN '0001-01-01' AND :H-TCONID.CRTD-DT
         --AND T2.ASMNT_END_DT BETWEEN :H-TCONID.CRTD-DT AND '9999-12-31'
         --** INSERT ORDER BY CLAUSE HERE **
      }
      into NOMADS-USRID ;
  end
  VDBCOMMON.UNRF = "Y";
  VDBCOMMON.UDUP = "N";
  /* Perform DBM error processing*/
  WDB00PE-SQLERR();
end // end TCONIDP2


// INQURY Message Text Data
Function TCONIDQ1()
  /* -----------------------------------------------------------*/
  /* Change History*/
  /* ==============*/
  /* DATE        NAME        DESCRIPTION*/
  /* ----        -----       ----------*/
  /* 28 Dec 1994   TBST155      CREATION*/
  /* -----------------------------------------------------------*/
  /* CBSI START*/
  /*  */
  /* Move name of SQL row record used to common record*/
  VDBCOMMON.USQLREC = "H2-IVD-CONTACTS";
  VDBCONTROL.UPROC-OBJ = "H2-IVD-CONTACTS";
  VDBCONTROL.UPROC-NM = "TCONIDQ1";
  VDBCONTROL.UPROC-OPT = "INSERT";
  /*  */
  /* CALL DATEAPP GDW,VDBCONTROL,VMESSAGE (NOMAPS;*/
  try
    add H2-IVD-CONTACTS
      with #sql{
        insert into TWNIVD_CONTACTS
        (UPI, CASE_SUFX, CRTD_TS, CASE_FUNC_AREA, CNTCT_TYPE, CNTCT_SRC,
            CASE_SPCFC_IND, WRKR_ID, CNTCT_TXT)
        values (:UPI, :CASE-SUFX, :CRTD-TS, :CASE-FUNC-AREA, :CNTCT-TYPE,
            :CNTCT-SRC, :CASE-SPCFC-IND, :WRKR-ID, :CNTCT-TXT)
      } ;
  end
  /*  */
  /* Increment count of rows retrieved*/
  if (sysVar.sqlData.sqlcode == 0)
    VDBCONTROL.UROWW = VDBCONTROL.UROWW + 1;
  end
  /* CBSI END*/
end // end TCONIDQ1


